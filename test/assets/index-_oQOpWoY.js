(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const vi=!1;var Ii=Array.isArray,tl=Array.prototype.indexOf,Fr=Array.prototype.includes,$n=Array.from,sl=Object.defineProperty,Rr=Object.getOwnPropertyDescriptor,rl=Object.getOwnPropertyDescriptors,nl=Object.prototype,il=Array.prototype,xa=Object.getPrototypeOf,na=Object.isExtensible;function al(s){for(var e=0;e<s.length;e++)s[e]()}function Pa(){var s,e,t=new Promise((r,n)=>{s=r,e=n});return{promise:t,resolve:s,reject:e}}function ol(s,e){if(Array.isArray(s))return s;if(!(Symbol.iterator in s))return Array.from(s);const t=[];for(const r of s)if(t.push(r),t.length===e)break;return t}const It=2,In=4,gn=8,qa=1<<24,Ys=16,qs=32,Pr=64,Ti=128,ms=512,kt=1024,Tt=2048,Ps=4096,os=8192,Ws=16384,Li=32768,Br=65536,ia=1<<17,Aa=1<<18,Yr=1<<19,Ma=1<<20,Us=1<<25,xr=32768,pi=1<<21,Di=1<<22,ir=1<<23,Sr=Symbol("$state"),ll=Symbol("legacy props"),cl=Symbol(""),Dr=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Ia(s){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function ul(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function fl(s,e,t){throw new Error("https://svelte.dev/e/each_key_duplicate")}function hl(s){throw new Error("https://svelte.dev/e/effect_in_teardown")}function dl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function vl(s){throw new Error("https://svelte.dev/e/effect_orphan")}function pl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function gl(s){throw new Error("https://svelte.dev/e/props_invalid_value")}function ml(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function _l(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function bl(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function wl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const yl=1,kl=2,Ta=4,Sl=8,El=16,Cl=1,xl=4,Pl=8,ql=16,Al=1,Ml=2,Mt=Symbol(),Il="http://www.w3.org/1999/xhtml";function Tl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function Ll(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function La(s){return s===this.v}function Dl(s,e){return s!=s?e==e:s!==e||s!==null&&typeof s=="object"||typeof s=="function"}function Da(s){return!Dl(s,this.v)}let Ol=!1,Xt=null;function Ur(s){Xt=s}function Os(s,e=!1,t){Xt={p:Xt,i:!1,c:null,e:null,s,x:null,l:null}}function Rs(s){var e=Xt,t=e.e;if(t!==null){e.e=null;for(var r of t)to(r)}return e.i=!0,Xt=e.p,{}}function Oa(){return!0}let mr=[];function Ra(){var s=mr;mr=[],al(s)}function Ks(s){if(mr.length===0&&!an){var e=mr;queueMicrotask(()=>{e===mr&&Ra()})}mr.push(s)}function Rl(){for(;mr.length>0;)Ra()}function Na(s){var e=Le;if(e===null)return ke.f|=ir,s;if((e.f&Li)===0){if((e.f&Ti)===0)throw s;e.b.error(s)}else Gr(s,e)}function Gr(s,e){for(;e!==null;){if((e.f&Ti)!==0)try{e.b.error(s);return}catch(t){s=t}e=e.parent}throw s}const Nl=-7169;function it(s,e){s.f=s.f&Nl|e}function Oi(s){(s.f&ms)!==0||s.deps===null?it(s,kt):it(s,Ps)}function $a(s){if(s!==null)for(const e of s)(e.f&It)===0||(e.f&xr)===0||(e.f^=xr,$a(e.deps))}function Fa(s,e,t){(s.f&Tt)!==0?e.add(s):(s.f&Ps)!==0&&t.add(s),$a(s.deps),it(s,kt)}const kn=new Set;let Te=null,gi=null,Ss=null,Vt=[],Fn=null,mi=!1,an=!1;class ar{committed=!1;current=new Map;previous=new Map;#e=new Set;#s=new Set;#t=0;#a=0;#n=null;#r=new Set;#i=new Set;#o=new Map;is_fork=!1;#l=!1;is_deferred(){return this.is_fork||this.#a>0}skip_effect(e){this.#o.has(e)||this.#o.set(e,{d:[],m:[]})}unskip_effect(e){var t=this.#o.get(e);if(t){this.#o.delete(e);for(var r of t.d)it(r,Tt),Cs(r);for(r of t.m)it(r,Ps),Cs(r)}}process(e){Vt=[],this.apply();var t=[],r=[];for(const n of e)this.#c(n,t,r);if(this.is_deferred()){this.#u(r),this.#u(t);for(const[n,i]of this.#o)Wa(n,i)}else{for(const n of this.#e)n();this.#e.clear(),this.#t===0&&this.#f(),gi=this,Te=null,aa(r),aa(t),gi=null,this.#n?.resolve()}Ss=null}#c(e,t,r){e.f^=kt;for(var n=e.first,i=null;n!==null;){var o=n.f,l=(o&(qs|Pr))!==0,c=l&&(o&kt)!==0,u=c||(o&os)!==0||this.#o.has(n);if(!u&&n.fn!==null){l?n.f^=kt:i!==null&&(o&(In|gn|qa))!==0?i.b.defer_effect(n):(o&In)!==0?t.push(n):_n(n)&&((o&Ys)!==0&&this.#i.add(n),ln(n));var d=n.first;if(d!==null){n=d;continue}}var g=n.parent;for(n=n.next;n===null&&g!==null;)g===i&&(i=null),n=g.next,g=g.parent}}#u(e){for(var t=0;t<e.length;t+=1)Fa(e[t],this.#r,this.#i)}capture(e,t){t!==Mt&&!this.previous.has(e)&&this.previous.set(e,t),(e.f&ir)===0&&(this.current.set(e,e.v),Ss?.set(e,e.v))}activate(){Te=this,this.apply()}deactivate(){Te===this&&(Te=null,Ss=null)}flush(){if(this.activate(),Vt.length>0){if(Ba(),Te!==null&&Te!==this)return}else this.#t===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#s)e(this);this.#s.clear()}#f(){if(kn.size>1){this.previous.clear();var e=Ss,t=!0;for(const n of kn){if(n===this){t=!1;continue}const i=[];for(const[l,c]of this.current){if(n.current.has(l))if(t&&c!==n.current.get(l))n.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...n.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Vt;Vt=[];const l=new Set,c=new Map;for(const u of i)Ua(u,o,l,c);if(Vt.length>0){Te=n,n.apply();for(const u of Vt)n.#c(u,[],[]);n.deactivate()}Vt=r}}Te=null,Ss=e}this.committed=!0,kn.delete(this)}increment(e){this.#t+=1,e&&(this.#a+=1)}decrement(e){this.#t-=1,e&&(this.#a-=1),!this.#l&&(this.#l=!0,Ks(()=>{this.#l=!1,this.is_deferred()?Vt.length>0&&this.flush():this.revive()}))}revive(){for(const e of this.#r)this.#i.delete(e),it(e,Tt),Cs(e);for(const e of this.#i)it(e,Ps),Cs(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#s.add(e)}settled(){return(this.#n??=Pa()).promise}static ensure(){if(Te===null){const e=Te=new ar;kn.add(Te),an||Ks(()=>{Te===e&&e.flush()})}return Te}apply(){}}function $l(s){var e=an;an=!0;try{for(var t;;){if(Rl(),Vt.length===0&&(Te?.flush(),Vt.length===0))return Fn=null,t;Ba()}}finally{an=e}}function Ba(){mi=!0;var s=null;try{for(var e=0;Vt.length>0;){var t=ar.ensure();if(e++>1e3){var r,n;Fl()}t.process(Vt),or.clear()}}finally{Vt=[],mi=!1,Fn=null}}function Fl(){try{pl()}catch(s){Gr(s,Fn)}}let Fs=null;function aa(s){var e=s.length;if(e!==0){for(var t=0;t<e;){var r=s[t++];if((r.f&(Ws|os))===0&&_n(r)&&(Fs=new Set,ln(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?no(r):r.fn=null),Fs?.size>0)){or.clear();for(const n of Fs){if((n.f&(Ws|os))!==0)continue;const i=[n];let o=n.parent;for(;o!==null;)Fs.has(o)&&(Fs.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const c=i[l];(c.f&(Ws|os))===0&&ln(c)}}Fs.clear()}}Fs=null}}function Ua(s,e,t,r){if(!t.has(s)&&(t.add(s),s.reactions!==null))for(const n of s.reactions){const i=n.f;(i&It)!==0?Ua(n,e,t,r):(i&(Di|Ys))!==0&&(i&Tt)===0&&Ga(n,e,r)&&(it(n,Tt),Cs(n))}}function Ga(s,e,t){const r=t.get(s);if(r!==void 0)return r;if(s.deps!==null)for(const n of s.deps){if(Fr.call(e,n))return!0;if((n.f&It)!==0&&Ga(n,e,t))return t.set(n,!0),!0}return t.set(s,!1),!1}function Cs(s){for(var e=Fn=s;e.parent!==null;){e=e.parent;var t=e.f;if(mi&&e===Le&&(t&Ys)!==0&&(t&Aa)===0)return;if((t&(Pr|qs))!==0){if((t&kt)===0)return;e.f^=kt}}Vt.push(e)}function Wa(s,e){if(!((s.f&qs)!==0&&(s.f&kt)!==0)){(s.f&Tt)!==0?e.d.push(s):(s.f&Ps)!==0&&e.m.push(s),it(s,kt);for(var t=s.first;t!==null;)Wa(t,e),t=t.next}}function Bl(s){let e=0,t=cr(0),r;return()=>{Ni()&&(a(t),Gn(()=>(e===0&&(r=hr(()=>s(()=>Ts(t)))),e+=1,()=>{Ks(()=>{e-=1,e===0&&(r?.(),r=void 0,Ts(t))})})))}}var Ul=Br|Yr|Ti;function Gl(s,e,t){new Wl(s,e,t)}class Wl{parent;is_pending=!1;#e;#s=null;#t;#a;#n;#r=null;#i=null;#o=null;#l=null;#c=null;#u=0;#f=0;#v=!1;#d=!1;#p=new Set;#g=new Set;#h=null;#y=Bl(()=>(this.#h=cr(this.#u),()=>{this.#h=null}));constructor(e,t,r){this.#e=e,this.#t=t,this.#a=r,this.parent=Le.b,this.is_pending=!!this.#t.pending,this.#n=Fi(()=>{Le.b=this;{var n=this.#b();try{this.#r=vs(()=>r(n))}catch(i){this.error(i)}this.#f>0?this.#_():this.is_pending=!1}return()=>{this.#c?.remove()}},Ul)}#k(){try{this.#r=vs(()=>this.#a(this.#e))}catch(e){this.error(e)}}#S(){const e=this.#t.pending;e&&(this.#i=vs(()=>e(this.#e)),Ks(()=>{var t=this.#b();this.#r=this.#m(()=>(ar.ensure(),vs(()=>this.#a(t)))),this.#f>0?this.#_():(Er(this.#i,()=>{this.#i=null}),this.is_pending=!1)}))}#b(){var e=this.#e;return this.is_pending&&(this.#c=Hs(),this.#e.before(this.#c),e=this.#c),e}defer_effect(e){Fa(e,this.#p,this.#g)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#t.pending}#m(e){var t=Le,r=ke,n=Xt;Ds(this.#n),bs(this.#n),Ur(this.#n.ctx);try{return e()}catch(i){return Na(i),null}finally{Ds(t),bs(r),Ur(n)}}#_(){const e=this.#t.pending;this.#r!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),oo(this.#r,this.#l)),this.#i===null&&(this.#i=vs(()=>e(this.#e)))}#w(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#w(e);return}if(this.#f+=e,this.#f===0){this.is_pending=!1;for(const t of this.#p)it(t,Tt),Cs(t);for(const t of this.#g)it(t,Ps),Cs(t);this.#p.clear(),this.#g.clear(),this.#i&&Er(this.#i,()=>{this.#i=null}),this.#l&&(this.#e.before(this.#l),this.#l=null)}}update_pending_count(e){this.#w(e),this.#u+=e,!(!this.#h||this.#v)&&(this.#v=!0,Ks(()=>{this.#v=!1,this.#h&&Wr(this.#h,this.#u)}))}get_effect_pending(){return this.#y(),a(this.#h)}error(e){var t=this.#t.onerror;let r=this.#t.failed;if(this.#d||!t&&!r)throw e;this.#r&&(Qt(this.#r),this.#r=null),this.#i&&(Qt(this.#i),this.#i=null),this.#o&&(Qt(this.#o),this.#o=null);var n=!1,i=!1;const o=()=>{if(n){Ll();return}n=!0,i&&wl(),ar.ensure(),this.#u=0,this.#o!==null&&Er(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#r=this.#m(()=>(this.#d=!1,vs(()=>this.#a(this.#e)))),this.#f>0?this.#_():this.is_pending=!1};Ks(()=>{try{i=!0,t?.(e,o),i=!1}catch(l){Gr(l,this.#n&&this.#n.parent)}r&&(this.#o=this.#m(()=>{ar.ensure(),this.#d=!0;try{return vs(()=>{r(this.#e,()=>e,()=>o)})}catch(l){return Gr(l,this.#n.parent),null}finally{this.#d=!1}}))})}}function Kl(s,e,t,r){const n=Bn;var i=s.filter(h=>!h.settled);if(t.length===0&&i.length===0){r(e.map(n));return}var o=Te,l=Le,c=Hl(),u=i.length===1?i[0].promise:i.length>1?Promise.all(i.map(h=>h.promise)):null;function d(h){c();try{r(h)}catch(p){(l.f&Ws)===0&&Gr(p,l)}o?.deactivate(),_i()}if(t.length===0){u.then(()=>d(e.map(n)));return}function g(){c(),Promise.all(t.map(h=>zl(h))).then(h=>d([...e.map(n),...h])).catch(h=>Gr(h,l))}u?u.then(g):g()}function Hl(){var s=Le,e=ke,t=Xt,r=Te;return function(i=!0){Ds(s),bs(e),Ur(t),i&&r?.activate()}}function _i(){Ds(null),bs(null),Ur(null)}function Bn(s){var e=It|Tt,t=ke!==null&&(ke.f&It)!==0?ke:null;return Le!==null&&(Le.f|=Yr),{ctx:Xt,deps:null,effects:null,equals:La,f:e,fn:s,reactions:null,rv:0,v:Mt,wv:0,parent:t??Le,ac:null}}function zl(s,e,t){let r=Le;r===null&&ul();var n=r.b,i=void 0,o=cr(Mt),l=!ke,c=new Map;return ic(()=>{var u=Pa();i=u.promise;try{Promise.resolve(s()).then(u.resolve,u.reject).then(()=>{d===Te&&d.committed&&d.deactivate(),_i()})}catch(p){u.reject(p),_i()}var d=Te;if(l){var g=n.is_rendered();n.update_pending_count(1),d.increment(g),c.get(d)?.reject(Dr),c.delete(d),c.set(d,u)}const h=(p,E=void 0)=>{if(d.activate(),E)E!==Dr&&(o.f|=ir,Wr(o,E));else{(o.f&ir)!==0&&(o.f^=ir),Wr(o,p);for(const[q,C]of c){if(c.delete(q),q===d)break;C.reject(Dr)}}l&&(n.update_pending_count(-1),d.decrement(g))};u.promise.then(h,p=>h(null,p||"unknown"))}),$i(()=>{for(const u of c.values())u.reject(Dr)}),new Promise(u=>{function d(g){function h(){g===i?u(o):d(i)}g.then(h,h)}d(i)})}function fe(s){const e=Bn(s);return lo(e),e}function Ka(s){const e=Bn(s);return e.equals=Da,e}function Ha(s){var e=s.effects;if(e!==null){s.effects=null;for(var t=0;t<e.length;t+=1)Qt(e[t])}}function Vl(s){for(var e=s.parent;e!==null;){if((e.f&It)===0)return(e.f&Ws)===0?e:null;e=e.parent}return null}function Ri(s){var e,t=Le;Ds(Vl(s));try{s.f&=~xr,Ha(s),e=ho(s)}finally{Ds(t)}return e}function za(s){var e=Ri(s);if(!s.equals(e)&&(s.wv=uo(),(!Te?.is_fork||s.deps===null)&&(s.v=e,s.deps===null))){it(s,kt);return}ur||(Ss!==null?(Ni()||Te?.is_fork)&&Ss.set(s,e):Oi(s))}let bi=new Set;const or=new Map;let Va=!1;function cr(s,e){var t={f:0,v:s,reactions:null,equals:La,rv:0,wv:0};return t}function L(s,e){const t=cr(s);return lo(t),t}function jl(s,e=!1,t=!0){const r=cr(s);return e||(r.equals=Da),r}function f(s,e,t=!1){ke!==null&&(!xs||(ke.f&ia)!==0)&&Oa()&&(ke.f&(It|Ys|Di|ia))!==0&&(_s===null||!Fr.call(_s,s))&&bl();let r=t?ht(e):e;return Wr(s,r)}function Wr(s,e){if(!s.equals(e)){var t=s.v;ur?or.set(s,e):or.set(s,t),s.v=e;var r=ar.ensure();if(r.capture(s,t),(s.f&It)!==0){const n=s;(s.f&Tt)!==0&&Ri(n),Oi(n)}s.wv=uo(),ja(s,Tt),Le!==null&&(Le.f&kt)!==0&&(Le.f&(qs|Pr))===0&&(hs===null?lc([s]):hs.push(s)),!r.is_fork&&bi.size>0&&!Va&&Yl()}return e}function Yl(){Va=!1;for(const s of bi)(s.f&kt)!==0&&it(s,Ps),_n(s)&&ln(s);bi.clear()}function Ql(s,e=1){var t=a(s),r=e===1?t++:t--;return f(s,t),r}function Ts(s){f(s,s.v+1)}function ja(s,e){var t=s.reactions;if(t!==null)for(var r=t.length,n=0;n<r;n++){var i=t[n],o=i.f,l=(o&Tt)===0;if(l&&it(i,e),(o&It)!==0){var c=i;Ss?.delete(c),(o&xr)===0&&(o&ms&&(i.f|=xr),ja(c,Ps))}else l&&((o&Ys)!==0&&Fs!==null&&Fs.add(i),Cs(i))}}function ht(s){if(typeof s!="object"||s===null||Sr in s)return s;const e=xa(s);if(e!==nl&&e!==il)return s;var t=new Map,r=Ii(s),n=L(0),i=zs,o=l=>{if(zs===i)return l();var c=ke,u=zs;bs(null),ua(i);var d=l();return bs(c),ua(u),d};return r&&t.set("length",L(s.length)),new Proxy(s,{defineProperty(l,c,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&ml();var d=t.get(c);return d===void 0?d=o(()=>{var g=L(u.value);return t.set(c,g),g}):f(d,u.value,!0),!0},deleteProperty(l,c){var u=t.get(c);if(u===void 0){if(c in l){const d=o(()=>L(Mt));t.set(c,d),Ts(n)}}else f(u,Mt),Ts(n);return!0},get(l,c,u){if(c===Sr)return s;var d=t.get(c),g=c in l;if(d===void 0&&(!g||Rr(l,c)?.writable)&&(d=o(()=>{var p=ht(g?l[c]:Mt),E=L(p);return E}),t.set(c,d)),d!==void 0){var h=a(d);return h===Mt?void 0:h}return Reflect.get(l,c,u)},getOwnPropertyDescriptor(l,c){var u=Reflect.getOwnPropertyDescriptor(l,c);if(u&&"value"in u){var d=t.get(c);d&&(u.value=a(d))}else if(u===void 0){var g=t.get(c),h=g?.v;if(g!==void 0&&h!==Mt)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return u},has(l,c){if(c===Sr)return!0;var u=t.get(c),d=u!==void 0&&u.v!==Mt||Reflect.has(l,c);if(u!==void 0||Le!==null&&(!d||Rr(l,c)?.writable)){u===void 0&&(u=o(()=>{var h=d?ht(l[c]):Mt,p=L(h);return p}),t.set(c,u));var g=a(u);if(g===Mt)return!1}return d},set(l,c,u,d){var g=t.get(c),h=c in l;if(r&&c==="length")for(var p=u;p<g.v;p+=1){var E=t.get(p+"");E!==void 0?f(E,Mt):p in l&&(E=o(()=>L(Mt)),t.set(p+"",E))}if(g===void 0)(!h||Rr(l,c)?.writable)&&(g=o(()=>L(void 0)),f(g,ht(u)),t.set(c,g));else{h=g.v!==Mt;var q=o(()=>ht(u));f(g,q)}var C=Reflect.getOwnPropertyDescriptor(l,c);if(C?.set&&C.set.call(d,u),!h){if(r&&typeof c=="string"){var U=t.get("length"),x=Number(c);Number.isInteger(x)&&x>=U.v&&f(U,x+1)}Ts(n)}return!0},ownKeys(l){a(n);var c=Reflect.ownKeys(l).filter(g=>{var h=t.get(g);return h===void 0||h.v!==Mt});for(var[u,d]of t)d.v!==Mt&&!(u in l)&&c.push(u);return c},setPrototypeOf(){_l()}})}function oa(s){try{if(s!==null&&typeof s=="object"&&Sr in s)return s[Sr]}catch{}return s}function Xl(s,e){return Object.is(oa(s),oa(e))}var on,Ya,Qa,Xa;function Zl(){if(on===void 0){on=window,Ya=/Firefox/.test(navigator.userAgent);var s=Element.prototype,e=Node.prototype,t=Text.prototype;Qa=Rr(e,"firstChild").get,Xa=Rr(e,"nextSibling").get,na(s)&&(s.__click=void 0,s.__className=void 0,s.__attributes=null,s.__style=void 0,s.__e=void 0),na(t)&&(t.__t=void 0)}}function Hs(s=""){return document.createTextNode(s)}function Tn(s){return Qa.call(s)}function mn(s){return Xa.call(s)}function y(s,e){return Tn(s)}function tt(s,e=!1){{var t=Tn(s);return t instanceof Comment&&t.data===""?mn(t):t}}function S(s,e=1,t=!1){let r=s;for(;e--;)r=mn(r);return r}function Jl(s){s.textContent=""}function Za(){return!1}let la=!1;function ec(){la||(la=!0,document.addEventListener("reset",s=>{Promise.resolve().then(()=>{if(!s.defaultPrevented)for(const e of s.target.elements)e.__on_r?.()})},{capture:!0}))}function Un(s){var e=ke,t=Le;bs(null),Ds(null);try{return s()}finally{bs(e),Ds(t)}}function Ja(s,e,t,r=t){s.addEventListener(e,()=>Un(t));const n=s.__on_r;n?s.__on_r=()=>{n(),r(!0)}:s.__on_r=()=>r(!0),ec()}function eo(s){Le===null&&(ke===null&&vl(),dl()),ur&&hl()}function tc(s,e){var t=e.last;t===null?e.last=e.first=s:(t.next=s,s.prev=t,e.last=s)}function Ns(s,e,t){var r=Le;r!==null&&(r.f&os)!==0&&(s|=os);var n={ctx:Xt,deps:null,nodes:null,f:s|Tt|ms,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{ln(n),n.f|=Li}catch(l){throw Qt(n),l}else e!==null&&Cs(n);var i=n;if(t&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Yr)===0&&(i=i.first,(s&Ys)!==0&&(s&Br)!==0&&i!==null&&(i.f|=Br)),i!==null&&(i.parent=r,r!==null&&tc(i,r),ke!==null&&(ke.f&It)!==0&&(s&Pr)===0)){var o=ke;(o.effects??=[]).push(i)}return n}function Ni(){return ke!==null&&!xs}function $i(s){const e=Ns(gn,null,!1);return it(e,kt),e.teardown=s,e}function ft(s){eo();var e=Le.f,t=!ke&&(e&qs)!==0&&(e&Li)===0;if(t){var r=Xt;(r.e??=[]).push(s)}else return to(s)}function to(s){return Ns(In|Ma,s,!1)}function sc(s){return eo(),Ns(gn|Ma,s,!0)}function rc(s){ar.ensure();const e=Ns(Pr|Yr,s,!0);return(t={})=>new Promise(r=>{t.outro?Er(e,()=>{Qt(e),r(void 0)}):(Qt(e),r(void 0))})}function nc(s){return Ns(In,s,!1)}function ic(s){return Ns(Di|Yr,s,!0)}function Gn(s,e=0){return Ns(gn|e,s,!0)}function Q(s,e=[],t=[],r=[]){Kl(r,e,t,n=>{Ns(gn,()=>s(...n.map(a)),!0)})}function Fi(s,e=0){var t=Ns(Ys|e,s,!0);return t}function vs(s){return Ns(qs|Yr,s,!0)}function so(s){var e=s.teardown;if(e!==null){const t=ur,r=ke;ca(!0),bs(null);try{e.call(null)}finally{ca(t),bs(r)}}}function ro(s,e=!1){var t=s.first;for(s.first=s.last=null;t!==null;){const n=t.ac;n!==null&&Un(()=>{n.abort(Dr)});var r=t.next;(t.f&Pr)!==0?t.parent=null:Qt(t,e),t=r}}function ac(s){for(var e=s.first;e!==null;){var t=e.next;(e.f&qs)===0&&Qt(e),e=t}}function Qt(s,e=!0){var t=!1;(e||(s.f&Aa)!==0)&&s.nodes!==null&&s.nodes.end!==null&&(oc(s.nodes.start,s.nodes.end),t=!0),ro(s,e&&!t),Ln(s,0),it(s,Ws);var r=s.nodes&&s.nodes.t;if(r!==null)for(const i of r)i.stop();so(s);var n=s.parent;n!==null&&n.first!==null&&no(s),s.next=s.prev=s.teardown=s.ctx=s.deps=s.fn=s.nodes=s.ac=null}function oc(s,e){for(;s!==null;){var t=s===e?null:mn(s);s.remove(),s=t}}function no(s){var e=s.parent,t=s.prev,r=s.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===s&&(e.first=r),e.last===s&&(e.last=t))}function Er(s,e,t=!0){var r=[];io(s,r,!0);var n=()=>{t&&Qt(s),e&&e()},i=r.length;if(i>0){var o=()=>--i||n();for(var l of r)l.out(o)}else n()}function io(s,e,t){if((s.f&os)===0){s.f^=os;var r=s.nodes&&s.nodes.t;if(r!==null)for(const l of r)(l.is_global||t)&&e.push(l);for(var n=s.first;n!==null;){var i=n.next,o=(n.f&Br)!==0||(n.f&qs)!==0&&(s.f&Ys)!==0;io(n,e,o?t:!1),n=i}}}function Bi(s){ao(s,!0)}function ao(s,e){if((s.f&os)!==0){s.f^=os,(s.f&kt)===0&&(it(s,Tt),Cs(s));for(var t=s.first;t!==null;){var r=t.next,n=(t.f&Br)!==0||(t.f&qs)!==0;ao(t,n?e:!1),t=r}var i=s.nodes&&s.nodes.t;if(i!==null)for(const o of i)(o.is_global||e)&&o.in()}}function oo(s,e){if(s.nodes)for(var t=s.nodes.start,r=s.nodes.end;t!==null;){var n=t===r?null:mn(t);e.append(t),t=n}}let Pn=!1,ur=!1;function ca(s){ur=s}let ke=null,xs=!1;function bs(s){ke=s}let Le=null;function Ds(s){Le=s}let _s=null;function lo(s){ke!==null&&(_s===null?_s=[s]:_s.push(s))}let jt=null,ns=0,hs=null;function lc(s){hs=s}let co=1,_r=0,zs=_r;function ua(s){zs=s}function uo(){return++co}function _n(s){var e=s.f;if((e&Tt)!==0)return!0;if(e&It&&(s.f&=~xr),(e&Ps)!==0){for(var t=s.deps,r=t.length,n=0;n<r;n++){var i=t[n];if(_n(i)&&za(i),i.wv>s.wv)return!0}(e&ms)!==0&&Ss===null&&it(s,kt)}return!1}function fo(s,e,t=!0){var r=s.reactions;if(r!==null&&!(_s!==null&&Fr.call(_s,s)))for(var n=0;n<r.length;n++){var i=r[n];(i.f&It)!==0?fo(i,e,!1):e===i&&(t?it(i,Tt):(i.f&kt)!==0&&it(i,Ps),Cs(i))}}function ho(s){var e=jt,t=ns,r=hs,n=ke,i=_s,o=Xt,l=xs,c=zs,u=s.f;jt=null,ns=0,hs=null,ke=(u&(qs|Pr))===0?s:null,_s=null,Ur(s.ctx),xs=!1,zs=++_r,s.ac!==null&&(Un(()=>{s.ac.abort(Dr)}),s.ac=null);try{s.f|=pi;var d=s.fn,g=d(),h=s.deps,p=Te?.is_fork;if(jt!==null){var E;if(p||Ln(s,ns),h!==null&&ns>0)for(h.length=ns+jt.length,E=0;E<jt.length;E++)h[ns+E]=jt[E];else s.deps=h=jt;if(Ni()&&(s.f&ms)!==0)for(E=ns;E<h.length;E++)(h[E].reactions??=[]).push(s)}else!p&&h!==null&&ns<h.length&&(Ln(s,ns),h.length=ns);if(Oa()&&hs!==null&&!xs&&h!==null&&(s.f&(It|Ps|Tt))===0)for(E=0;E<hs.length;E++)fo(hs[E],s);if(n!==null&&n!==s){if(_r++,n.deps!==null)for(let q=0;q<t;q+=1)n.deps[q].rv=_r;if(e!==null)for(const q of e)q.rv=_r;hs!==null&&(r===null?r=hs:r.push(...hs))}return(s.f&ir)!==0&&(s.f^=ir),g}catch(q){return Na(q)}finally{s.f^=pi,jt=e,ns=t,hs=r,ke=n,_s=i,Ur(o),xs=l,zs=c}}function cc(s,e){let t=e.reactions;if(t!==null){var r=tl.call(t,s);if(r!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[r]=t[n],t.pop())}}if(t===null&&(e.f&It)!==0&&(jt===null||!Fr.call(jt,e))){var i=e;(i.f&ms)!==0&&(i.f^=ms,i.f&=~xr),Oi(i),Ha(i),Ln(i,0)}}function Ln(s,e){var t=s.deps;if(t!==null)for(var r=e;r<t.length;r++)cc(s,t[r])}function ln(s){var e=s.f;if((e&Ws)===0){it(s,kt);var t=Le,r=Pn;Le=s,Pn=!0;try{(e&(Ys|qa))!==0?ac(s):ro(s),so(s);var n=ho(s);s.teardown=typeof n=="function"?n:null,s.wv=co;var i;vi&&Ol&&(s.f&Tt)!==0&&s.deps}finally{Pn=r,Le=t}}}async function vo(){await Promise.resolve(),$l()}function a(s){var e=s.f,t=(e&It)!==0;if(ke!==null&&!xs){var r=Le!==null&&(Le.f&Ws)!==0;if(!r&&(_s===null||!Fr.call(_s,s))){var n=ke.deps;if((ke.f&pi)!==0)s.rv<_r&&(s.rv=_r,jt===null&&n!==null&&n[ns]===s?ns++:jt===null?jt=[s]:jt.push(s));else{(ke.deps??=[]).push(s);var i=s.reactions;i===null?s.reactions=[ke]:Fr.call(i,ke)||i.push(ke)}}}if(ur&&or.has(s))return or.get(s);if(t){var o=s;if(ur){var l=o.v;return((o.f&kt)===0&&o.reactions!==null||go(o))&&(l=Ri(o)),or.set(o,l),l}var c=(o.f&ms)===0&&!xs&&ke!==null&&(Pn||(ke.f&ms)!==0),u=o.deps===null;_n(o)&&(c&&(o.f|=ms),za(o)),c&&!u&&po(o)}if(Ss?.has(s))return Ss.get(s);if((s.f&ir)!==0)throw s.v;return s.v}function po(s){if(s.deps!==null){s.f|=ms;for(const e of s.deps)(e.reactions??=[]).push(s),(e.f&It)!==0&&(e.f&ms)===0&&po(e)}}function go(s){if(s.v===Mt)return!0;if(s.deps===null)return!1;for(const e of s.deps)if(or.has(e)||(e.f&It)!==0&&go(e))return!0;return!1}function hr(s){var e=xs;try{return xs=!0,s()}finally{xs=e}}const uc=["touchstart","touchmove"];function fc(s){return uc.includes(s)}const mo=new Set,wi=new Set;function hc(s,e,t,r={}){function n(i){if(r.capture||tn.call(e,i),!i.cancelBubble)return Un(()=>t?.call(this,i))}return s.startsWith("pointer")||s.startsWith("touch")||s==="wheel"?Ks(()=>{e.addEventListener(s,n,r)}):e.addEventListener(s,n,r),n}function Vs(s,e,t,r,n){var i={capture:r,passive:n},o=hc(s,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&$i(()=>{e.removeEventListener(s,o,i)})}function bn(s){for(var e=0;e<s.length;e++)mo.add(s[e]);for(var t of wi)t(s)}let fa=null;function tn(s){var e=this,t=e.ownerDocument,r=s.type,n=s.composedPath?.()||[],i=n[0]||s.target;fa=s;var o=0,l=fa===s&&s.__root;if(l){var c=n.indexOf(l);if(c!==-1&&(e===document||e===window)){s.__root=e;return}var u=n.indexOf(e);if(u===-1)return;c<=u&&(o=c)}if(i=n[o]||s.target,i!==e){sl(s,"currentTarget",{configurable:!0,get(){return i||t}});var d=ke,g=Le;bs(null),Ds(null);try{for(var h,p=[];i!==null;){var E=i.assignedSlot||i.parentNode||i.host||null;try{var q=i["__"+r];q!=null&&(!i.disabled||s.target===i)&&q.call(i,s)}catch(C){h?p.push(C):h=C}if(s.cancelBubble||E===e||E===null)break;i=E}if(h){for(let C of p)queueMicrotask(()=>{throw C});throw h}}finally{s.__root=e,delete s.currentTarget,bs(d),Ds(g)}}}function dc(s){var e=document.createElement("template");return e.innerHTML=s.replaceAll("<!>","<!---->"),e.content}function Dn(s,e){var t=Le;t.nodes===null&&(t.nodes={start:s,end:e,a:null,t:null})}function $(s,e){var t=(e&Al)!==0,r=(e&Ml)!==0,n,i=!s.startsWith("<!>");return()=>{n===void 0&&(n=dc(i?s:"<!>"+s),t||(n=Tn(n)));var o=r||Ya?document.importNode(n,!0):n.cloneNode(!0);if(t){var l=Tn(o),c=o.lastChild;Dn(l,c)}else Dn(o,o);return o}}function fr(s=""){{var e=Hs(s+"");return Dn(e,e),e}}function js(){var s=document.createDocumentFragment(),e=document.createComment(""),t=Hs();return s.append(e,t),Dn(e,t),s}function I(s,e){s!==null&&s.before(e)}function R(s,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(s.__t??=s.nodeValue)&&(s.__t=t,s.nodeValue=t+"")}function vc(s,e){return pc(s,e)}const Ir=new Map;function pc(s,{target:e,anchor:t,props:r={},events:n,context:i,intro:o=!0}){Zl();var l=new Set,c=g=>{for(var h=0;h<g.length;h++){var p=g[h];if(!l.has(p)){l.add(p);var E=fc(p);e.addEventListener(p,tn,{passive:E});var q=Ir.get(p);q===void 0?(document.addEventListener(p,tn,{passive:E}),Ir.set(p,1)):Ir.set(p,q+1)}}};c($n(mo)),wi.add(c);var u=void 0,d=rc(()=>{var g=t??e.appendChild(Hs());return Gl(g,{pending:()=>{}},h=>{Os({});var p=Xt;i&&(p.c=i),n&&(r.$$events=n),u=s(h,r)||{},Rs()}),()=>{for(var h of l){e.removeEventListener(h,tn);var p=Ir.get(h);--p===0?(document.removeEventListener(h,tn),Ir.delete(h)):Ir.set(h,p)}wi.delete(c),g!==t&&g.parentNode?.removeChild(g)}});return gc.set(u,d),u}let gc=new WeakMap;class mc{anchor;#e=new Map;#s=new Map;#t=new Map;#a=new Set;#n=!0;constructor(e,t=!0){this.anchor=e,this.#n=t}#r=()=>{var e=Te;if(this.#e.has(e)){var t=this.#e.get(e),r=this.#s.get(t);if(r)Bi(r),this.#a.delete(t);else{var n=this.#t.get(t);n&&(this.#s.set(t,n.effect),this.#t.delete(t),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),r=n.effect)}for(const[i,o]of this.#e){if(this.#e.delete(i),i===e)break;const l=this.#t.get(o);l&&(Qt(l.effect),this.#t.delete(o))}for(const[i,o]of this.#s){if(i===t||this.#a.has(i))continue;const l=()=>{if(Array.from(this.#e.values()).includes(i)){var u=document.createDocumentFragment();oo(o,u),u.append(Hs()),this.#t.set(i,{effect:o,fragment:u})}else Qt(o);this.#a.delete(i),this.#s.delete(i)};this.#n||!r?(this.#a.add(i),Er(o,l,!1)):l()}}};#i=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[r,n]of this.#t)t.includes(r)||(Qt(n.effect),this.#t.delete(r))};ensure(e,t){var r=Te,n=Za();if(t&&!this.#s.has(e)&&!this.#t.has(e))if(n){var i=document.createDocumentFragment(),o=Hs();i.append(o),this.#t.set(e,{effect:vs(()=>t(o)),fragment:i})}else this.#s.set(e,vs(()=>t(this.anchor)));if(this.#e.set(r,e),n){for(const[l,c]of this.#s)l===e?r.unskip_effect(c):r.skip_effect(c);for(const[l,c]of this.#t)l===e?r.unskip_effect(c.effect):r.skip_effect(c.effect);r.oncommit(this.#r),r.ondiscard(this.#i)}else this.#r()}}function ye(s,e,t=!1){var r=new mc(s),n=t?Br:0;function i(o,l){r.ensure(o,l)}Fi(()=>{var o=!1;e((l,c=!0)=>{o=!0,i(c,l)}),o||i(!1,null)},n)}function Ls(s,e){return e}function _c(s,e,t){for(var r=[],n=e.length,i,o=e.length,l=0;l<n;l++){let g=e[l];Er(g,()=>{if(i){if(i.pending.delete(g),i.done.add(g),i.pending.size===0){var h=s.outrogroups;yi($n(i.done)),h.delete(i),h.size===0&&(s.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=r.length===0&&t!==null;if(c){var u=t,d=u.parentNode;Jl(d),d.append(u),s.items.clear()}yi(e,!c)}else i={pending:new Set(e),done:new Set},(s.outrogroups??=new Set).add(i)}function yi(s,e=!0){for(var t=0;t<s.length;t++)Qt(s[t],e)}var ha;function Bt(s,e,t,r,n,i=null){var o=s,l=new Map,c=(e&Ta)!==0;if(c){var u=s;o=u.appendChild(Hs())}var d=null,g=Ka(()=>{var U=t();return Ii(U)?U:U==null?[]:$n(U)}),h,p=!0;function E(){C.fallback=d,bc(C,h,o,e,r),d!==null&&(h.length===0?(d.f&Us)===0?Bi(d):(d.f^=Us,sn(d,null,o)):Er(d,()=>{d=null}))}var q=Fi(()=>{h=a(g);for(var U=h.length,x=new Set,D=Te,M=Za(),z=0;z<U;z+=1){var Y=h[z],V=r(Y,z),W=p?null:l.get(V);W?(W.v&&Wr(W.v,Y),W.i&&Wr(W.i,z),M&&D.unskip_effect(W.e)):(W=wc(l,p?o:ha??=Hs(),Y,V,z,n,e,t),p||(W.e.f|=Us),l.set(V,W)),x.add(V)}if(U===0&&i&&!d&&(p?d=vs(()=>i(o)):(d=vs(()=>i(ha??=Hs())),d.f|=Us)),U>x.size&&fl(),!p)if(M){for(const[re,oe]of l)x.has(re)||D.skip_effect(oe.e);D.oncommit(E),D.ondiscard(()=>{})}else E();a(g)}),C={effect:q,items:l,outrogroups:null,fallback:d};p=!1}function Xr(s){for(;s!==null&&(s.f&qs)===0;)s=s.next;return s}function bc(s,e,t,r,n){var i=(r&Sl)!==0,o=e.length,l=s.items,c=Xr(s.effect.first),u,d=null,g,h=[],p=[],E,q,C,U;if(i)for(U=0;U<o;U+=1)E=e[U],q=n(E,U),C=l.get(q).e,(C.f&Us)===0&&(C.nodes?.a?.measure(),(g??=new Set).add(C));for(U=0;U<o;U+=1){if(E=e[U],q=n(E,U),C=l.get(q).e,s.outrogroups!==null)for(const oe of s.outrogroups)oe.pending.delete(C),oe.done.delete(C);if((C.f&Us)!==0)if(C.f^=Us,C===c)sn(C,null,t);else{var x=d?d.next:c;C===s.effect.last&&(s.effect.last=C.prev),C.prev&&(C.prev.next=C.next),C.next&&(C.next.prev=C.prev),er(s,d,C),er(s,C,x),sn(C,x,t),d=C,h=[],p=[],c=Xr(d.next);continue}if((C.f&os)!==0&&(Bi(C),i&&(C.nodes?.a?.unfix(),(g??=new Set).delete(C))),C!==c){if(u!==void 0&&u.has(C)){if(h.length<p.length){var D=p[0],M;d=D.prev;var z=h[0],Y=h[h.length-1];for(M=0;M<h.length;M+=1)sn(h[M],D,t);for(M=0;M<p.length;M+=1)u.delete(p[M]);er(s,z.prev,Y.next),er(s,d,z),er(s,Y,D),c=D,d=Y,U-=1,h=[],p=[]}else u.delete(C),sn(C,c,t),er(s,C.prev,C.next),er(s,C,d===null?s.effect.first:d.next),er(s,d,C),d=C;continue}for(h=[],p=[];c!==null&&c!==C;)(u??=new Set).add(c),p.push(c),c=Xr(c.next);if(c===null)continue}(C.f&Us)===0&&h.push(C),d=C,c=Xr(C.next)}if(s.outrogroups!==null){for(const oe of s.outrogroups)oe.pending.size===0&&(yi($n(oe.done)),s.outrogroups?.delete(oe));s.outrogroups.size===0&&(s.outrogroups=null)}if(c!==null||u!==void 0){var V=[];if(u!==void 0)for(C of u)(C.f&os)===0&&V.push(C);for(;c!==null;)(c.f&os)===0&&c!==s.fallback&&V.push(c),c=Xr(c.next);var W=V.length;if(W>0){var re=(r&Ta)!==0&&o===0?t:null;if(i){for(U=0;U<W;U+=1)V[U].nodes?.a?.measure();for(U=0;U<W;U+=1)V[U].nodes?.a?.fix()}_c(s,V,re)}}i&&Ks(()=>{if(g!==void 0)for(C of g)C.nodes?.a?.apply()})}function wc(s,e,t,r,n,i,o,l){var c=(o&yl)!==0?(o&El)===0?jl(t,!1,!1):cr(t):null,u=(o&kl)!==0?cr(n):null;return{v:c,i:u,e:vs(()=>(i(e,c??t,u??n,l),()=>{s.delete(r)}))}}function sn(s,e,t){if(s.nodes)for(var r=s.nodes.start,n=s.nodes.end,i=e&&(e.f&Us)===0?e.nodes.start:t;r!==null;){var o=mn(r);if(i.before(r),r===n)return;r=o}}function er(s,e,t){e===null?s.effect.first=t:e.next=t,t===null?s.effect.last=e:t.prev=e}const da=[...` 	
\r\fÂ \v\uFEFF`];function yc(s,e,t){var r=s==null?"":""+s;if(e&&(r=r?r+" "+e:e),t){for(var n in t)if(t[n])r=r?r+" "+n:n;else if(r.length)for(var i=n.length,o=0;(o=r.indexOf(n,o))>=0;){var l=o+i;(o===0||da.includes(r[o-1]))&&(l===r.length||da.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function va(s,e=!1){var t=e?" !important;":";",r="";for(var n in s){var i=s[n];i!=null&&i!==""&&(r+=" "+n+": "+i+t)}return r}function ei(s){return s[0]!=="-"||s[1]!=="-"?s.toLowerCase():s}function kc(s,e){if(e){var t="",r,n;if(Array.isArray(e)?(r=e[0],n=e[1]):r=e,s){s=String(s).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,o=0,l=!1,c=[];r&&c.push(...Object.keys(r).map(ei)),n&&c.push(...Object.keys(n).map(ei));var u=0,d=-1;const q=s.length;for(var g=0;g<q;g++){var h=s[g];if(l?h==="/"&&s[g-1]==="*"&&(l=!1):i?i===h&&(i=!1):h==="/"&&s[g+1]==="*"?l=!0:h==='"'||h==="'"?i=h:h==="("?o++:h===")"&&o--,!l&&i===!1&&o===0){if(h===":"&&d===-1)d=g;else if(h===";"||g===q-1){if(d!==-1){var p=ei(s.substring(u,d).trim());if(!c.includes(p)){h!==";"&&g++;var E=s.substring(u,g).trim();t+=" "+E+";"}}u=g+1,d=-1}}}}return r&&(t+=va(r)),n&&(t+=va(n,!0)),t=t.trim(),t===""?null:t}return s==null?null:String(s)}function we(s,e,t,r,n,i){var o=s.__className;if(o!==t||o===void 0){var l=yc(t,r,i);l==null?s.removeAttribute("class"):s.className=l,s.__className=t}else if(i&&n!==i)for(var c in i){var u=!!i[c];(n==null||u!==!!n[c])&&s.classList.toggle(c,u)}return i}function ti(s,e={},t,r){for(var n in t){var i=t[n];e[n]!==i&&(t[n]==null?s.style.removeProperty(n):s.style.setProperty(n,i,r))}}function gs(s,e,t,r){var n=s.__style;if(n!==e){var i=kc(e,r);i==null?s.removeAttribute("style"):s.style.cssText=i,s.__style=e}else r&&(Array.isArray(r)?(ti(s,t?.[0],r[0]),ti(s,t?.[1],r[1],"important")):ti(s,t,r));return r}function _o(s,e,t=!1){if(s.multiple){if(e==null)return;if(!Ii(e))return Tl();for(var r of s.options)r.selected=e.includes(pa(r));return}for(r of s.options){var n=pa(r);if(Xl(n,e)){r.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function Sc(s){var e=new MutationObserver(()=>{_o(s,s.__value)});e.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),$i(()=>{e.disconnect()})}function pa(s){return"__value"in s?s.__value:s.value}const Ec=Symbol("is custom element"),Cc=Symbol("is html");function On(s,e,t,r){var n=xc(s);n[e]!==(n[e]=t)&&(e==="loading"&&(s[cl]=t),t==null?s.removeAttribute(e):typeof t!="string"&&Pc(s).includes(e)?s[e]=t:s.setAttribute(e,t))}function xc(s){return s.__attributes??={[Ec]:s.nodeName.includes("-"),[Cc]:s.namespaceURI===Il}}var ga=new Map;function Pc(s){var e=s.getAttribute("is")||s.nodeName,t=ga.get(e);if(t)return t;ga.set(e,t=[]);for(var r,n=s,i=Element.prototype;i!==n;){r=rl(n);for(var o in r)r[o].set&&t.push(o);n=xa(n)}return t}function si(s,e,t=e){var r=new WeakSet;Ja(s,"input",async n=>{var i=n?s.defaultValue:s.value;if(i=ri(s)?ni(i):i,t(i),Te!==null&&r.add(Te),await vo(),i!==(i=e())){var o=s.selectionStart,l=s.selectionEnd,c=s.value.length;if(s.value=i??"",l!==null){var u=s.value.length;o===l&&l===c&&u>c?(s.selectionStart=u,s.selectionEnd=u):(s.selectionStart=o,s.selectionEnd=Math.min(l,u))}}}),hr(e)==null&&s.value&&(t(ri(s)?ni(s.value):s.value),Te!==null&&r.add(Te)),Gn(()=>{var n=e();if(s===document.activeElement){var i=gi??Te;if(r.has(i))return}ri(s)&&n===ni(s.value)||s.type==="date"&&!n&&!s.value||n!==s.value&&(s.value=n??"")})}function qc(s,e,t=e){Ja(s,"change",r=>{var n=r?s.defaultChecked:s.checked;t(n)}),hr(e)==null&&t(s.checked),Gn(()=>{var r=e();s.checked=!!r})}function ri(s){var e=s.type;return e==="number"||e==="range"}function ni(s){return s===""?null:+s}function ma(s,e){return s===e||s?.[Sr]===e}function Rn(s={},e,t,r){return nc(()=>{var n,i;return Gn(()=>{n=i,i=[],hr(()=>{s!==t(...i)&&(e(s,...i),n&&ma(t(...n),s)&&e(null,...n))})}),()=>{Ks(()=>{i&&ma(t(...i),s)&&e(null,...i)})}}),s}let Sn=!1;function Ac(s){var e=Sn;try{return Sn=!1,[s(),Sn]}finally{Sn=e}}function ps(s,e,t,r){var n=(t&Pl)!==0,i=(t&ql)!==0,o=r,l=!0,c=()=>(l&&(l=!1,o=i?hr(r):r),o),u;if(n){var d=Sr in s||ll in s;u=Rr(s,e)?.set??(d&&e in s?x=>s[e]=x:void 0)}var g,h=!1;n?[g,h]=Ac(()=>s[e]):g=s[e],g===void 0&&r!==void 0&&(g=c(),u&&(gl(),u(g)));var p;if(p=()=>{var x=s[e];return x===void 0?c():(l=!0,x)},(t&xl)===0)return p;if(u){var E=s.$$legacy;return(function(x,D){return arguments.length>0?((!D||E||h)&&u(D?p():x),x):p()})}var q=!1,C=((t&Cl)!==0?Bn:Ka)(()=>(q=!1,p()));n&&a(C);var U=Le;return(function(x,D){if(arguments.length>0){const M=D?a(C):n?ht(x):x;return f(C,M),q=!0,o!==void 0&&(o=M),x}return ur&&q||(U.f&Ws)!==0?C.v:a(C)})}function Kr(s){Xt===null&&Ia(),ft(()=>{const e=hr(s);if(typeof e=="function")return e})}function bo(s){Xt===null&&Ia(),Kr(()=>()=>hr(s))}const wo=crypto.randomUUID();let Gs=null,yo=0,ki=null;const Nr=new Map,cn=new Map;function ko(s,e){return`${e}:${s.toLowerCase()}`}navigator.locks.request(`chess-tab-${wo}`,()=>new Promise(()=>{}));function Mc(s,e){const t=ko(s,e),r=new Worker(new URL(""+new URL("db-worker-BD5gUua4.js",import.meta.url).href,import.meta.url),{type:"module"}),n=new MessageChannel;r.postMessage({type:"init",username:s,platform:e,port:n.port1},[n.port1]),Gs.postMessage({type:"workerPort",username:s,platform:e,port:n.port2},[n.port2]),cn.set(t,r)}function Ic(){const s=new Worker(new URL(""+new URL("db-metadata-reader-worker-BB93cdYb.js",import.meta.url).href,import.meta.url),{type:"module"});s.onmessage=e=>{const t=e.data;t.type==="result"&&(Gs.postMessage({type:"cachedPlayersResult",data:t.data}),s.terminate())},s.postMessage({type:"readCachedPlayers"})}function Tc(s,e){const t=ko(s,e),r=cn.get(t);r&&(r.terminate(),cn.delete(t))}function Lc(){for(const[,s]of Nr)s.reject(new Error("SharedWorker connection lost"));Nr.clear();for(const[,s]of cn)s.terminate();cn.clear(),So()}function So(){Gs=new SharedWorker(new URL(""+new URL("db-shared-worker-DIaiZ3hb.js",import.meta.url).href,import.meta.url),{type:"module"}).port,Gs.onmessage=e=>{const t=e.data;if(t.type==="helloAck"){navigator.locks.request("chess-shared-worker",()=>{console.warn("[db-client] SharedWorker died (Web Lock released), reconnecting..."),Lc()});return}if(t.type==="reload"){ki?ki():location.reload();return}if(t.type==="spawnWorker"){Mc(t.username,t.platform);return}if(t.type==="terminateWorker"){Tc(t.username,t.platform);return}if(t.type==="readCachedPlayers"){Ic();return}const{requestId:r}=t,n=Nr.get(r);if(n)switch(t.type){case"progress":n.onProgress?.(t.message);break;case"status":n.onBlockedByIngestion?.(t.status);break;case"result":Nr.delete(r),n.resolve(t.data);break;case"error":Nr.delete(r),t.error==="WorkerSpawnFailed"?(console.error(`[db-client] WorkerSpawnFailed for request ${r}`),alert("Fatal error: Worker failed to spawn. Please reload the page."),n.reject(new Error(t.error))):t.error==="AbortError"?n.reject(new DOMException("Aborted","AbortError")):n.reject(new Error(t.error));break}},Gs.start(),Gs.postMessage({type:"hello",tabId:wo})}function Dc(s){ki=null,So()}function $s(s,e){return new Promise((t,r)=>{if(!Gs){r(new Error("SharedWorker not connected"));return}const n=yo++;Nr.set(n,{resolve:t,reject:r,onProgress:e?.onProgress,onBlockedByIngestion:e?.onBlockedByIngestion}),Gs.postMessage({...s,requestId:n})})}async function Si(){return $s({type:"listCachedPlayers"})}async function Oc(s,e){return $s({type:"clearPlayerData",username:s,platform:e})}async function Rc(){return $s({type:"clearAllData"})}async function Nc(s,e,t,r,n,i){if(i?.aborted)throw new DOMException("Aborted","AbortError");const o=yo,l=()=>{Gs?.postMessage({type:"cancel",cancelRequestId:o})};i&&i.addEventListener("abort",l,{once:!0});try{return await $s({type:"ensureIngested",username:s,platform:e,since:t,until:r},{onProgress:n})}finally{i?.removeEventListener("abort",l)}}async function $c(s,e,t,r,n,i,o,l,c){return $s({type:"getContinuations",username:s,platform:e,since:t,until:r,moveSequence:n,playerColor:i,timeControl:o,includeTranspositions:l},{onBlockedByIngestion:c})}async function Fc(s,e,t,r,n,i,o,l){return $s({type:"searchByPosition",username:s,platform:e,since:t,until:r,pattern:n,playerColor:i,timeControl:o},{onBlockedByIngestion:l})}async function Eo(s,e,t,r){return $s({type:"getGamesMetadata",username:s,platform:e,gameIds:t},{onBlockedByIngestion:r})}async function Co(s,e,t,r){return $s({type:"getGamesMoves",username:s,platform:e,gameIds:t},{onBlockedByIngestion:r})}async function Bc(s,e,t,r,n,i,o){return $s({type:"getRecentGames",username:s,platform:e,since:t,until:r,timeControl:n,limit:i},{onBlockedByIngestion:o})}async function Uc(s,e,t,r,n){return $s({type:"getAvailableTimeControls",username:s,platform:e,since:t,until:r},{onBlockedByIngestion:n})}const Gc="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Gc);function Wc(s){return s!==null?{comment:s,variations:[]}:{variations:[]}}function Kc(s,e,t,r,n){const i={move:s,variations:n};return e&&(i.suffix=e),t&&(i.nag=t),r!==null&&(i.comment=r),i}function Hc(...s){const[e,...t]=s;let r=e;for(const n of t)n!==null&&(r.variations=[n,...n.variations],n.variations=[],r=n);return e}function zc(s,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const r=t.variations[0];if(!r){t.comment=e.marker.comment;break}t=r}}return{headers:s,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function Vc(s,e){function t(){this.constructor=s}t.prototype=e.prototype,s.prototype=new t}function Hr(s,e,t,r){var n=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(n,Hr.prototype),n.expected=e,n.found=t,n.location=r,n.name="SyntaxError",n}Vc(Hr,Error);function ii(s,e,t){return t=t||" ",s.length>e?s:(e-=s.length,t+=t.repeat(e),s+t.slice(0,e))}Hr.prototype.format=function(s){var e="Error: "+this.message;if(this.location){var t=null,r;for(r=0;r<s.length;r++)if(s[r].source===this.location.source){t=s[r].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,i=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(n):n,o=this.location.source+":"+i.line+":"+i.column;if(t){var l=this.location.end,c=ii("",i.line.toString().length," "),u=t[n.line-1],d=n.line===l.line?l.column:u.length+1,g=d-n.column||1;e+=`
 --> `+o+`
`+c+` |
`+i.line+" | "+u+`
`+c+" | "+ii("",n.column-1," ")+ii("",g,"^")}else e+=`
 at `+o}return e};Hr.buildMessage=function(s,e){var t={literal:function(u){return'"'+n(u.text)+'"'},class:function(u){var d=u.parts.map(function(g){return Array.isArray(g)?i(g[0])+"-"+i(g[1]):i(g)});return"["+(u.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(u){return u.description}};function r(u){return u.charCodeAt(0).toString(16).toUpperCase()}function n(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+r(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+r(d)})}function i(u){return u.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+r(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+r(d)})}function o(u){return t[u.type](u)}function l(u){var d=u.map(o),g,h;if(d.sort(),d.length>0){for(g=1,h=1;g<d.length;g++)d[g-1]!==d[g]&&(d[h]=d[g],h++);d.length=h}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function c(u){return u?'"'+n(u)+'"':"end of input"}return"Expected "+l(s)+" but "+c(e)+" found."};function jc(s,e){e=e!==void 0?e:{};var t={},r=e.grammarSource,n={pgn:O},i=O,o="[",l='"',c="]",u=".",d="O-O-O",g="O-O",h="0-0-0",p="0-0",E="$",q="{",C="}",U=";",x="(",D=")",M="1-0",z="0-1",Y="1/2-1/2",V="*",W=/^[a-zA-Z]/,re=/^[^"]/,oe=/^[0-9]/,Ye=/^[.]/,Be=/^[a-zA-Z1-8\-=]/,X=/^[+#]/,ge=/^[!?]/,ce=/^[^}]/,Se=/^[^\r\n]/,Ee=/^[ \t\r\n]/,me=Ce("tag pair"),Re=Ne("[",!1),he=Ne('"',!1),j=Ne("]",!1),_e=Ce("tag name"),Pe=Ct([["a","z"],["A","Z"]],!1,!1),Je=Ce("tag value"),Me=Ct(['"'],!0,!1),Qe=Ce("move number"),De=Ct([["0","9"]],!1,!1),at=Ne(".",!1),Rt=Ct(["."],!1,!1),Zt=Ce("standard algebraic notation"),Jt=Ne("O-O-O",!1),As=Ne("O-O",!1),ws=Ne("0-0-0",!1),ys=Ne("0-0",!1),ls=Ct([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),St=Ct(["+","#"],!1,!1),P=Ce("suffix annotation"),F=Ct(["!","?"],!1,!1),de=Ce("NAG"),ue=Ne("$",!1),ee=Ce("brace comment"),ie=Ne("{",!1),ae=Ct(["}"],!0,!1),Oe=Ne("}",!1),$e=Ce("rest of line comment"),Ke=Ne(";",!1),He=Ct(["\r",`
`],!0,!1),ve=Ce("variation"),gt=Ne("(",!1),mt=Ne(")",!1),Ut=Ce("game termination marker"),es=Ne("1-0",!1),cs=Ne("0-1",!1),Gt=Ne("1/2-1/2",!1),Ue=Ne("*",!1),qe=Ce("whitespace"),ot=Ct([" ","	","\r",`
`],!1,!1),Lt=function(v,b){return zc(v,b)},ts=function(v){return Object.fromEntries(v)},T=function(v,b){return[v,b]},J=function(v,b){return{root:v,marker:b}},le=function(v,b){return Hc(Wc(v),...b.flat())},lt=function(v,b,w,G,H){return Kc(v,b,w,G,H)},Xe=function(v){return v},_t=function(v){return v.replace(/[\r\n]+/g," ")},Et=function(v){return v.trim()},Nt=function(v){return v},$t=function(v,b){return{result:v,comment:b}},m=e.peg$currPos|0,dt=[{line:1,column:1}],st=m,us=e.peg$maxFailExpected||[],A=e.peg$silentFails|0,Ge;if(e.startRule){if(!(e.startRule in n))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');i=n[e.startRule]}function Ne(v,b){return{type:"literal",text:v,ignoreCase:b}}function Ct(v,b,w){return{type:"class",parts:v,inverted:b,ignoreCase:w}}function Xs(){return{type:"end"}}function Ce(v){return{type:"other",description:v}}function bt(v){var b=dt[v],w;if(b)return b;if(v>=dt.length)w=dt.length-1;else for(w=v;!dt[--w];);for(b=dt[w],b={line:b.line,column:b.column};w<v;)s.charCodeAt(w)===10?(b.line++,b.column=1):b.column++,w++;return dt[v]=b,b}function k(v,b,w){var G=bt(v),H=bt(b),be={source:r,start:{offset:v,line:G.line,column:G.column},end:{offset:b,line:H.line,column:H.column}};return be}function _(v){m<st||(m>st&&(st=m,us=[]),us.push(v))}function N(v,b,w){return new Hr(Hr.buildMessage(v,b),v,b,w)}function O(){var v,b,w;return v=m,b=te(),w=ze(),v=Lt(b,w),v}function te(){var v,b,w;for(v=m,b=[],w=K();w!==t;)b.push(w),w=K();return w=et(),v=ts(b),v}function K(){var v,b,w,G,H,be,ss;return A++,v=m,et(),s.charCodeAt(m)===91?(b=o,m++):(b=t,A===0&&_(Re)),b!==t?(et(),w=ne(),w!==t?(et(),s.charCodeAt(m)===34?(G=l,m++):(G=t,A===0&&_(he)),G!==t?(H=Ze(),s.charCodeAt(m)===34?(be=l,m++):(be=t,A===0&&_(he)),be!==t?(et(),s.charCodeAt(m)===93?(ss=c,m++):(ss=t,A===0&&_(j)),ss!==t?v=T(w,H):(m=v,v=t)):(m=v,v=t)):(m=v,v=t)):(m=v,v=t)):(m=v,v=t),A--,v===t&&A===0&&_(me),v}function ne(){var v,b,w;if(A++,v=m,b=[],w=s.charAt(m),W.test(w)?m++:(w=t,A===0&&_(Pe)),w!==t)for(;w!==t;)b.push(w),w=s.charAt(m),W.test(w)?m++:(w=t,A===0&&_(Pe));else b=t;return b!==t?v=s.substring(v,m):v=b,A--,v===t&&(b=t,A===0&&_(_e)),v}function Ze(){var v,b,w;for(A++,v=m,b=[],w=s.charAt(m),re.test(w)?m++:(w=t,A===0&&_(Me));w!==t;)b.push(w),w=s.charAt(m),re.test(w)?m++:(w=t,A===0&&_(Me));return v=s.substring(v,m),A--,b=t,A===0&&_(Je),v}function ze(){var v,b,w;return v=m,b=xt(),et(),w=Zs(),w===t&&(w=null),et(),v=J(b,w),v}function xt(){var v,b,w,G;for(v=m,b=Dt(),b===t&&(b=null),w=[],G=Wt();G!==t;)w.push(G),G=Wt();return v=le(b,w),v}function Wt(){var v,b,w,G,H,be,ss,Js;if(v=m,et(),Ve(),et(),b=vt(),b!==t){for(w=Ms(),w===t&&(w=null),G=[],H=qr();H!==t;)G.push(H),H=qr();for(H=et(),be=Dt(),be===t&&(be=null),ss=[],Js=Ht();Js!==t;)ss.push(Js),Js=Ht();v=lt(b,w,G,be,ss)}else m=v,v=t;return v}function Ve(){var v,b,w,G,H,be;for(A++,v=m,b=[],w=s.charAt(m),oe.test(w)?m++:(w=t,A===0&&_(De));w!==t;)b.push(w),w=s.charAt(m),oe.test(w)?m++:(w=t,A===0&&_(De));if(s.charCodeAt(m)===46?(w=u,m++):(w=t,A===0&&_(at)),w!==t){for(G=et(),H=[],be=s.charAt(m),Ye.test(be)?m++:(be=t,A===0&&_(Rt));be!==t;)H.push(be),be=s.charAt(m),Ye.test(be)?m++:(be=t,A===0&&_(Rt));b=[b,w,G,H],v=b}else m=v,v=t;return A--,v===t&&(b=t,A===0&&_(Qe)),v}function vt(){var v,b,w,G,H,be;if(A++,v=m,b=m,s.substr(m,5)===d?(w=d,m+=5):(w=t,A===0&&_(Jt)),w===t&&(s.substr(m,3)===g?(w=g,m+=3):(w=t,A===0&&_(As)),w===t&&(s.substr(m,5)===h?(w=h,m+=5):(w=t,A===0&&_(ws)),w===t&&(s.substr(m,3)===p?(w=p,m+=3):(w=t,A===0&&_(ys)),w===t))))if(w=m,G=s.charAt(m),W.test(G)?m++:(G=t,A===0&&_(Pe)),G!==t){if(H=[],be=s.charAt(m),Be.test(be)?m++:(be=t,A===0&&_(ls)),be!==t)for(;be!==t;)H.push(be),be=s.charAt(m),Be.test(be)?m++:(be=t,A===0&&_(ls));else H=t;H!==t?(G=[G,H],w=G):(m=w,w=t)}else m=w,w=t;return w!==t?(G=s.charAt(m),X.test(G)?m++:(G=t,A===0&&_(St)),G===t&&(G=null),w=[w,G],b=w):(m=b,b=t),b!==t?v=s.substring(v,m):v=b,A--,v===t&&(b=t,A===0&&_(Zt)),v}function Ms(){var v,b,w;for(A++,v=m,b=[],w=s.charAt(m),ge.test(w)?m++:(w=t,A===0&&_(F));w!==t;)b.push(w),b.length>=2?w=t:(w=s.charAt(m),ge.test(w)?m++:(w=t,A===0&&_(F)));return b.length<1?(m=v,v=t):v=b,A--,v===t&&(b=t,A===0&&_(P)),v}function qr(){var v,b,w,G,H;if(A++,v=m,et(),s.charCodeAt(m)===36?(b=E,m++):(b=t,A===0&&_(ue)),b!==t){if(w=m,G=[],H=s.charAt(m),oe.test(H)?m++:(H=t,A===0&&_(De)),H!==t)for(;H!==t;)G.push(H),H=s.charAt(m),oe.test(H)?m++:(H=t,A===0&&_(De));else G=t;G!==t?w=s.substring(w,m):w=G,w!==t?v=Xe(w):(m=v,v=t)}else m=v,v=t;return A--,v===t&&A===0&&_(de),v}function Dt(){var v;return v=Fe(),v===t&&(v=Kt()),v}function Fe(){var v,b,w,G,H;if(A++,v=m,s.charCodeAt(m)===123?(b=q,m++):(b=t,A===0&&_(ie)),b!==t){for(w=m,G=[],H=s.charAt(m),ce.test(H)?m++:(H=t,A===0&&_(ae));H!==t;)G.push(H),H=s.charAt(m),ce.test(H)?m++:(H=t,A===0&&_(ae));w=s.substring(w,m),s.charCodeAt(m)===125?(G=C,m++):(G=t,A===0&&_(Oe)),G!==t?v=_t(w):(m=v,v=t)}else m=v,v=t;return A--,v===t&&(b=t,A===0&&_(ee)),v}function Kt(){var v,b,w,G,H;if(A++,v=m,s.charCodeAt(m)===59?(b=U,m++):(b=t,A===0&&_(Ke)),b!==t){for(w=m,G=[],H=s.charAt(m),Se.test(H)?m++:(H=t,A===0&&_(He));H!==t;)G.push(H),H=s.charAt(m),Se.test(H)?m++:(H=t,A===0&&_(He));w=s.substring(w,m),v=Et(w)}else m=v,v=t;return A--,v===t&&(b=t,A===0&&_($e)),v}function Ht(){var v,b,w,G;return A++,v=m,et(),s.charCodeAt(m)===40?(b=x,m++):(b=t,A===0&&_(gt)),b!==t?(w=xt(),w!==t?(et(),s.charCodeAt(m)===41?(G=D,m++):(G=t,A===0&&_(mt)),G!==t?v=Nt(w):(m=v,v=t)):(m=v,v=t)):(m=v,v=t),A--,v===t&&A===0&&_(ve),v}function Zs(){var v,b,w;return A++,v=m,s.substr(m,3)===M?(b=M,m+=3):(b=t,A===0&&_(es)),b===t&&(s.substr(m,3)===z?(b=z,m+=3):(b=t,A===0&&_(cs)),b===t&&(s.substr(m,7)===Y?(b=Y,m+=7):(b=t,A===0&&_(Gt)),b===t&&(s.charCodeAt(m)===42?(b=V,m++):(b=t,A===0&&_(Ue))))),b!==t?(et(),w=Dt(),w===t&&(w=null),v=$t(b,w)):(m=v,v=t),A--,v===t&&(b=t,A===0&&_(Ut)),v}function et(){var v,b;for(A++,v=[],b=s.charAt(m),Ee.test(b)?m++:(b=t,A===0&&_(ot));b!==t;)v.push(b),b=s.charAt(m),Ee.test(b)?m++:(b=t,A===0&&_(ot));return A--,b=t,A===0&&_(qe),v}if(Ge=i(),e.peg$library)return{peg$result:Ge,peg$currPos:m,peg$FAILED:t,peg$maxFailExpected:us,peg$maxFailPos:st};if(Ge!==t&&m===s.length)return Ge;throw Ge!==t&&m<s.length&&_(Xs()),N(us,st<s.length?s.charAt(st):null,st<s.length?k(st,st+1):k(st,st))}const qn=0xffffffffffffffffn;function ai(s,e){return(s<<e|s>>64n-e)&0xffffffffffffffffn}function _a(s,e){return s*e&qn}function Yc(s){return function(){let e=BigInt(s&qn),t=BigInt(s>>64n&qn);const r=_a(ai(_a(e,5n),7n),9n);return t^=e,e=(ai(e,24n)^t^t<<16n)&qn,t=ai(t,37n),s=t<<64n|e,r}}const Wn=Yc(0xa187eb39cdcaed8f31c4b365b102e01en),Qc=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Wn()))),Xc=Array.from({length:8},()=>Wn()),Zc=Array.from({length:16},()=>Wn()),oi=Wn(),Ot="w",rs="b",ct="p",Ei="n",An="b",rn="r",nr="q",pt="k",li="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class En{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){const{color:r,piece:n,from:i,to:o,flags:l,captured:c,promotion:u}=t,d=wt(i),g=wt(o);this.color=r,this.piece=n,this.from=d,this.to=g,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=d+g,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const h in se)se[h]&l&&(this.flags+=pr[h]);c&&(this.captured=c),u&&(this.promotion=u,this.lan+=u)}isCapture(){return this.flags.indexOf(pr.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(pr.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(pr.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(pr.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(pr.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(pr.BIG_PAWN)>-1}}const At=-1,pr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},se={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Ci={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Jc={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},eu={...Ci,...Jc},Z={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ci={b:[16,32,17,15],w:[-16,-32,-17,-15]},ba={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},tu=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],su=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],ru={p:1,n:2,b:4,r:8,q:16,k:32},nu="pnbrqkPNBRQK",wa=[Ei,An,rn,nr],iu=7,au=6,ou=1,lu=0,Cn={[pt]:se.KSIDE_CASTLE,[nr]:se.QSIDE_CASTLE},tr={w:[{square:Z.a1,flag:se.QSIDE_CASTLE},{square:Z.h1,flag:se.KSIDE_CASTLE}],b:[{square:Z.a8,flag:se.QSIDE_CASTLE},{square:Z.h8,flag:se.KSIDE_CASTLE}]},cu={b:ou,w:au},ui="--";function Cr(s){return s>>4}function un(s){return s&15}function xo(s){return"0123456789".indexOf(s)!==-1}function wt(s){const e=un(s),t=Cr(s);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function Zr(s){return s===Ot?rs:Ot}function uu(s){const e=s.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(e[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const n=e[0].split("/");if(n.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<n.length;o++){let l=0,c=!1;for(let u=0;u<n[o].length;u++)if(xo(n[o][u])){if(c)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(n[o][u],10),c=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[o][u]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,c=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const i=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:l}of i){if(!l.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(n[0]+n[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function fu(s,e){const t=s.from,r=s.to,n=s.piece;let i=0,o=0,l=0;for(let c=0,u=e.length;c<u;c++){const d=e[c].from,g=e[c].to,h=e[c].piece;n===h&&t!==d&&r===g&&(i++,Cr(t)===Cr(d)&&o++,un(t)===un(d)&&l++)}return i>0?o>0&&l>0?wt(t):l>0?wt(t).charAt(1):wt(t).charAt(0):""}function sr(s,e,t,r,n,i=void 0,o=se.NORMAL){const l=Cr(r);if(n===ct&&(l===iu||l===lu))for(let c=0;c<wa.length;c++){const u=wa[c];s.push({color:e,from:t,to:r,piece:n,captured:i,promotion:u,flags:o|se.PROMOTION})}else s.push({color:e,from:t,to:r,piece:n,captured:i,flags:o})}function ya(s){let e=s.charAt(0);return e>="a"&&e<="h"?s.match(/[a-h]\d.*[a-h]\d/)?void 0:ct:(e=e.toLowerCase(),e==="o"?pt:e)}function fi(s){return s.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class dr{_board=new Array(128);_turn=Ot;_header={};_kings={w:At,b:At};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=li,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:At,b:At},this._turn=Ot,this._castling={w:0,b:0},this._epSquare=At,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...eu},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:r=!1}={}){let n=e.split(/\s+/);if(n.length>=2&&n.length<6){const l=["-","-","0","1"];e=n.concat(l.slice(-(6-n.length))).join(" ")}if(n=e.split(/\s+/),!t){const{ok:l,error:c}=uu(e);if(!l)throw new Error(c)}const i=n[0];let o=0;this.clear({preserveHeaders:r});for(let l=0;l<i.length;l++){const c=i.charAt(l);if(c==="/")o+=8;else if(xo(c))o+=parseInt(c,10);else{const u=c<"a"?Ot:rs;this._put({type:c.toLowerCase(),color:u},wt(o)),o++}}this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=se.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=se.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=se.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=se.QSIDE_CASTLE),this._epSquare=n[3]==="-"?At:Z[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let t=0,r="";for(let o=Z.a8;o<=Z.h1;o++){if(this._board[o]){t>0&&(r+=t,t=0);const{color:l,type:c}=this._board[o];r+=l===Ot?c.toUpperCase():c.toLowerCase()}else t++;o+1&136&&(t>0&&(r+=t),o!==Z.h1&&(r+="/"),t=0,o+=8)}let n="";this._castling[Ot]&se.KSIDE_CASTLE&&(n+="K"),this._castling[Ot]&se.QSIDE_CASTLE&&(n+="Q"),this._castling[rs]&se.KSIDE_CASTLE&&(n+="k"),this._castling[rs]&se.QSIDE_CASTLE&&(n+="q"),n=n||"-";let i="-";if(this._epSquare!==At)if(e)i=wt(this._epSquare);else{const o=this._epSquare+(this._turn===Ot?16:-16),l=[o+1,o-1];for(const c of l){if(c&136)continue;const u=this._turn;if(this._board[c]?.color===u&&this._board[c]?.type===ct){this._makeMove({color:u,from:c,to:this._epSquare,piece:ct,captured:ct,flags:se.EP_CAPTURE});const d=!this._isKingAttacked(u);if(this._undoMove(),d){i=wt(this._epSquare);break}}}}return[r,this._turn,n,i,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:t,type:r}=this._board[e],n={w:0,b:1}[t],i={p:0,n:1,b:2,r:3,q:4,k:5}[r];return Qc[n][i][e]}_epKey(){return this._epSquare===At?0n:Xc[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return Zc[e]}_computeHash(){let e=0n;for(let t=Z.a8;t<=Z.h1;t++){if(t&136){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=oi),e}_updateSetup(e){this._history.length>0||(e!==li?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(li)}get(e){return this._board[Z[e]]}findPiece(e){const t=[];for(let r=Z.a8;r<=Z.h1;r++){if(r&136){r+=7;continue}!this._board[r]||this._board[r]?.color!==e.color||this._board[r].color===e.color&&this._board[r].type===e.type&&t.push(wt(r))}return t}put({type:e,color:t},r){return this._put({type:e,color:t},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},r){if(nu.indexOf(e.toLowerCase())===-1||!(r in Z))return!1;const n=Z[r];if(e==pt&&!(this._kings[t]==At||this._kings[t]==n))return!1;const i=this._board[n];return i&&i.type===pt&&(this._kings[i.color]=At),this._set(n,{type:e,color:t}),e===pt&&(this._kings[t]=n),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const t=this.get(e);return this._clear(Z[e]),t&&t.type===pt&&(this._kings[t.color]=At),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){this._hash^=this._castlingKey();const e=this._board[Z.e1]?.type===pt&&this._board[Z.e1]?.color===Ot,t=this._board[Z.e8]?.type===pt&&this._board[Z.e8]?.color===rs;(!e||this._board[Z.a1]?.type!==rn||this._board[Z.a1]?.color!==Ot)&&(this._castling.w&=-65),(!e||this._board[Z.h1]?.type!==rn||this._board[Z.h1]?.color!==Ot)&&(this._castling.w&=-33),(!t||this._board[Z.a8]?.type!==rn||this._board[Z.a8]?.color!==rs)&&(this._castling.b&=-65),(!t||this._board[Z.h8]?.type!==rn||this._board[Z.h8]?.color!==rs)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===At)return;const e=this._epSquare+(this._turn===Ot?-16:16),t=this._epSquare+(this._turn===Ot?16:-16),r=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||this._board[t]?.color!==Zr(this._turn)||this._board[t]?.type!==ct){this._hash^=this._epKey(),this._epSquare=At;return}const n=i=>!(i&136)&&this._board[i]?.color===this._turn&&this._board[i]?.type===ct;r.some(n)||(this._hash^=this._epKey(),this._epSquare=At)}_attacked(e,t,r){const n=[];for(let i=Z.a8;i<=Z.h1;i++){if(i&136){i+=7;continue}if(this._board[i]===void 0||this._board[i].color!==e)continue;const o=this._board[i],l=i-t;if(l===0)continue;const c=l+119;if(tu[c]&ru[o.type]){if(o.type===ct){if(l>0&&o.color===Ot||l<=0&&o.color===rs)if(r)n.push(wt(i));else return!0;continue}if(o.type==="n"||o.type==="k")if(r){n.push(wt(i));continue}else return!0;const u=su[c];let d=i+u,g=!1;for(;d!==t;){if(this._board[d]!=null){g=!0;break}d+=u}if(!g)if(r){n.push(wt(i));continue}else return!0}}return r?n:!1}attackers(e,t){return t?this._attacked(t,Z[e],!0):this._attacked(this._turn,Z[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(Zr(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,Z[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let r=0,n=0;for(let i=Z.a8;i<=Z.h1;i++){if(n=(n+1)%2,i&136){i+=7;continue}const o=this._board[i];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===An&&t.push(n),r++)}if(r===2)return!0;if(r===3&&(e[An]===1||e[Ei]===1))return!0;if(r===e[An]+2){let i=0;const o=t.length;for(let l=0;l<o;l++)i+=t[l];if(i===0||i===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:r=void 0}={}){const n=this._moves({square:t,piece:r});return e?n.map(i=>new En(this,i)):n.map(i=>this._moveToSan(i,n))}_moves({legal:e=!0,piece:t=void 0,square:r=void 0}={}){const n=r?r.toLowerCase():void 0,i=t?.toLowerCase(),o=[],l=this._turn,c=Zr(l);let u=Z.a8,d=Z.h1,g=!1;if(n)if(n in Z)u=d=Z[n],g=!0;else return[];for(let p=u;p<=d;p++){if(p&136){p+=7;continue}if(!this._board[p]||this._board[p].color===c)continue;const{type:E}=this._board[p];let q;if(E===ct){if(i&&i!==E)continue;q=p+ci[l][0],this._board[q]||(sr(o,l,p,q,ct),q=p+ci[l][1],cu[l]===Cr(p)&&!this._board[q]&&sr(o,l,p,q,ct,void 0,se.BIG_PAWN));for(let C=2;C<4;C++)q=p+ci[l][C],!(q&136)&&(this._board[q]?.color===c?sr(o,l,p,q,ct,this._board[q].type,se.CAPTURE):q===this._epSquare&&sr(o,l,p,q,ct,ct,se.EP_CAPTURE))}else{if(i&&i!==E)continue;for(let C=0,U=ba[E].length;C<U;C++){const x=ba[E][C];for(q=p;q+=x,!(q&136);){if(!this._board[q])sr(o,l,p,q,E);else{if(this._board[q].color===l)break;sr(o,l,p,q,E,this._board[q].type,se.CAPTURE);break}if(E===Ei||E===pt)break}}}}if((i===void 0||i===pt)&&(!g||d===this._kings[l])){if(this._castling[l]&se.KSIDE_CASTLE){const p=this._kings[l],E=p+2;!this._board[p+1]&&!this._board[E]&&!this._attacked(c,this._kings[l])&&!this._attacked(c,p+1)&&!this._attacked(c,E)&&sr(o,l,this._kings[l],E,pt,void 0,se.KSIDE_CASTLE)}if(this._castling[l]&se.QSIDE_CASTLE){const p=this._kings[l],E=p-2;!this._board[p-1]&&!this._board[p-2]&&!this._board[p-3]&&!this._attacked(c,this._kings[l])&&!this._attacked(c,p-1)&&!this._attacked(c,E)&&sr(o,l,this._kings[l],E,pt,void 0,se.QSIDE_CASTLE)}}if(!e||this._kings[l]===-1)return o;const h=[];for(let p=0,E=o.length;p<E;p++)this._makeMove(o[p]),this._isKingAttacked(l)||h.push(o[p]),this._undoMove();return h}move(e,{strict:t=!1}={}){let r=null;if(typeof e=="string")r=this._moveFromSan(e,t);else if(e===null)r=this._moveFromSan(ui,t);else if(typeof e=="object"){const i=this._moves();for(let o=0,l=i.length;o<l;o++)if(e.from===wt(i[o].from)&&e.to===wt(i[o].to)&&(!("promotion"in i[o])||e.promotion===i[o].promotion)){r=i[o];break}}if(!r)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&r.flags&se.NULL_MOVE)throw new Error("Null move not allowed when in check");const n=new En(this,r);return this._makeMove(r),this._incPositionCount(),n}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){const t=this._turn,r=Zr(t);if(this._push(e),e.flags&se.NULL_MOVE){t===rs&&this._moveNumber++,this._halfMoves++,this._turn=r,this._epSquare=At;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&se.EP_CAPTURE&&(this._turn===rs?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),this._board[e.to].type===pt){if(this._kings[t]=e.to,e.flags&se.KSIDE_CASTLE){const n=e.to-1,i=e.to+1;this._movePiece(i,n)}else if(e.flags&se.QSIDE_CASTLE){const n=e.to+1,i=e.to-2;this._movePiece(i,n)}this._castling[t]=0}if(this._castling[t]){for(let n=0,i=tr[t].length;n<i;n++)if(e.from===tr[t][n].square&&this._castling[t]&tr[t][n].flag){this._castling[t]^=tr[t][n].flag;break}}if(this._castling[r]){for(let n=0,i=tr[r].length;n<i;n++)if(e.to===tr[r][n].square&&this._castling[r]&tr[r][n].flag){this._castling[r]^=tr[r][n].flag;break}}if(this._hash^=this._castlingKey(),e.flags&se.BIG_PAWN){let n;t===rs?n=e.to-16:n=e.to+16,!(e.to-1&136)&&this._board[e.to-1]?.type===ct&&this._board[e.to-1]?.color===r||!(e.to+1&136)&&this._board[e.to+1]?.type===ct&&this._board[e.to+1]?.color===r?(this._epSquare=n,this._hash^=this._epKey()):this._epSquare=At}else this._epSquare=At;e.piece===ct?this._halfMoves=0:e.flags&(se.CAPTURE|se.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===rs&&this._moveNumber++,this._turn=r,this._hash^=oi}undo(){const e=this._hash,t=this._undoMove();if(t){const r=new En(this,t);return this._decPositionCount(e),r}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=oi;const r=this._turn,n=Zr(r);if(t.flags&se.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:r})),t.captured)if(t.flags&se.EP_CAPTURE){let i;r===rs?i=t.to-16:i=t.to+16,this._set(i,{type:ct,color:n})}else this._set(t.to,{type:t.captured,color:n});if(t.flags&(se.KSIDE_CASTLE|se.QSIDE_CASTLE)){let i,o;t.flags&se.KSIDE_CASTLE?(i=t.to+1,o=t.to-1):(i=t.to-2,o=t.to+1),this._movePiece(o,i)}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const r=[];let n=!1;for(const h in this._header)this._header[h]&&r.push(`[${h} "${this._header[h]}"]`+e),n=!0;n&&this._history.length&&r.push(e);const i=h=>{const p=this._comments[this.fen()];if(typeof p<"u"){const E=h.length>0?" ":"";h=`${h}${E}{${p}}`}return h},o=[];for(;this._history.length>0;)o.push(this._undoMove());const l=[];let c="";for(o.length===0&&l.push(i(""));o.length>0;){c=i(c);const h=o.pop();if(!h)break;if(!this._history.length&&h.color==="b"){const p=`${this._moveNumber}. ...`;c=c?`${c} ${p}`:p}else h.color==="w"&&(c.length&&l.push(c),c=this._moveNumber+".");c=c+" "+this._moveToSan(h,this._moves({legal:!0})),this._makeMove(h)}if(c.length&&l.push(i(c)),l.push(this._header.Result||"*"),t===0)return r.join("")+l.join(" ");const u=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},d=function(h,p){for(const E of p.split(" "))if(E){if(h+E.length>t){for(;u();)h--;r.push(e),h=0}r.push(E),h+=E.length,r.push(" "),h++}return u()&&h--,h};let g=0;for(let h=0;h<l.length;h++){if(g+l[h].length>t&&l[h].includes("{")){g=d(g,l[h]);continue}g+l[h].length>t&&h!==0?(r[r.length-1]===" "&&r.pop(),r.push(e),g=0):h!==0&&(r.push(" "),g++),r.push(l[h]),g+=l[h].length}return r.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??Ci[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=Ci[e]||null,!0):!1}getHeaders(){const e={};for(const[t,r]of Object.entries(this._header))r!==null&&(e[t]=r);return e}loadPgn(e,{strict:t=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(e=e.replace(new RegExp(r,"g"),`
`));const n=jc(e);this.reset();const i=n.headers;let o="";for(const u in i)u.toLowerCase()==="fen"&&(o=i[u]),this.header(u,i[u]);if(!t)o&&this.load(o,{preserveHeaders:!0});else if(i.SetUp==="1"){if(!("FEN"in i))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(i.FEN,{preserveHeaders:!0})}let l=n.root;for(;l;){if(l.move){const u=this._moveFromSan(l.move,t);if(u==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(u),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const c=n.result;c&&Object.keys(this._header).length&&this._header.Result!==c&&this.setHeader("Result",c)}_moveToSan(e,t){let r="";if(e.flags&se.KSIDE_CASTLE)r="O-O";else if(e.flags&se.QSIDE_CASTLE)r="O-O-O";else{if(e.flags&se.NULL_MOVE)return ui;if(e.piece!==ct){const n=fu(e,t);r+=e.piece.toUpperCase()+n}e.flags&(se.CAPTURE|se.EP_CAPTURE)&&(e.piece===ct&&(r+=wt(e.from)[0]),r+="x"),r+=wt(e.to),e.promotion&&(r+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(e,t=!1){let r=fi(e);if(t||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O")),r==ui)return{color:this._turn,from:0,to:0,piece:"k",flags:se.NULL_MOVE};let n=ya(r),i=this._moves({legal:!0,piece:n});for(let h=0,p=i.length;h<p;h++)if(r===fi(this._moveToSan(i[h],i)))return i[h];if(t)return null;let o,l,c,u,d,g=!1;if(l=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(o=l[1],c=l[2],u=l[3],d=l[4],c.length==1&&(g=!0)):(l=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(o=l[1],c=l[2],u=l[3],d=l[4],c.length==1&&(g=!0))),n=ya(r),i=this._moves({legal:!0,piece:o||n}),!u)return null;for(let h=0,p=i.length;h<p;h++)if(c){if((!o||o.toLowerCase()==i[h].piece)&&Z[c]==i[h].from&&Z[u]==i[h].to&&(!d||d.toLowerCase()==i[h].promotion))return i[h];if(g){const E=wt(i[h].from);if((!o||o.toLowerCase()==i[h].piece)&&Z[u]==i[h].to&&(c==E[0]||c==E[1])&&(!d||d.toLowerCase()==i[h].promotion))return i[h]}}else if(r===fi(this._moveToSan(i[h],i)).replace("x",""))return i[h];return null}ascii(){let e=`   +------------------------+
`;for(let t=Z.a8;t<=Z.h1;t++){if(un(t)===0&&(e+=" "+"87654321"[Cr(t)]+" |"),this._board[t]){const r=this._board[t].type,i=this._board[t].color===Ot?r.toUpperCase():r.toLowerCase();e+=" "+i+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let r=0;const n=this._turn;for(let i=0,o=t.length;i<o;i++)this._makeMove(t[i]),this._isKingAttacked(n)||(e-1>0?r+=this.perft(e-1):r++),this._undoMove();return r}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let t=[];for(let r=Z.a8;r<=Z.h1;r++)this._board[r]==null?t.push(null):t.push({square:wt(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(e.push(t),t=[],r+=8);return e}squareColor(e){if(e in Z){const t=Z[e];return(Cr(t)+un(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],r=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const n=t.pop();if(!n)break;e?r.push(new En(this,n)):r.push(this._moveToSan(n,this._moves())),this._makeMove(n)}return r}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const t=this._positionCount.get(e)??0;t===1?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){const e=[],t={},r=n=>{n in this._comments&&(t[n]=this._comments[n])};for(;this._history.length>0;)e.push(this._undoMove());for(r(this.fen());;){const n=e.pop();if(!n)break;this._makeMove(n),r(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const n of[pt,nr])t[n]!==void 0&&(t[n]?this._castling[e]|=Cn[n]:this._castling[e]&=~Cn[n]);this._updateCastlingRights();const r=this.getCastlingRights(e);return(t[pt]===void 0||t[pt]===r[pt])&&(t[nr]===void 0||t[nr]===r[nr])}getCastlingRights(e){return{[pt]:(this._castling[e]&Cn[pt])!==0,[nr]:(this._castling[e]&Cn[nr])!==0}}moveNumber(){return this._moveNumber}}function Ui(s){if(s.type==="cp"){const t=s.pawns>=0?"+":"â",r=Math.abs(s.pawns).toFixed(1);return`${t}${r}`}return`${s.moves>=0?"":"â"}M${Math.abs(s.moves)}`}function zr(s){return s.type==="cp"?s.pawns<0:s.moves<0}function xn(s,e){const t=new dr(s);try{return t.move({from:e.slice(0,2),to:e.slice(2,4),promotion:e[4]}),t.fen()}catch{const r=`FATAL: fenAfterMove failed for "${e}" at FEN "${s}" â illegal move`;return console.error(r),alert(r),s}}function hu(s,e){if(s.length===0)return 0;const t=s.length,r=s.reduce((o,l)=>o+l,0)/t;if(e<=0)return r-400;if(e>=t)return r+400;let n=0,i=4e3;for(;i-n>.01;){const o=(n+i)/2;s.reduce((c,u)=>c+1/(1+Math.pow(10,(u-o)/400)),0)>e?i=o:n=o}return(n+i)/2}function Or(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Jr(s){return new Date(s).toISOString().split("T")[0]}function du(s){const[e,t,r]=s.split("-").map(Number);return new Date(e,t-1,r,0,0,0,0).getTime()}function vu(s){const[e,t,r]=s.split("-").map(Number),n=new Date(e,t-1,r,23,59,59,999).getTime();return Math.min(n,Date.now())}function pu(s){const e=new Date,t=e;let r;switch(s){case"month":r=new Date(e),r.setMonth(r.getMonth()-1);break;case"3months":r=new Date(e),r.setMonth(r.getMonth()-3);break;case"year":r=new Date(e),r.setFullYear(r.getFullYear()-1);break;case"all":r=new Date(0);break;default:r=new Date(e),r.setMonth(r.getMonth()-3)}return{from:r,to:t}}var gu=$('<header class="header svelte-aum2bf"><div></div> <div class="header-content svelte-aum2bf"><h1 class="svelte-aum2bf">Opening Explorer</h1> <p class="subtitle svelte-aum2bf">Explore your chess openings from Lichess and Chess.com</p></div> <div></div></header> <main class="card loading-card svelte-aum2bf"><h2 class="svelte-aum2bf"> </h2> <p class="loading-status svelte-aum2bf"> </p> <button class="secondary-btn svelte-aum2bf">Cancel</button></main>',1),mu=$('<button class="dropdown-item svelte-aum2bf"><div> </div> <div class="player-info svelte-aum2bf"><div class="player-name svelte-aum2bf"> </div> <div class="player-details svelte-aum2bf"> </div></div></button>'),_u=$('<div class="cache-info svelte-aum2bf"><div class="cache-icon svelte-aum2bf">ð</div> <div class="cache-details svelte-aum2bf"><span class="cached-label svelte-aum2bf">Cached:</span> <span class="cache-range svelte-aum2bf"> </span></div> <button class="cache-clear-btn svelte-aum2bf">Clear</button></div>'),bu=$('<div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Account</label>  <div><button class="account-select svelte-aum2bf"><!></button> <div class="dropdown-menu svelte-aum2bf"><!> <button class="dropdown-item add-account-item svelte-aum2bf"><div class="plus-icon svelte-aum2bf">+</div> <div class="player-info svelte-aum2bf"><div class="player-name svelte-aum2bf">Add new account</div></div></button></div></div></div> <!>',1),wu=$('<div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Platform</label> <div class="platform-toggle svelte-aum2bf"><button>Chess.com</button> <button>Lichess</button></div></div> <div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Username</label> <input type="text" class="username-input svelte-aum2bf" placeholder="Enter username"/></div>',1),yu=$("<button> </button>"),ku=$('<div class="error-text svelte-aum2bf"> </div>'),Su=$('<header class="header svelte-aum2bf"><div></div> <div class="header-content svelte-aum2bf"><h1 class="svelte-aum2bf">Opening Explorer</h1> <p class="subtitle svelte-aum2bf">Explore your chess openings from Lichess and Chess.com</p></div> <div class="header-right svelte-aum2bf"><button class="link-btn svelte-aum2bf">Clear all data</button></div></header> <main class="card svelte-aum2bf"><h2 class="svelte-aum2bf">Connect Your Account</h2> <!> <!> <div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Date Range</label> <div class="preset-group svelte-aum2bf"></div></div> <div class="date-inputs svelte-aum2bf"><div class="date-field svelte-aum2bf"><label class="svelte-aum2bf">From</label> <input type="date" class="svelte-aum2bf"/></div> <div class="date-field svelte-aum2bf"><label class="svelte-aum2bf">To</label> <input type="date" class="svelte-aum2bf"/></div></div> <!> <button class="primary-btn svelte-aum2bf">Load Games</button></main>',1);function Eu(s,e){Os(e,!0);let t=ps(e,"cachedPlayers",19,()=>[]),r=L(ht(t()[0]??null)),n=L(!1),i=L("chesscom"),o=L(""),l=L("3months"),c=L(""),u=L(""),d=L(""),g=L(!1),h=L(""),p=L(null),E=L(!1);const q=fe(()=>t().length>0),C=fe(()=>a(n)||!a(q)),U=fe(()=>Jr(Date.now())),x=fe(()=>a(i)==="lichess"?"Lichess":"Chess.com");ft(()=>{if(a(l)!=="custom"){const{from:j,to:_e}=pu(a(l));f(c,Jr(j.getTime()),!0),f(u,Jr(_e.getTime()),!0)}else a(r)&&!a(n)&&(f(c,Jr(a(r).cacheStart),!0),f(u,Jr(a(r).cacheEnd),!0))}),ft(()=>{t().length>0&&!a(r)&&f(r,t()[0],!0)});function D(j){return j==="lichess"?"lichess":"chesscom"}function M(j){return j.toLocaleString()}function z(j){f(r,j,!0),f(n,!1),f(l,"custom"),f(E,!1)}function Y(){f(n,!0),f(r,null),f(l,"3months"),f(E,!1)}function V(j){f(l,j,!0)}function W(){f(l,"custom"),re()}function re(){return a(c)&&a(u)&&a(c)>a(u)?(f(d,'"From" date cannot be after "To" date'),!1):(f(d,""),!0)}async function oe(){confirm("Clear all cached data? This cannot be undone.")&&(await Rc(),e.onCachedPlayersChanged([]),f(r,null),f(n,!1))}async function Ye(){if(a(r)&&confirm(`Clear all data for ${a(r).username}?`)){await Oc(a(r).username,a(r).platform);const j=t().filter(_e=>!(_e.username===a(r).username&&_e.platform===a(r).platform));e.onCachedPlayersChanged(j),f(r,j[0]??null,!0),a(r)||f(n,!1)}}function Be(){return a(r)&&!a(n)?!0:a(o).trim()!==""}async function X(){if(!re())return;let j,_e;if(a(r)&&!a(n))j=a(r).username,_e=a(r).platform;else if(j=a(o).trim(),_e=a(i),!j){alert("Please enter a username");return}const Pe=du(a(c)),Je=vu(a(u));f(g,!0),f(h,""),f(p,new AbortController,!0);try{await Nc(j,_e,Pe,Je,De=>{f(h,De,!0)},a(p).signal);const Me=await Si();e.onCachedPlayersChanged(Me);const Qe=Me.find(De=>De.username===j&&De.platform===_e);e.onEnterWorkspace({username:j,platform:_e,gameCount:Qe?.gameCount??0,since:Pe,until:Je})}catch(Me){Me instanceof DOMException&&Me.name==="AbortError"||(console.error("Failed to load games:",Me),alert(`Failed to load games: ${Me instanceof Error?Me.message:String(Me)}`))}finally{f(g,!1),f(p,null)}}function ge(){a(p)?.abort()}function ce(j){j.stopPropagation(),f(E,!a(E))}function Se(){f(E,!1)}var Ee=js();Vs("click",on,Se);var me=tt(Ee);{var Re=j=>{var _e=gu(),Pe=S(tt(_e),2),Je=y(Pe),Me=y(Je),Qe=S(Je,2),De=y(Qe),at=S(Qe,2);at.__click=ge,Q(()=>{R(Me,`Loading ${(a(o)||a(r)?.username)??""} (${a(x)??""})...`),R(De,a(h))}),I(j,_e)},he=j=>{var _e=Su(),Pe=tt(_e),Je=S(y(Pe),4),Me=y(Je);Me.__click=oe;var Qe=S(Pe,2),De=S(y(Qe),2);{var at=ee=>{var ie=bu(),ae=tt(ie),Oe=S(y(ae),2);let $e;var Ke=y(Oe);Ke.__click=ce;var He=y(Ke);{var ve=Ue=>{var qe=fr();Q(()=>R(qe,`${a(r).username??""} (${a(r).platform==="lichess"?"Lichess":"Chess.com"})`)),I(Ue,qe)},gt=Ue=>{var qe=fr("Select an account...");I(Ue,qe)};ye(He,Ue=>{a(r)&&!a(n)?Ue(ve):Ue(gt,!1)})}var mt=S(Ke,2);mt.__click=Ue=>Ue.stopPropagation();var Ut=y(mt);Bt(Ut,17,t,Ls,(Ue,qe)=>{var ot=mu();ot.__click=()=>z(a(qe));var Lt=y(ot),ts=y(Lt),T=S(Lt,2),J=y(T),le=y(J),lt=S(J,2),Xe=y(lt);Q((_t,Et,Nt,$t,m)=>{we(Lt,1,`player-avatar ${_t??""}`,"svelte-aum2bf"),R(ts,Et),R(le,a(qe).username),R(Xe,`${Nt??""} games on ${a(qe).platform==="lichess"?"Lichess":"Chess.com"} Â· ${$t??""} - ${m??""}`)},[()=>D(a(qe).platform),()=>a(qe).username[0].toUpperCase(),()=>M(a(qe).gameCount),()=>Or(a(qe).cacheStart),()=>Or(a(qe).cacheEnd)]),I(Ue,ot)});var es=S(Ut,2);es.__click=Y;var cs=S(ae,2);{var Gt=Ue=>{var qe=_u(),ot=S(y(qe),2),Lt=S(y(ot),2),ts=y(Lt),T=S(ot,2);T.__click=Ye,Q((J,le,lt)=>R(ts,`${J??""} games Â· ${le??""} - ${lt??""}`),[()=>M(a(r).gameCount),()=>Or(a(r).cacheStart),()=>Or(a(r).cacheEnd)]),I(Ue,qe)};ye(cs,Ue=>{a(r)&&!a(n)&&Ue(Gt)})}Q(()=>$e=we(Oe,1,"account-dropdown svelte-aum2bf",null,$e,{open:a(E)})),I(ee,ie)};ye(De,ee=>{a(q)&&ee(at)})}var Rt=S(De,2);{var Zt=ee=>{var ie=wu(),ae=tt(ie),Oe=S(y(ae),2),$e=y(Oe);let Ke;$e.__click=()=>f(i,"chesscom");var He=S($e,2);let ve;He.__click=()=>f(i,"lichess");var gt=S(ae,2),mt=S(y(gt),2);Q(()=>{Ke=we($e,1,"platform-btn svelte-aum2bf",null,Ke,{active:a(i)==="chesscom"}),ve=we(He,1,"platform-btn svelte-aum2bf",null,ve,{active:a(i)==="lichess"})}),si(mt,()=>a(o),Ut=>f(o,Ut)),I(ee,ie)};ye(Rt,ee=>{a(C)&&ee(Zt)})}var Jt=S(Rt,2),As=S(y(Jt),2);Bt(As,20,()=>[["3months","Last 3 months"],["month","Last month"],["year","Last year"],["all","All time"],["custom","Custom"]],Ls,(ee,ie)=>{var ae=fe(()=>ol(ie,2));let Oe=()=>a(ae)[0],$e=()=>a(ae)[1];var Ke=yu();let He;Ke.__click=()=>V(Oe());var ve=y(Ke);Q(()=>{He=we(Ke,1,"preset-btn svelte-aum2bf",null,He,{active:a(l)===Oe()}),R(ve,$e())}),I(ee,Ke)});var ws=S(Jt,2),ys=y(ws),ls=S(y(ys),2);ls.__input=W;var St=S(ys,2),P=S(y(St),2);P.__input=W;var F=S(ws,2);{var de=ee=>{var ie=ku(),ae=y(ie);Q(()=>R(ae,a(d))),I(ee,ie)};ye(F,ee=>{a(d)&&ee(de)})}var ue=S(F,2);ue.__click=X,Q(ee=>{On(ls,"max",a(U)),On(P,"max",a(U)),ue.disabled=ee},[()=>!Be()]),si(ls,()=>a(c),ee=>f(c,ee)),si(P,()=>a(u),ee=>f(u,ee)),I(j,_e)};ye(me,j=>{a(g)?j(Re):j(he,!1)})}I(s,Ee),Rs()}bn(["click","input"]);const fn={start:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",empty:"8/8/8/8/8/8/8/8"};class nt{constructor(e=fn.empty){this.squares=new Array(64).fill(null),this.setFen(e)}setFen(e=fn.empty){const t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let r=0;r<8;r++){const n=t[7-r].replace(/\d/g,i=>{const o=parseInt(i);let l="";for(let c=0;c<o;c++)l+="-";return l});for(let i=0;i<8;i++){const o=n.substring(i,i+1);let l=null;o!=="-"&&(o.toUpperCase()===o?l=`w${o.toLowerCase()}`:l=`b${o}`),this.squares[r*8+i]=l}}}getFen(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let r=0;for(let n=0;n<8;n++){const i=this.squares[t*8+n];if(!i)r++;else{r>0&&(e[7-t]+=r,r=0);const o=i.substring(0,1),l=i.substring(1,2);o==="w"?e[7-t]+=l.toUpperCase():e[7-t]+=l}}r>0&&(e[7-t]+=r,r=0)}return e.join("/")}getPieces(e=void 0,t=void 0,r=["k","q","r","b","n","p"]){const n=[],i=(o,l)=>r.indexOf(o.name)-r.indexOf(l.name);for(let o=0;o<64;o++){const l=this.squares[o];if(l){const c=l.charAt(1),u=l.charAt(0),d=nt.indexToSquare(o);if(t&&t!==c||e&&e!==u)continue;n.push({name:c,type:c,color:u,position:d,square:d})}}return r&&n.sort(i),n}movePiece(e,t){if(!this.squares[nt.squareToIndex(e)]){console.warn("no piece on",e);return}this.squares[nt.squareToIndex(t)]=this.squares[nt.squareToIndex(e)],this.squares[nt.squareToIndex(e)]=null}setPiece(e,t){this.squares[nt.squareToIndex(e)]=t}getPiece(e){return this.squares[nt.squareToIndex(e)]}static squareToIndex(e){const t=nt.squareToCoordinates(e);return t[0]+t[1]*8}static indexToSquare(e){return this.coordinatesToSquare([Math.floor(e%8),e/8])}static squareToCoordinates(e){const t=e.charCodeAt(0)-97,r=e.charCodeAt(1)-49;return[t,r]}static coordinatesToSquare(e){const t=String.fromCharCode(e[0]+97),r=String.fromCharCode(e[1]+49);return t+r}toString(){return this.getFen()}clone(){const e=new nt;return e.squares=this.squares.slice(0),e}}class Cu{constructor(){this.position=new nt,this.orientation=void 0,this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.squareSelectEnabled=!1,this.moveInputCallback=null,this.extensionPoints={},this.moveInputProcess=Promise.resolve()}inputEnabled(){return this.inputWhiteEnabled||this.inputBlackEnabled}invokeExtensionPoints(e,t={}){const r=this.extensionPoints[e],n=Object.assign({},t);n.extensionPoint=e;let i=!0;if(r)for(const o of r)o(n)===!1&&(i=!1);return i}}const ka="http://www.w3.org/2000/svg";class pe{static createSvg(e=void 0){let t=document.createElementNS(ka,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,r={}){let n=document.createElementNS(ka,t);t==="use"&&(r["xlink:href"]=r.href);for(let i in r)if(r.hasOwnProperty(i))if(i.indexOf(":")!==-1){const o=i.split(":");n.setAttributeNS("http://www.w3.org/1999/"+o[0],o[1],r[i])}else n.setAttribute(i,r[i]);return e.appendChild(n),n}static removeElement(e){if(!e){console.warn("removeElement, element is",e);return}e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode")}}const We={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",beforeRedrawBoard:"beforeRedrawBoard",afterRedrawBoard:"afterRedrawBoard",redrawBoard:"redrawBoard",animation:"animation",destroy:"destroy"};class Gi{constructor(e){this.chessboard=e}registerExtensionPoint(e,t){e===We.redrawBoard&&(console.warn("EXTENSION_POINT.redrawBoard is deprecated, use EXTENSION_POINT.afterRedrawBoard"),e=We.afterRedrawBoard),this.chessboard.state.extensionPoints[e]||(this.chessboard.state.extensionPoints[e]=[]),this.chessboard.state.extensionPoints[e].push(t)}registerMethod(e,t){console.warn("registerMethod is deprecated, just add methods directly to the chessboard instance"),this.chessboard[e]?log.error("method",e,"already exists"):this.chessboard[e]=(...r)=>t.apply(this,r)}}class Qs{static delegate(e,t,r,n){const i=function(o){let l=o.target;for(;l&&l!==this;)l.matches(r)&&n.call(l,o),l=l.parentNode};return e.addEventListener(t,i),{remove:function(){e.removeEventListener(t,i)}}}static mergeObjects(e,t){const r=n=>n&&typeof n=="object";if(!r(e)||!r(t))return t;for(const n of Object.keys(t))t[n]instanceof Object&&Object.assign(t[n],Qs.mergeObjects(e[n],t[n]));return Object.assign(e||{},t),e}static createDomElement(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}static createTask(){let e,t;const r=new Promise(function(n,i){e=n,t=i});return r.resolve=e,r.reject=t,r}static isAbsoluteUrl(e){return e.indexOf("://")!==-1||e.startsWith("/")}}const hi={start:"start",frame:"frame",end:"end"};class xu{constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}async enqueue(e){return new Promise((t,r)=>{this.queue.push({promise:e,resolve:t,reject:r}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop){this.queue=[],this.stop=!1;return}const e=this.queue.shift();if(e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}}const Is={move:0,appear:1,disappear:2};class $r{constructor(e,t,r,n,i){this.view=e,t&&r?(this.animatedElements=this.createAnimation(t.squares,r.squares),this.duration=n,this.callback=i,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",r),this.view.positionsAnimationTask=Qs.createTask(),this.view.chessboard.state.invokeExtensionPoints(We.animation,{type:hi.start})}static seekChanges(e,t){const r=[],n=[],i=[];for(let o=0;o<64;o++){const l=e[o],c=t[o];c!==l&&(c&&r.push({piece:c,index:o}),l&&n.push({piece:l,index:o}))}return r.forEach(o=>{let l=8,c=null;n.forEach(u=>{if(o.piece===u.piece){const d=$r.squareDistance(o.index,u.index);d<l&&(c=u,l=d)}}),c?(n.splice(n.indexOf(c),1),i.push({type:Is.move,piece:o.piece,atIndex:c.index,toIndex:o.index})):i.push({type:Is.appear,piece:o.piece,atIndex:o.index})}),n.forEach(o=>{i.push({type:Is.disappear,piece:o.piece,atIndex:o.index})}),i}createAnimation(e,t){const r=$r.seekChanges(e,t),n=[];return r.forEach(i=>{const o={type:i.type};switch(i.type){case Is.move:o.element=this.view.getPieceElement(nt.indexToSquare(i.atIndex)),o.element.parentNode.appendChild(o.element),o.atPoint=this.view.indexToPoint(i.atIndex),o.toPoint=this.view.indexToPoint(i.toIndex);break;case Is.appear:o.element=this.view.drawPieceOnSquare(nt.indexToSquare(i.atIndex),i.piece),o.element.style.opacity=0;break;case Is.disappear:o.element=this.view.getPieceElement(nt.indexToSquare(i.atIndex));break}n.push(o)}),n}animationStep(e){if(!this.view||!this.view.chessboard.state)return;this.startTime||(this.startTime=e);const t=e-this.startTime;if(t<=this.duration)this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));else{cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(i=>{i.type===Is.disappear&&pe.removeElement(i.element)}),this.view.positionsAnimationTask.resolve(),this.view.chessboard.state.invokeExtensionPoints(We.animation,{type:hi.end}),this.callback();return}const r=Math.min(1,t/this.duration);let n=r<.5?2*r*r:-1+(4-2*r)*r;(isNaN(n)||n>.99)&&(n=1),this.animatedElements.forEach(i=>{if(i.element)switch(i.type){case Is.move:i.element.transform.baseVal.removeItem(0);const o=this.view.svg.createSVGTransform();o.setTranslate(i.atPoint.x+(i.toPoint.x-i.atPoint.x)*n,i.atPoint.y+(i.toPoint.y-i.atPoint.y)*n),i.element.transform.baseVal.appendItem(o);break;case Is.appear:i.element.style.opacity=Math.round(n*100)/100;break;case Is.disappear:i.element.style.opacity=Math.round((1-n)*100)/100;break}else console.warn("animatedItem has no element",i)}),this.view.chessboard.state.invokeExtensionPoints(We.animation,{type:hi.frame,progress:n})}static squareDistance(e,t){const r=e%8,n=Math.floor(e/8),i=t%8,o=Math.floor(t/8);return Math.max(Math.abs(o-n),Math.abs(i-r))}}class Pu extends xu{constructor(e){super(),this.chessboard=e}async enqueuePositionChange(e,t,r){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(n=>{let i=r?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(i=i/(1+Math.pow(this.queue.length/5,2))),new $r(this.chessboard.view,e,t,r?i:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),n()})}))}async enqueueTurnBoard(e,t,r){return super.enqueue(()=>new Promise(n=>{const i=new nt(fn.empty);let o=r?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(o=o/(1+Math.pow(this.queue.length/5,2))),new $r(this.chessboard.view,e,i,r?o:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(i.squares),new $r(this.chessboard.view,i,e,r?o:0,()=>{this.chessboard.view.redrawPieces(e.squares),n()})})}))}}const B={waitForInputStart:"waitForInputStart",pieceClickedThreshold:"pieceClickedThreshold",clickTo:"clickTo",secondClickThreshold:"secondClickThreshold",dragTo:"dragTo",clickDragTo:"clickDragTo",moveDone:"moveDone",reset:"reset"},en={secondClick:"secondClick",secondaryClick:"secondaryClick",movedOutOfBoard:"movedOutOfBoard",draggedBack:"draggedBack",clickedAnotherPiece:"clickedAnotherPiece"},Sa=4;class qu{constructor(e){this.view=e,this.chessboard=e.chessboard,this.moveInputState=null,this.fromSquare=null,this.toSquare=null,this.setMoveInputState(B.waitForInputStart)}moveInputStartedCallback(e){const t=this.view.moveInputStartedCallback(e);return t&&(this.chessboard.state.moveInputProcess=Qs.createTask(),this.chessboard.state.moveInputProcess.then(r=>{(this.moveInputState===B.waitForInputStart||this.moveInputState===B.moveDone)&&this.view.moveInputFinishedCallback(this.fromSquare,this.toSquare,r)})),t}movingOverSquareCallback(e,t){this.view.movingOverSquareCallback(e,t)}validateMoveInputCallback(e,t){const r=this.view.validateMoveInputCallback(e,t);return this.chessboard.state.moveInputProcess.resolve(r),r}moveInputCanceledCallback(e,t,r){this.view.moveInputCanceledCallback(e,t,r),this.chessboard.state.moveInputProcess.resolve()}setMoveInputState(e,t=void 0){const r=this.moveInputState;switch(this.moveInputState=e,e){case B.waitForInputStart:break;case B.pieceClickedThreshold:if(B.waitForInputStart!==r&&B.clickTo!==r)throw new Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.fromSquare=t.square,this.toSquare=null,this.movedPiece=t.piece,this.startPoint=t.point,!this.pointerMoveListener&&!this.pointerUpListener){if(t.type==="mousedown")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else if(t.type==="touchstart")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener);else throw Error("4b74af");this.contextMenuListener||(this.contextMenuListener=this.onContextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener))}else throw Error("94ad0c");break;case B.clickTo:this.draggablePiece&&(pe.removeElement(this.draggablePiece),this.draggablePiece=null),r===B.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case B.secondClickThreshold:if(B.clickTo!==r)throw new Error("moveInputState");this.startPoint=t.point;break;case B.dragTo:if(B.pieceClickedThreshold!==r)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case B.clickDragTo:if(B.secondClickThreshold!==r)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case B.moveDone:if([B.dragTo,B.clickTo,B.clickDragTo].indexOf(r)===-1)throw new Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?this.chessboard.movePiece(this.fromSquare,this.toSquare,r===B.clickTo).then(()=>{r===B.clickTo&&this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(B.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(B.reset));break;case B.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=null,this.toSquare=null,this.movedPiece=null,this.draggablePiece&&(pe.removeElement(this.draggablePiece),this.draggablePiece=null),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.contextMenuListener&&(removeEventListener("contextmenu",this.contextMenuListener),this.contextMenuListener=null),this.setMoveInputState(B.waitForInputStart);const n=this.view.piecesGroup.querySelectorAll("[visibility=hidden]");for(let i=0;i<n.length;i++)n[i].removeAttribute("visibility");break;default:throw Error(`260b09: moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece already exists");this.draggablePiece=pe.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.chessboard.props.assetsCache?"":this.view.getSpriteUrl(),r=pe.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),n=this.view.squareHeight/this.chessboard.props.style.pieces.tileSize,i=this.draggablePiece.createSVGTransform();i.setScale(n,n),r.transform.baseVal.appendItem(i)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if(!(e.type==="mousedown"&&e.button===0||e.type==="touchstart"))return;const t=e.target.getAttribute("data-square");if(!t)return;const r=this.chessboard.getPiece(t);let n;if(r&&(n=r?r.substring(0,1):null,(n==="w"&&this.chessboard.state.inputWhiteEnabled||n==="b"&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault()),this.moveInputState!==B.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&n==="w"||this.chessboard.state.inputBlackEnabled&&n==="b"){let i;if(e.type==="mousedown"?i={x:e.clientX,y:e.clientY}:e.type==="touchstart"&&(i={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===B.waitForInputStart&&r&&this.moveInputStartedCallback(t))this.setMoveInputState(B.pieceClickedThreshold,{square:t,piece:r,point:i,type:e.type});else if(this.moveInputState===B.clickTo)if(t===this.fromSquare)this.setMoveInputState(B.secondClickThreshold,{square:t,piece:r,point:i,type:e.type});else{const o=this.chessboard.getPiece(t),l=o?o.substring(0,1):null,c=this.chessboard.getPiece(this.fromSquare),u=c?c.substring(0,1):null;n&&u===l?this.validateMoveInputCallback(this.fromSquare,t)||(this.moveInputCanceledCallback(this.fromSquare,t,en.clickedAnotherPiece),this.moveInputStartedCallback(t)?this.setMoveInputState(B.pieceClickedThreshold,{square:t,piece:o,point:i,type:e.type}):this.setMoveInputState(B.reset)):this.setMoveInputState(B.moveDone,{square:t})}}}onPointerMove(e){let t,r,n,i,o;if(e.type==="mousemove"?(n=e.clientX,i=e.clientY,t=e.pageX,r=e.pageY,o=e.target):e.type==="touchmove"&&(n=e.touches[0].clientX,i=e.touches[0].clientY,t=e.touches[0].pageX,r=e.touches[0].pageY,o=document.elementFromPoint(n,i)),this.moveInputState===B.pieceClickedThreshold||this.moveInputState===B.secondClickThreshold)(Math.abs(this.startPoint.x-n)>Sa||Math.abs(this.startPoint.y-i)>Sa)&&(this.moveInputState===B.secondClickThreshold?this.setMoveInputState(B.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(B.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled()&&this.moveDraggablePiece(t,r));else if(this.moveInputState===B.dragTo||this.moveInputState===B.clickDragTo||this.moveInputState===B.clickTo){if(o&&o.getAttribute&&o.parentElement===this.view.boardGroup){const l=o.getAttribute("data-square");l!==this.fromSquare&&l!==this.toSquare?(this.toSquare=l,this.movingOverSquareCallback(this.fromSquare,this.toSquare)):l===this.fromSquare&&this.toSquare!==null&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null))}else this.toSquare!==null&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null));this.view.chessboard.state.inputEnabled()&&(this.moveInputState===B.dragTo||this.moveInputState===B.clickDragTo)&&this.moveDraggablePiece(t,r)}}onPointerUp(e){let t;if(e.type==="mouseup"?t=e.target:e.type==="touchend"&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const r=t.getAttribute("data-square");if(r)this.moveInputState===B.dragTo||this.moveInputState===B.clickDragTo?this.fromSquare===r?this.moveInputState===B.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(r,null,en.draggedBack),this.setMoveInputState(B.reset)):this.setMoveInputState(B.clickTo,{square:r}):this.setMoveInputState(B.moveDone,{square:r}):this.moveInputState===B.pieceClickedThreshold?this.setMoveInputState(B.clickTo,{square:r}):this.moveInputState===B.secondClickThreshold&&(this.setMoveInputState(B.reset),this.moveInputCanceledCallback(r,null,en.secondClick));else{this.view.redrawPieces();const n=this.fromSquare;this.setMoveInputState(B.reset),this.moveInputCanceledCallback(n,null,en.movedOutOfBoard)}}else this.view.redrawPieces(),this.setMoveInputState(B.reset)}onContextMenu(e){e.preventDefault(),this.view.redrawPieces(),this.setMoveInputState(B.reset),this.moveInputCanceledCallback(this.fromSquare,null,en.secondaryClick)}isDragging(){return this.moveInputState===B.dragTo||this.moveInputState===B.clickDragTo}destroy(){this.setMoveInputState(B.reset)}}const is={white:"w",black:"b"},Yt={moveInputStarted:"moveInputStarted",movingOverSquare:"movingOverSquare",validateMoveInput:"validateMoveInput",moveInputCanceled:"moveInputCanceled",moveInputFinished:"moveInputFinished"},Po={pointerdown:"pointerdown"},Tr={none:"none",thin:"thin",frame:"frame"};class Au{constructor(e){this.chessboard=e,this.visualMoveInput=new qu(this),e.props.assetsCache&&this.cacheSpriteToDiv("cm-chessboard-sprite",this.getSpriteUrl()),this.container=document.createElement("div"),this.chessboard.context.appendChild(this.container),e.props.responsive&&(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(()=>{setTimeout(()=>{this.handleResize()})}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.positionsAnimationTask=Promise.resolve(),this.pointerDownListener=this.pointerDownHandler.bind(this),this.container.addEventListener("mousedown",this.pointerDownListener),this.container.addEventListener("touchstart",this.pointerDownListener,{passive:!1}),this.createSvgAndGroups(),this.handleResize()}pointerDownHandler(e){this.visualMoveInput.onPointerDown(e)}destroy(){this.visualMoveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),pe.removeElement(this.svg),this.container.remove()}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){const r=document.createElement("div");r.style.transform="scale(0)",r.style.position="absolute",r.setAttribute("aria-hidden","true"),r.id=e,document.body.appendChild(r);const n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){r.insertAdjacentHTML("afterbegin",n.response)},n.send()}}createSvgAndGroups(){this.svg=pe.createSvg(this.container);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=pe.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=pe.addElement(this.svg,"g",{class:"coordinates","aria-hidden":"true"}),this.markersLayer=pe.addElement(this.svg,"g",{class:"markers-layer"}),this.piecesLayer=pe.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=pe.addElement(this.piecesLayer,"g",{class:"pieces"}),this.markersTopLayer=pe.addElement(this.svg,"g",{class:"markers-top-layer"}),this.interactiveTopLayer=pe.addElement(this.svg,"g",{class:"interactive-top-layer"})}updateMetrics(){const e=this.chessboard.props.style.pieces.tileSize;this.width=this.container.clientWidth,this.height=this.container.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===Tr.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===Tr.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/e,this.scalingY=this.squareHeight/e,this.pieceXTranslate=this.squareWidth/2-e*this.scalingY/2}handleResize(){this.container.style.width=this.chessboard.context.clientWidth+"px",this.container.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",(this.container.clientWidth!==this.width||this.container.clientHeight!==this.height)&&(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.chessboard.state.invokeExtensionPoints(We.beforeRedrawBoard),this.redrawSquares(),this.drawCoordinates(),this.chessboard.state.invokeExtensionPoints(We.afterRedrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(pe.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===Tr.frame){const t=this.borderSize;pe.addElement(this.boardGroup,"rect",{x:t,y:t,width:this.width-t*2,height:this.height-t*2}).setAttribute("class","border-inner")}for(let t=0;t<64;t++){const r=this.chessboard.state.orientation===is.white?t:63-t,i=`square ${(9*r&8)===0?"black":"white"}`,o=this.squareToPoint(nt.indexToSquare(r)),l=pe.addElement(this.boardGroup,"rect",{x:o.x,y:o.y,width:this.squareWidth,height:this.squareHeight});l.setAttribute("class",i),l.setAttribute("data-square",nt.indexToSquare(r))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==Tr.frame;for(let t=0;t<8;t++){let r=this.borderSize+(17+this.chessboard.props.style.pieces.tileSize*t)*this.scalingX,n=this.height-this.scalingY*3.5,i="coordinate file";e&&(r=r+this.scalingX*15.5,i+=t%2?" white":" black");const o=pe.addElement(this.coordinatesGroup,"text",{class:i,x:r,y:n,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===is.white?o.textContent=String.fromCharCode(97+t):o.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let r=this.borderSize/3.7,n=this.borderSize+25*this.scalingY+t*this.squareHeight,i="coordinate rank";e&&(i+=t%2?" black":" white",this.chessboard.props.style.borderType===Tr.frame?(r=r+this.scalingX*10,n=n-this.scalingY*15):(r=r+this.scalingX*2,n=n-this.scalingY*15));const o=pe.addElement(this.coordinatesGroup,"text",{class:i,x:r,y:n,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===is.white?o.textContent=""+(8-t):o.textContent=""+(1+t)}}redrawPieces(e=this.chessboard.state.position.squares){const t=Array.from(this.piecesGroup.childNodes),r=this.visualMoveInput.isDragging();for(let n=0;n<64;n++){const i=e[n];if(i){const o=nt.indexToSquare(n);this.drawPieceOnSquare(o,i,r&&o===this.visualMoveInput.fromSquare)}}for(const n of t)this.piecesGroup.removeChild(n)}drawPiece(e,t,r){const n=pe.addElement(e,"g",{});n.setAttribute("data-piece",t);const i=this.svg.createSVGTransform();i.setTranslate(r.x,r.y),n.transform.baseVal.appendItem(i);const o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),l=pe.addElement(n,"use",{href:`${o}#${t}`,class:"piece"}),c=this.svg.createSVGTransform();return c.setScale(this.scalingY,this.scalingY),l.transform.baseVal.appendItem(c),n}drawPieceOnSquare(e,t,r=!1){const n=pe.addElement(this.piecesGroup,"g",{});n.setAttribute("data-piece",t),n.setAttribute("data-square",e),r&&n.setAttribute("visibility","hidden");const i=this.squareToPoint(e),o=this.svg.createSVGTransform();o.setTranslate(i.x,i.y),n.transform.baseVal.appendItem(o);const l=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),c=pe.addElement(n,"use",{href:`${l}#${t}`,class:"piece"}),u=this.svg.createSVGTransform();u.setTranslate(this.pieceXTranslate,0),c.transform.baseVal.appendItem(u);const d=this.svg.createSVGTransform();return d.setScale(this.scalingY,this.scalingY),c.transform.baseVal.appendItem(d),n}setPieceVisibility(e,t=!0){const r=this.getPieceElement(e);r?t?r.setAttribute("visibility","visible"):r.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(!e||e.length<2)return console.warn("invalid square",e),null;const t=this.piecesGroup.querySelector(`g[data-square='${e}']`);return t||(console.warn("no piece on",e),null)}enableMoveInput(e,t=null){if(this.chessboard.state.moveInputCallback)throw Error("moveInput already enabled");t===is.white?this.chessboard.state.inputWhiteEnabled=!0:t===is.black?this.chessboard.state.inputBlackEnabled=!0:(this.chessboard.state.inputWhiteEnabled=!0,this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(We.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.moveInputCallback=null,this.chessboard.state.invokeExtensionPoints(We.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){const t={chessboard:this.chessboard,type:Yt.moveInputStarted,square:e,squareFrom:e,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(t.moveInputCallbackResult=this.chessboard.state.moveInputCallback(t)),this.chessboard.state.invokeExtensionPoints(We.moveInput,t),t.moveInputCallbackResult}movingOverSquareCallback(e,t){const r={chessboard:this.chessboard,type:Yt.movingOverSquare,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.chessboard.state.moveInputCallback&&(r.moveInputCallbackResult=this.chessboard.state.moveInputCallback(r)),this.chessboard.state.invokeExtensionPoints(We.moveInput,r)}validateMoveInputCallback(e,t){const r={chessboard:this.chessboard,type:Yt.validateMoveInput,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(r.moveInputCallbackResult=this.chessboard.state.moveInputCallback(r)),this.chessboard.state.invokeExtensionPoints(We.moveInput,r),r.moveInputCallbackResult}moveInputCanceledCallback(e,t,r){const n={chessboard:this.chessboard,type:Yt.moveInputCanceled,reason:r,squareFrom:e,squareTo:t};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(n),this.chessboard.state.invokeExtensionPoints(We.moveInput,n)}moveInputFinishedCallback(e,t,r){const n={chessboard:this.chessboard,type:Yt.moveInputFinished,squareFrom:e,squareTo:t,legalMove:r};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(n),this.chessboard.state.invokeExtensionPoints(We.moveInput,n)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,r;return this.chessboard.state.orientation===is.white?(t=this.borderSize+e%8*this.squareWidth,r=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,r=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:r}}squareToPoint(e){const t=nt.squareToIndex(e);return this.indexToPoint(t)}getSpriteUrl(){return Qs.isAbsoluteUrl(this.chessboard.props.style.pieces.file)?this.chessboard.props.style.pieces.file:this.chessboard.props.assetsUrl+this.chessboard.props.style.pieces.file}}const rr={wp:"wp",wb:"wb",wn:"wn",wr:"wr",wq:"wq",wk:"wk",bp:"bp",bb:"bb",bn:"bn",br:"br",bq:"bq",bk:"bk"},Mu={svgSprite:"svgSprite"};class Iu{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[],this.props={position:fn.empty,orientation:is.white,responsive:!0,assetsUrl:"./assets/",assetsCache:!0,style:{cssClass:"default",showCoordinates:!0,borderType:Tr.none,aspectRatio:1,pieces:{type:Mu.svgSprite,file:"pieces/standard.svg",tileSize:40},animationDuration:300},extensions:[]},Qs.mergeObjects(this.props,t),this.state=new Cu,this.view=new Au(this),this.positionAnimationsQueue=new Pu(this),this.state.orientation=this.props.orientation;for(const r of this.props.extensions)this.addExtension(r.class,r.props);this.view.redrawBoard(),this.state.position=new nt(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(We.positionChanged),this.initialized=Promise.resolve()}async setPiece(e,t,r=!1){const n=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(We.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(n,this.state.position.clone(),r)}async movePiece(e,t,r=!1){const n=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(We.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(n,this.state.position.clone(),r)}async setPosition(e,t=!1){const r=this.state.position.clone(),n=new nt(e);return r.getFen()!==n.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(We.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(r,this.state.position.clone(),t)}async setOrientation(e,t=!1){const r=this.state.position.clone();if(this.boardTurning){console.warn("setOrientation is only once in queue allowed");return}return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(r,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(We.boardChanged)})}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}enableMoveInput(e,t=void 0){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}isMoveInputEnabled(){return this.state.inputWhiteEnabled||this.state.inputBlackEnabled}enableSquareSelect(e=Po.pointerdown,t){this.squareSelectListener||(this.squareSelectListener=function(r){const n=r.target.getAttribute("data-square");t({eventType:r.type,event:r,chessboard:this,square:n})}),this.context.addEventListener(e,this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(e){this.context.removeEventListener(e,this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}isSquareSelectEnabled(){return this.state.squareSelectEnabled}addExtension(e,t){if(this.getExtension(e))throw Error('extension "'+e.name+'" already added');this.extensions.push(new e(this,t))}getExtension(e){for(const t of this.extensions)if(t instanceof e)return t;return null}destroy(){this.state.invokeExtensionPoints(We.destroy),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0}}const Ft={hidden:"hidden",displayRequested:"displayRequested",shown:"shown"},Tu={de:{choosePromotion:"Bauernumwandlung wÃ¤hlen",promotionDialogTitle:"Bauernumwandlung",pieces:{q:"Dame",r:"Turm",b:"LÃ¤ufer",n:"Springer"},promoteTo:"Umwandeln in"},en:{choosePromotion:"Choose promotion piece",promotionDialogTitle:"Pawn promotion",pieces:{q:"Queen",r:"Rook",b:"Bishop",n:"Knight"},promoteTo:"Promote to"}},nn={pieceSelected:"pieceSelected",canceled:"canceled"};class Lu extends Gi{constructor(e,t={}){super(e),this.props={language:navigator.language.substring(0,2).toLowerCase()},Object.assign(this.props,t),this.props.language!=="de"&&this.props.language!=="en"&&(this.props.language="en"),this.t=Tu[this.props.language],this.pieceOrder=["q","r","b","n"],this.focusedIndex=0,this.previouslyFocusedElement=null,this.registerExtensionPoint(We.afterRedrawBoard,this.extensionPointRedrawBoard.bind(this)),this.registerExtensionPoint(We.destroy,this.destroy.bind(this)),e.showPromotionDialog=this.showPromotionDialog.bind(this),e.isPromotionDialogShown=this.isPromotionDialogShown.bind(this),this.promotionDialogGroup=pe.addElement(e.view.interactiveTopLayer,"g",{class:"promotion-dialog-group",role:"dialog","aria-modal":"true","aria-label":this.t.choosePromotion}),this.liveRegion=document.createElement("div"),this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.className="cm-chessboard-promotion-live-region visually-hidden",this.liveRegion.style.cssText="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;",e.context.appendChild(this.liveRegion),this.state={displayState:Ft.hidden,callback:null,dialogParams:{square:null,color:null}},this.handleKeyDown=this.handleKeyDown.bind(this)}showPromotionDialog(e,t,r){this.previouslyFocusedElement=document.activeElement,this.focusedIndex=0,this.state.dialogParams.square=e,this.state.dialogParams.color=t,this.state.callback=r,this.setDisplayState(Ft.displayRequested),setTimeout(()=>{this.chessboard.view.positionsAnimationTask.then(()=>{this.setDisplayState(Ft.shown),this.announce(this.t.choosePromotion+": "+this.pieceOrder.map(n=>this.t.pieces[n]).join(", "))})})}isPromotionDialogShown(){return this.state.displayState===Ft.shown||this.state.displayState===Ft.displayRequested}extensionPointRedrawBoard(){this.redrawDialog()}drawPieceButton(e,t,r){const n=this.chessboard.view.squareWidth,i=this.chessboard.view.squareHeight,o=e.charAt(1),l=this.t.pieces[o],c=pe.addElement(this.promotionDialogGroup,"g",{class:"promotion-dialog-button-group",role:"button",tabindex:r===0?"0":"-1","aria-label":l,"data-piece":e,"data-index":r});pe.addElement(c,"rect",{x:t.x,y:t.y,width:n,height:i,class:"promotion-dialog-button","data-piece":e}),this.chessboard.view.drawPiece(c,e,t)}redrawDialog(){for(;this.promotionDialogGroup.firstChild;)this.promotionDialogGroup.removeChild(this.promotionDialogGroup.firstChild);if(this.state.displayState===Ft.shown){const e=this.chessboard.view.squareWidth,t=this.chessboard.view.squareHeight,r=this.chessboard.view.squareToPoint(this.state.dialogParams.square);r.x=r.x+e/2,r.y=r.y+t/2;let n=!1;const i=parseInt(this.state.dialogParams.square.charAt(1),10);(this.chessboard.getOrientation()===is.white&&i<5||this.chessboard.getOrientation()===is.black&&i>=5)&&(n=!0);const o=n?-4*t:0,l=r.x+e>this.chessboard.view.width?-e:0;pe.addElement(this.promotionDialogGroup,"rect",{x:r.x+l,y:r.y+o,width:e,height:t*4,class:"promotion-dialog"});const c=this.state.dialogParams;n?(this.drawPieceButton(rr[c.color+"q"],{x:r.x+l,y:r.y-t},0),this.drawPieceButton(rr[c.color+"r"],{x:r.x+l,y:r.y-t*2},1),this.drawPieceButton(rr[c.color+"b"],{x:r.x+l,y:r.y-t*3},2),this.drawPieceButton(rr[c.color+"n"],{x:r.x+l,y:r.y-t*4},3)):(this.drawPieceButton(rr[c.color+"q"],{x:r.x+l,y:r.y},0),this.drawPieceButton(rr[c.color+"r"],{x:r.x+l,y:r.y+t},1),this.drawPieceButton(rr[c.color+"b"],{x:r.x+l,y:r.y+t*2},2),this.drawPieceButton(rr[c.color+"n"],{x:r.x+l,y:r.y+t*3},3))}}promotionDialogOnClickPiece(e){if(e.button!==2){let t=e.target.dataset.piece;if(!t&&e.target.closest){const r=e.target.closest(".promotion-dialog-button-group");r&&(t=r.dataset.piece)}t?this.selectPiece(t):this.promotionDialogOnCancel(e)}}selectPiece(e){this.state.callback&&this.state.callback({type:nn.pieceSelected,square:this.state.dialogParams.square,piece:e}),this.setDisplayState(Ft.hidden)}promotionDialogOnCancel(e){this.state.displayState===Ft.shown&&(e.preventDefault(),this.setDisplayState(Ft.hidden),this.state.callback&&this.state.callback({type:nn.canceled}))}contextMenu(e){e.preventDefault(),this.setDisplayState(Ft.hidden),this.state.callback&&this.state.callback({type:nn.canceled})}setDisplayState(e){this.state.displayState=e,e===Ft.shown?(this.clickDelegate=Qs.delegate(this.chessboard.view.svg,"pointerdown","*",this.promotionDialogOnClickPiece.bind(this)),this.contextMenuListener=this.contextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener),document.addEventListener("keydown",this.handleKeyDown)):e===Ft.hidden&&(this.clickDelegate.remove(),this.chessboard.view.svg.removeEventListener("contextmenu",this.contextMenuListener),document.removeEventListener("keydown",this.handleKeyDown),this.previouslyFocusedElement&&this.previouslyFocusedElement.focus&&this.previouslyFocusedElement.focus()),this.redrawDialog(),e===Ft.shown&&setTimeout(()=>{this.focusButton(0)},0)}handleKeyDown(e){if(this.state.displayState===Ft.shown)switch(e.key){case"ArrowDown":case"ArrowRight":e.preventDefault(),this.focusedIndex=(this.focusedIndex+1)%4,this.focusButton(this.focusedIndex);break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),this.focusedIndex=(this.focusedIndex-1+4)%4,this.focusButton(this.focusedIndex);break;case"Enter":case" ":e.preventDefault();const t=this.promotionDialogGroup.querySelectorAll(".promotion-dialog-button-group");if(t[this.focusedIndex]){const r=t[this.focusedIndex].dataset.piece;this.selectPiece(r)}break;case"Escape":e.preventDefault(),this.setDisplayState(Ft.hidden),this.state.callback&&this.state.callback({type:nn.canceled});break;case"Tab":e.preventDefault(),e.shiftKey?this.focusedIndex=(this.focusedIndex-1+4)%4:this.focusedIndex=(this.focusedIndex+1)%4,this.focusButton(this.focusedIndex);break}}focusButton(e){const t=this.promotionDialogGroup.querySelectorAll(".promotion-dialog-button-group");if(t.forEach((r,n)=>{r.setAttribute("tabindex",n===e?"0":"-1")}),t[e]){t[e].focus();const r=this.pieceOrder[e];this.announce(this.t.pieces[r])}}announce(e){this.liveRegion.textContent="",setTimeout(()=>{this.liveRegion.textContent=e},50)}destroy(){document.removeEventListener("keydown",this.handleKeyDown),this.liveRegion&&this.liveRegion.parentNode&&this.liveRegion.parentNode.removeChild(this.liveRegion)}}const Ea={default:{class:"arrow-success"},success:{class:"arrow-success"},secondary:{class:"arrow-secondary"},warning:{class:"arrow-warning"},info:{class:"arrow-info"},danger:{class:"arrow-danger"}};class Du extends Gi{constructor(e,t={}){super(e),this.registerExtensionPoint(We.afterRedrawBoard,()=>{this.onRedrawBoard()}),this.props={sprite:"extensions/arrows/arrows.svg",slice:"arrowDefault",headSize:7,offsetFrom:0,offsetTo:.55},Object.assign(this.props,t),this.chessboard.props.assetsCache&&this.chessboard.view.cacheSpriteToDiv("cm-chessboard-arrows",this.getSpriteUrl()),e.addArrow=this.addArrow.bind(this),e.getArrows=this.getArrows.bind(this),e.removeArrows=this.removeArrows.bind(this),this.arrowGroup=pe.addElement(e.view.markersTopLayer,"g",{class:"arrows"}),this.arrows=[]}onRedrawBoard(){for(;this.arrowGroup.firstChild;)this.arrowGroup.removeChild(this.arrowGroup.firstChild);this.arrows.forEach(e=>{this.drawArrow(e)})}drawArrow(e){const t=this.chessboard.view,r=pe.addElement(this.arrowGroup,"g");r.setAttribute("data-arrow",e.from+e.to),r.setAttribute("class","arrow "+e.type.class);const n=t.squareToPoint(e.from),i=t.squareToPoint(e.to),o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),l=pe.addElement(r,"defs"),c="arrow-"+e.from+e.to,u=pe.addElement(l,"marker",{id:c,markerWidth:this.props.headSize,markerHeight:this.props.headSize,refX:20,refY:20,viewBox:"0 0 40 40",orient:"auto",class:"arrow-head"});pe.addElement(u,"use",{href:`${o}#${this.props.slice}`});const d=n.x+t.squareWidth/2,g=n.y+t.squareHeight/2,h=i.x+t.squareWidth/2,p=i.y+t.squareHeight/2,E=h-d,q=p-g,C=Math.hypot(E,q)||1,U=E/C,x=q/C,D=Math.min(t.squareWidth,t.squareHeight)/2,M=X=>Math.max(0,Math.min(1,X)),z=D*M(this.props.offsetFrom),Y=D*M(this.props.offsetTo),V=d+U*z,W=g+x*z,re=h-U*Y,oe=p-x*Y,Ye=(t.scalingX+t.scalingY)/2*8;let Be=pe.addElement(r,"line");Be.setAttribute("x1",V.toString()),Be.setAttribute("x2",re.toString()),Be.setAttribute("y1",W.toString()),Be.setAttribute("y2",oe.toString()),Be.setAttribute("class","arrow-line"),Be.setAttribute("marker-end","url(#"+c+")"),Be.setAttribute("stroke-width",Ye+"px")}addArrow(e,t,r){this.arrows.push(new Ou(t,r,e)),this.chessboard.view.redrawBoard()}getArrows(e=void 0,t=void 0,r=void 0){let n=[];return this.arrows.forEach(i=>{i.matches(t,r,e)&&n.push(i)}),n}removeArrows(e=void 0,t=void 0,r=void 0){this.arrows=this.arrows.filter(n=>!n.matches(t,r,e)),this.chessboard.view.redrawBoard()}getSpriteUrl(){return Qs.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class Ou{constructor(e,t,r){this.from=e,this.to=t,this.type=r}matches(e=void 0,t=void 0,r=void 0){return e&&e!==this.from||t&&t!==this.to?!1:!(r&&r!==this.type)}}const gr={frame:{class:"marker-frame",slice:"markerFrame"},dot:{class:"marker-dot",slice:"markerDot",position:"above"},bevel:{class:"marker-bevel",slice:"markerBevel"}};class Ru extends Gi{constructor(e,t={}){super(e),this.registerExtensionPoint(We.afterRedrawBoard,()=>{this.onRedrawBoard()}),this.props={autoMarkers:gr.frame,sprite:"extensions/markers/markers.svg"},Object.assign(this.props,t),e.props.assetsCache&&e.view.cacheSpriteToDiv("cm-chessboard-markers",this.getSpriteUrl()),e.addMarker=this.addMarker.bind(this),e.getMarkers=this.getMarkers.bind(this),e.removeMarkers=this.removeMarkers.bind(this),e.addLegalMovesMarkers=this.addLegalMovesMarkers.bind(this),e.removeLegalMovesMarkers=this.removeLegalMovesMarkers.bind(this),this.markerGroupDown=pe.addElement(e.view.markersLayer,"g",{class:"markers"}),this.markerGroupUp=pe.addElement(e.view.markersTopLayer,"g",{class:"markers"}),this.markers=[],this.props.autoMarkers&&(Object.assign(this.props.autoMarkers,this.props.autoMarkers),this.registerExtensionPoint(We.moveInput,r=>{this.drawAutoMarkers(r)}))}drawAutoMarkers(e){e.type!==Yt.moveInputFinished&&this.removeMarkers(this.props.autoMarkers),!(e.type===Yt.moveInputStarted&&!e.moveInputCallbackResult)&&(e.type===Yt.moveInputStarted||e.type===Yt.movingOverSquare)&&(e.squareFrom&&this.addMarker(this.props.autoMarkers,e.squareFrom),e.squareTo&&this.addMarker(this.props.autoMarkers,e.squareTo))}onRedrawBoard(){for(;this.markerGroupUp.firstChild;)this.markerGroupUp.removeChild(this.markerGroupUp.firstChild);for(;this.markerGroupDown.firstChild;)this.markerGroupDown.removeChild(this.markerGroupDown.firstChild);this.markers.forEach(e=>{this.drawMarker(e)})}addLegalMovesMarkers(e){for(const t of e)t.promotion&&t.promotion!=="q"||(this.chessboard.getPiece(t.to)?this.chessboard.addMarker(gr.bevel,t.to):this.chessboard.addMarker(gr.dot,t.to))}removeLegalMovesMarkers(){this.chessboard.removeMarkers(gr.bevel),this.chessboard.removeMarkers(gr.dot)}drawMarker(e){let t;e.type.position==="above"?t=pe.addElement(this.markerGroupUp,"g"):t=pe.addElement(this.markerGroupDown,"g"),t.setAttribute("data-square",e.square);const r=this.chessboard.view.squareToPoint(e.square),n=this.chessboard.view.svg.createSVGTransform();n.setTranslate(r.x,r.y),t.transform.baseVal.appendItem(n);const i=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),o=pe.addElement(t,"use",{href:`${i}#${e.type.slice}`,class:"marker "+e.type.class}),l=this.chessboard.view.svg.createSVGTransform();return l.setScale(this.chessboard.view.scalingX,this.chessboard.view.scalingY),o.transform.baseVal.appendItem(l),t}addMarker(e,t){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x");return}this.markers.push(new Nu(t,e)),this.onRedrawBoard()}getMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");return}let r=[];return this.markers.forEach(n=>{n.matches(t,e)&&r.push(n)}),r}removeMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x");return}this.markers=this.markers.filter(r=>!r.matches(t,e)),this.onRedrawBoard()}getSpriteUrl(){return Qs.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class Nu{constructor(e,t){this.square=e,this.type=t}matches(e=void 0,t=void 0){if(!t&&!e)return!0;if(t){if(e){if(this.type===t&&e===this.square)return!0}else if(this.type===t)return!0}else if(e===this.square)return!0;return!1}}var $u=$('<div class="chessboard-container svelte-ipgdpj"></div>');function qo(s,e){Os(e,!0);let t=ps(e,"fen",19,()=>fn.start),r=ps(e,"orientation",3,"white"),n=ps(e,"arrows",19,()=>[]),i=ps(e,"markers",19,()=>[]),o=ps(e,"inputMode",3,"none"),l=ps(e,"showCoordinates",3,!0),c,u=null,d=null;Kr(()=>{const x=[];x.push({class:Lu}),x.push({class:Du}),x.push({class:Ru,props:{autoMarkers:null}}),u=new Iu(c,{position:t(),orientation:r()==="white"?is.white:is.black,responsive:!0,assetsUrl:"./cm-chessboard/",style:{cssClass:"default",showCoordinates:l(),borderType:"none",aspectRatio:1,animationDuration:200},extensions:x}),h(o()),C()}),bo(()=>{u?.destroy(),u=null}),ft(()=>{u&&t()&&u.setPosition(t(),!0)}),ft(()=>{if(u){const x=r()==="white"?is.white:is.black;u.setOrientation(x,!0)}});function g(x,D,M,z,Y,V,W){const re="http://www.w3.org/2000/svg";let oe=Y.querySelector(`.${W}`);oe||(oe=document.createElementNS(re,"defs"),oe.setAttribute("class",W),Y.appendChild(oe));const Ye=`mask-head-${W}-${D}`,Be=z.cloneNode(!0);Be.id=Ye;const X=Be.querySelector("use");X&&(X.style.fill="black"),oe.appendChild(Be);const ge=`outline-mask-${W}-${D}`,ce=document.createElementNS(re,"mask");ce.id=ge,ce.setAttribute("maskUnits","userSpaceOnUse"),ce.setAttribute("x","0"),ce.setAttribute("y","0"),ce.setAttribute("width","10000"),ce.setAttribute("height","10000");const Se=document.createElementNS(re,"rect");Se.setAttribute("x","0"),Se.setAttribute("y","0"),Se.setAttribute("width","10000"),Se.setAttribute("height","10000"),Se.setAttribute("fill","white"),ce.appendChild(Se);const Ee=M.cloneNode(!0);Ee.setAttribute("stroke","black"),Ee.style.opacity="1",Ee.style.strokeLinecap="round",Ee.setAttribute("marker-end",`url(#${Ye})`),ce.appendChild(Ee),oe.appendChild(ce);const me=document.createElementNS(re,"g");me.setAttribute("class",`arrow-outline-${W}`),me.setAttribute("mask",`url(#${ge})`);const Re=`outline-head-${W}-${D}`,he=z.cloneNode(!0);he.id=Re;const j=he.querySelector("use");j&&(j.style.fill=V);const _e=document.createElementNS(re,"defs");_e.appendChild(he),me.appendChild(_e);const Pe=M.cloneNode(!0),Je=parseFloat(M.getAttribute("stroke-width")||"0");Pe.setAttribute("stroke-width",String(Je+5)),Pe.style.stroke=V,Pe.style.opacity="1",Pe.style.strokeLinecap="round",Pe.setAttribute("marker-end",`url(#${Re})`),me.appendChild(Pe),x.parentNode.insertBefore(me,x)}ft(()=>{if(u&&(u.removeArrows(),c?.querySelector("svg .engine-hover-defs")?.remove(),c?.querySelector("svg .continuation-hover-defs")?.remove(),n().length!==0)){for(const x of n()){const D=x.type?Ea[x.type]:Ea.default;u.addArrow(D,x.from,x.to)}for(const x of n()){const D=x.from+x.to,M=c?.querySelector(`[data-arrow="${D}"]`);if(!M)continue;M.style.opacity=String(x.opacity);const z=x.continuationHover?"gold":x.engineHover?"blue":null;if(!z)continue;const Y=M.querySelector(".arrow-line"),V=M.querySelector("defs"),W=V?.querySelector("marker");if(!Y||!V||!W)continue;const re=M.closest("svg");if(!re)continue;const oe=x.engineHover?"engine-hover-defs":"continuation-hover-defs";g(M,D,Y,W,re,z,oe)}}}),ft(()=>{if(u){u.removeMarkers(gr.dot);for(const x of i())u.addMarker(gr.dot,x.square)}}),ft(()=>{u&&o()!==d&&h(o())});function h(x){if(u){u.disableMoveInput();try{u.disableSquareSelect()}catch{}d=x,x==="legal"?u.enableMoveInput(p):x==="free"?u.enableMoveInput(E):x==="none"&&u.enableSquareSelect(Po.pointerdown,q)}}function p(x){if(x.type===Yt.moveInputStarted)return!0;if(x.type===Yt.validateMoveInput){const D=x.squareFrom,M=x.squareTo,z=x.piece,Y=z==="wp"&&M[1]==="8",V=z==="bp"&&M[1]==="1";if(Y||V){const W=z[0];return u?.showPromotionDialog(M,W,re=>{if(re.type===nn.pieceSelected&&re.piece){const oe=re.piece[1];e.onMove?.(D,M,oe)&&u?.setPosition(t(),!0)}}),!1}return e.onMove?.(D,M)??!1}x.type===Yt.moveInputFinished&&x.legalMove&&u?.setPosition(t(),!1)}function E(x){if(x.type===Yt.moveInputStarted)return!0;if(x.type===Yt.validateMoveInput){const D=x.squareFrom,M=x.squareTo,z=x.piece,Y=z[0]==="w"?z[1].toUpperCase():z[1].toLowerCase();return e.onFreeDrop?.(D,M,Y),!0}}function q(x){const D=x.square;D&&e.onSquareClick?.(D)}function C(){if(!c||!e.onArrowHover)return;const x=c.querySelector(".arrows");if(!x)return;let D=null;c.addEventListener("mousemove",M=>{x.style.pointerEvents="auto";const z=document.elementFromPoint(M.clientX,M.clientY);x.style.pointerEvents="none";const V=z?.closest?.("[data-arrow]")?.getAttribute("data-arrow")||null;V!==D&&(D=V,e.onArrowHover?.(V))}),c.addEventListener("mouseleave",()=>{D&&(D=null,e.onArrowHover?.(null))})}var U=$u();Rn(U,x=>c=x,()=>c),I(s,U),Rs()}var Fu=$('<span class="eval-label eval-label-dark svelte-5gau2q"> </span>'),Bu=$('<span class="eval-label svelte-5gau2q"> </span>'),Uu=$('<div><div class="eval-fill-black svelte-5gau2q"><!></div> <div class="eval-fill-white svelte-5gau2q"><!></div></div>');function Gu(s,e){Os(e,!0);let t=ps(e,"evaluation",3,null),r=ps(e,"orientation",3,"white");const n=fe(()=>t()===null?50:t().type==="mate"?t().moves>0?100:0:1/(1+Math.exp(-t().pawns*.5))*100),i=fe(()=>{if(t()===null)return"Â·Â·Â·";if(t().type==="mate"){const q=Math.abs(t().moves);return t().moves>0?`M${q}`:`âM${q}`}return`${t().pawns>=0?"+":"â"}${Math.abs(t().pawns).toFixed(1)}`});var o=Uu();let l;var c=y(o),u=y(c);{var d=E=>{var q=Fu(),C=y(q);Q(()=>R(C,a(i))),I(E,q)};ye(u,E=>{a(n)<50&&E(d)})}var g=S(c,2),h=y(g);{var p=E=>{var q=Bu(),C=y(q);Q(()=>R(C,a(i))),I(E,q)};ye(h,E=>{a(n)>=50&&E(p)})}Q(()=>{l=we(o,1,"eval-bar svelte-5gau2q",null,l,{flipped:r()==="black"}),gs(c,`height: ${100-a(n)}%`),gs(g,`height: ${a(n)??""}%`)}),I(s,o),Rs()}let Es=L(ht([])),br=L(0),hn=L(ht(new dr)),Wu=fe(()=>a(hn).fen()),wr=L(ht([]));function Ku(){const s=new dr,e=[];for(const t of a(Es))try{const r=s.move({from:t.slice(0,2),to:t.slice(2,4),promotion:t[4]});e.push(r.san)}catch{e.push(t)}f(wr,e,!0)}const Ie={get moves(){return a(Es)},get index(){return a(br)},get fen(){return a(Wu)},get sanList(){return a(wr)}};function Wi(s,e,t){a(br)<a(Es).length&&(f(Es,a(Es).slice(0,a(br)),!0),f(wr,a(wr).slice(0,a(br)),!0));try{const r=new dr(a(hn).fen()),n=r.move({from:s,to:e,promotion:t});if(!n)return!1;const i=s+e+(t||"");return f(Es,[...a(Es),i],!0),f(wr,[...a(wr),n.san],!0),Ql(br),f(hn,r,!0),!0}catch{return!1}}function as(s){const e=Math.max(0,Math.min(s,a(Es).length));f(br,e,!0);const t=new dr;for(let r=0;r<e;r++){const n=a(Es)[r];try{t.move({from:n.slice(0,2),to:n.slice(2,4),promotion:n[4]})}catch{break}}f(hn,t,!0)}function xi(){f(Es,[],!0),f(br,0),f(hn,new dr,!0),f(wr,[],!0)}function Ao(s,e){f(Es,[...s],!0),Ku(),as(Math.min(e,s.length))}let Lr=L(ht([])),Hu=0;function zu(s,e=2e3){const t=Hu++;a(Lr).push({id:t,message:s,visible:!1}),requestAnimationFrame(()=>{const r=a(Lr).find(n=>n.id===t);r&&(r.visible=!0)}),setTimeout(()=>{const r=a(Lr).find(n=>n.id===t);r&&(r.visible=!1),setTimeout(()=>{f(Lr,a(Lr).filter(n=>n.id!==t),!0)},300)},e)}var Vu=$("<div> </div>");function ju(s){var e=js(),t=tt(e);Bt(t,17,()=>a(Lr),Ls,(r,n)=>{var i=Vu();let o;var l=y(i);Q(()=>{o=we(i,1,"toast-notification svelte-1w29e1y",null,o,{visible:a(n).visible}),R(l,a(n).message)}),I(r,i)}),I(s,e)}let Kn=L(null),Hn=L(0),dn=L(ht([])),zn=L(!1),yt=null,Ki=0,Pi=0,Mo="white";const yr={get eval(){return a(Kn)},get depth(){return a(Hn)},get lines(){return a(dn)},get ready(){return a(zn)}};function Yu(s){const e=s.match(/\bdepth (\d+)/);if(!e)return null;const t=parseInt(e[1],10);let r;const n=s.match(/\bscore cp (-?\d+)/);if(n)r={type:"cp",pawns:parseInt(n[1],10)/100};else{const u=s.match(/\bscore mate (-?\d+)/);if(u)r={type:"mate",moves:parseInt(u[1],10)};else return null}const i=s.match(/\bmultipv (\d+)/),o=i?parseInt(i[1],10):1;let l=[];const c=s.indexOf(" pv ");return c!==-1&&(l=s.slice(c+4).split(/\s+/).filter(Boolean)),{eval:r,depth:t,multipv:o,pvUci:l}}function Qu(s){const e=typeof s.data=="string"?s.data:String(s.data);if(e==="readyok"){Pi++;return}if(e.startsWith("bestmove")||Pi<Ki||!e.startsWith("info")||!e.includes(" score "))return;const t=Yu(e);if(t){let r;Mo==="black"?t.eval.type==="cp"?r={type:"cp",pawns:-t.eval.pawns}:r={type:"mate",moves:-t.eval.moves}:r=t.eval;const n={multipv:t.multipv,eval:r,depth:t.depth,pvUci:t.pvUci},i=t.multipv-1,o=[...a(dn)];for(;o.length<=i;){const l=o.length+1;o.push({multipv:l,eval:r,depth:t.depth,pvUci:[]})}o[i]=n,f(dn,o,!0),t.multipv===1&&(f(Kn,r,!0),f(Hn,t.depth,!0))}}function Xu(){return new Promise((s,e)=>{try{yt=new Worker("./stockfish/stockfish-17.1-lite-51f59da.js")}catch(r){e(r);return}let t=!1;yt.onmessage=r=>{const n=typeof r.data=="string"?r.data:String(r.data);if(!t&&n==="uciok"){const i=Math.min(navigator.hardwareConcurrency||1,2);yt.postMessage(`setoption name Threads value ${i}`),yt.postMessage("setoption name Hash value 128"),yt.postMessage("setoption name MultiPV value 3"),yt.postMessage("isready"),t=!0;return}if(t&&n==="readyok"){yt.onmessage=Qu,f(zn,!0),s();return}},yt.onerror=r=>{e(new Error("Stockfish worker failed to load: "+r.message))},yt.postMessage("uci")})}function Zu(s){if(!yt||!a(zn))return;Ki++,f(Kn,null),f(Hn,0),f(dn,[],!0),Mo=s.length%2===0?"white":"black",yt.postMessage("stop"),yt.postMessage("isready");const e=s.length===0?"position startpos":"position startpos moves "+s.join(" ");yt.postMessage(e),yt.postMessage("go depth 30")}function Ju(){yt&&(yt.postMessage("quit"),yt.terminate(),yt=null),f(Kn,null),f(Hn,0),f(dn,[],!0),f(zn,!1),Ki=0,Pi=0}var ef=$('<div class="engine-line svelte-eu7elq"><span class="engine-moves svelte-eu7elq">&middot;&middot;&middot;</span></div>'),tf=$('<div class="engine-line clickable svelte-eu7elq" role="button" tabindex="0"><span> </span> <span class="engine-moves svelte-eu7elq"> </span></div>'),sf=$('<span class="move-list-empty svelte-eu7elq">Starting position</span>'),rf=$("<td> </td>"),nf=$('<td class="svelte-eu7elq"></td>'),af=$('<tr class="svelte-eu7elq"><td class="move-number svelte-eu7elq"></td><td> </td><!></tr>'),of=$('<table class="move-table svelte-eu7elq"></table>'),lf=$('<div class="engine-section svelte-eu7elq"><div class="engine-header svelte-eu7elq"><span class="engine-label svelte-eu7elq"> </span></div> <!></div> <div class="current-line-section svelte-eu7elq"><h3 class="section-title svelte-eu7elq">Current Line</h3> <div class="move-list svelte-eu7elq"><!></div></div> <div class="vcr-controls svelte-eu7elq"><button class="vcr-btn svelte-eu7elq" title="Start">â®</button> <button class="vcr-btn svelte-eu7elq" title="Back">â</button> <button class="vcr-btn svelte-eu7elq" title="Forward">â¶</button> <button class="vcr-btn svelte-eu7elq" title="End">â­</button></div> <div class="export-controls svelte-eu7elq"><button class="export-btn svelte-eu7elq">Copy PGN</button></div>',1);function cf(s,e){Os(e,!0);let t;function r(X,ge){if(ge.length===0)return"";const ce=new dr(X),Se=[],Ee=ce.turn()==="w"?0:1;for(let me=0;me<ge.length;me++){const Re=ge[me];try{const he=ce.move({from:Re.slice(0,2),to:Re.slice(2,4),promotion:Re[4]}),j=Ee+me;j%2===0?Se.push(`${Math.floor(j/2)+1}.${he.san}`):me===0?Se.push(`${Math.floor(j/2)+1}...${he.san}`):Se.push(he.san)}catch{Se.push(Re);break}}return Se.join(" ")}function n(X){if(!X)return;const ge=X.slice(0,2),ce=X.slice(2,4),Se=X[4];Wi(ge,ce,Se)}ft(()=>{Ie.index,vo().then(()=>{const X=t?.querySelector(".move-san.active");X&&X.scrollIntoView({block:"nearest",behavior:"smooth"})})});const i=fe(()=>Ie.index===0),o=fe(()=>Ie.index>=Ie.moves.length);function l(){let X="";const ge=Ie.sanList;for(let ce=0;ce<ge.length;ce++)ce%2===0?(ce>0&&(X+=" "),X+=`${Math.floor(ce/2)+1}. ${ge[ce]}`):X+=` ${ge[ce]}`;return X}function c(){const X=l();X&&navigator.clipboard.writeText(X).then(()=>zu("Copied!"))}var u=lf(),d=tt(u),g=y(d),h=y(g),p=y(h),E=S(g,2);{var q=X=>{var ge=ef();I(X,ge)},C=X=>{var ge=js(),ce=tt(ge);Bt(ce,17,()=>yr.lines,Se=>Se.multipv,(Se,Ee)=>{var me=tf();me.__click=()=>n(a(Ee).pvUci[0]);var Re=y(me);let he;var j=y(Re),_e=S(Re,2),Pe=y(_e);Q((Je,Me,Qe)=>{he=we(Re,1,"eval-badge svelte-eu7elq",null,he,Je),R(j,Me),R(Pe,Qe)},[()=>({positive:!zr(a(Ee).eval),negative:zr(a(Ee).eval)}),()=>Ui(a(Ee).eval),()=>r(Ie.fen,a(Ee).pvUci)]),Vs("mouseenter",me,()=>e.onEngineLineHover?.(a(Ee).pvUci[0]??null)),Vs("mouseleave",me,()=>e.onEngineLineHover?.(null)),I(Se,me)}),I(X,ge)};ye(E,X=>{yr.lines.length===0?X(q):X(C,!1)})}var U=S(d,2),x=S(y(U),2),D=y(x);{var M=X=>{var ge=sf();I(X,ge)},z=X=>{var ge=of();Bt(ge,21,()=>Array(Math.ceil(Ie.sanList.length/2)),Ls,(ce,Se,Ee)=>{const me=fe(()=>Ee*2);var Re=af(),he=y(Re);he.textContent=`${Ee+1}.`;var j=S(he);let _e;j.__click=()=>as(a(me)+1);var Pe=y(j),Je=S(j);{var Me=De=>{var at=rf();let Rt;at.__click=()=>as(a(me)+2);var Zt=y(at);Q(()=>{Rt=we(at,1,"move-san svelte-eu7elq",null,Rt,{active:a(me)+2===Ie.index}),R(Zt,Ie.sanList[a(me)+1])}),I(De,at)},Qe=De=>{var at=nf();I(De,at)};ye(Je,De=>{a(me)+1<Ie.sanList.length?De(Me):De(Qe,!1)})}Q(()=>{_e=we(j,1,"move-san svelte-eu7elq",null,_e,{active:a(me)+1===Ie.index}),R(Pe,Ie.sanList[a(me)])}),I(ce,Re)}),I(X,ge)};ye(D,X=>{Ie.sanList.length===0?X(M):X(z,!1)})}Rn(x,X=>t=X,()=>t);var Y=S(U,2),V=y(Y);V.__click=()=>as(0);var W=S(V,2);W.__click=()=>as(Ie.index-1);var re=S(W,2);re.__click=()=>as(Ie.index+1);var oe=S(re,2);oe.__click=()=>as(Ie.moves.length);var Ye=S(Y,2),Be=y(Ye);Be.__click=c,Q(()=>{R(p,`Engine${yr.depth>0?` Â· depth ${yr.depth}`:""}`),V.disabled=a(i),W.disabled=a(i),re.disabled=a(o),oe.disabled=a(o)}),I(s,u),Rs()}bn(["click"]);let Hi=L(null),Vn=L("white"),jn=L(null),Yn=L(ht([])),Qn=L("explorer"),Vr=L("white");const Ae={get playerContext(){return a(Hi)},get playerColor(){return a(Vn)},get timeControl(){return a(jn)},get availableTimeControls(){return a(Yn)},get activeMode(){return a(Qn)},get boardOrientation(){return a(Vr)}};function uf(s){f(Hi,s,!0),f(Vn,"white"),f(jn,null),f(Yn,[],!0),f(Qn,"explorer"),f(Vr,"white")}function ff(){f(Hi,null),f(Vn,"white"),f(jn,null),f(Yn,[],!0),f(Qn,"explorer"),f(Vr,"white")}function di(s){f(Vn,s,!0)}function qi(){f(Vr,a(Vr)==="white"?"black":"white",!0)}function hf(s){f(Vr,s,!0)}function df(s){f(jn,s,!0)}function vf(s){f(Yn,s,!0)}function Ca(s){f(Qn,s,!0)}const pf=50,Bs=new Map;function Io(s,e,t,r){return JSON.stringify([s,e,t,r])}function gf(s,e,t,r){const n=Io(s,e,t,r),i=Bs.get(n);return i!==void 0&&(Bs.delete(n),Bs.set(n,i)),i}function mf(s,e,t,r,n){const i=Io(s,e,t,r);if(Bs.delete(i),Bs.set(i,n),Bs.size>pf){const o=Bs.keys().next().value;o!==void 0&&Bs.delete(o)}}function _f(){Bs.clear()}class To extends Map{#e=new Map;#s=L(0);#t=L(0);#a=zs||-1;constructor(e){if(super(),e){for(var[t,r]of e)super.set(t,r);this.#t.v=super.size}}#n(e){return zs===this.#a?L(e):cr(e)}has(e){var t=this.#e,r=t.get(e);if(r===void 0){var n=super.get(e);if(n!==void 0)r=this.#n(0),t.set(e,r);else return a(this.#s),!1}return a(r),!0}forEach(e,t){this.#r(),super.forEach(e,t)}get(e){var t=this.#e,r=t.get(e);if(r===void 0){var n=super.get(e);if(n!==void 0)r=this.#n(0),t.set(e,r);else{a(this.#s);return}}return a(r),super.get(e)}set(e,t){var r=this.#e,n=r.get(e),i=super.get(e),o=super.set(e,t),l=this.#s;if(n===void 0)n=this.#n(0),r.set(e,n),f(this.#t,super.size),Ts(l);else if(i!==t){Ts(n);var c=l.reactions===null?null:new Set(l.reactions),u=c===null||!n.reactions?.every(d=>c.has(d));u&&Ts(l)}return o}delete(e){var t=this.#e,r=t.get(e),n=super.delete(e);return r!==void 0&&(t.delete(e),f(this.#t,super.size),f(r,-1),Ts(this.#s)),n}clear(){if(super.size!==0){super.clear();var e=this.#e;f(this.#t,0);for(var t of e.values())f(t,-1);Ts(this.#s),e.clear()}}#r(){a(this.#s);var e=this.#e;if(this.#t.v!==e.size){for(var t of super.keys())if(!e.has(t)){var r=this.#n(0);e.set(t,r)}}for([,r]of this.#e)a(r)}keys(){return a(this.#s),super.keys()}values(){return this.#r(),super.values()}entries(){return this.#r(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return a(this.#t),super.size}}const Lo=15,bf=2,wf=64,yf=200;let lr=new To,vn=L(0),pn=L(0),Do=L(Lo),ut=null,kr=!1,Nn=[],jr=[],Ai="continuation",Oo=[],Ro=[],zi=0,Mi=0,Mn="",No="continuation",ks=null;const ds={get cache(){return lr},get continuationFensLeft(){return a(vn)},get posSearchFensLeft(){return a(pn)}};function kf(s){const e=s.match(/\bdepth (\d+)/);if(!e)return null;const t=parseInt(e[1],10),r=s.match(/\bscore cp (-?\d+)/);if(r)return{eval:{type:"cp",pawns:parseInt(r[1],10)/100},depth:t};const n=s.match(/\bscore mate (-?\d+)/);return n?{eval:{type:"mate",moves:parseInt(n[1],10)},depth:t}:null}function Sf(s){const e=typeof s.data=="string"?s.data:String(s.data);if(e==="readyok"){Mi++;return}if(e.startsWith("bestmove")){if(ks&&Mn){const r=Mn.split(" ")[1];let n;r==="b"?ks.eval.type==="cp"?n={type:"cp",pawns:-ks.eval.pawns}:n={type:"mate",moves:-ks.eval.moves}:n=ks.eval,lr.set(Mn,{eval:n,depth:ks.depth}),No==="continuation"?f(vn,Math.max(0,a(vn)-1),!0):f(pn,Math.max(0,a(pn)-1),!0)}Vi();return}if(Mi<zi||!e.startsWith("info")||!e.includes(" score "))return;const t=kf(e);t&&(!ks||t.depth>ks.depth)&&(ks=t)}function Vi(){if(!ut){kr=!1;return}for(;;){let s;const e=Ai==="continuation"?Nn:jr,t=Ai==="continuation"?jr:Nn;if(e.length>0)s=e.shift();else if(t.length>0)s=t.shift();else{kr=!1;return}if(!s){kr=!1;return}if(!lr.has(s.fen)){kr=!0,Mn=s.fen,No=s.source,ks=null,zi++,ut.postMessage("stop"),ut.postMessage("isready"),ut.postMessage(`position fen ${s.fen}`),ut.postMessage(`go depth ${a(Do)}`);return}}}function Ef(){const s=Oo.length+Ro.length+yf;for(;lr.size>s;){const e=lr.keys().next().value;if(e===void 0)break;lr.delete(e)}}function Cf(){return new Promise((s,e)=>{try{ut=new Worker("./stockfish/stockfish-17.1-lite-51f59da.js")}catch(r){e(r);return}let t=!1;ut.onmessage=r=>{const n=typeof r.data=="string"?r.data:String(r.data);if(!t&&n==="uciok"){const i=Math.min(navigator.hardwareConcurrency||1,bf);ut.postMessage(`setoption name Threads value ${i}`),ut.postMessage(`setoption name Hash value ${wf}`),ut.postMessage("setoption name MultiPV value 1"),ut.postMessage("isready"),t=!0;return}if(t&&n==="readyok"){ut.onmessage=Sf,s();return}},ut.onerror=r=>{e(new Error("Eval queue worker failed to load: "+r.message))},ut.postMessage("uci")})}function xf(){ut&&(ut.postMessage("quit"),ut.terminate(),ut=null),lr=new To,f(vn,0),f(pn,0),f(Do,Lo),kr=!1,Nn=[],jr=[],zi=0,Mi=0,ks=null}function $o(s,e){const t=e.filter(n=>!lr.has(n)),r=t.map(n=>({fen:n,source:s}));s==="continuation"?(Nn=r,f(vn,t.length,!0),Oo=e):(jr=r,f(pn,t.length,!0),Ro=e),Ef(),!kr&&ut&&Vi()}function Pf(s,e){jr=[...e.map(r=>({fen:r,source:s})),...jr],!kr&&ut&&Vi()}function qf(s){Ai=s}var Af=$('<div class="cont-loading svelte-1wi8bi9">Loading...</div>'),Mf=$('<div class="cont-empty svelte-1wi8bi9">No games from this position</div>'),If=$("<span> </span>"),Tf=$('<span class="eval-badge eval-pending svelte-1wi8bi9"><span class="eval-spinner svelte-1wi8bi9">â¿</span></span>'),Lf=$('<div class="cont-loading svelte-1wi8bi9">Loading games...</div>'),Df=$('<div class="cont-empty svelte-1wi8bi9">No games found</div>'),Of=$("<button> </button>"),Rf=$("<strong> </strong>"),Nf=$("<strong> </strong>"),$f=$('<div class="game-row svelte-1wi8bi9" role="button" tabindex="0"><span class="game-players svelte-1wi8bi9"><!> <!> </span> <span class="game-result svelte-1wi8bi9"> </span> <span class="game-date svelte-1wi8bi9"> </span></div>'),Ff=$('<button class="show-all-games svelte-1wi8bi9"> </button>'),Bf=$('<div class="game-sort-controls svelte-1wi8bi9"><span class="sort-label svelte-1wi8bi9">Sort:</span> <!></div> <div class="game-list svelte-1wi8bi9"></div> <!>',1),Uf=$('<div class="cont-expanded svelte-1wi8bi9"><!></div>'),Gf=$('<div role="button" tabindex="0"><span class="cont-count svelte-1wi8bi9"> </span> <span class="cont-move svelte-1wi8bi9"> </span> <!> <div class="wdl-bar svelte-1wi8bi9"><div class="wdl-white svelte-1wi8bi9"> </div> <div class="wdl-draw svelte-1wi8bi9"> </div> <div class="wdl-black svelte-1wi8bi9"> </div></div> <span class="cont-perf svelte-1wi8bi9"> </span> <button class="cont-show-games svelte-1wi8bi9"> </button></div> <!>',1),Wf=$('<div class="cont-game-count svelte-1wi8bi9"> </div> <div class="cont-list svelte-1wi8bi9"></div>',1),Kf=$('<div class="continuations-header svelte-1wi8bi9"><h2 class="panel-title svelte-1wi8bi9">Continuations</h2> <div class="sort-controls svelte-1wi8bi9"><span class="sort-label svelte-1wi8bi9">Sort:</span> <button> </button> <button> </button> <button> </button></div></div> <div class="cont-toolbar svelte-1wi8bi9"><button class="cont-nav-btn svelte-1wi8bi9" title="Go back">&#8593;</button> <button class="cont-nav-btn svelte-1wi8bi9" title="Go to start">&#8962;</button> <label class="transposition-toggle svelte-1wi8bi9"><input type="checkbox" class="svelte-1wi8bi9"/> Transpositions</label></div> <div class="cont-content"><!></div>',1);function Hf(s,e){Os(e,!0);let t=ps(e,"highlightedArrowUci",3,null),r=L(ht([])),n=L(""),i=L(!1),o=0,l=L("games"),c=L(!1),u=L(!1),d=L(null),g=L(null),h=L(ht([])),p=L(!1),E=L(!1),q=L("date"),C=L(!1);function U(P,F){const de=new dr(P);try{return de.move({from:F.slice(0,2),to:F.slice(2,4),promotion:F[4]}).san}catch{return console.error(`UCI-to-SAN failed for "${F}" â not a legal move at FEN "${P}"`),"â "+F}}const x=fe(()=>{if(a(r).length===0)return[];const P=Math.max(...a(r).map(F=>F.gameCount));return a(r).map(F=>({from:F.move.slice(0,2),to:F.move.slice(2,4),opacity:Math.max(.4,F.gameCount/P)}))});ft(()=>{e.onArrowsChanged(a(x))}),ft(()=>{if(a(r).length===0||!a(n))return;const P=a(n),F=a(r).map(ue=>xn(P,ue.move)),de=setTimeout(()=>$o("continuation",F),1e3);return()=>clearTimeout(de)});const D=fe(()=>a(r).reduce((P,F)=>P+F.gameCount,0));function M(P){return P.eval.type==="cp"?P.eval.pawns:P.eval.moves>0?1e4-P.eval.moves:-1e4-P.eval.moves}function z(P,F,de){const ue=[...P],ee=de?1:-1;if(F==="eval"){const ie=a(n).split(" ")[1]==="w"?1:-1;ue.sort((ae,Oe)=>{const $e=xn(a(n),ae.move),Ke=xn(a(n),Oe.move),He=ds.cache.get($e),ve=ds.cache.get(Ke);return!He&&!ve?0:He?ve?ee*ie*(M(He)-M(ve)):-1:1})}else F==="perf"?ue.sort((ie,ae)=>ee*(ie.performanceRating-ae.performanceRating)):ue.sort((ie,ae)=>ee*(ie.gameCount-ae.gameCount));return ue}function Y(P,F,de){const ue=[...P],ee=de?1:-1;if(F==="result"){const ie={"1-0":0,"1/2-1/2":1,"0-1":2};ue.sort((ae,Oe)=>ee*((ie[ae.result]??3)-(ie[Oe.result]??3)))}else if(F==="elo"){const ie=ae=>ae.playerColor==="white"?ae.blackRating:ae.whiteRating;ue.sort((ae,Oe)=>ee*(ie(ae)-ie(Oe)))}else ue.sort((ie,ae)=>ee*(ie.date-ae.date));return ue}function V(P){P.length===1&&P[0].gameCount<10&&Ye(P[0].move,P[0].gameIds)}sc(()=>{const P=Ae.playerContext;if(!P)return;const F=Ie.moves.slice(0,Ie.index),de=Ae.playerColor,ue=Ae.timeControl,ee=a(u),ie=gf(F,de,ue,ee);if(ie){const $e=z(ie,a(l),a(c));f(r,$e,!0),f(n,Ie.fen,!0),f(i,!1),f(g,null),f(h,[],!0),V($e);return}const ae=++o,Oe=Ie.fen;f(i,!0),f(g,null),f(h,[],!0),f(p,!1),f(E,!1),$c(P.username,P.platform,P.since,P.until,F,de,ue,ee).then($e=>{if(ae!==o)return;mf(F,de,ue,ee,$e);const Ke=z($e,a(l),a(c));f(r,Ke,!0),f(n,Oe,!0),f(i,!1),V(Ke)}).catch($e=>{ae===o&&(f(i,!1),f(r,[],!0),f(n,Oe,!0),console.error("getContinuations failed:",$e))})});function W(P){P===a(l)?f(c,!a(c)):(f(l,P,!0),f(c,!1)),f(r,z(a(r),a(l),a(c)),!0)}function re(P,F,de){const ee={games:"Games",perf:"Perf",eval:"Eval"}[P]||P;return P===F?`${ee} ${de?"â²":"â¼"}`:ee}function oe(P){const F=P.slice(0,2),de=P.slice(2,4),ue=P[4];Wi(F,de,ue)}function Ye(P,F){f(g,P,!0),f(h,[],!0),f(p,!0),f(E,!1),f(q,"date"),f(C,!1);const de=Ae.playerContext;Eo(de.username,de.platform,F).then(ue=>{a(g)===P&&(f(h,Y(ue,a(q),a(C)),!0),f(p,!1))}).catch(ue=>{a(g)===P&&(f(p,!1),f(h,[],!0),console.error("getGamesMetadata failed:",ue))})}function Be(P,F){if(a(g)===P){f(g,null),f(h,[],!0),f(p,!1),f(E,!1);return}Ye(P,F)}function X(P){P===a(q)?f(C,!a(C)):(f(q,P,!0),f(C,!1)),f(h,Y(a(h),a(q),a(C)),!0)}function ge(P){const de={date:"Date",result:"Result",elo:"Elo"}[P]||P;return P===a(q)?`${de} ${a(C)?"â²":"â¼"}`:de}function ce(P){const F=P.whiteWins+P.draws+P.blackWins;return{wPct:F>0?P.whiteWins/F*100:0,dPct:F>0?P.draws/F*100:0,bPct:F>0?P.blackWins/F*100:0}}var Se=Kf(),Ee=tt(Se),me=S(y(Ee),2),Re=S(y(me),2);let he;Re.__click=()=>W("games");var j=y(Re),_e=S(Re,2);let Pe;_e.__click=()=>W("eval");var Je=y(_e),Me=S(_e,2);let Qe;Me.__click=()=>W("perf");var De=y(Me),at=S(Ee,2),Rt=y(at);Rt.__click=()=>as(Math.max(0,Ie.index-1));var Zt=S(Rt,2);Zt.__click=()=>as(0);var Jt=S(Zt,2),As=y(Jt),ws=S(at,2),ys=y(ws);{var ls=P=>{var F=Af();I(P,F)},St=P=>{var F=js(),de=tt(F);{var ue=ie=>{var ae=Mf();I(ie,ae)},ee=ie=>{var ae=Wf(),Oe=tt(ae),$e=y(Oe),Ke=S(Oe,2);Bt(Ke,21,()=>a(r),He=>He.move,(He,ve)=>{const gt=fe(()=>ce(a(ve))),mt=fe(()=>U(a(n),a(ve).move)),Ut=fe(()=>xn(a(n),a(ve).move)),es=fe(()=>ds.cache.get(a(Ut))),cs=fe(()=>a(g)===a(ve).move),Gt=fe(()=>t()===a(ve).move||a(d)===a(ve).move);var Ue=Gf(),qe=tt(Ue);let ot;qe.__click=()=>oe(a(ve).move);var Lt=y(qe),ts=y(Lt),T=S(Lt,2),J=y(T),le=S(T,2);{var lt=Ce=>{var bt=If();let k;var _=y(bt);Q((N,O)=>{k=we(bt,1,"eval-badge svelte-1wi8bi9",null,k,N),R(_,O)},[()=>({positive:!zr(a(es).eval),negative:zr(a(es).eval)}),()=>Ui(a(es).eval)]),I(Ce,bt)},Xe=Ce=>{var bt=Tf();I(Ce,bt)};ye(le,Ce=>{a(es)?Ce(lt):Ce(Xe,!1)})}var _t=S(le,2),Et=y(_t),Nt=y(Et),$t=S(Et,2),m=y($t),dt=S($t,2),st=y(dt),us=S(_t,2),A=y(us),Ge=S(us,2);Ge.__click=Ce=>{Ce.stopPropagation(),Be(a(ve).move,a(ve).gameIds)};var Ne=y(Ge),Ct=S(qe,2);{var Xs=Ce=>{var bt=Uf(),k=y(bt);{var _=O=>{var te=Lf();I(O,te)},N=O=>{var te=js(),K=tt(te);{var ne=ze=>{var xt=Df();I(ze,xt)},Ze=ze=>{var xt=Bf(),Wt=tt(xt),Ve=S(y(Wt),2);Bt(Ve,16,()=>["date","result","elo"],Ls,(Dt,Fe)=>{var Kt=Of();let Ht;Kt.__click=()=>X(Fe);var Zs=y(Kt);Q(et=>{Ht=we(Kt,1,"sort-btn game-sort-btn svelte-1wi8bi9",null,Ht,{active:Fe===a(q)}),R(Zs,et)},[()=>ge(Fe)]),I(Dt,Kt)});var vt=S(Wt,2);Bt(vt,21,()=>a(E)?a(h):a(h).slice(0,100),Dt=>Dt.gameId,(Dt,Fe)=>{var Kt=$f();Kt.__click=()=>window.open(a(Fe).url,"_blank");var Ht=y(Kt),Zs=y(Ht);{var et=Pt=>{var zt=Rf(),Ar=y(zt);Q(()=>R(Ar,a(Fe).whiteName)),I(Pt,zt)},v=Pt=>{var zt=fr();Q(()=>R(zt,a(Fe).whiteName)),I(Pt,zt)};ye(Zs,Pt=>{a(Fe).result==="1-0"?Pt(et):Pt(v,!1)})}var b=S(Zs),w=S(b);{var G=Pt=>{var zt=Nf(),Ar=y(zt);Q(()=>R(Ar,a(Fe).blackName)),I(Pt,zt)},H=Pt=>{var zt=fr();Q(()=>R(zt,a(Fe).blackName)),I(Pt,zt)};ye(w,Pt=>{a(Fe).result==="0-1"?Pt(G):Pt(H,!1)})}var be=S(w),ss=S(Ht,2),Js=y(ss),Xn=S(ss,2),wn=y(Xn);Q(Pt=>{R(b,` (${a(Fe).whiteRating??""}) vs `),R(be,` (${a(Fe).blackRating??""})`),R(Js,a(Fe).result==="1/2-1/2"?"Â½-Â½":a(Fe).result),R(wn,Pt)},[()=>new Date(a(Fe).date).toLocaleDateString()]),I(Dt,Kt)});var Ms=S(vt,2);{var qr=Dt=>{var Fe=Ff();Fe.__click=()=>{f(E,!0)};var Kt=y(Fe);Q(Ht=>R(Kt,`Show all ${Ht??""} games`),[()=>a(h).length.toLocaleString()]),I(Dt,Fe)};ye(Ms,Dt=>{!a(E)&&a(h).length>100&&Dt(qr)})}I(ze,xt)};ye(K,ze=>{a(h).length===0?ze(ne):ze(Ze,!1)},!0)}I(O,te)};ye(k,O=>{a(p)?O(_):O(N,!1)})}I(Ce,bt)};ye(Ct,Ce=>{a(cs)&&Ce(Xs)})}Q((Ce,bt)=>{ot=we(qe,1,"cont-row svelte-1wi8bi9",null,ot,{expanded:a(cs),hover:a(Gt)}),R(ts,Ce),R(J,a(mt)),gs(Et,`width: ${a(gt).wPct??""}%`),R(Nt,a(ve).whiteWins>0&&a(gt).wPct>15?a(ve).whiteWins:""),gs($t,`width: ${a(gt).dPct??""}%`),R(m,a(ve).draws>0&&a(gt).dPct>10?a(ve).draws:""),gs(dt,`width: ${a(gt).bPct??""}%`),R(st,a(ve).blackWins>0&&a(gt).bPct>15?a(ve).blackWins:""),R(A,bt),R(Ne,a(cs)?"Hide games":"Show games")},[()=>a(ve).gameCount.toLocaleString(),()=>a(ve).performanceRating>0?`PR: ${Math.round(a(ve).performanceRating)}`:"PR: â"]),Vs("mouseenter",qe,()=>{f(d,a(ve).move,!0),e.onContinuationHover(a(ve).move)}),Vs("mouseleave",qe,()=>{f(d,null),e.onContinuationHover(null)}),I(He,Ue)}),Q(He=>R($e,`${He??""} games`),[()=>a(D).toLocaleString()]),I(ie,ae)};ye(de,ie=>{a(r).length===0?ie(ue):ie(ee,!1)},!0)}I(P,F)};ye(ys,P=>{a(i)?P(ls):P(St,!1)})}Q((P,F,de)=>{he=we(Re,1,"sort-btn svelte-1wi8bi9",null,he,{active:a(l)==="games"}),R(j,P),Pe=we(_e,1,"sort-btn svelte-1wi8bi9",null,Pe,{active:a(l)==="eval"}),_e.disabled=ds.continuationFensLeft>0,R(Je,F),Qe=we(Me,1,"sort-btn svelte-1wi8bi9",null,Qe,{active:a(l)==="perf"}),R(De,de)},[()=>re("games",a(l),a(c)),()=>re("eval",a(l),a(c)),()=>re("perf",a(l),a(c))]),qc(As,()=>a(u),P=>f(u,P)),I(s,Se),Rs()}bn(["click"]);var zf=$("<div> </div>"),Vf=$('<div class="mini-board svelte-tgw8do"></div>');function jf(s,e){Os(e,!0);const t={K:"â",Q:"â",R:"â",B:"â",N:"â",P:"â",k:"â",q:"â",r:"â",b:"â",n:"â",p:"â"};let r=ps(e,"size",3,160);const n=fe(()=>{const l=[],c=e.placement.split("/");for(let u=0;u<8;u++){const d=c[u]||"";let g=0;for(const h of d)if(h>="1"&&h<="8")for(let p=0;p<parseInt(h);p++)l.push({light:(u+g)%2===1,piece:""}),g++;else l.push({light:(u+g)%2===1,piece:t[h]||""}),g++;for(;g<8;)l.push({light:(u+g)%2===1,piece:""}),g++}return l});var i=Vf();let o;Bt(i,21,()=>a(n),Ls,(l,c)=>{var u=zf();let d;var g=y(u);Q(()=>{d=we(u,1,"mini-square svelte-tgw8do",null,d,{light:a(c).light,dark:!a(c).light}),R(g,a(c).piece)}),I(l,u)}),Q(()=>o=gs(i,"",o,{width:`${r()??""}px`,height:`${r()??""}px`})),I(s,i),Rs()}var Yf=$("<button> </button>"),Qf=$("<button> </button>"),Xf=$('<div class="search-empty svelte-1goeqgu">Place pieces on the board to search</div>'),Zf=$('<div class="search-loading svelte-1goeqgu">Searching...</div>'),Jf=$('<div class="search-empty svelte-1goeqgu">No games found</div>'),eh=$('<span class="search-pr svelte-1goeqgu"> </span>'),th=$("<button> </button>"),sh=$('<div class="eval-sort-overlay svelte-1goeqgu"><div class="eval-sort-progress svelte-1goeqgu"> <button class="eval-sort-cancel svelte-1goeqgu">Cancel</button></div></div>'),rh=$("<span> </span>"),nh=$('<span class="eval-badge eval-pending svelte-1goeqgu"><span class="eval-spinner svelte-1goeqgu">â¿</span></span>'),ih=$("<strong> </strong>"),ah=$("<strong> </strong>"),oh=$('<div class="result-row svelte-1goeqgu"><!> <!> <div class="result-info svelte-1goeqgu"><div class="result-players svelte-1goeqgu"><!> <!> </div> <div class="result-meta svelte-1goeqgu"> </div> <div class="result-actions svelte-1goeqgu"><button class="result-show-btn svelte-1goeqgu">Show on main board</button> <a class="result-link svelte-1goeqgu" target="_blank"> </a></div></div></div>'),lh=$('<div class="scroll-sentinel svelte-1goeqgu" id="search-sentinel"></div>'),ch=$('<div class="search-results-header svelte-1goeqgu"><span class="search-count svelte-1goeqgu"> </span> <div class="wdl-bar svelte-1goeqgu"><div class="wdl-white svelte-1goeqgu"> </div> <div class="wdl-draw svelte-1goeqgu"> </div> <div class="wdl-black svelte-1goeqgu"> </div></div> <!></div> <div class="sort-controls svelte-1goeqgu"><span class="sort-label svelte-1goeqgu">Sort:</span> <!> <button> </button></div> <div class="result-list-wrapper svelte-1goeqgu"><!> <div class="result-list svelte-1goeqgu"><!> <!></div></div>',1),uh=$('<div><div class="piece-palette white-palette svelte-1goeqgu"><button></button> <!> <button></button> <button></button></div> <div class="editor-board-wrap svelte-1goeqgu"><!></div> <div class="piece-palette black-palette svelte-1goeqgu"><button></button> <!> <button></button> <button></button></div></div> <div class="editor-controls svelte-1goeqgu"><button class="editor-btn svelte-1goeqgu">Clear</button> <button class="editor-btn svelte-1goeqgu">From Current</button> <button class="editor-btn svelte-1goeqgu">Flip Board</button></div> <div class="resize-handle svelte-1goeqgu"><div class="resize-grip svelte-1goeqgu"></div></div> <div class="search-results svelte-1goeqgu"><!></div>',1);function fh(s,e){Os(e,!0);let t=ps(e,"platformLabel",3,"");const r={K:"â",Q:"â",R:"â",B:"â",N:"â",P:"â",k:"â",q:"â",r:"â",b:"â",n:"â",p:"â"},n=["K","Q","R","B","N","P"],i=["k","q","r","b","n","p"];let o=L(ht(new Map)),l=L(null),c=null,u=!1;const d="posSearchBoardWidth",g=150;let p=L(420),E=L(void 0);Kr(()=>{const k=localStorage.getItem(d);if(k){const _=Number(k);_>=g&&f(p,_,!0)}});function q(){let k=a(E)?.parentElement??null;for(;k;){if(k.offsetWidth>0)return k.offsetWidth;k=k.parentElement}return 600}function C(k){if(!a(E))return;k.preventDefault();const _=k.clientY,N=a(p),O=a(E),te=q();function K(ze){return Math.max(g,Math.min(te,N+ze))}function ne(ze){const xt=K(ze.clientY-_);O.style.width=xt+"px"}function Ze(ze){document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",Ze),f(p,K(ze.clientY-_),!0),localStorage.setItem(d,String(a(p)))}document.addEventListener("mousemove",ne),document.addEventListener("mouseup",Ze)}let U=0,x=L(!1),D=L(null),M=L(ht([])),z=L("date"),Y=L(!1),V=L(50),W=null,re=null,oe=L(null),Ye=null;const Be=fe(()=>Pe(a(o))),X=fe(()=>{const k=[];for(const[_,N]of a(o))N==="X"&&k.push({square:_});return k}),ge=fe(()=>a(l)===null?"free":"none");function ce(k){!c||c.style.display==="none"||(c.style.left=`${k.clientX+12}px`,c.style.top=`${k.clientY+12}px`)}function Se(k){c||(c=document.createElement("div"),c.className="ghost-cursor",c.style.cssText="position:fixed;pointer-events:none;font-size:28px;z-index:10000;opacity:0.7;display:none;",document.body.appendChild(c)),c.textContent=k,c.style.display=u?"block":"none"}function Ee(){c&&(c.style.display="none")}function me(){u=!0,c&&a(l)!==null&&(c.style.display="block")}function Re(){u=!1,Ee()}Kr(()=>{document.addEventListener("mousemove",ce)}),bo(()=>{document.removeEventListener("mousemove",ce),c&&(c.remove(),c=null),re!==null&&clearTimeout(re),Ye!==null&&clearTimeout(Ye),W&&(W.disconnect(),W=null)});function he(k){f(l,k,!0),k===null?Ee():Se(k==="trash"?"ðï¸":k==="X"?"â":r[k]||k)}function j(k){if(a(l)===null)return;const _=new Map(a(o));a(l)==="trash"?_.delete(k):a(l)==="X"?_.set(k,"X"):_.set(k,a(l)),f(o,_,!0),Qe()}function _e(k,_,N){const O=new Map(a(o));O.delete(k),O.set(_,N),f(o,O,!0),Qe()}function Pe(k){const _=Array.from({length:8},()=>Array(8).fill(""));for(const[O,te]of k){if(te==="X")continue;const K=O.charCodeAt(0)-97,ne=parseInt(O[1])-1;_[ne][K]=te}const N=[];for(let O=7;O>=0;O--){let te="",K=0;for(let ne=0;ne<8;ne++)_[O][ne]===""?K++:(K>0&&(te+=K,K=0),te+=_[O][ne]);K>0&&(te+=K),N.push(te)}return N.join("/")+" w - - 0 1"}function Je(){f(o,new Map,!0),Qe()}function Me(){const k=new Map,O=Ie.fen.split(" ")[0].split("/");for(let te=0;te<8;te++){const K=7-te;let ne=0;for(const Ze of O[te])if(Ze>="1"&&Ze<="8")ne+=parseInt(Ze);else{const ze=String.fromCharCode(97+ne)+(K+1);k.set(ze,Ze),ne++}}f(o,k,!0),Qe()}function Qe(){re!==null&&clearTimeout(re),re=setTimeout(()=>{re=null,De()},300)}ft(()=>(Ae.playerColor,Ae.timeControl,hr(()=>a(o).size)>0&&Qe(),()=>{re!==null&&(clearTimeout(re),re=null)}));async function De(){if(a(o).size===0){f(D,null),f(M,[],!0),f(x,!1);return}const k=++U;f(x,!0),f(V,50);try{const _={};for(const[te,K]of a(o))_[te]=K;const N=Ae.playerContext,O=await Fc(N.username,N.platform,N.since,N.until,{pieces:_},Ae.playerColor,Ae.timeControl);if(k!==U)return;if(f(D,O,!0),O.gameIds.length>0){const te=await Eo(N.username,N.platform,O.gameIds);if(k!==U)return;const K=new Map(te.map(ne=>[ne.gameId,ne]));f(M,at(O.gameIds.map(ne=>K.get(ne)).filter(Boolean),a(z),a(Y)),!0)}else f(M,[],!0);f(x,!1)}catch(_){if(k!==U)return;f(x,!1),f(D,null),f(M,[],!0),console.error("searchByPosition failed:",_)}}function at(k,_,N){if(_==="eval")return k;const O=[...k],te=N?1:-1;if(_==="result"){const K={"1-0":0,"1/2-1/2":1,"0-1":2};O.sort((ne,Ze)=>te*((K[ne.result]??3)-(K[Ze.result]??3)))}else if(_==="elo"){const K=ne=>ne.playerColor==="white"?ne.blackRating:ne.whiteRating;O.sort((ne,Ze)=>te*(K(ne)-K(Ze)))}else O.sort((K,ne)=>te*(K.date-ne.date));return O}function Rt(k){k===a(z)?f(Y,!a(Y)):(f(z,k,!0),f(Y,!1)),f(M,at(a(M),a(z),a(Y)),!0),f(V,50)}function Zt(k){const N={date:"Date",result:"Result",elo:"Opp Elo",eval:"Eval"}[k]||k;return k===a(z)?`${N} ${a(Y)?"â²":"â¼"}`:N}async function Jt(k,_){try{const N=Ae.playerContext,O=await Co(N.username,N.platform,[k]);if(O.length===0){console.error("No moves found for game",k);return}Ao(O[0].moves,_)}catch(N){console.error("getGamesMoves failed:",N)}}function As(){W&&(W.disconnect(),W=null);const k=document.getElementById("search-sentinel");k&&(W=new IntersectionObserver(_=>{for(const N of _)N.isIntersecting&&a(V)<a(M).length&&f(V,a(V)+50)},{threshold:.1}),W.observe(k))}ft(()=>(a(M).length>0&&a(V)<a(M).length&&queueMicrotask(()=>As()),()=>{W&&(W.disconnect(),W=null)}));function ws(k){let _=k.parentElement;for(;_;){const N=getComputedStyle(_).overflowY;if(N==="auto"||N==="scroll")return _;_=_.parentElement}return null}function ys(){Ye===null&&(Ye=setTimeout(()=>{Ye=null,ls()},200))}ft(()=>{const k=a(oe);if(!k)return;const _=ws(k);if(_)return _.addEventListener("scroll",ys),()=>{_.removeEventListener("scroll",ys)}});function ls(){if(!a(oe)||!a(D)||a(F).length===0)return;const k=a(oe).querySelectorAll(".result-row"),_=[];for(const N of k){const O=N.getBoundingClientRect();if(O.bottom>0&&O.top<window.innerHeight){const te=N.dataset.gameId;if(te){const K=a(de).get(Number(te));K&&_.push(K)}}}_.length>0&&Pf("position_search",_)}const St=fe(()=>{if(a(M).length===0)return{pr:0,wins:0,draws:0,losses:0};const k=[];let _=0,N=0,O=0,te=0;for(const K of a(M)){const ne=K.playerColor==="white"?K.blackRating:K.whiteRating;k.push(ne),K.result==="1-0"?K.playerColor==="white"?(_+=1,N++):te++:K.result==="0-1"?K.playerColor==="black"?(_+=1,N++):te++:(_+=.5,O++)}return{pr:Math.round(hu(k,_)),wins:N,draws:O,losses:te}}),P=fe(()=>{const{wins:k,draws:_,losses:N}=a(St),O=k+_+N;return{wPct:O>0?k/O*100:0,dPct:O>0?_/O*100:0,lPct:O>0?N/O*100:0}}),F=fe(()=>a(M).slice(0,a(V))),de=fe(()=>{if(!a(D))return new Map;const k=a(D),_=new Map;return k.gameIds.forEach((N,O)=>_.set(N,k.fens[O])),_});ft(()=>{if(!a(D)||a(M).length===0)return;const k=a(M).slice(0,a(V)),_=a(M).slice(a(V)),N=[...k,..._].map(O=>a(de).get(O.gameId)).filter(O=>O!=null);$o("position_search",N)});let ue=L(!1),ee=null,ie=L(0);function ae(k){return k.eval.type==="cp"?k.eval.pawns:k.eval.moves>0?1e4-k.eval.moves:-1e4-k.eval.moves}function Oe(k,_){const N=_?1:-1,O=[...k];return O.sort((te,K)=>{const ne=a(de).get(te.gameId),Ze=a(de).get(K.gameId),ze=ne?ds.cache.get(ne):void 0,xt=Ze?ds.cache.get(Ze):void 0;return!ze&&!xt?0:ze?xt?N*(ae(xt)-ae(ze)):-1:1}),O}function $e(){a(z)==="eval"&&ds.posSearchFensLeft===0?(f(Y,!a(Y)),f(M,Oe(a(M),a(Y)),!0),f(V,50)):ds.posSearchFensLeft===0?(f(Y,!1),f(z,"eval"),f(M,Oe(a(M),a(Y)),!0),f(V,50)):(f(ue,!0),ee=[...a(M)],f(ie,a(M).length,!0))}function Ke(){f(ue,!1),ee&&(f(M,ee,!0),ee=null)}ft(()=>{a(ue)&&ds.posSearchFensLeft===0&&(f(Y,!1),f(z,"eval"),f(M,Oe(a(M),a(Y)),!0),f(V,50),f(ue,!1),ee=null)});function He(k){if(!a(D))return"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";const _=a(D).gameIds.indexOf(k.gameId);return _===-1?"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR":a(D).fens[_].split(" ")[0]}function ve(k){if(!a(D))return 0;const _=a(D).gameIds.indexOf(k.gameId);return _!==-1?a(D).plys[_]:0}var gt=uh(),mt=tt(gt);let Ut,es;var cs=y(mt),Gt=y(cs);let Ue;Gt.__mousedown=k=>{k.preventDefault(),he(null)},Gt.textContent="â";var qe=S(Gt,2);Bt(qe,17,()=>n,Ls,(k,_)=>{var N=Yf();let O;N.__mousedown=K=>{K.preventDefault(),he(a(_))};var te=y(N);Q(()=>{O=we(N,1,"palette-piece svelte-1goeqgu",null,O,{active:a(l)===a(_)}),R(te,r[a(_)])}),I(k,N)});var ot=S(qe,2);let Lt;ot.__mousedown=k=>{k.preventDefault(),he("X")},ot.textContent="â";var ts=S(ot,2);let T;ts.__mousedown=k=>{k.preventDefault(),he("trash")},ts.textContent="ðï¸";var J=S(cs,2),le=y(J);qo(le,{get fen(){return a(Be)},get orientation(){return Ae.boardOrientation},get inputMode(){return a(ge)},get markers(){return a(X)},showCoordinates:!1,onSquareClick:j,onFreeDrop:_e});var lt=S(J,2),Xe=y(lt);let _t;Xe.__mousedown=k=>{k.preventDefault(),he(null)},Xe.textContent="â";var Et=S(Xe,2);Bt(Et,17,()=>i,Ls,(k,_)=>{var N=Qf();let O;N.__mousedown=K=>{K.preventDefault(),he(a(_))};var te=y(N);Q(()=>{O=we(N,1,"palette-piece svelte-1goeqgu",null,O,{active:a(l)===a(_)}),R(te,r[a(_)])}),I(k,N)});var Nt=S(Et,2);let $t;Nt.__mousedown=k=>{k.preventDefault(),he("X")},Nt.textContent="â";var m=S(Nt,2);let dt;m.__mousedown=k=>{k.preventDefault(),he("trash")},m.textContent="ðï¸",Rn(mt,k=>f(E,k),()=>a(E));var st=S(mt,2),us=y(st);us.__click=Je;var A=S(us,2);A.__click=Me;var Ge=S(A,2);Ge.__click=function(...k){qi?.apply(this,k)};var Ne=S(st,2);Ne.__mousedown=C;var Ct=S(Ne,2),Xs=y(Ct);{var Ce=k=>{var _=Xf();I(k,_)},bt=k=>{var _=js(),N=tt(_);{var O=K=>{var ne=Zf();I(K,ne)},te=K=>{var ne=js(),Ze=tt(ne);{var ze=Wt=>{var Ve=Jf();I(Wt,Ve)},xt=Wt=>{var Ve=ch(),vt=tt(Ve),Ms=y(vt),qr=y(Ms),Dt=S(Ms,2),Fe=y(Dt),Kt=y(Fe),Ht=S(Fe,2),Zs=y(Ht),et=S(Ht,2),v=y(et),b=S(Dt,2);{var w=rt=>{var xe=eh(),fs=y(xe);Q(()=>R(fs,`PR: ${a(St).pr??""}`)),I(rt,xe)};ye(b,rt=>{a(St).pr>0&&rt(w)})}var G=S(vt,2),H=S(y(G),2);Bt(H,16,()=>["date","result","elo"],Ls,(rt,xe)=>{var fs=th();let vr;fs.__click=()=>Rt(xe);var Qr=y(fs);Q(Zn=>{vr=we(fs,1,"sort-btn search-sort-btn svelte-1goeqgu",null,vr,{active:xe===a(z)}),R(Qr,Zn)},[()=>Zt(xe)]),I(rt,fs)});var be=S(H,2);let ss;be.__click=$e;var Js=y(be),Xn=S(G,2),wn=y(Xn);{var Pt=rt=>{var xe=sh(),fs=y(xe),vr=y(fs),Qr=S(vr);Qr.__click=Ke,Q(()=>R(vr,`Evaluating positions: ${a(ie)-ds.posSearchFensLeft} of ${a(ie)??""} `)),I(rt,xe)};ye(wn,rt=>{a(ue)&&ds.posSearchFensLeft>0&&rt(Pt)})}var zt=S(wn,2),Ar=y(zt);Bt(Ar,17,()=>a(F),rt=>rt.gameId,(rt,xe)=>{const fs=fe(()=>ve(a(xe))),vr=fe(()=>Math.floor(a(fs)/2)+1),Qr=fe(()=>a(fs)%2===1?"...":""),Zn=fe(()=>a(xe).result==="1/2-1/2"?"Â½-Â½":a(xe).result),ji=fe(()=>a(de).get(a(xe).gameId)),yn=fe(()=>a(ji)?ds.cache.get(a(ji)):void 0);var Jn=oh(),Yi=y(Jn);{let je=fe(()=>He(a(xe)));jf(Yi,{get placement(){return a(je)}})}var Qi=S(Yi,2);{var Uo=je=>{var qt=rh();let Mr;var Zo=y(qt);Q((Jo,el)=>{Mr=we(qt,1,"eval-badge svelte-1goeqgu",null,Mr,Jo),R(Zo,el)},[()=>({positive:!zr(a(yn).eval),negative:zr(a(yn).eval)}),()=>Ui(a(yn).eval)]),I(je,qt)},Go=je=>{var qt=nh();I(je,qt)};ye(Qi,je=>{a(yn)?je(Uo):je(Go,!1)})}var Wo=S(Qi,2),Xi=y(Wo),Zi=y(Xi);{var Ko=je=>{var qt=ih(),Mr=y(qt);Q(()=>R(Mr,a(xe).whiteName)),I(je,qt)},Ho=je=>{var qt=fr();Q(()=>R(qt,a(xe).whiteName)),I(je,qt)};ye(Zi,je=>{a(xe).result==="1-0"?je(Ko):je(Ho,!1)})}var Ji=S(Zi),ea=S(Ji);{var zo=je=>{var qt=ah(),Mr=y(qt);Q(()=>R(Mr,a(xe).blackName)),I(je,qt)},Vo=je=>{var qt=fr();Q(()=>R(qt,a(xe).blackName)),I(je,qt)};ye(ea,je=>{a(xe).result==="0-1"?je(zo):je(Vo,!1)})}var jo=S(ea),ta=S(Xi,2),Yo=y(ta),Qo=S(ta,2),sa=y(Qo);sa.__click=()=>Jt(a(xe).gameId,a(fs));var ra=S(sa,2),Xo=y(ra);Q(je=>{On(Jn,"data-game-id",a(xe).gameId),R(Ji,` (${a(xe).whiteRating??""}) vs `),R(jo,` (${a(xe).blackRating??""})`),R(Yo,`${je??""} Â· ${a(Zn)??""} Â· move ${a(vr)??""}${a(Qr)??""}`),On(ra,"href",a(xe).url),R(Xo,`View on ${t()??""}`)},[()=>new Date(a(xe).date).toLocaleDateString()]),I(rt,Jn)});var Fo=S(Ar,2);{var Bo=rt=>{var xe=lh();I(rt,xe)};ye(Fo,rt=>{a(V)<a(M).length&&rt(Bo)})}Rn(zt,rt=>f(oe,rt),()=>a(oe)),Q((rt,xe)=>{R(qr,`Found in ${rt??""} games`),gs(Fe,`width: ${a(P).wPct??""}%`),R(Kt,a(St).wins>0&&a(P).wPct>15?a(St).wins:""),gs(Ht,`width: ${a(P).dPct??""}%`),R(Zs,a(St).draws>0&&a(P).dPct>10?a(St).draws:""),gs(et,`width: ${a(P).lPct??""}%`),R(v,a(St).losses>0&&a(P).lPct>15?a(St).losses:""),ss=we(be,1,"sort-btn svelte-1goeqgu",null,ss,{active:a(z)==="eval"}),R(Js,xe)},[()=>a(D).gameIds.length.toLocaleString(),()=>Zt("eval")]),I(Wt,Ve)};ye(Ze,Wt=>{!a(D)||a(D).gameIds.length===0?Wt(ze):Wt(xt,!1)},!0)}I(K,ne)};ye(N,K=>{a(x)?K(O):K(te,!1)},!0)}I(k,_)};ye(Xs,k=>{a(o).size===0?k(Ce):k(bt,!1)})}Q(()=>{Ut=we(mt,1,"editor-section svelte-1goeqgu",null,Ut,{flipped:Ae.boardOrientation==="black"}),es=gs(mt,"",es,{width:`${a(p)??""}px`}),Ue=we(Gt,1,"palette-piece palette-tool svelte-1goeqgu",null,Ue,{active:a(l)===null}),Lt=we(ot,1,"palette-piece palette-tool svelte-1goeqgu",null,Lt,{active:a(l)==="X"}),T=we(ts,1,"palette-piece palette-tool svelte-1goeqgu",null,T,{active:a(l)==="trash"}),_t=we(Xe,1,"palette-piece palette-tool svelte-1goeqgu",null,_t,{active:a(l)===null}),$t=we(Nt,1,"palette-piece palette-tool svelte-1goeqgu",null,$t,{active:a(l)==="X"}),dt=we(m,1,"palette-piece palette-tool svelte-1goeqgu",null,dt,{active:a(l)==="trash"})}),Vs("mouseenter",mt,me),Vs("mouseleave",mt,Re),I(s,gt),Rs()}bn(["mousedown","click"]);var hh=$("<option> </option>"),dh=$('<div class="recent-games-empty svelte-9k08f">Loading...</div>'),vh=$('<div class="recent-games-empty svelte-9k08f">No games found</div>'),ph=$("<strong> </strong>"),gh=$("<strong> </strong>"),mh=$('<button class="recent-game-row svelte-9k08f"><span></span> <span class="recent-game-players svelte-9k08f"><!> <!> </span> <span class="recent-game-result svelte-9k08f"> </span> <span class="recent-game-date svelte-9k08f"> </span></button>'),_h=$('<div class="recent-games-menu svelte-9k08f"><!></div>'),bh=$('<header class="workspace-header svelte-9k08f"><button class="ws-back-btn svelte-9k08f">&larr; Back</button> <div class="color-filter svelte-9k08f"><button> </button> <button> </button></div> <select class="tc-select svelte-9k08f"><option>All time controls</option><!></select> <div class="ws-player-info svelte-9k08f"><span class="ws-username svelte-9k08f"> </span> <span class="ws-meta svelte-9k08f"> </span> <span class="ws-date-range svelte-9k08f"> </span></div> <div><button class="recent-games-btn svelte-9k08f">Recent Games &#x25BE;</button> <!></div> <div class="mode-toggle svelte-9k08f"><button>Opening Explorer</button> <button>Partial Position Search</button></div> <button class="ws-gear-btn svelte-9k08f" title="Settings">&#9881;</button></header> <div class="workspace-columns svelte-9k08f"><div class="workspace-col col-board svelte-9k08f"><div class="board-with-eval svelte-9k08f"><!> <div class="main-board-wrap svelte-9k08f"><!></div></div> <div class="board-controls svelte-9k08f"><button class="board-btn svelte-9k08f">Flip Board</button> <button class="board-btn svelte-9k08f">Reset</button> <button class="board-btn svelte-9k08f">Open Analysis Board</button></div></div> <div class="workspace-col col-pgn svelte-9k08f"><!></div> <div class="workspace-col col-context svelte-9k08f"><div><!></div> <div><!></div></div></div>',1);function wh(s,e){Os(e,!0);let t=L(ht([])),r=L(null),n=L(null),i=L(null),o=L(null);ft(()=>{const T=yr.lines[0]?.pvUci[0]??null;if(T===a(o))return;const J=setTimeout(()=>{f(o,T,!0)},150);return()=>clearTimeout(J)});const l=fe(()=>a(i)?a(i):!a(o)||a(o).length<4?null:{from:a(o).slice(0,2),to:a(o).slice(2,4)}),c=fe(()=>{const T=a(n)?a(n).slice(0,2)+a(n).slice(2,4):a(r),J=a(l)?a(l).from+a(l).to:null,le=J!=null?a(t).findIndex(Xe=>Xe.from+Xe.to===J):-1,lt=a(t).map((Xe,_t)=>{const Et=Xe.from+Xe.to,Nt=_t===le,$t=T===Et;return Nt||$t?{...Xe,...Nt&&{engineHover:!0},...$t&&{continuationHover:!0}}:{...Xe}});return a(l)&&le<0&&lt.push({...a(l),opacity:1,type:"info"}),lt});Kr(async()=>{const T=Ae.playerContext;if(T)try{const J=await Uc(T.username,T.platform,T.since,T.until);vf(J)}catch(J){console.error("getAvailableTimeControls failed:",J)}}),Kr(()=>(Xu().catch(T=>console.error("Engine init failed:",T)),Cf().catch(T=>console.error("Eval queue init failed:",T)),()=>{Ju(),xf()})),ft(()=>{const T=Ie.moves,J=Ie.index;yr.ready&&(Zu(T.slice(0,J)),f(i,null),f(o,null))}),ft(()=>{qf(Ae.activeMode==="explorer"?"continuation":"position_search")});function u(T,J,le){return Wi(T,J,le)}function d(T){if(T===null){f(r,null);return}f(r,T,!0)}function g(T){f(n,T,!0)}function h(T){f(t,T,!0)}function p(T){if(!T){f(i,null);return}f(i,{from:T.slice(0,2),to:T.slice(2,4)},!0)}function E(T){const J=T.target?.tagName;if(!(J==="INPUT"||J==="TEXTAREA"||J==="SELECT")&&!a(D))switch(T.key){case"x":case"X":qi();break;case"ArrowLeft":T.preventDefault(),as(Ie.index-1);break;case"ArrowRight":T.preventDefault(),as(Ie.index+1);break;case"Home":T.preventDefault(),as(0);break;case"End":T.preventDefault(),as(Ie.moves.length);break}}function q(){const T=Ie.sanList;let J="";for(let le=0;le<T.length;le++)le%2===0?(le>0&&(J+=" "),J+=`${Math.floor(le/2)+1}. ${T[le]}`):J+=` ${T[le]}`;J&&window.open(`https://lichess.org/analysis/pgn/${encodeURIComponent(J)}`,"_blank")}const C=fe(()=>Ae.playerContext),U=fe(()=>a(C)?.platform==="lichess"?"Lichess":"Chess.com"),x=fe(()=>a(C)?`${Or(a(C).since)} â ${Or(a(C).until)}`:"");let D=L(!1),M=L(ht([])),z=L(!1),Y=0;ft(()=>{const T=Ae.playerContext,J=Ae.timeControl;if(!T)return;const le=++Y;f(z,!0),Bc(T.username,T.platform,T.since,T.until,J,100).then(lt=>{le===Y&&(f(M,lt,!0),f(z,!1))}).catch(lt=>{le===Y&&(console.error("getRecentGames failed:",lt),f(M,[],!0),f(z,!1))})});function V(){f(D,!a(D))}function W(){f(D,!1)}async function re(T){f(D,!1);const J=Ae.playerContext;if(J)try{const le=await Co(J.username,J.platform,[T.gameId]);le.length>0&&(Ao(le[0].moves,Math.min(1,le[0].moves.length)),di(T.playerColor),hf(T.playerColor))}catch(le){console.error("Failed to load game moves:",le)}}var oe=bh();Vs("keydown",on,E),Vs("click",on,W);var Ye=tt(oe),Be=y(Ye);Be.__click=function(...T){e.onBack?.apply(this,T)};var X=S(Be,2),ge=y(X);let ce;ge.__click=()=>di("white");var Se=y(ge),Ee=S(ge,2);let me;Ee.__click=()=>di("black");var Re=y(Ee),he=S(X,2);he.__change=T=>df(T.target.value||null);var j=y(he);j.value=j.__value="";var _e=S(j);Bt(_e,17,()=>Ae.availableTimeControls,Ls,(T,J)=>{var le=hh(),lt=y(le),Xe={};Q(()=>{R(lt,a(J)),Xe!==(Xe=a(J))&&(le.value=(le.__value=a(J))??"")}),I(T,le)});var Pe;Sc(he);var Je=S(he,2),Me=y(Je),Qe=y(Me),De=S(Me,2),at=y(De),Rt=S(De,2),Zt=y(Rt),Jt=S(Je,2);let As;Jt.__click=T=>T.stopPropagation();var ws=y(Jt);ws.__click=V;var ys=S(ws,2);{var ls=T=>{var J=_h(),le=y(J);{var lt=_t=>{var Et=dh();I(_t,Et)},Xe=_t=>{var Et=js(),Nt=tt(Et);{var $t=dt=>{var st=vh();I(dt,st)},m=dt=>{var st=js(),us=tt(st);Bt(us,17,()=>a(M),A=>A.gameId,(A,Ge)=>{var Ne=mh();Ne.__click=()=>re(a(Ge));var Ct=y(Ne);let Xs;var Ce=S(Ct,2),bt=y(Ce);{var k=Ve=>{var vt=ph(),Ms=y(vt);Q(()=>R(Ms,a(Ge).whiteName)),I(Ve,vt)},_=Ve=>{var vt=fr();Q(()=>R(vt,a(Ge).whiteName)),I(Ve,vt)};ye(bt,Ve=>{a(Ge).result==="1-0"?Ve(k):Ve(_,!1)})}var N=S(bt),O=S(N);{var te=Ve=>{var vt=gh(),Ms=y(vt);Q(()=>R(Ms,a(Ge).blackName)),I(Ve,vt)},K=Ve=>{var vt=fr();Q(()=>R(vt,a(Ge).blackName)),I(Ve,vt)};ye(O,Ve=>{a(Ge).result==="0-1"?Ve(te):Ve(K,!1)})}var ne=S(O),Ze=S(Ce,2),ze=y(Ze),xt=S(Ze,2),Wt=y(xt);Q(Ve=>{Xs=we(Ct,1,"recent-game-color svelte-9k08f",null,Xs,{white:a(Ge).playerColor==="white",black:a(Ge).playerColor==="black"}),R(N,` (${a(Ge).whiteRating??""}) vs `),R(ne,` (${a(Ge).blackRating??""})`),R(ze,a(Ge).result==="1/2-1/2"?"Â½-Â½":a(Ge).result),R(Wt,Ve)},[()=>new Date(a(Ge).date).toLocaleDateString()]),I(A,Ne)}),I(dt,st)};ye(Nt,dt=>{a(M).length===0?dt($t):dt(m,!1)},!0)}I(_t,Et)};ye(le,_t=>{a(z)?_t(lt):_t(Xe,!1)})}I(T,J)};ye(ys,T=>{a(D)&&T(ls)})}var St=S(Jt,2),P=y(St);let F;P.__click=()=>Ca("explorer");var de=S(P,2);let ue;de.__click=()=>Ca("search");var ee=S(Ye,2),ie=y(ee),ae=y(ie),Oe=y(ae);Gu(Oe,{get evaluation(){return yr.eval},get orientation(){return Ae.boardOrientation}});var $e=S(Oe,2),Ke=y($e);qo(Ke,{get fen(){return Ie.fen},get orientation(){return Ae.boardOrientation},get arrows(){return a(c)},inputMode:"legal",onMove:u,onArrowHover:d});var He=S(ae,2),ve=y(He);ve.__click=function(...T){qi?.apply(this,T)};var gt=S(ve,2);gt.__click=function(...T){xi?.apply(this,T)};var mt=S(gt,2);mt.__click=q;var Ut=S(ie,2),es=y(Ut);cf(es,{onEngineLineHover:p});var cs=S(Ut,2),Gt=y(cs);let Ue;var qe=y(Gt);Hf(qe,{onArrowsChanged:h,onContinuationHover:g,get highlightedArrowUci(){return a(r)}});var ot=S(Gt,2);let Lt;var ts=y(ot);fh(ts,{get platformLabel(){return a(U)}}),Q(T=>{ce=we(ge,1,"color-btn svelte-9k08f",null,ce,{active:Ae.playerColor==="white"}),R(Se,`${a(C)?.username??""} as White`),me=we(Ee,1,"color-btn svelte-9k08f",null,me,{active:Ae.playerColor==="black"}),R(Re,`${a(C)?.username??""} as Black`),Pe!==(Pe=Ae.timeControl??"")&&(he.value=(he.__value=Ae.timeControl??"")??"",_o(he,Ae.timeControl??"")),R(Qe,a(C)?.username),R(at,`Â· ${T??""} games`),R(Zt,a(x)),As=we(Jt,1,"recent-games-dropdown svelte-9k08f",null,As,{open:a(D)}),F=we(P,1,"mode-btn svelte-9k08f",null,F,{active:Ae.activeMode==="explorer"}),ue=we(de,1,"mode-btn svelte-9k08f",null,ue,{active:Ae.activeMode==="search"}),Ue=gs(Gt,"",Ue,{display:Ae.activeMode==="explorer"?"contents":"none"}),Lt=gs(ot,"",Lt,{display:Ae.activeMode==="search"?"contents":"none"})},[()=>a(C)?.gameCount.toLocaleString()]),I(s,oe),Rs()}bn(["click","change"]);var yh=$("<!> <!>",1);function kh(s,e){Os(e,!0);let t=L("setup"),r=L(ht([]));async function n(){try{f(r,await Si(),!0)}catch(p){console.error("Failed to load cached players:",p)}}n();function i(p){uf(p),xi(),f(t,"workspace")}async function o(){ff(),xi(),_f();try{f(r,await Si(),!0)}catch(p){console.error("Failed to refresh cached players:",p)}f(t,"setup")}function l(p){f(r,p,!0)}var c=yh(),u=tt(c);{var d=p=>{Eu(p,{get cachedPlayers(){return a(r)},onEnterWorkspace:i,onCachedPlayersChanged:l})},g=p=>{wh(p,{onBack:o})};ye(u,p=>{a(t)==="setup"?p(d):p(g,!1)})}var h=S(u,2);ju(h),I(s,c),Rs()}Dc();vc(kh,{target:document.getElementById("app")});
