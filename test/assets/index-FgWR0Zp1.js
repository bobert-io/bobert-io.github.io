(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const ai=!1;var Ei=Array.isArray,Ko=Array.prototype.indexOf,Or=Array.prototype.includes,Ln=Array.from,Ho=Object.defineProperty,Tr=Object.getOwnPropertyDescriptor,zo=Object.getOwnPropertyDescriptors,Vo=Object.prototype,jo=Array.prototype,ma=Object.getPrototypeOf,Yi=Object.isExtensible;function Yo(s){for(var e=0;e<s.length;e++)s[e]()}function _a(){var s,e,t=new Promise((r,n)=>{s=r,e=n});return{promise:t,resolve:s,reject:e}}function Qo(s,e){if(Array.isArray(s))return s;if(!(Symbol.iterator in s))return Array.from(s);const t=[];for(const r of s)if(t.push(r),t.length===e)break;return t}const Ct=2,xn=4,dn=8,ba=1<<24,zs=16,ws=32,Sr=64,Si=128,as=512,_t=1024,xt=2048,bs=4096,ts=8192,Fs=16384,Ci=32768,Rr=65536,Qi=1<<17,wa=1<<18,Hr=1<<19,ya=1<<20,Ns=1<<25,Er=32768,oi=1<<21,xi=1<<22,er=1<<23,wr=Symbol("$state"),Xo=Symbol("legacy props"),Zo=Symbol(""),Mr=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function ka(s){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Jo(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function el(s,e,t){throw new Error("https://svelte.dev/e/each_key_duplicate")}function tl(s){throw new Error("https://svelte.dev/e/effect_in_teardown")}function sl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function rl(s){throw new Error("https://svelte.dev/e/effect_orphan")}function nl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function il(s){throw new Error("https://svelte.dev/e/props_invalid_value")}function al(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function ol(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ll(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function cl(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const ul=1,fl=2,Ea=4,hl=8,dl=16,vl=1,pl=4,gl=8,ml=16,_l=1,bl=2,St=Symbol(),wl="http://www.w3.org/1999/xhtml";function yl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function kl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Sa(s){return s===this.v}function El(s,e){return s!=s?e==e:s!==e||s!==null&&typeof s=="object"||typeof s=="function"}function Ca(s){return!El(s,this.v)}let Sl=!1,zt=null;function Nr(s){zt=s}function As(s,e=!1,t){zt={p:zt,i:!1,c:null,e:null,s,x:null,l:null}}function Ms(s){var e=zt,t=e.e;if(t!==null){e.e=null;for(var r of t)za(r)}return s!==void 0&&(e.x=s),e.i=!0,zt=e.p,s??{}}function xa(){return!0}let vr=[];function Pa(){var s=vr;vr=[],Yo(s)}function Bs(s){if(vr.length===0&&!sn){var e=vr;queueMicrotask(()=>{e===vr&&Pa()})}vr.push(s)}function Cl(){for(;vr.length>0;)Pa()}function qa(s){var e=De;if(e===null)return be.f|=er,s;if((e.f&Ci)===0){if((e.f&Si)===0)throw s;e.b.error(s)}else $r(s,e)}function $r(s,e){for(;e!==null;){if((e.f&Si)!==0)try{e.b.error(s);return}catch(t){s=t}e=e.parent}throw s}const xl=-7169;function nt(s,e){s.f=s.f&xl|e}function Pi(s){(s.f&as)!==0||s.deps===null?nt(s,_t):nt(s,bs)}function Aa(s){if(s!==null)for(const e of s)(e.f&Ct)===0||(e.f&Er)===0||(e.f^=Er,Aa(e.deps))}function Ma(s,e,t){(s.f&xt)!==0?e.add(s):(s.f&bs)!==0&&t.add(s),Aa(s.deps),nt(s,_t)}const mn=new Set;let Le=null,li=null,ps=null,Gt=[],Dn=null,ci=!1,sn=!1;class tr{committed=!1;current=new Map;previous=new Map;#e=new Set;#s=new Set;#t=0;#a=0;#n=null;#r=new Set;#i=new Set;#o=new Map;is_fork=!1;#l=!1;is_deferred(){return this.is_fork||this.#a>0}skip_effect(e){this.#o.has(e)||this.#o.set(e,{d:[],m:[]})}unskip_effect(e){var t=this.#o.get(e);if(t){this.#o.delete(e);for(var r of t.d)nt(r,xt),ms(r);for(r of t.m)nt(r,bs),ms(r)}}process(e){Gt=[],this.apply();var t=[],r=[];for(const n of e)this.#c(n,t,r);if(this.is_deferred()){this.#u(r),this.#u(t);for(const[n,i]of this.#o)Da(n,i)}else{for(const n of this.#e)n();this.#e.clear(),this.#t===0&&this.#f(),li=this,Le=null,Xi(r),Xi(t),li=null,this.#n?.resolve()}ps=null}#c(e,t,r){e.f^=_t;for(var n=e.first,i=null;n!==null;){var o=n.f,l=(o&(ws|Sr))!==0,c=l&&(o&_t)!==0,u=c||(o&ts)!==0||this.#o.has(n);if(!u&&n.fn!==null){l?n.f^=_t:i!==null&&(o&(xn|dn|ba))!==0?i.b.defer_effect(n):(o&xn)!==0?t.push(n):pn(n)&&((o&zs)!==0&&this.#i.add(n),nn(n));var d=n.first;if(d!==null){n=d;continue}}var p=n.parent;for(n=n.next;n===null&&p!==null;)p===i&&(i=null),n=p.next,p=p.parent}}#u(e){for(var t=0;t<e.length;t+=1)Ma(e[t],this.#r,this.#i)}capture(e,t){t!==St&&!this.previous.has(e)&&this.previous.set(e,t),(e.f&er)===0&&(this.current.set(e,e.v),ps?.set(e,e.v))}activate(){Le=this,this.apply()}deactivate(){Le===this&&(Le=null,ps=null)}flush(){if(this.activate(),Gt.length>0){if(Ia(),Le!==null&&Le!==this)return}else this.#t===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#s)e(this);this.#s.clear()}#f(){if(mn.size>1){this.previous.clear();var e=ps,t=!0;for(const n of mn){if(n===this){t=!1;continue}const i=[];for(const[l,c]of this.current){if(n.current.has(l))if(t&&c!==n.current.get(l))n.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...n.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Gt;Gt=[];const l=new Set,c=new Map;for(const u of i)Ta(u,o,l,c);if(Gt.length>0){Le=n,n.apply();for(const u of Gt)n.#c(u,[],[]);n.deactivate()}Gt=r}}Le=null,ps=e}this.committed=!0,mn.delete(this)}increment(e){this.#t+=1,e&&(this.#a+=1)}decrement(e){this.#t-=1,e&&(this.#a-=1),!this.#l&&(this.#l=!0,Bs(()=>{this.#l=!1,this.is_deferred()?Gt.length>0&&this.flush():this.revive()}))}revive(){for(const e of this.#r)this.#i.delete(e),nt(e,xt),ms(e);for(const e of this.#i)nt(e,bs),ms(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#s.add(e)}settled(){return(this.#n??=_a()).promise}static ensure(){if(Le===null){const e=Le=new tr;mn.add(Le),sn||Bs(()=>{Le===e&&e.flush()})}return Le}apply(){}}function Pl(s){var e=sn;sn=!0;try{for(var t;;){if(Cl(),Gt.length===0&&(Le?.flush(),Gt.length===0))return Dn=null,t;Ia()}}finally{sn=e}}function Ia(){ci=!0;var s=null;try{for(var e=0;Gt.length>0;){var t=tr.ensure();if(e++>1e3){var r,n;ql()}t.process(Gt),sr.clear()}}finally{Gt=[],ci=!1,Dn=null}}function ql(){try{nl()}catch(s){$r(s,Dn)}}let Os=null;function Xi(s){var e=s.length;if(e!==0){for(var t=0;t<e;){var r=s[t++];if((r.f&(Fs|ts))===0&&pn(r)&&(Os=new Set,nn(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Ya(r):r.fn=null),Os?.size>0)){sr.clear();for(const n of Os){if((n.f&(Fs|ts))!==0)continue;const i=[n];let o=n.parent;for(;o!==null;)Os.has(o)&&(Os.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const c=i[l];(c.f&(Fs|ts))===0&&nn(c)}}Os.clear()}}Os=null}}function Ta(s,e,t,r){if(!t.has(s)&&(t.add(s),s.reactions!==null))for(const n of s.reactions){const i=n.f;(i&Ct)!==0?Ta(n,e,t,r):(i&(xi|zs))!==0&&(i&xt)===0&&La(n,e,r)&&(nt(n,xt),ms(n))}}function La(s,e,t){const r=t.get(s);if(r!==void 0)return r;if(s.deps!==null)for(const n of s.deps){if(Or.call(e,n))return!0;if((n.f&Ct)!==0&&La(n,e,t))return t.set(n,!0),!0}return t.set(s,!1),!1}function ms(s){for(var e=Dn=s;e.parent!==null;){e=e.parent;var t=e.f;if(ci&&e===De&&(t&zs)!==0&&(t&wa)===0)return;if((t&(Sr|ws))!==0){if((t&_t)===0)return;e.f^=_t}}Gt.push(e)}function Da(s,e){if(!((s.f&ws)!==0&&(s.f&_t)!==0)){(s.f&xt)!==0?e.d.push(s):(s.f&bs)!==0&&e.m.push(s),nt(s,_t);for(var t=s.first;t!==null;)Da(t,e),t=t.next}}function Al(s){let e=0,t=nr(0),r;return()=>{Ai()&&(a(t),Nn(()=>(e===0&&(r=or(()=>s(()=>xs(t)))),e+=1,()=>{Bs(()=>{e-=1,e===0&&(r?.(),r=void 0,xs(t))})})))}}var Ml=Rr|Hr|Si;function Il(s,e,t){new Tl(s,e,t)}class Tl{parent;is_pending=!1;#e;#s=null;#t;#a;#n;#r=null;#i=null;#o=null;#l=null;#c=null;#u=0;#f=0;#v=!1;#d=!1;#p=new Set;#g=new Set;#h=null;#y=Al(()=>(this.#h=nr(this.#u),()=>{this.#h=null}));constructor(e,t,r){this.#e=e,this.#t=t,this.#a=r,this.parent=De.b,this.is_pending=!!this.#t.pending,this.#n=Ii(()=>{De.b=this;{var n=this.#b();try{this.#r=ns(()=>r(n))}catch(i){this.error(i)}this.#f>0?this.#_():this.is_pending=!1}return()=>{this.#c?.remove()}},Ml)}#k(){try{this.#r=ns(()=>this.#a(this.#e))}catch(e){this.error(e)}}#E(){const e=this.#t.pending;e&&(this.#i=ns(()=>e(this.#e)),Bs(()=>{var t=this.#b();this.#r=this.#m(()=>(tr.ensure(),ns(()=>this.#a(t)))),this.#f>0?this.#_():(yr(this.#i,()=>{this.#i=null}),this.is_pending=!1)}))}#b(){var e=this.#e;return this.is_pending&&(this.#c=Us(),this.#e.before(this.#c),e=this.#c),e}defer_effect(e){Ma(e,this.#p,this.#g)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#t.pending}#m(e){var t=De,r=be,n=zt;qs(this.#n),ls(this.#n),Nr(this.#n.ctx);try{return e()}catch(i){return qa(i),null}finally{qs(t),ls(r),Nr(n)}}#_(){const e=this.#t.pending;this.#r!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Za(this.#r,this.#l)),this.#i===null&&(this.#i=ns(()=>e(this.#e)))}#w(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#w(e);return}if(this.#f+=e,this.#f===0){this.is_pending=!1;for(const t of this.#p)nt(t,xt),ms(t);for(const t of this.#g)nt(t,bs),ms(t);this.#p.clear(),this.#g.clear(),this.#i&&yr(this.#i,()=>{this.#i=null}),this.#l&&(this.#e.before(this.#l),this.#l=null)}}update_pending_count(e){this.#w(e),this.#u+=e,!(!this.#h||this.#v)&&(this.#v=!0,Bs(()=>{this.#v=!1,this.#h&&Fr(this.#h,this.#u)}))}get_effect_pending(){return this.#y(),a(this.#h)}error(e){var t=this.#t.onerror;let r=this.#t.failed;if(this.#d||!t&&!r)throw e;this.#r&&(Ht(this.#r),this.#r=null),this.#i&&(Ht(this.#i),this.#i=null),this.#o&&(Ht(this.#o),this.#o=null);var n=!1,i=!1;const o=()=>{if(n){kl();return}n=!0,i&&cl(),tr.ensure(),this.#u=0,this.#o!==null&&yr(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#r=this.#m(()=>(this.#d=!1,ns(()=>this.#a(this.#e)))),this.#f>0?this.#_():this.is_pending=!1};Bs(()=>{try{i=!0,t?.(e,o),i=!1}catch(l){$r(l,this.#n&&this.#n.parent)}r&&(this.#o=this.#m(()=>{tr.ensure(),this.#d=!0;try{return ns(()=>{r(this.#e,()=>e,()=>o)})}catch(l){return $r(l,this.#n.parent),null}finally{this.#d=!1}}))})}}function Ll(s,e,t,r){const n=On;var i=s.filter(f=>!f.settled);if(t.length===0&&i.length===0){r(e.map(n));return}var o=Le,l=De,c=Dl(),u=i.length===1?i[0].promise:i.length>1?Promise.all(i.map(f=>f.promise)):null;function d(f){c();try{r(f)}catch(g){(l.f&Fs)===0&&$r(g,l)}o?.deactivate(),ui()}if(t.length===0){u.then(()=>d(e.map(n)));return}function p(){c(),Promise.all(t.map(f=>Ol(f))).then(f=>d([...e.map(n),...f])).catch(f=>$r(f,l))}u?u.then(p):p()}function Dl(){var s=De,e=be,t=zt,r=Le;return function(i=!0){qs(s),ls(e),Nr(t),i&&r?.activate()}}function ui(){qs(null),ls(null),Nr(null)}function On(s){var e=Ct|xt,t=be!==null&&(be.f&Ct)!==0?be:null;return De!==null&&(De.f|=Hr),{ctx:zt,deps:null,effects:null,equals:Sa,f:e,fn:s,reactions:null,rv:0,v:St,wv:0,parent:t??De,ac:null}}function Ol(s,e,t){let r=De;r===null&&Jo();var n=r.b,i=void 0,o=nr(St),l=!be,c=new Map;return jl(()=>{var u=_a();i=u.promise;try{Promise.resolve(s()).then(u.resolve,u.reject).then(()=>{d===Le&&d.committed&&d.deactivate(),ui()})}catch(g){u.reject(g),ui()}var d=Le;if(l){var p=n.is_rendered();n.update_pending_count(1),d.increment(p),c.get(d)?.reject(Mr),c.delete(d),c.set(d,u)}const f=(g,E=void 0)=>{if(d.activate(),E)E!==Mr&&(o.f|=er,Fr(o,E));else{(o.f&er)!==0&&(o.f^=er),Fr(o,g);for(const[q,C]of c){if(c.delete(q),q===d)break;C.reject(Mr)}}l&&(n.update_pending_count(-1),d.decrement(p))};u.promise.then(f,g=>f(null,g||"unknown"))}),Mi(()=>{for(const u of c.values())u.reject(Mr)}),new Promise(u=>{function d(p){function f(){p===i?u(o):d(i)}p.then(f,f)}d(i)})}function de(s){const e=On(s);return Ja(e),e}function Oa(s){const e=On(s);return e.equals=Ca,e}function Ra(s){var e=s.effects;if(e!==null){s.effects=null;for(var t=0;t<e.length;t+=1)Ht(e[t])}}function Rl(s){for(var e=s.parent;e!==null;){if((e.f&Ct)===0)return(e.f&Fs)===0?e:null;e=e.parent}return null}function qi(s){var e,t=De;qs(Rl(s));try{s.f&=~Er,Ra(s),e=ro(s)}finally{qs(t)}return e}function Na(s){var e=qi(s);if(!s.equals(e)&&(s.wv=to(),(!Le?.is_fork||s.deps===null)&&(s.v=e,s.deps===null))){nt(s,_t);return}ir||(ps!==null?(Ai()||Le?.is_fork)&&ps.set(s,e):Pi(s))}let fi=new Set;const sr=new Map;let $a=!1;function nr(s,e){var t={f:0,v:s,reactions:null,equals:Sa,rv:0,wv:0};return t}function D(s,e){const t=nr(s);return Ja(t),t}function Nl(s,e=!1,t=!0){const r=nr(s);return e||(r.equals=Ca),r}function h(s,e,t=!1){be!==null&&(!_s||(be.f&Qi)!==0)&&xa()&&(be.f&(Ct|zs|xi|Qi))!==0&&(os===null||!Or.call(os,s))&&ll();let r=t?ut(e):e;return Fr(s,r)}function Fr(s,e){if(!s.equals(e)){var t=s.v;ir?sr.set(s,e):sr.set(s,t),s.v=e;var r=tr.ensure();if(r.capture(s,t),(s.f&Ct)!==0){const n=s;(s.f&xt)!==0&&qi(n),Pi(n)}s.wv=to(),Fa(s,xt),De!==null&&(De.f&_t)!==0&&(De.f&(ws|Sr))===0&&(rs===null?Xl([s]):rs.push(s)),!r.is_fork&&fi.size>0&&!$a&&$l()}return e}function $l(){$a=!1;for(const s of fi)(s.f&_t)!==0&&nt(s,bs),pn(s)&&nn(s);fi.clear()}function Fl(s,e=1){var t=a(s),r=e===1?t++:t--;return h(s,t),r}function xs(s){h(s,s.v+1)}function Fa(s,e){var t=s.reactions;if(t!==null)for(var r=t.length,n=0;n<r;n++){var i=t[n],o=i.f,l=(o&xt)===0;if(l&&nt(i,e),(o&Ct)!==0){var c=i;ps?.delete(c),(o&Er)===0&&(o&as&&(i.f|=Er),Fa(c,bs))}else l&&((o&zs)!==0&&Os!==null&&Os.add(i),ms(i))}}function ut(s){if(typeof s!="object"||s===null||wr in s)return s;const e=ma(s);if(e!==Vo&&e!==jo)return s;var t=new Map,r=Ei(s),n=D(0),i=Gs,o=l=>{if(Gs===i)return l();var c=be,u=Gs;ls(null),ta(i);var d=l();return ls(c),ta(u),d};return r&&t.set("length",D(s.length)),new Proxy(s,{defineProperty(l,c,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&al();var d=t.get(c);return d===void 0?d=o(()=>{var p=D(u.value);return t.set(c,p),p}):h(d,u.value,!0),!0},deleteProperty(l,c){var u=t.get(c);if(u===void 0){if(c in l){const d=o(()=>D(St));t.set(c,d),xs(n)}}else h(u,St),xs(n);return!0},get(l,c,u){if(c===wr)return s;var d=t.get(c),p=c in l;if(d===void 0&&(!p||Tr(l,c)?.writable)&&(d=o(()=>{var g=ut(p?l[c]:St),E=D(g);return E}),t.set(c,d)),d!==void 0){var f=a(d);return f===St?void 0:f}return Reflect.get(l,c,u)},getOwnPropertyDescriptor(l,c){var u=Reflect.getOwnPropertyDescriptor(l,c);if(u&&"value"in u){var d=t.get(c);d&&(u.value=a(d))}else if(u===void 0){var p=t.get(c),f=p?.v;if(p!==void 0&&f!==St)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return u},has(l,c){if(c===wr)return!0;var u=t.get(c),d=u!==void 0&&u.v!==St||Reflect.has(l,c);if(u!==void 0||De!==null&&(!d||Tr(l,c)?.writable)){u===void 0&&(u=o(()=>{var f=d?ut(l[c]):St,g=D(f);return g}),t.set(c,u));var p=a(u);if(p===St)return!1}return d},set(l,c,u,d){var p=t.get(c),f=c in l;if(r&&c==="length")for(var g=u;g<p.v;g+=1){var E=t.get(g+"");E!==void 0?h(E,St):g in l&&(E=o(()=>D(St)),t.set(g+"",E))}if(p===void 0)(!f||Tr(l,c)?.writable)&&(p=o(()=>D(void 0)),h(p,ut(u)),t.set(c,p));else{f=p.v!==St;var q=o(()=>ut(u));h(p,q)}var C=Reflect.getOwnPropertyDescriptor(l,c);if(C?.set&&C.set.call(d,u),!f){if(r&&typeof c=="string"){var N=t.get("length"),j=Number(c);Number.isInteger(j)&&j>=N.v&&h(N,j+1)}xs(n)}return!0},ownKeys(l){a(n);var c=Reflect.ownKeys(l).filter(p=>{var f=t.get(p);return f===void 0||f.v!==St});for(var[u,d]of t)d.v!==St&&!(u in l)&&c.push(u);return c},setPrototypeOf(){ol()}})}function Zi(s){try{if(s!==null&&typeof s=="object"&&wr in s)return s[wr]}catch{}return s}function Bl(s,e){return Object.is(Zi(s),Zi(e))}var rn,Ba,Ua,Ga;function Ul(){if(rn===void 0){rn=window,Ba=/Firefox/.test(navigator.userAgent);var s=Element.prototype,e=Node.prototype,t=Text.prototype;Ua=Tr(e,"firstChild").get,Ga=Tr(e,"nextSibling").get,Yi(s)&&(s.__click=void 0,s.__className=void 0,s.__attributes=null,s.__style=void 0,s.__e=void 0),Yi(t)&&(t.__t=void 0)}}function Us(s=""){return document.createTextNode(s)}function Pn(s){return Ua.call(s)}function vn(s){return Ga.call(s)}function w(s,e){return Pn(s)}function et(s,e=!1){{var t=Pn(s);return t instanceof Comment&&t.data===""?vn(t):t}}function S(s,e=1,t=!1){let r=s;for(;e--;)r=vn(r);return r}function Gl(s){s.textContent=""}function Wa(){return!1}let Ji=!1;function Wl(){Ji||(Ji=!0,document.addEventListener("reset",s=>{Promise.resolve().then(()=>{if(!s.defaultPrevented)for(const e of s.target.elements)e.__on_r?.()})},{capture:!0}))}function Rn(s){var e=be,t=De;ls(null),qs(null);try{return s()}finally{ls(e),qs(t)}}function Ka(s,e,t,r=t){s.addEventListener(e,()=>Rn(t));const n=s.__on_r;n?s.__on_r=()=>{n(),r(!0)}:s.__on_r=()=>r(!0),Wl()}function Ha(s){De===null&&(be===null&&rl(),sl()),ir&&tl()}function Kl(s,e){var t=e.last;t===null?e.last=e.first=s:(t.next=s,s.prev=t,e.last=s)}function Is(s,e,t){var r=De;r!==null&&(r.f&ts)!==0&&(s|=ts);var n={ctx:zt,deps:null,nodes:null,f:s|xt|as,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{nn(n),n.f|=Ci}catch(l){throw Ht(n),l}else e!==null&&ms(n);var i=n;if(t&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Hr)===0&&(i=i.first,(s&zs)!==0&&(s&Rr)!==0&&i!==null&&(i.f|=Rr)),i!==null&&(i.parent=r,r!==null&&Kl(i,r),be!==null&&(be.f&Ct)!==0&&(s&Sr)===0)){var o=be;(o.effects??=[]).push(i)}return n}function Ai(){return be!==null&&!_s}function Mi(s){const e=Is(dn,null,!1);return nt(e,_t),e.teardown=s,e}function ct(s){Ha();var e=De.f,t=!be&&(e&ws)!==0&&(e&Ci)===0;if(t){var r=zt;(r.e??=[]).push(s)}else return za(s)}function za(s){return Is(xn|ya,s,!1)}function Hl(s){return Ha(),Is(dn|ya,s,!0)}function zl(s){tr.ensure();const e=Is(Sr|Hr,s,!0);return(t={})=>new Promise(r=>{t.outro?yr(e,()=>{Ht(e),r(void 0)}):(Ht(e),r(void 0))})}function Vl(s){return Is(xn,s,!1)}function jl(s){return Is(xi|Hr,s,!0)}function Nn(s,e=0){return Is(dn|e,s,!0)}function Q(s,e=[],t=[],r=[]){Ll(r,e,t,n=>{Is(dn,()=>s(...n.map(a)),!0)})}function Ii(s,e=0){var t=Is(zs|e,s,!0);return t}function ns(s){return Is(ws|Hr,s,!0)}function Va(s){var e=s.teardown;if(e!==null){const t=ir,r=be;ea(!0),ls(null);try{e.call(null)}finally{ea(t),ls(r)}}}function ja(s,e=!1){var t=s.first;for(s.first=s.last=null;t!==null;){const n=t.ac;n!==null&&Rn(()=>{n.abort(Mr)});var r=t.next;(t.f&Sr)!==0?t.parent=null:Ht(t,e),t=r}}function Yl(s){for(var e=s.first;e!==null;){var t=e.next;(e.f&ws)===0&&Ht(e),e=t}}function Ht(s,e=!0){var t=!1;(e||(s.f&wa)!==0)&&s.nodes!==null&&s.nodes.end!==null&&(Ql(s.nodes.start,s.nodes.end),t=!0),ja(s,e&&!t),qn(s,0),nt(s,Fs);var r=s.nodes&&s.nodes.t;if(r!==null)for(const i of r)i.stop();Va(s);var n=s.parent;n!==null&&n.first!==null&&Ya(s),s.next=s.prev=s.teardown=s.ctx=s.deps=s.fn=s.nodes=s.ac=null}function Ql(s,e){for(;s!==null;){var t=s===e?null:vn(s);s.remove(),s=t}}function Ya(s){var e=s.parent,t=s.prev,r=s.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===s&&(e.first=r),e.last===s&&(e.last=t))}function yr(s,e,t=!0){var r=[];Qa(s,r,!0);var n=()=>{t&&Ht(s),e&&e()},i=r.length;if(i>0){var o=()=>--i||n();for(var l of r)l.out(o)}else n()}function Qa(s,e,t){if((s.f&ts)===0){s.f^=ts;var r=s.nodes&&s.nodes.t;if(r!==null)for(const l of r)(l.is_global||t)&&e.push(l);for(var n=s.first;n!==null;){var i=n.next,o=(n.f&Rr)!==0||(n.f&ws)!==0&&(s.f&zs)!==0;Qa(n,e,o?t:!1),n=i}}}function Ti(s){Xa(s,!0)}function Xa(s,e){if((s.f&ts)!==0){s.f^=ts,(s.f&_t)===0&&(nt(s,xt),ms(s));for(var t=s.first;t!==null;){var r=t.next,n=(t.f&Rr)!==0||(t.f&ws)!==0;Xa(t,n?e:!1),t=r}var i=s.nodes&&s.nodes.t;if(i!==null)for(const o of i)(o.is_global||e)&&o.in()}}function Za(s,e){if(s.nodes)for(var t=s.nodes.start,r=s.nodes.end;t!==null;){var n=t===r?null:vn(t);e.append(t),t=n}}let kn=!1,ir=!1;function ea(s){ir=s}let be=null,_s=!1;function ls(s){be=s}let De=null;function qs(s){De=s}let os=null;function Ja(s){be!==null&&(os===null?os=[s]:os.push(s))}let Wt=null,Zt=0,rs=null;function Xl(s){rs=s}let eo=1,pr=0,Gs=pr;function ta(s){Gs=s}function to(){return++eo}function pn(s){var e=s.f;if((e&xt)!==0)return!0;if(e&Ct&&(s.f&=~Er),(e&bs)!==0){for(var t=s.deps,r=t.length,n=0;n<r;n++){var i=t[n];if(pn(i)&&Na(i),i.wv>s.wv)return!0}(e&as)!==0&&ps===null&&nt(s,_t)}return!1}function so(s,e,t=!0){var r=s.reactions;if(r!==null&&!(os!==null&&Or.call(os,s)))for(var n=0;n<r.length;n++){var i=r[n];(i.f&Ct)!==0?so(i,e,!1):e===i&&(t?nt(i,xt):(i.f&_t)!==0&&nt(i,bs),ms(i))}}function ro(s){var e=Wt,t=Zt,r=rs,n=be,i=os,o=zt,l=_s,c=Gs,u=s.f;Wt=null,Zt=0,rs=null,be=(u&(ws|Sr))===0?s:null,os=null,Nr(s.ctx),_s=!1,Gs=++pr,s.ac!==null&&(Rn(()=>{s.ac.abort(Mr)}),s.ac=null);try{s.f|=oi;var d=s.fn,p=d(),f=s.deps,g=Le?.is_fork;if(Wt!==null){var E;if(g||qn(s,Zt),f!==null&&Zt>0)for(f.length=Zt+Wt.length,E=0;E<Wt.length;E++)f[Zt+E]=Wt[E];else s.deps=f=Wt;if(Ai()&&(s.f&as)!==0)for(E=Zt;E<f.length;E++)(f[E].reactions??=[]).push(s)}else!g&&f!==null&&Zt<f.length&&(qn(s,Zt),f.length=Zt);if(xa()&&rs!==null&&!_s&&f!==null&&(s.f&(Ct|bs|xt))===0)for(E=0;E<rs.length;E++)so(rs[E],s);if(n!==null&&n!==s){if(pr++,n.deps!==null)for(let q=0;q<t;q+=1)n.deps[q].rv=pr;if(e!==null)for(const q of e)q.rv=pr;rs!==null&&(r===null?r=rs:r.push(...rs))}return(s.f&er)!==0&&(s.f^=er),p}catch(q){return qa(q)}finally{s.f^=oi,Wt=e,Zt=t,rs=r,be=n,os=i,Nr(o),_s=l,Gs=c}}function Zl(s,e){let t=e.reactions;if(t!==null){var r=Ko.call(t,s);if(r!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[r]=t[n],t.pop())}}if(t===null&&(e.f&Ct)!==0&&(Wt===null||!Or.call(Wt,e))){var i=e;(i.f&as)!==0&&(i.f^=as,i.f&=~Er),Pi(i),Ra(i),qn(i,0)}}function qn(s,e){var t=s.deps;if(t!==null)for(var r=e;r<t.length;r++)Zl(s,t[r])}function nn(s){var e=s.f;if((e&Fs)===0){nt(s,_t);var t=De,r=kn;De=s,kn=!0;try{(e&(zs|ba))!==0?Yl(s):ja(s),Va(s);var n=ro(s);s.teardown=typeof n=="function"?n:null,s.wv=eo;var i;ai&&Sl&&(s.f&xt)!==0&&s.deps}finally{kn=r,De=t}}}async function no(){await Promise.resolve(),Pl()}function a(s){var e=s.f,t=(e&Ct)!==0;if(be!==null&&!_s){var r=De!==null&&(De.f&Fs)!==0;if(!r&&(os===null||!Or.call(os,s))){var n=be.deps;if((be.f&oi)!==0)s.rv<pr&&(s.rv=pr,Wt===null&&n!==null&&n[Zt]===s?Zt++:Wt===null?Wt=[s]:Wt.push(s));else{(be.deps??=[]).push(s);var i=s.reactions;i===null?s.reactions=[be]:Or.call(i,be)||i.push(be)}}}if(ir&&sr.has(s))return sr.get(s);if(t){var o=s;if(ir){var l=o.v;return((o.f&_t)===0&&o.reactions!==null||ao(o))&&(l=qi(o)),sr.set(o,l),l}var c=(o.f&as)===0&&!_s&&be!==null&&(kn||(be.f&as)!==0),u=o.deps===null;pn(o)&&(c&&(o.f|=as),Na(o)),c&&!u&&io(o)}if(ps?.has(s))return ps.get(s);if((s.f&er)!==0)throw s.v;return s.v}function io(s){if(s.deps!==null){s.f|=as;for(const e of s.deps)(e.reactions??=[]).push(s),(e.f&Ct)!==0&&(e.f&as)===0&&io(e)}}function ao(s){if(s.v===St)return!0;if(s.deps===null)return!1;for(const e of s.deps)if(sr.has(e)||(e.f&Ct)!==0&&ao(e))return!0;return!1}function or(s){var e=_s;try{return _s=!0,s()}finally{_s=e}}const Jl=["touchstart","touchmove"];function ec(s){return Jl.includes(s)}const oo=new Set,hi=new Set;function tc(s,e,t,r={}){function n(i){if(r.capture||Zr.call(e,i),!i.cancelBubble)return Rn(()=>t?.call(this,i))}return s.startsWith("pointer")||s.startsWith("touch")||s==="wheel"?Bs(()=>{e.addEventListener(s,n,r)}):e.addEventListener(s,n,r),n}function Ks(s,e,t,r,n){var i={capture:r,passive:n},o=tc(s,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Mi(()=>{e.removeEventListener(s,o,i)})}function gn(s){for(var e=0;e<s.length;e++)oo.add(s[e]);for(var t of hi)t(s)}let sa=null;function Zr(s){var e=this,t=e.ownerDocument,r=s.type,n=s.composedPath?.()||[],i=n[0]||s.target;sa=s;var o=0,l=sa===s&&s.__root;if(l){var c=n.indexOf(l);if(c!==-1&&(e===document||e===window)){s.__root=e;return}var u=n.indexOf(e);if(u===-1)return;c<=u&&(o=c)}if(i=n[o]||s.target,i!==e){Ho(s,"currentTarget",{configurable:!0,get(){return i||t}});var d=be,p=De;ls(null),qs(null);try{for(var f,g=[];i!==null;){var E=i.assignedSlot||i.parentNode||i.host||null;try{var q=i["__"+r];q!=null&&(!i.disabled||s.target===i)&&q.call(i,s)}catch(C){f?g.push(C):f=C}if(s.cancelBubble||E===e||E===null)break;i=E}if(f){for(let C of g)queueMicrotask(()=>{throw C});throw f}}finally{s.__root=e,delete s.currentTarget,ls(d),qs(p)}}}function sc(s){var e=document.createElement("template");return e.innerHTML=s.replaceAll("<!>","<!---->"),e.content}function An(s,e){var t=De;t.nodes===null&&(t.nodes={start:s,end:e,a:null,t:null})}function F(s,e){var t=(e&_l)!==0,r=(e&bl)!==0,n,i=!s.startsWith("<!>");return()=>{n===void 0&&(n=sc(i?s:"<!>"+s),t||(n=Pn(n)));var o=r||Ba?document.importNode(n,!0):n.cloneNode(!0);if(t){var l=Pn(o),c=o.lastChild;An(l,c)}else An(o,o);return o}}function ar(s=""){{var e=Us(s+"");return An(e,e),e}}function Hs(){var s=document.createDocumentFragment(),e=document.createComment(""),t=Us();return s.append(e,t),An(e,t),s}function T(s,e){s!==null&&s.before(e)}function R(s,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(s.__t??=s.nodeValue)&&(s.__t=t,s.nodeValue=t+"")}function rc(s,e){return nc(s,e)}const Pr=new Map;function nc(s,{target:e,anchor:t,props:r={},events:n,context:i,intro:o=!0}){Ul();var l=new Set,c=p=>{for(var f=0;f<p.length;f++){var g=p[f];if(!l.has(g)){l.add(g);var E=ec(g);e.addEventListener(g,Zr,{passive:E});var q=Pr.get(g);q===void 0?(document.addEventListener(g,Zr,{passive:E}),Pr.set(g,1)):Pr.set(g,q+1)}}};c(Ln(oo)),hi.add(c);var u=void 0,d=zl(()=>{var p=t??e.appendChild(Us());return Il(p,{pending:()=>{}},f=>{As({});var g=zt;i&&(g.c=i),n&&(r.$$events=n),u=s(f,r)||{},Ms()}),()=>{for(var f of l){e.removeEventListener(f,Zr);var g=Pr.get(f);--g===0?(document.removeEventListener(f,Zr),Pr.delete(f)):Pr.set(f,g)}hi.delete(c),p!==t&&p.parentNode?.removeChild(p)}});return ic.set(u,d),u}let ic=new WeakMap;class ac{anchor;#e=new Map;#s=new Map;#t=new Map;#a=new Set;#n=!0;constructor(e,t=!0){this.anchor=e,this.#n=t}#r=()=>{var e=Le;if(this.#e.has(e)){var t=this.#e.get(e),r=this.#s.get(t);if(r)Ti(r),this.#a.delete(t);else{var n=this.#t.get(t);n&&(this.#s.set(t,n.effect),this.#t.delete(t),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),r=n.effect)}for(const[i,o]of this.#e){if(this.#e.delete(i),i===e)break;const l=this.#t.get(o);l&&(Ht(l.effect),this.#t.delete(o))}for(const[i,o]of this.#s){if(i===t||this.#a.has(i))continue;const l=()=>{if(Array.from(this.#e.values()).includes(i)){var u=document.createDocumentFragment();Za(o,u),u.append(Us()),this.#t.set(i,{effect:o,fragment:u})}else Ht(o);this.#a.delete(i),this.#s.delete(i)};this.#n||!r?(this.#a.add(i),yr(o,l,!1)):l()}}};#i=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[r,n]of this.#t)t.includes(r)||(Ht(n.effect),this.#t.delete(r))};ensure(e,t){var r=Le,n=Wa();if(t&&!this.#s.has(e)&&!this.#t.has(e))if(n){var i=document.createDocumentFragment(),o=Us();i.append(o),this.#t.set(e,{effect:ns(()=>t(o)),fragment:i})}else this.#s.set(e,ns(()=>t(this.anchor)));if(this.#e.set(r,e),n){for(const[l,c]of this.#s)l===e?r.unskip_effect(c):r.skip_effect(c);for(const[l,c]of this.#t)l===e?r.unskip_effect(c.effect):r.skip_effect(c.effect);r.oncommit(this.#r),r.ondiscard(this.#i)}else this.#r()}}function we(s,e,t=!1){var r=new ac(s),n=t?Rr:0;function i(o,l){r.ensure(o,l)}Ii(()=>{var o=!1;e((l,c=!0)=>{o=!0,i(c,l)}),o||i(!1,null)},n)}function Ps(s,e){return e}function oc(s,e,t){for(var r=[],n=e.length,i,o=e.length,l=0;l<n;l++){let p=e[l];yr(p,()=>{if(i){if(i.pending.delete(p),i.done.add(p),i.pending.size===0){var f=s.outrogroups;di(Ln(i.done)),f.delete(i),f.size===0&&(s.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=r.length===0&&t!==null;if(c){var u=t,d=u.parentNode;Gl(d),d.append(u),s.items.clear()}di(e,!c)}else i={pending:new Set(e),done:new Set},(s.outrogroups??=new Set).add(i)}function di(s,e=!0){for(var t=0;t<s.length;t++)Ht(s[t],e)}var ra;function Ot(s,e,t,r,n,i=null){var o=s,l=new Map,c=(e&Ea)!==0;if(c){var u=s;o=u.appendChild(Us())}var d=null,p=Oa(()=>{var N=t();return Ei(N)?N:N==null?[]:Ln(N)}),f,g=!0;function E(){C.fallback=d,lc(C,f,o,e,r),d!==null&&(f.length===0?(d.f&Ns)===0?Ti(d):(d.f^=Ns,Jr(d,null,o)):yr(d,()=>{d=null}))}var q=Ii(()=>{f=a(p);for(var N=f.length,j=new Set,x=Le,L=Wa(),B=0;B<N;B+=1){var J=f[B],ee=r(J,B),H=g?null:l.get(ee);H?(H.v&&Fr(H.v,J),H.i&&Fr(H.i,B),L&&x.unskip_effect(H.e)):(H=cc(l,g?o:ra??=Us(),J,ee,B,n,e,t),g||(H.e.f|=Ns),l.set(ee,H)),j.add(ee)}if(N===0&&i&&!d&&(g?d=ns(()=>i(o)):(d=ns(()=>i(ra??=Us())),d.f|=Ns)),N>j.size&&el(),!g)if(L){for(const[ce,ue]of l)j.has(ce)||x.skip_effect(ue.e);x.oncommit(E),x.ondiscard(()=>{})}else E();a(p)}),C={effect:q,items:l,outrogroups:null,fallback:d};g=!1}function jr(s){for(;s!==null&&(s.f&ws)===0;)s=s.next;return s}function lc(s,e,t,r,n){var i=(r&hl)!==0,o=e.length,l=s.items,c=jr(s.effect.first),u,d=null,p,f=[],g=[],E,q,C,N;if(i)for(N=0;N<o;N+=1)E=e[N],q=n(E,N),C=l.get(q).e,(C.f&Ns)===0&&(C.nodes?.a?.measure(),(p??=new Set).add(C));for(N=0;N<o;N+=1){if(E=e[N],q=n(E,N),C=l.get(q).e,s.outrogroups!==null)for(const ue of s.outrogroups)ue.pending.delete(C),ue.done.delete(C);if((C.f&Ns)!==0)if(C.f^=Ns,C===c)Jr(C,null,t);else{var j=d?d.next:c;C===s.effect.last&&(s.effect.last=C.prev),C.prev&&(C.prev.next=C.next),C.next&&(C.next.prev=C.prev),Ys(s,d,C),Ys(s,C,j),Jr(C,j,t),d=C,f=[],g=[],c=jr(d.next);continue}if((C.f&ts)!==0&&(Ti(C),i&&(C.nodes?.a?.unfix(),(p??=new Set).delete(C))),C!==c){if(u!==void 0&&u.has(C)){if(f.length<g.length){var x=g[0],L;d=x.prev;var B=f[0],J=f[f.length-1];for(L=0;L<f.length;L+=1)Jr(f[L],x,t);for(L=0;L<g.length;L+=1)u.delete(g[L]);Ys(s,B.prev,J.next),Ys(s,d,B),Ys(s,J,x),c=x,d=J,N-=1,f=[],g=[]}else u.delete(C),Jr(C,c,t),Ys(s,C.prev,C.next),Ys(s,C,d===null?s.effect.first:d.next),Ys(s,d,C),d=C;continue}for(f=[],g=[];c!==null&&c!==C;)(u??=new Set).add(c),g.push(c),c=jr(c.next);if(c===null)continue}(C.f&Ns)===0&&f.push(C),d=C,c=jr(C.next)}if(s.outrogroups!==null){for(const ue of s.outrogroups)ue.pending.size===0&&(di(Ln(ue.done)),s.outrogroups?.delete(ue));s.outrogroups.size===0&&(s.outrogroups=null)}if(c!==null||u!==void 0){var ee=[];if(u!==void 0)for(C of u)(C.f&ts)===0&&ee.push(C);for(;c!==null;)(c.f&ts)===0&&c!==s.fallback&&ee.push(c),c=jr(c.next);var H=ee.length;if(H>0){var ce=(r&Ea)!==0&&o===0?t:null;if(i){for(N=0;N<H;N+=1)ee[N].nodes?.a?.measure();for(N=0;N<H;N+=1)ee[N].nodes?.a?.fix()}oc(s,ee,ce)}}i&&Bs(()=>{if(p!==void 0)for(C of p)C.nodes?.a?.apply()})}function cc(s,e,t,r,n,i,o,l){var c=(o&ul)!==0?(o&dl)===0?Nl(t,!1,!1):nr(t):null,u=(o&fl)!==0?nr(n):null;return{v:c,i:u,e:ns(()=>(i(e,c??t,u??n,l),()=>{s.delete(r)}))}}function Jr(s,e,t){if(s.nodes)for(var r=s.nodes.start,n=s.nodes.end,i=e&&(e.f&Ns)===0?e.nodes.start:t;r!==null;){var o=vn(r);if(i.before(r),r===n)return;r=o}}function Ys(s,e,t){e===null?s.effect.first=t:e.next=t,t===null?s.effect.last=e:t.prev=e}const na=[...` 	
\r\fÂ \v\uFEFF`];function uc(s,e,t){var r=s==null?"":""+s;if(e&&(r=r?r+" "+e:e),t){for(var n in t)if(t[n])r=r?r+" "+n:n;else if(r.length)for(var i=n.length,o=0;(o=r.indexOf(n,o))>=0;){var l=o+i;(o===0||na.includes(r[o-1]))&&(l===r.length||na.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function ia(s,e=!1){var t=e?" !important;":";",r="";for(var n in s){var i=s[n];i!=null&&i!==""&&(r+=" "+n+": "+i+t)}return r}function zn(s){return s[0]!=="-"||s[1]!=="-"?s.toLowerCase():s}function fc(s,e){if(e){var t="",r,n;if(Array.isArray(e)?(r=e[0],n=e[1]):r=e,s){s=String(s).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,o=0,l=!1,c=[];r&&c.push(...Object.keys(r).map(zn)),n&&c.push(...Object.keys(n).map(zn));var u=0,d=-1;const q=s.length;for(var p=0;p<q;p++){var f=s[p];if(l?f==="/"&&s[p-1]==="*"&&(l=!1):i?i===f&&(i=!1):f==="/"&&s[p+1]==="*"?l=!0:f==='"'||f==="'"?i=f:f==="("?o++:f===")"&&o--,!l&&i===!1&&o===0){if(f===":"&&d===-1)d=p;else if(f===";"||p===q-1){if(d!==-1){var g=zn(s.substring(u,d).trim());if(!c.includes(g)){f!==";"&&p++;var E=s.substring(u,p).trim();t+=" "+E+";"}}u=p+1,d=-1}}}}return r&&(t+=ia(r)),n&&(t+=ia(n,!0)),t=t.trim(),t===""?null:t}return s==null?null:String(s)}function _e(s,e,t,r,n,i){var o=s.__className;if(o!==t||o===void 0){var l=uc(t,r,i);l==null?s.removeAttribute("class"):s.className=l,s.__className=t}else if(i&&n!==i)for(var c in i){var u=!!i[c];(n==null||u!==!!n[c])&&s.classList.toggle(c,u)}return i}function Vn(s,e={},t,r){for(var n in t){var i=t[n];e[n]!==i&&(t[n]==null?s.style.removeProperty(n):s.style.setProperty(n,i,r))}}function Ws(s,e,t,r){var n=s.__style;if(n!==e){var i=fc(e,r);i==null?s.removeAttribute("style"):s.style.cssText=i,s.__style=e}else r&&(Array.isArray(r)?(Vn(s,t?.[0],r[0]),Vn(s,t?.[1],r[1],"important")):Vn(s,t,r));return r}function lo(s,e,t=!1){if(s.multiple){if(e==null)return;if(!Ei(e))return yl();for(var r of s.options)r.selected=e.includes(aa(r));return}for(r of s.options){var n=aa(r);if(Bl(n,e)){r.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function hc(s){var e=new MutationObserver(()=>{lo(s,s.__value)});e.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Mi(()=>{e.disconnect()})}function aa(s){return"__value"in s?s.__value:s.value}const dc=Symbol("is custom element"),vc=Symbol("is html");function Mn(s,e,t,r){var n=pc(s);n[e]!==(n[e]=t)&&(e==="loading"&&(s[Zo]=t),t==null?s.removeAttribute(e):typeof t!="string"&&gc(s).includes(e)?s[e]=t:s.setAttribute(e,t))}function pc(s){return s.__attributes??={[dc]:s.nodeName.includes("-"),[vc]:s.namespaceURI===wl}}var oa=new Map;function gc(s){var e=s.getAttribute("is")||s.nodeName,t=oa.get(e);if(t)return t;oa.set(e,t=[]);for(var r,n=s,i=Element.prototype;i!==n;){r=zo(n);for(var o in r)r[o].set&&t.push(o);n=ma(n)}return t}function jn(s,e,t=e){var r=new WeakSet;Ka(s,"input",async n=>{var i=n?s.defaultValue:s.value;if(i=Yn(s)?Qn(i):i,t(i),Le!==null&&r.add(Le),await no(),i!==(i=e())){var o=s.selectionStart,l=s.selectionEnd,c=s.value.length;if(s.value=i??"",l!==null){var u=s.value.length;o===l&&l===c&&u>c?(s.selectionStart=u,s.selectionEnd=u):(s.selectionStart=o,s.selectionEnd=Math.min(l,u))}}}),or(e)==null&&s.value&&(t(Yn(s)?Qn(s.value):s.value),Le!==null&&r.add(Le)),Nn(()=>{var n=e();if(s===document.activeElement){var i=li??Le;if(r.has(i))return}Yn(s)&&n===Qn(s.value)||s.type==="date"&&!n&&!s.value||n!==s.value&&(s.value=n??"")})}function mc(s,e,t=e){Ka(s,"change",r=>{var n=r?s.defaultChecked:s.checked;t(n)}),or(e)==null&&t(s.checked),Nn(()=>{var r=e();s.checked=!!r})}function Yn(s){var e=s.type;return e==="number"||e==="range"}function Qn(s){return s===""?null:+s}function la(s,e){return s===e||s?.[wr]===e}function In(s={},e,t,r){return Vl(()=>{var n,i;return Nn(()=>{n=i,i=[],or(()=>{s!==t(...i)&&(e(s,...i),n&&la(t(...n),s)&&e(null,...n))})}),()=>{Bs(()=>{i&&la(t(...i),s)&&e(null,...i)})}}),s}let _n=!1;function _c(s){var e=_n;try{return _n=!1,[s(),_n]}finally{_n=e}}function is(s,e,t,r){var n=(t&gl)!==0,i=(t&ml)!==0,o=r,l=!0,c=()=>(l&&(l=!1,o=i?or(r):r),o),u;if(n){var d=wr in s||Xo in s;u=Tr(s,e)?.set??(d&&e in s?j=>s[e]=j:void 0)}var p,f=!1;n?[p,f]=_c(()=>s[e]):p=s[e],p===void 0&&r!==void 0&&(p=c(),u&&(il(),u(p)));var g;if(g=()=>{var j=s[e];return j===void 0?c():(l=!0,j)},(t&pl)===0)return g;if(u){var E=s.$$legacy;return(function(j,x){return arguments.length>0?((!x||E||f)&&u(x?g():j),j):g()})}var q=!1,C=((t&vl)!==0?On:Oa)(()=>(q=!1,g()));n&&a(C);var N=De;return(function(j,x){if(arguments.length>0){const L=x?a(C):n?ut(j):j;return h(C,L),q=!0,o!==void 0&&(o=L),j}return ir&&q||(N.f&Fs)!==0?C.v:a(C)})}function Br(s){zt===null&&ka(),ct(()=>{const e=or(s);if(typeof e=="function")return e})}function co(s){zt===null&&ka(),Br(()=>()=>or(s))}const uo=crypto.randomUUID();let $s=null,fo=0,vi=null;const Lr=new Map,an=new Map;function ho(s,e){return`${e}:${s.toLowerCase()}`}navigator.locks.request(`chess-tab-${uo}`,()=>new Promise(()=>{}));function bc(s,e){const t=ho(s,e),r=new Worker(new URL(""+new URL("db-worker-BD5gUua4.js",import.meta.url).href,import.meta.url),{type:"module"}),n=new MessageChannel;r.postMessage({type:"init",username:s,platform:e,port:n.port1},[n.port1]),$s.postMessage({type:"workerPort",username:s,platform:e,port:n.port2},[n.port2]),an.set(t,r)}function wc(){const s=new Worker(new URL(""+new URL("db-metadata-reader-worker-BB93cdYb.js",import.meta.url).href,import.meta.url),{type:"module"});s.onmessage=e=>{const t=e.data;t.type==="result"&&($s.postMessage({type:"cachedPlayersResult",data:t.data}),s.terminate())},s.postMessage({type:"readCachedPlayers"})}function yc(s,e){const t=ho(s,e),r=an.get(t);r&&(r.terminate(),an.delete(t))}function kc(){for(const[,s]of Lr)s.reject(new Error("SharedWorker connection lost"));Lr.clear();for(const[,s]of an)s.terminate();an.clear(),vo()}function vo(){$s=new SharedWorker(new URL(""+new URL("db-shared-worker-DIaiZ3hb.js",import.meta.url).href,import.meta.url),{type:"module"}).port,$s.onmessage=e=>{const t=e.data;if(t.type==="helloAck"){navigator.locks.request("chess-shared-worker",()=>{console.warn("[db-client] SharedWorker died (Web Lock released), reconnecting..."),kc()});return}if(t.type==="reload"){vi?vi():location.reload();return}if(t.type==="spawnWorker"){bc(t.username,t.platform);return}if(t.type==="terminateWorker"){yc(t.username,t.platform);return}if(t.type==="readCachedPlayers"){wc();return}const{requestId:r}=t,n=Lr.get(r);if(n)switch(t.type){case"progress":n.onProgress?.(t.message);break;case"status":n.onBlockedByIngestion?.(t.status);break;case"result":Lr.delete(r),n.resolve(t.data);break;case"error":Lr.delete(r),t.error==="WorkerSpawnFailed"?(console.error(`[db-client] WorkerSpawnFailed for request ${r}`),alert("Fatal error: Worker failed to spawn. Please reload the page."),n.reject(new Error(t.error))):t.error==="AbortError"?n.reject(new DOMException("Aborted","AbortError")):n.reject(new Error(t.error));break}},$s.start(),$s.postMessage({type:"hello",tabId:uo})}function Ec(s){vi=null,vo()}function Ts(s,e){return new Promise((t,r)=>{if(!$s){r(new Error("SharedWorker not connected"));return}const n=fo++;Lr.set(n,{resolve:t,reject:r,onProgress:e?.onProgress,onBlockedByIngestion:e?.onBlockedByIngestion}),$s.postMessage({...s,requestId:n})})}async function pi(){return Ts({type:"listCachedPlayers"})}async function Sc(s,e){return Ts({type:"clearPlayerData",username:s,platform:e})}async function Cc(){return Ts({type:"clearAllData"})}async function xc(s,e,t,r,n,i){if(i?.aborted)throw new DOMException("Aborted","AbortError");const o=fo,l=()=>{$s?.postMessage({type:"cancel",cancelRequestId:o})};i&&i.addEventListener("abort",l,{once:!0});try{return await Ts({type:"ensureIngested",username:s,platform:e,since:t,until:r},{onProgress:n})}finally{i?.removeEventListener("abort",l)}}async function Pc(s,e,t,r,n,i,o,l,c){return Ts({type:"getContinuations",username:s,platform:e,since:t,until:r,moveSequence:n,playerColor:i,timeControl:o,includeTranspositions:l},{onBlockedByIngestion:c})}async function qc(s,e,t,r,n,i,o,l){return Ts({type:"searchByPosition",username:s,platform:e,since:t,until:r,pattern:n,playerColor:i,timeControl:o},{onBlockedByIngestion:l})}async function po(s,e,t,r){return Ts({type:"getGamesMetadata",username:s,platform:e,gameIds:t},{onBlockedByIngestion:r})}async function go(s,e,t,r){return Ts({type:"getGamesMoves",username:s,platform:e,gameIds:t},{onBlockedByIngestion:r})}async function Ac(s,e,t,r,n,i,o){return Ts({type:"getRecentGames",username:s,platform:e,since:t,until:r,timeControl:n,limit:i},{onBlockedByIngestion:o})}async function Mc(s,e,t,r,n){return Ts({type:"getAvailableTimeControls",username:s,platform:e,since:t,until:r},{onBlockedByIngestion:n})}const Ic="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Ic);function Tc(s){return s!==null?{comment:s,variations:[]}:{variations:[]}}function Lc(s,e,t,r,n){const i={move:s,variations:n};return e&&(i.suffix=e),t&&(i.nag=t),r!==null&&(i.comment=r),i}function Dc(...s){const[e,...t]=s;let r=e;for(const n of t)n!==null&&(r.variations=[n,...n.variations],n.variations=[],r=n);return e}function Oc(s,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const r=t.variations[0];if(!r){t.comment=e.marker.comment;break}t=r}}return{headers:s,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function Rc(s,e){function t(){this.constructor=s}t.prototype=e.prototype,s.prototype=new t}function Ur(s,e,t,r){var n=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(n,Ur.prototype),n.expected=e,n.found=t,n.location=r,n.name="SyntaxError",n}Rc(Ur,Error);function Xn(s,e,t){return t=t||" ",s.length>e?s:(e-=s.length,t+=t.repeat(e),s+t.slice(0,e))}Ur.prototype.format=function(s){var e="Error: "+this.message;if(this.location){var t=null,r;for(r=0;r<s.length;r++)if(s[r].source===this.location.source){t=s[r].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,i=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(n):n,o=this.location.source+":"+i.line+":"+i.column;if(t){var l=this.location.end,c=Xn("",i.line.toString().length," "),u=t[n.line-1],d=n.line===l.line?l.column:u.length+1,p=d-n.column||1;e+=`
 --> `+o+`
`+c+` |
`+i.line+" | "+u+`
`+c+" | "+Xn("",n.column-1," ")+Xn("",p,"^")}else e+=`
 at `+o}return e};Ur.buildMessage=function(s,e){var t={literal:function(u){return'"'+n(u.text)+'"'},class:function(u){var d=u.parts.map(function(p){return Array.isArray(p)?i(p[0])+"-"+i(p[1]):i(p)});return"["+(u.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(u){return u.description}};function r(u){return u.charCodeAt(0).toString(16).toUpperCase()}function n(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+r(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+r(d)})}function i(u){return u.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+r(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+r(d)})}function o(u){return t[u.type](u)}function l(u){var d=u.map(o),p,f;if(d.sort(),d.length>0){for(p=1,f=1;p<d.length;p++)d[p-1]!==d[p]&&(d[f]=d[p],f++);d.length=f}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function c(u){return u?'"'+n(u)+'"':"end of input"}return"Expected "+l(s)+" but "+c(e)+" found."};function Nc(s,e){e=e!==void 0?e:{};var t={},r=e.grammarSource,n={pgn:X},i=X,o="[",l='"',c="]",u=".",d="O-O-O",p="O-O",f="0-0-0",g="0-0",E="$",q="{",C="}",N=";",j="(",x=")",L="1-0",B="0-1",J="1/2-1/2",ee="*",H=/^[a-zA-Z]/,ce=/^[^"]/,ue=/^[0-9]/,Ie=/^[.]/,Re=/^[a-zA-Z1-8\-=]/,Y=/^[+#]/,ye=/^[!?]/,ke=/^[^}]/,ve=/^[^\r\n]/,Se=/^[ \t\r\n]/,oe=qe("tag pair"),Ce=He("[",!1),xe=He('"',!1),z=He("]",!1),pe=qe("tag name"),Ne=yt([["a","z"],["A","Z"]],!1,!1),$e=qe("tag value"),Pe=yt(['"'],!0,!1),Qe=qe("move number"),Oe=yt([["0","9"]],!1,!1),it=He(".",!1),dt=yt(["."],!1,!1),Vt=qe("standard algebraic notation"),cs=He("O-O-O",!1),Ls=He("O-O",!1),ys=He("0-0-0",!1),us=He("0-0",!1),Rt=yt([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),fs=yt(["+","#"],!1,!1),M=qe("suffix annotation"),$=yt(["!","?"],!1,!1),ge=qe("NAG"),fe=He("$",!1),re=qe("brace comment"),ie=He("{",!1),ae=yt(["}"],!0,!1),Be=He("}",!1),Fe=qe("rest of line comment"),Ue=He(";",!1),Ge=yt(["\r",`
`],!0,!1),me=qe("variation"),Xe=He("(",!1),jt=He(")",!1),Yt=qe("game termination marker"),Mt=He("1-0",!1),It=He("0-1",!1),ks=He("1/2-1/2",!1),We=He("*",!1),Ee=qe("whitespace"),bt=yt([" ","	","\r",`
`],!1,!1),I=function(v,_){return Oc(v,_)},te=function(v){return Object.fromEntries(v)},le=function(v,_){return[v,_]},je=function(v,_){return{root:v,marker:_}},wt=function(v,_){return Dc(Tc(v),..._.flat())},ft=function(v,_,b,K,O){return Lc(v,_,b,K,O)},Qt=function(v){return v},hs=function(v){return v.replace(/[\r\n]+/g," ")},Nt=function(v){return v.trim()},Es=function(v){return v},vt=function(v,_){return{result:v,comment:_}},m=e.peg$currPos|0,$t=[{line:1,column:1}],at=m,Ke=e.peg$maxFailExpected||[],A=e.peg$silentFails|0,Ft;if(e.startRule){if(!(e.startRule in n))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');i=n[e.startRule]}function He(v,_){return{type:"literal",text:v,ignoreCase:_}}function yt(v,_,b){return{type:"class",parts:v,inverted:_,ignoreCase:b}}function js(){return{type:"end"}}function qe(v){return{type:"other",description:v}}function y(v){var _=$t[v],b;if(_)return _;if(v>=$t.length)b=$t.length-1;else for(b=v;!$t[--b];);for(_=$t[b],_={line:_.line,column:_.column};b<v;)s.charCodeAt(b)===10?(_.line++,_.column=1):_.column++,b++;return $t[v]=_,_}function P(v,_,b){var K=y(v),O=y(_),G={source:r,start:{offset:v,line:K.line,column:K.column},end:{offset:_,line:O.line,column:O.column}};return G}function k(v){m<at||(m>at&&(at=m,Ke=[]),Ke.push(v))}function W(v,_,b){return new Ur(Ur.buildMessage(v,_),v,_,b)}function X(){var v,_,b;return v=m,_=V(),b=Bt(),v=I(_,b),v}function V(){var v,_,b;for(v=m,_=[],b=ne();b!==t;)_.push(b),b=ne();return b=tt(),v=te(_),v}function ne(){var v,_,b,K,O,G,st;return A++,v=m,tt(),s.charCodeAt(m)===91?(_=o,m++):(_=t,A===0&&k(Ce)),_!==t?(tt(),b=Ze(),b!==t?(tt(),s.charCodeAt(m)===34?(K=l,m++):(K=t,A===0&&k(xe)),K!==t?(O=Tt(),s.charCodeAt(m)===34?(G=l,m++):(G=t,A===0&&k(xe)),G!==t?(tt(),s.charCodeAt(m)===93?(st=c,m++):(st=t,A===0&&k(z)),st!==t?v=le(b,O):(m=v,v=t)):(m=v,v=t)):(m=v,v=t)):(m=v,v=t)):(m=v,v=t),A--,v===t&&A===0&&k(oe),v}function Ze(){var v,_,b;if(A++,v=m,_=[],b=s.charAt(m),H.test(b)?m++:(b=t,A===0&&k(Ne)),b!==t)for(;b!==t;)_.push(b),b=s.charAt(m),H.test(b)?m++:(b=t,A===0&&k(Ne));else _=t;return _!==t?v=s.substring(v,m):v=_,A--,v===t&&(_=t,A===0&&k(pe)),v}function Tt(){var v,_,b;for(A++,v=m,_=[],b=s.charAt(m),ce.test(b)?m++:(b=t,A===0&&k(Pe));b!==t;)_.push(b),b=s.charAt(m),ce.test(b)?m++:(b=t,A===0&&k(Pe));return v=s.substring(v,m),A--,_=t,A===0&&k($e),v}function Bt(){var v,_,b;return v=m,_=Ae(),tt(),b=Ds(),b===t&&(b=null),tt(),v=je(_,b),v}function Ae(){var v,_,b,K;for(v=m,_=Pt(),_===t&&(_=null),b=[],K=Je();K!==t;)b.push(K),K=Je();return v=wt(_,b),v}function Je(){var v,_,b,K,O,G,st,Ut;if(v=m,tt(),Ss(),tt(),_=Cr(),_!==t){for(b=zr(),b===t&&(b=null),K=[],O=cr();O!==t;)K.push(O),O=cr();for(O=tt(),G=Pt(),G===t&&(G=null),st=[],Ut=ss();Ut!==t;)st.push(Ut),Ut=ss();v=ft(_,b,K,G,st)}else m=v,v=t;return v}function Ss(){var v,_,b,K,O,G;for(A++,v=m,_=[],b=s.charAt(m),ue.test(b)?m++:(b=t,A===0&&k(Oe));b!==t;)_.push(b),b=s.charAt(m),ue.test(b)?m++:(b=t,A===0&&k(Oe));if(s.charCodeAt(m)===46?(b=u,m++):(b=t,A===0&&k(it)),b!==t){for(K=tt(),O=[],G=s.charAt(m),Ie.test(G)?m++:(G=t,A===0&&k(dt));G!==t;)O.push(G),G=s.charAt(m),Ie.test(G)?m++:(G=t,A===0&&k(dt));_=[_,b,K,O],v=_}else m=v,v=t;return A--,v===t&&(_=t,A===0&&k(Qe)),v}function Cr(){var v,_,b,K,O,G;if(A++,v=m,_=m,s.substr(m,5)===d?(b=d,m+=5):(b=t,A===0&&k(cs)),b===t&&(s.substr(m,3)===p?(b=p,m+=3):(b=t,A===0&&k(Ls)),b===t&&(s.substr(m,5)===f?(b=f,m+=5):(b=t,A===0&&k(ys)),b===t&&(s.substr(m,3)===g?(b=g,m+=3):(b=t,A===0&&k(us)),b===t))))if(b=m,K=s.charAt(m),H.test(K)?m++:(K=t,A===0&&k(Ne)),K!==t){if(O=[],G=s.charAt(m),Re.test(G)?m++:(G=t,A===0&&k(Rt)),G!==t)for(;G!==t;)O.push(G),G=s.charAt(m),Re.test(G)?m++:(G=t,A===0&&k(Rt));else O=t;O!==t?(K=[K,O],b=K):(m=b,b=t)}else m=b,b=t;return b!==t?(K=s.charAt(m),Y.test(K)?m++:(K=t,A===0&&k(fs)),K===t&&(K=null),b=[b,K],_=b):(m=_,_=t),_!==t?v=s.substring(v,m):v=_,A--,v===t&&(_=t,A===0&&k(Vt)),v}function zr(){var v,_,b;for(A++,v=m,_=[],b=s.charAt(m),ye.test(b)?m++:(b=t,A===0&&k($));b!==t;)_.push(b),_.length>=2?b=t:(b=s.charAt(m),ye.test(b)?m++:(b=t,A===0&&k($)));return _.length<1?(m=v,v=t):v=_,A--,v===t&&(_=t,A===0&&k(M)),v}function cr(){var v,_,b,K,O;if(A++,v=m,tt(),s.charCodeAt(m)===36?(_=E,m++):(_=t,A===0&&k(fe)),_!==t){if(b=m,K=[],O=s.charAt(m),ue.test(O)?m++:(O=t,A===0&&k(Oe)),O!==t)for(;O!==t;)K.push(O),O=s.charAt(m),ue.test(O)?m++:(O=t,A===0&&k(Oe));else K=t;K!==t?b=s.substring(b,m):b=K,b!==t?v=Qt(b):(m=v,v=t)}else m=v,v=t;return A--,v===t&&A===0&&k(ge),v}function Pt(){var v;return v=ze(),v===t&&(v=Lt()),v}function ze(){var v,_,b,K,O;if(A++,v=m,s.charCodeAt(m)===123?(_=q,m++):(_=t,A===0&&k(ie)),_!==t){for(b=m,K=[],O=s.charAt(m),ke.test(O)?m++:(O=t,A===0&&k(ae));O!==t;)K.push(O),O=s.charAt(m),ke.test(O)?m++:(O=t,A===0&&k(ae));b=s.substring(b,m),s.charCodeAt(m)===125?(K=C,m++):(K=t,A===0&&k(Be)),K!==t?v=hs(b):(m=v,v=t)}else m=v,v=t;return A--,v===t&&(_=t,A===0&&k(re)),v}function Lt(){var v,_,b,K,O;if(A++,v=m,s.charCodeAt(m)===59?(_=N,m++):(_=t,A===0&&k(Ue)),_!==t){for(b=m,K=[],O=s.charAt(m),ve.test(O)?m++:(O=t,A===0&&k(Ge));O!==t;)K.push(O),O=s.charAt(m),ve.test(O)?m++:(O=t,A===0&&k(Ge));b=s.substring(b,m),v=Nt(b)}else m=v,v=t;return A--,v===t&&(_=t,A===0&&k(Fe)),v}function ss(){var v,_,b,K;return A++,v=m,tt(),s.charCodeAt(m)===40?(_=j,m++):(_=t,A===0&&k(Xe)),_!==t?(b=Ae(),b!==t?(tt(),s.charCodeAt(m)===41?(K=x,m++):(K=t,A===0&&k(jt)),K!==t?v=Es(b):(m=v,v=t)):(m=v,v=t)):(m=v,v=t),A--,v===t&&A===0&&k(me),v}function Ds(){var v,_,b;return A++,v=m,s.substr(m,3)===L?(_=L,m+=3):(_=t,A===0&&k(Mt)),_===t&&(s.substr(m,3)===B?(_=B,m+=3):(_=t,A===0&&k(It)),_===t&&(s.substr(m,7)===J?(_=J,m+=7):(_=t,A===0&&k(ks)),_===t&&(s.charCodeAt(m)===42?(_=ee,m++):(_=t,A===0&&k(We))))),_!==t?(tt(),b=Pt(),b===t&&(b=null),v=vt(_,b)):(m=v,v=t),A--,v===t&&(_=t,A===0&&k(Yt)),v}function tt(){var v,_;for(A++,v=[],_=s.charAt(m),Se.test(_)?m++:(_=t,A===0&&k(bt));_!==t;)v.push(_),_=s.charAt(m),Se.test(_)?m++:(_=t,A===0&&k(bt));return A--,_=t,A===0&&k(Ee),v}if(Ft=i(),e.peg$library)return{peg$result:Ft,peg$currPos:m,peg$FAILED:t,peg$maxFailExpected:Ke,peg$maxFailPos:at};if(Ft!==t&&m===s.length)return Ft;throw Ft!==t&&m<s.length&&k(js()),W(Ke,at<s.length?s.charAt(at):null,at<s.length?P(at,at+1):P(at,at))}const En=0xffffffffffffffffn;function Zn(s,e){return(s<<e|s>>64n-e)&0xffffffffffffffffn}function ca(s,e){return s*e&En}function $c(s){return function(){let e=BigInt(s&En),t=BigInt(s>>64n&En);const r=ca(Zn(ca(e,5n),7n),9n);return t^=e,e=(Zn(e,24n)^t^t<<16n)&En,t=Zn(t,37n),s=t<<64n|e,r}}const $n=$c(0xa187eb39cdcaed8f31c4b365b102e01en),Fc=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>$n()))),Bc=Array.from({length:8},()=>$n()),Uc=Array.from({length:16},()=>$n()),Jn=$n(),At="w",Xt="b",ot="p",gi="n",Sn="b",en="r",Js="q",ht="k",ei="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class bn{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){const{color:r,piece:n,from:i,to:o,flags:l,captured:c,promotion:u}=t,d=gt(i),p=gt(o);this.color=r,this.piece=n,this.from=d,this.to=p,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=d+p,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const f in se)se[f]&l&&(this.flags+=hr[f]);c&&(this.captured=c),u&&(this.promotion=u,this.lan+=u)}isCapture(){return this.flags.indexOf(hr.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(hr.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(hr.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(hr.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(hr.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(hr.BIG_PAWN)>-1}}const Et=-1,hr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},se={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},mi={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Gc={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Wc={...mi,...Gc},Z={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ti={b:[16,32,17,15],w:[-16,-32,-17,-15]},ua={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Kc=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Hc=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],zc={p:1,n:2,b:4,r:8,q:16,k:32},Vc="pnbrqkPNBRQK",fa=[gi,Sn,en,Js],jc=7,Yc=6,Qc=1,Xc=0,wn={[ht]:se.KSIDE_CASTLE,[Js]:se.QSIDE_CASTLE},Qs={w:[{square:Z.a1,flag:se.QSIDE_CASTLE},{square:Z.h1,flag:se.KSIDE_CASTLE}],b:[{square:Z.a8,flag:se.QSIDE_CASTLE},{square:Z.h8,flag:se.KSIDE_CASTLE}]},Zc={b:Qc,w:Yc},si="--";function kr(s){return s>>4}function on(s){return s&15}function mo(s){return"0123456789".indexOf(s)!==-1}function gt(s){const e=on(s),t=kr(s);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function Yr(s){return s===At?Xt:At}function Jc(s){const e=s.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(e[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const n=e[0].split("/");if(n.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<n.length;o++){let l=0,c=!1;for(let u=0;u<n[o].length;u++)if(mo(n[o][u])){if(c)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(n[o][u],10),c=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[o][u]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,c=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const i=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:l}of i){if(!l.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(n[0]+n[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function eu(s,e){const t=s.from,r=s.to,n=s.piece;let i=0,o=0,l=0;for(let c=0,u=e.length;c<u;c++){const d=e[c].from,p=e[c].to,f=e[c].piece;n===f&&t!==d&&r===p&&(i++,kr(t)===kr(d)&&o++,on(t)===on(d)&&l++)}return i>0?o>0&&l>0?gt(t):l>0?gt(t).charAt(1):gt(t).charAt(0):""}function Xs(s,e,t,r,n,i=void 0,o=se.NORMAL){const l=kr(r);if(n===ot&&(l===jc||l===Xc))for(let c=0;c<fa.length;c++){const u=fa[c];s.push({color:e,from:t,to:r,piece:n,captured:i,promotion:u,flags:o|se.PROMOTION})}else s.push({color:e,from:t,to:r,piece:n,captured:i,flags:o})}function ha(s){let e=s.charAt(0);return e>="a"&&e<="h"?s.match(/[a-h]\d.*[a-h]\d/)?void 0:ot:(e=e.toLowerCase(),e==="o"?ht:e)}function ri(s){return s.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class lr{_board=new Array(128);_turn=At;_header={};_kings={w:Et,b:Et};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=ei,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:Et,b:Et},this._turn=At,this._castling={w:0,b:0},this._epSquare=Et,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...Wc},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:r=!1}={}){let n=e.split(/\s+/);if(n.length>=2&&n.length<6){const l=["-","-","0","1"];e=n.concat(l.slice(-(6-n.length))).join(" ")}if(n=e.split(/\s+/),!t){const{ok:l,error:c}=Jc(e);if(!l)throw new Error(c)}const i=n[0];let o=0;this.clear({preserveHeaders:r});for(let l=0;l<i.length;l++){const c=i.charAt(l);if(c==="/")o+=8;else if(mo(c))o+=parseInt(c,10);else{const u=c<"a"?At:Xt;this._put({type:c.toLowerCase(),color:u},gt(o)),o++}}this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=se.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=se.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=se.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=se.QSIDE_CASTLE),this._epSquare=n[3]==="-"?Et:Z[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let t=0,r="";for(let o=Z.a8;o<=Z.h1;o++){if(this._board[o]){t>0&&(r+=t,t=0);const{color:l,type:c}=this._board[o];r+=l===At?c.toUpperCase():c.toLowerCase()}else t++;o+1&136&&(t>0&&(r+=t),o!==Z.h1&&(r+="/"),t=0,o+=8)}let n="";this._castling[At]&se.KSIDE_CASTLE&&(n+="K"),this._castling[At]&se.QSIDE_CASTLE&&(n+="Q"),this._castling[Xt]&se.KSIDE_CASTLE&&(n+="k"),this._castling[Xt]&se.QSIDE_CASTLE&&(n+="q"),n=n||"-";let i="-";if(this._epSquare!==Et)if(e)i=gt(this._epSquare);else{const o=this._epSquare+(this._turn===At?16:-16),l=[o+1,o-1];for(const c of l){if(c&136)continue;const u=this._turn;if(this._board[c]?.color===u&&this._board[c]?.type===ot){this._makeMove({color:u,from:c,to:this._epSquare,piece:ot,captured:ot,flags:se.EP_CAPTURE});const d=!this._isKingAttacked(u);if(this._undoMove(),d){i=gt(this._epSquare);break}}}}return[r,this._turn,n,i,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:t,type:r}=this._board[e],n={w:0,b:1}[t],i={p:0,n:1,b:2,r:3,q:4,k:5}[r];return Fc[n][i][e]}_epKey(){return this._epSquare===Et?0n:Bc[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return Uc[e]}_computeHash(){let e=0n;for(let t=Z.a8;t<=Z.h1;t++){if(t&136){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=Jn),e}_updateSetup(e){this._history.length>0||(e!==ei?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(ei)}get(e){return this._board[Z[e]]}findPiece(e){const t=[];for(let r=Z.a8;r<=Z.h1;r++){if(r&136){r+=7;continue}!this._board[r]||this._board[r]?.color!==e.color||this._board[r].color===e.color&&this._board[r].type===e.type&&t.push(gt(r))}return t}put({type:e,color:t},r){return this._put({type:e,color:t},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},r){if(Vc.indexOf(e.toLowerCase())===-1||!(r in Z))return!1;const n=Z[r];if(e==ht&&!(this._kings[t]==Et||this._kings[t]==n))return!1;const i=this._board[n];return i&&i.type===ht&&(this._kings[i.color]=Et),this._set(n,{type:e,color:t}),e===ht&&(this._kings[t]=n),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const t=this.get(e);return this._clear(Z[e]),t&&t.type===ht&&(this._kings[t.color]=Et),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){this._hash^=this._castlingKey();const e=this._board[Z.e1]?.type===ht&&this._board[Z.e1]?.color===At,t=this._board[Z.e8]?.type===ht&&this._board[Z.e8]?.color===Xt;(!e||this._board[Z.a1]?.type!==en||this._board[Z.a1]?.color!==At)&&(this._castling.w&=-65),(!e||this._board[Z.h1]?.type!==en||this._board[Z.h1]?.color!==At)&&(this._castling.w&=-33),(!t||this._board[Z.a8]?.type!==en||this._board[Z.a8]?.color!==Xt)&&(this._castling.b&=-65),(!t||this._board[Z.h8]?.type!==en||this._board[Z.h8]?.color!==Xt)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===Et)return;const e=this._epSquare+(this._turn===At?-16:16),t=this._epSquare+(this._turn===At?16:-16),r=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||this._board[t]?.color!==Yr(this._turn)||this._board[t]?.type!==ot){this._hash^=this._epKey(),this._epSquare=Et;return}const n=i=>!(i&136)&&this._board[i]?.color===this._turn&&this._board[i]?.type===ot;r.some(n)||(this._hash^=this._epKey(),this._epSquare=Et)}_attacked(e,t,r){const n=[];for(let i=Z.a8;i<=Z.h1;i++){if(i&136){i+=7;continue}if(this._board[i]===void 0||this._board[i].color!==e)continue;const o=this._board[i],l=i-t;if(l===0)continue;const c=l+119;if(Kc[c]&zc[o.type]){if(o.type===ot){if(l>0&&o.color===At||l<=0&&o.color===Xt)if(r)n.push(gt(i));else return!0;continue}if(o.type==="n"||o.type==="k")if(r){n.push(gt(i));continue}else return!0;const u=Hc[c];let d=i+u,p=!1;for(;d!==t;){if(this._board[d]!=null){p=!0;break}d+=u}if(!p)if(r){n.push(gt(i));continue}else return!0}}return r?n:!1}attackers(e,t){return t?this._attacked(t,Z[e],!0):this._attacked(this._turn,Z[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(Yr(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,Z[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let r=0,n=0;for(let i=Z.a8;i<=Z.h1;i++){if(n=(n+1)%2,i&136){i+=7;continue}const o=this._board[i];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===Sn&&t.push(n),r++)}if(r===2)return!0;if(r===3&&(e[Sn]===1||e[gi]===1))return!0;if(r===e[Sn]+2){let i=0;const o=t.length;for(let l=0;l<o;l++)i+=t[l];if(i===0||i===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:r=void 0}={}){const n=this._moves({square:t,piece:r});return e?n.map(i=>new bn(this,i)):n.map(i=>this._moveToSan(i,n))}_moves({legal:e=!0,piece:t=void 0,square:r=void 0}={}){const n=r?r.toLowerCase():void 0,i=t?.toLowerCase(),o=[],l=this._turn,c=Yr(l);let u=Z.a8,d=Z.h1,p=!1;if(n)if(n in Z)u=d=Z[n],p=!0;else return[];for(let g=u;g<=d;g++){if(g&136){g+=7;continue}if(!this._board[g]||this._board[g].color===c)continue;const{type:E}=this._board[g];let q;if(E===ot){if(i&&i!==E)continue;q=g+ti[l][0],this._board[q]||(Xs(o,l,g,q,ot),q=g+ti[l][1],Zc[l]===kr(g)&&!this._board[q]&&Xs(o,l,g,q,ot,void 0,se.BIG_PAWN));for(let C=2;C<4;C++)q=g+ti[l][C],!(q&136)&&(this._board[q]?.color===c?Xs(o,l,g,q,ot,this._board[q].type,se.CAPTURE):q===this._epSquare&&Xs(o,l,g,q,ot,ot,se.EP_CAPTURE))}else{if(i&&i!==E)continue;for(let C=0,N=ua[E].length;C<N;C++){const j=ua[E][C];for(q=g;q+=j,!(q&136);){if(!this._board[q])Xs(o,l,g,q,E);else{if(this._board[q].color===l)break;Xs(o,l,g,q,E,this._board[q].type,se.CAPTURE);break}if(E===gi||E===ht)break}}}}if((i===void 0||i===ht)&&(!p||d===this._kings[l])){if(this._castling[l]&se.KSIDE_CASTLE){const g=this._kings[l],E=g+2;!this._board[g+1]&&!this._board[E]&&!this._attacked(c,this._kings[l])&&!this._attacked(c,g+1)&&!this._attacked(c,E)&&Xs(o,l,this._kings[l],E,ht,void 0,se.KSIDE_CASTLE)}if(this._castling[l]&se.QSIDE_CASTLE){const g=this._kings[l],E=g-2;!this._board[g-1]&&!this._board[g-2]&&!this._board[g-3]&&!this._attacked(c,this._kings[l])&&!this._attacked(c,g-1)&&!this._attacked(c,E)&&Xs(o,l,this._kings[l],E,ht,void 0,se.QSIDE_CASTLE)}}if(!e||this._kings[l]===-1)return o;const f=[];for(let g=0,E=o.length;g<E;g++)this._makeMove(o[g]),this._isKingAttacked(l)||f.push(o[g]),this._undoMove();return f}move(e,{strict:t=!1}={}){let r=null;if(typeof e=="string")r=this._moveFromSan(e,t);else if(e===null)r=this._moveFromSan(si,t);else if(typeof e=="object"){const i=this._moves();for(let o=0,l=i.length;o<l;o++)if(e.from===gt(i[o].from)&&e.to===gt(i[o].to)&&(!("promotion"in i[o])||e.promotion===i[o].promotion)){r=i[o];break}}if(!r)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&r.flags&se.NULL_MOVE)throw new Error("Null move not allowed when in check");const n=new bn(this,r);return this._makeMove(r),this._incPositionCount(),n}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){const t=this._turn,r=Yr(t);if(this._push(e),e.flags&se.NULL_MOVE){t===Xt&&this._moveNumber++,this._halfMoves++,this._turn=r,this._epSquare=Et;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&se.EP_CAPTURE&&(this._turn===Xt?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),this._board[e.to].type===ht){if(this._kings[t]=e.to,e.flags&se.KSIDE_CASTLE){const n=e.to-1,i=e.to+1;this._movePiece(i,n)}else if(e.flags&se.QSIDE_CASTLE){const n=e.to+1,i=e.to-2;this._movePiece(i,n)}this._castling[t]=0}if(this._castling[t]){for(let n=0,i=Qs[t].length;n<i;n++)if(e.from===Qs[t][n].square&&this._castling[t]&Qs[t][n].flag){this._castling[t]^=Qs[t][n].flag;break}}if(this._castling[r]){for(let n=0,i=Qs[r].length;n<i;n++)if(e.to===Qs[r][n].square&&this._castling[r]&Qs[r][n].flag){this._castling[r]^=Qs[r][n].flag;break}}if(this._hash^=this._castlingKey(),e.flags&se.BIG_PAWN){let n;t===Xt?n=e.to-16:n=e.to+16,!(e.to-1&136)&&this._board[e.to-1]?.type===ot&&this._board[e.to-1]?.color===r||!(e.to+1&136)&&this._board[e.to+1]?.type===ot&&this._board[e.to+1]?.color===r?(this._epSquare=n,this._hash^=this._epKey()):this._epSquare=Et}else this._epSquare=Et;e.piece===ot?this._halfMoves=0:e.flags&(se.CAPTURE|se.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===Xt&&this._moveNumber++,this._turn=r,this._hash^=Jn}undo(){const e=this._hash,t=this._undoMove();if(t){const r=new bn(this,t);return this._decPositionCount(e),r}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=Jn;const r=this._turn,n=Yr(r);if(t.flags&se.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:r})),t.captured)if(t.flags&se.EP_CAPTURE){let i;r===Xt?i=t.to-16:i=t.to+16,this._set(i,{type:ot,color:n})}else this._set(t.to,{type:t.captured,color:n});if(t.flags&(se.KSIDE_CASTLE|se.QSIDE_CASTLE)){let i,o;t.flags&se.KSIDE_CASTLE?(i=t.to+1,o=t.to-1):(i=t.to-2,o=t.to+1),this._movePiece(o,i)}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const r=[];let n=!1;for(const f in this._header)this._header[f]&&r.push(`[${f} "${this._header[f]}"]`+e),n=!0;n&&this._history.length&&r.push(e);const i=f=>{const g=this._comments[this.fen()];if(typeof g<"u"){const E=f.length>0?" ":"";f=`${f}${E}{${g}}`}return f},o=[];for(;this._history.length>0;)o.push(this._undoMove());const l=[];let c="";for(o.length===0&&l.push(i(""));o.length>0;){c=i(c);const f=o.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const g=`${this._moveNumber}. ...`;c=c?`${c} ${g}`:g}else f.color==="w"&&(c.length&&l.push(c),c=this._moveNumber+".");c=c+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(c.length&&l.push(i(c)),l.push(this._header.Result||"*"),t===0)return r.join("")+l.join(" ");const u=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},d=function(f,g){for(const E of g.split(" "))if(E){if(f+E.length>t){for(;u();)f--;r.push(e),f=0}r.push(E),f+=E.length,r.push(" "),f++}return u()&&f--,f};let p=0;for(let f=0;f<l.length;f++){if(p+l[f].length>t&&l[f].includes("{")){p=d(p,l[f]);continue}p+l[f].length>t&&f!==0?(r[r.length-1]===" "&&r.pop(),r.push(e),p=0):f!==0&&(r.push(" "),p++),r.push(l[f]),p+=l[f].length}return r.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??mi[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=mi[e]||null,!0):!1}getHeaders(){const e={};for(const[t,r]of Object.entries(this._header))r!==null&&(e[t]=r);return e}loadPgn(e,{strict:t=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(e=e.replace(new RegExp(r,"g"),`
`));const n=Nc(e);this.reset();const i=n.headers;let o="";for(const u in i)u.toLowerCase()==="fen"&&(o=i[u]),this.header(u,i[u]);if(!t)o&&this.load(o,{preserveHeaders:!0});else if(i.SetUp==="1"){if(!("FEN"in i))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(i.FEN,{preserveHeaders:!0})}let l=n.root;for(;l;){if(l.move){const u=this._moveFromSan(l.move,t);if(u==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(u),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const c=n.result;c&&Object.keys(this._header).length&&this._header.Result!==c&&this.setHeader("Result",c)}_moveToSan(e,t){let r="";if(e.flags&se.KSIDE_CASTLE)r="O-O";else if(e.flags&se.QSIDE_CASTLE)r="O-O-O";else{if(e.flags&se.NULL_MOVE)return si;if(e.piece!==ot){const n=eu(e,t);r+=e.piece.toUpperCase()+n}e.flags&(se.CAPTURE|se.EP_CAPTURE)&&(e.piece===ot&&(r+=gt(e.from)[0]),r+="x"),r+=gt(e.to),e.promotion&&(r+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(e,t=!1){let r=ri(e);if(t||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O")),r==si)return{color:this._turn,from:0,to:0,piece:"k",flags:se.NULL_MOVE};let n=ha(r),i=this._moves({legal:!0,piece:n});for(let f=0,g=i.length;f<g;f++)if(r===ri(this._moveToSan(i[f],i)))return i[f];if(t)return null;let o,l,c,u,d,p=!1;if(l=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(o=l[1],c=l[2],u=l[3],d=l[4],c.length==1&&(p=!0)):(l=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(o=l[1],c=l[2],u=l[3],d=l[4],c.length==1&&(p=!0))),n=ha(r),i=this._moves({legal:!0,piece:o||n}),!u)return null;for(let f=0,g=i.length;f<g;f++)if(c){if((!o||o.toLowerCase()==i[f].piece)&&Z[c]==i[f].from&&Z[u]==i[f].to&&(!d||d.toLowerCase()==i[f].promotion))return i[f];if(p){const E=gt(i[f].from);if((!o||o.toLowerCase()==i[f].piece)&&Z[u]==i[f].to&&(c==E[0]||c==E[1])&&(!d||d.toLowerCase()==i[f].promotion))return i[f]}}else if(r===ri(this._moveToSan(i[f],i)).replace("x",""))return i[f];return null}ascii(){let e=`   +------------------------+
`;for(let t=Z.a8;t<=Z.h1;t++){if(on(t)===0&&(e+=" "+"87654321"[kr(t)]+" |"),this._board[t]){const r=this._board[t].type,i=this._board[t].color===At?r.toUpperCase():r.toLowerCase();e+=" "+i+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let r=0;const n=this._turn;for(let i=0,o=t.length;i<o;i++)this._makeMove(t[i]),this._isKingAttacked(n)||(e-1>0?r+=this.perft(e-1):r++),this._undoMove();return r}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let t=[];for(let r=Z.a8;r<=Z.h1;r++)this._board[r]==null?t.push(null):t.push({square:gt(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(e.push(t),t=[],r+=8);return e}squareColor(e){if(e in Z){const t=Z[e];return(kr(t)+on(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],r=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const n=t.pop();if(!n)break;e?r.push(new bn(this,n)):r.push(this._moveToSan(n,this._moves())),this._makeMove(n)}return r}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const t=this._positionCount.get(e)??0;t===1?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){const e=[],t={},r=n=>{n in this._comments&&(t[n]=this._comments[n])};for(;this._history.length>0;)e.push(this._undoMove());for(r(this.fen());;){const n=e.pop();if(!n)break;this._makeMove(n),r(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const n of[ht,Js])t[n]!==void 0&&(t[n]?this._castling[e]|=wn[n]:this._castling[e]&=~wn[n]);this._updateCastlingRights();const r=this.getCastlingRights(e);return(t[ht]===void 0||t[ht]===r[ht])&&(t[Js]===void 0||t[Js]===r[Js])}getCastlingRights(e){return{[ht]:(this._castling[e]&wn[ht])!==0,[Js]:(this._castling[e]&wn[Js])!==0}}moveNumber(){return this._moveNumber}}function Li(s){if(s.type==="cp"){const t=s.pawns>=0?"+":"â",r=Math.abs(s.pawns).toFixed(1);return`${t}${r}`}return`${s.moves>=0?"":"â"}M${Math.abs(s.moves)}`}function Gr(s){return s.type==="cp"?s.pawns<0:s.moves<0}function yn(s,e){const t=new lr(s);try{return t.move({from:e.slice(0,2),to:e.slice(2,4),promotion:e[4]}),t.fen()}catch{const r=`FATAL: fenAfterMove failed for "${e}" at FEN "${s}" â illegal move`;return console.error(r),alert(r),s}}function tu(s,e){if(s.length===0)return 0;const t=s.length,r=s.reduce((o,l)=>o+l,0)/t;if(e<=0)return r-400;if(e>=t)return r+400;let n=0,i=4e3;for(;i-n>.01;){const o=(n+i)/2;s.reduce((c,u)=>c+1/(1+Math.pow(10,(u-o)/400)),0)>e?i=o:n=o}return(n+i)/2}function Ir(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Qr(s){return new Date(s).toISOString().split("T")[0]}function su(s){const[e,t,r]=s.split("-").map(Number);return new Date(e,t-1,r,0,0,0,0).getTime()}function ru(s){const[e,t,r]=s.split("-").map(Number),n=new Date(e,t-1,r,23,59,59,999).getTime();return Math.min(n,Date.now())}function nu(s){const e=new Date,t=e;let r;switch(s){case"month":r=new Date(e),r.setMonth(r.getMonth()-1);break;case"3months":r=new Date(e),r.setMonth(r.getMonth()-3);break;case"year":r=new Date(e),r.setFullYear(r.getFullYear()-1);break;case"all":r=new Date(0);break;default:r=new Date(e),r.setMonth(r.getMonth()-3)}return{from:r,to:t}}var iu=F('<header class="header svelte-aum2bf"><div></div> <div class="header-content svelte-aum2bf"><h1 class="svelte-aum2bf">Opening Explorer</h1> <p class="subtitle svelte-aum2bf">Explore your chess openings from Lichess and Chess.com</p></div> <div></div></header> <main class="card loading-card svelte-aum2bf"><h2 class="svelte-aum2bf"> </h2> <p class="loading-status svelte-aum2bf"> </p> <button class="secondary-btn svelte-aum2bf">Cancel</button></main>',1),au=F('<button class="dropdown-item svelte-aum2bf"><div> </div> <div class="player-info svelte-aum2bf"><div class="player-name svelte-aum2bf"> </div> <div class="player-details svelte-aum2bf"> </div></div></button>'),ou=F('<div class="cache-info svelte-aum2bf"><div class="cache-icon svelte-aum2bf">ð</div> <div class="cache-details svelte-aum2bf"><span class="cached-label svelte-aum2bf">Cached:</span> <span class="cache-range svelte-aum2bf"> </span></div> <button class="cache-clear-btn svelte-aum2bf">Clear</button></div>'),lu=F('<div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Account</label>  <div><button class="account-select svelte-aum2bf"><!></button> <div class="dropdown-menu svelte-aum2bf"><!> <button class="dropdown-item add-account-item svelte-aum2bf"><div class="plus-icon svelte-aum2bf">+</div> <div class="player-info svelte-aum2bf"><div class="player-name svelte-aum2bf">Add new account</div></div></button></div></div></div> <!>',1),cu=F('<div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Platform</label> <div class="platform-toggle svelte-aum2bf"><button>Chess.com</button> <button>Lichess</button></div></div> <div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Username</label> <input type="text" class="username-input svelte-aum2bf" placeholder="Enter username"/></div>',1),uu=F("<button> </button>"),fu=F('<div class="error-text svelte-aum2bf"> </div>'),hu=F('<header class="header svelte-aum2bf"><div></div> <div class="header-content svelte-aum2bf"><h1 class="svelte-aum2bf">Opening Explorer</h1> <p class="subtitle svelte-aum2bf">Explore your chess openings from Lichess and Chess.com</p></div> <div class="header-right svelte-aum2bf"><button class="link-btn svelte-aum2bf">Clear all data</button></div></header> <main class="card svelte-aum2bf"><h2 class="svelte-aum2bf">Connect Your Account</h2> <!> <!> <div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Date Range</label> <div class="preset-group svelte-aum2bf"></div></div> <div class="date-inputs svelte-aum2bf"><div class="date-field svelte-aum2bf"><label class="svelte-aum2bf">From</label> <input type="date" class="svelte-aum2bf"/></div> <div class="date-field svelte-aum2bf"><label class="svelte-aum2bf">To</label> <input type="date" class="svelte-aum2bf"/></div></div> <!> <button class="primary-btn svelte-aum2bf">Load Games</button></main>',1);function du(s,e){As(e,!0);let t=is(e,"cachedPlayers",19,()=>[]),r=D(ut(t()[0]??null)),n=D(!1),i=D("chesscom"),o=D(""),l=D("3months"),c=D(""),u=D(""),d=D(""),p=D(!1),f=D(""),g=D(null),E=D(!1);const q=de(()=>t().length>0),C=de(()=>a(n)||!a(q)),N=de(()=>Qr(Date.now())),j=de(()=>a(i)==="lichess"?"Lichess":"Chess.com");ct(()=>{if(a(l)!=="custom"){const{from:z,to:pe}=nu(a(l));h(c,Qr(z.getTime()),!0),h(u,Qr(pe.getTime()),!0)}else a(r)&&!a(n)&&(h(c,Qr(a(r).cacheStart),!0),h(u,Qr(a(r).cacheEnd),!0))}),ct(()=>{t().length>0&&!a(r)&&h(r,t()[0],!0)});function x(z){return z==="lichess"?"lichess":"chesscom"}function L(z){return z.toLocaleString()}function B(z){h(r,z,!0),h(n,!1),h(l,"custom"),h(E,!1)}function J(){h(n,!0),h(r,null),h(l,"3months"),h(E,!1)}function ee(z){h(l,z,!0)}function H(){h(l,"custom"),ce()}function ce(){return a(c)&&a(u)&&a(c)>a(u)?(h(d,'"From" date cannot be after "To" date'),!1):(h(d,""),!0)}async function ue(){confirm("Clear all cached data? This cannot be undone.")&&(await Cc(),e.onCachedPlayersChanged([]),h(r,null),h(n,!1))}async function Ie(){if(a(r)&&confirm(`Clear all data for ${a(r).username}?`)){await Sc(a(r).username,a(r).platform);const z=t().filter(pe=>!(pe.username===a(r).username&&pe.platform===a(r).platform));e.onCachedPlayersChanged(z),h(r,z[0]??null,!0),a(r)||h(n,!1)}}function Re(){return a(r)&&!a(n)?!0:a(o).trim()!==""}async function Y(){if(!ce())return;let z,pe;if(a(r)&&!a(n))z=a(r).username,pe=a(r).platform;else if(z=a(o).trim(),pe=a(i),!z){alert("Please enter a username");return}const Ne=su(a(c)),$e=ru(a(u));h(p,!0),h(f,""),h(g,new AbortController,!0);try{await xc(z,pe,Ne,$e,Oe=>{h(f,Oe,!0)},a(g).signal);const Pe=await pi();e.onCachedPlayersChanged(Pe);const Qe=Pe.find(Oe=>Oe.username===z&&Oe.platform===pe);e.onEnterWorkspace({username:z,platform:pe,gameCount:Qe?.gameCount??0,since:Ne,until:$e})}catch(Pe){Pe instanceof DOMException&&Pe.name==="AbortError"||(console.error("Failed to load games:",Pe),alert(`Failed to load games: ${Pe instanceof Error?Pe.message:String(Pe)}`))}finally{h(p,!1),h(g,null)}}function ye(){a(g)?.abort()}function ke(z){z.stopPropagation(),h(E,!a(E))}function ve(){h(E,!1)}var Se=Hs();Ks("click",rn,ve);var oe=et(Se);{var Ce=z=>{var pe=iu(),Ne=S(et(pe),2),$e=w(Ne),Pe=w($e),Qe=S($e,2),Oe=w(Qe),it=S(Qe,2);it.__click=ye,Q(()=>{R(Pe,`Loading ${(a(o)||a(r)?.username)??""} (${a(j)??""})...`),R(Oe,a(f))}),T(z,pe)},xe=z=>{var pe=hu(),Ne=et(pe),$e=S(w(Ne),4),Pe=w($e);Pe.__click=ue;var Qe=S(Ne,2),Oe=S(w(Qe),2);{var it=re=>{var ie=lu(),ae=et(ie),Be=S(w(ae),2);let Fe;var Ue=w(Be);Ue.__click=ke;var Ge=w(Ue);{var me=We=>{var Ee=ar();Q(()=>R(Ee,`${a(r).username??""} (${a(r).platform==="lichess"?"Lichess":"Chess.com"})`)),T(We,Ee)},Xe=We=>{var Ee=ar("Select an account...");T(We,Ee)};we(Ge,We=>{a(r)&&!a(n)?We(me):We(Xe,!1)})}var jt=S(Ue,2);jt.__click=We=>We.stopPropagation();var Yt=w(jt);Ot(Yt,17,t,Ps,(We,Ee)=>{var bt=au();bt.__click=()=>B(a(Ee));var I=w(bt),te=w(I),le=S(I,2),je=w(le),wt=w(je),ft=S(je,2),Qt=w(ft);Q((hs,Nt,Es,vt,m)=>{_e(I,1,`player-avatar ${hs??""}`,"svelte-aum2bf"),R(te,Nt),R(wt,a(Ee).username),R(Qt,`${Es??""} games on ${a(Ee).platform==="lichess"?"Lichess":"Chess.com"} Â· ${vt??""} - ${m??""}`)},[()=>x(a(Ee).platform),()=>a(Ee).username[0].toUpperCase(),()=>L(a(Ee).gameCount),()=>Ir(a(Ee).cacheStart),()=>Ir(a(Ee).cacheEnd)]),T(We,bt)});var Mt=S(Yt,2);Mt.__click=J;var It=S(ae,2);{var ks=We=>{var Ee=ou(),bt=S(w(Ee),2),I=S(w(bt),2),te=w(I),le=S(bt,2);le.__click=Ie,Q((je,wt,ft)=>R(te,`${je??""} games Â· ${wt??""} - ${ft??""}`),[()=>L(a(r).gameCount),()=>Ir(a(r).cacheStart),()=>Ir(a(r).cacheEnd)]),T(We,Ee)};we(It,We=>{a(r)&&!a(n)&&We(ks)})}Q(()=>Fe=_e(Be,1,"account-dropdown svelte-aum2bf",null,Fe,{open:a(E)})),T(re,ie)};we(Oe,re=>{a(q)&&re(it)})}var dt=S(Oe,2);{var Vt=re=>{var ie=cu(),ae=et(ie),Be=S(w(ae),2),Fe=w(Be);let Ue;Fe.__click=()=>h(i,"chesscom");var Ge=S(Fe,2);let me;Ge.__click=()=>h(i,"lichess");var Xe=S(ae,2),jt=S(w(Xe),2);Q(()=>{Ue=_e(Fe,1,"platform-btn svelte-aum2bf",null,Ue,{active:a(i)==="chesscom"}),me=_e(Ge,1,"platform-btn svelte-aum2bf",null,me,{active:a(i)==="lichess"})}),jn(jt,()=>a(o),Yt=>h(o,Yt)),T(re,ie)};we(dt,re=>{a(C)&&re(Vt)})}var cs=S(dt,2),Ls=S(w(cs),2);Ot(Ls,20,()=>[["3months","Last 3 months"],["month","Last month"],["year","Last year"],["all","All time"],["custom","Custom"]],Ps,(re,ie)=>{var ae=de(()=>Qo(ie,2));let Be=()=>a(ae)[0],Fe=()=>a(ae)[1];var Ue=uu();let Ge;Ue.__click=()=>ee(Be());var me=w(Ue);Q(()=>{Ge=_e(Ue,1,"preset-btn svelte-aum2bf",null,Ge,{active:a(l)===Be()}),R(me,Fe())}),T(re,Ue)});var ys=S(cs,2),us=w(ys),Rt=S(w(us),2);Rt.__input=H;var fs=S(us,2),M=S(w(fs),2);M.__input=H;var $=S(ys,2);{var ge=re=>{var ie=fu(),ae=w(ie);Q(()=>R(ae,a(d))),T(re,ie)};we($,re=>{a(d)&&re(ge)})}var fe=S($,2);fe.__click=Y,Q(re=>{Mn(Rt,"max",a(N)),Mn(M,"max",a(N)),fe.disabled=re},[()=>!Re()]),jn(Rt,()=>a(c),re=>h(c,re)),jn(M,()=>a(u),re=>h(u,re)),T(z,pe)};we(oe,z=>{a(p)?z(Ce):z(xe,!1)})}T(s,Se),Ms()}gn(["click","input"]);const ln={start:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",empty:"8/8/8/8/8/8/8/8"};class rt{constructor(e=ln.empty){this.squares=new Array(64).fill(null),this.setFen(e)}setFen(e=ln.empty){const t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let r=0;r<8;r++){const n=t[7-r].replace(/\d/g,i=>{const o=parseInt(i);let l="";for(let c=0;c<o;c++)l+="-";return l});for(let i=0;i<8;i++){const o=n.substring(i,i+1);let l=null;o!=="-"&&(o.toUpperCase()===o?l=`w${o.toLowerCase()}`:l=`b${o}`),this.squares[r*8+i]=l}}}getFen(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let r=0;for(let n=0;n<8;n++){const i=this.squares[t*8+n];if(!i)r++;else{r>0&&(e[7-t]+=r,r=0);const o=i.substring(0,1),l=i.substring(1,2);o==="w"?e[7-t]+=l.toUpperCase():e[7-t]+=l}}r>0&&(e[7-t]+=r,r=0)}return e.join("/")}getPieces(e=void 0,t=void 0,r=["k","q","r","b","n","p"]){const n=[],i=(o,l)=>r.indexOf(o.name)-r.indexOf(l.name);for(let o=0;o<64;o++){const l=this.squares[o];if(l){const c=l.charAt(1),u=l.charAt(0),d=rt.indexToSquare(o);if(t&&t!==c||e&&e!==u)continue;n.push({name:c,type:c,color:u,position:d,square:d})}}return r&&n.sort(i),n}movePiece(e,t){if(!this.squares[rt.squareToIndex(e)]){console.warn("no piece on",e);return}this.squares[rt.squareToIndex(t)]=this.squares[rt.squareToIndex(e)],this.squares[rt.squareToIndex(e)]=null}setPiece(e,t){this.squares[rt.squareToIndex(e)]=t}getPiece(e){return this.squares[rt.squareToIndex(e)]}static squareToIndex(e){const t=rt.squareToCoordinates(e);return t[0]+t[1]*8}static indexToSquare(e){return this.coordinatesToSquare([Math.floor(e%8),e/8])}static squareToCoordinates(e){const t=e.charCodeAt(0)-97,r=e.charCodeAt(1)-49;return[t,r]}static coordinatesToSquare(e){const t=String.fromCharCode(e[0]+97),r=String.fromCharCode(e[1]+49);return t+r}toString(){return this.getFen()}clone(){const e=new rt;return e.squares=this.squares.slice(0),e}}class vu{constructor(){this.position=new rt,this.orientation=void 0,this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.squareSelectEnabled=!1,this.moveInputCallback=null,this.extensionPoints={},this.moveInputProcess=Promise.resolve()}inputEnabled(){return this.inputWhiteEnabled||this.inputBlackEnabled}invokeExtensionPoints(e,t={}){const r=this.extensionPoints[e],n=Object.assign({},t);n.extensionPoint=e;let i=!0;if(r)for(const o of r)o(n)===!1&&(i=!1);return i}}const da="http://www.w3.org/2000/svg";class he{static createSvg(e=void 0){let t=document.createElementNS(da,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,r={}){let n=document.createElementNS(da,t);t==="use"&&(r["xlink:href"]=r.href);for(let i in r)if(r.hasOwnProperty(i))if(i.indexOf(":")!==-1){const o=i.split(":");n.setAttributeNS("http://www.w3.org/1999/"+o[0],o[1],r[i])}else n.setAttribute(i,r[i]);return e.appendChild(n),n}static removeElement(e){if(!e){console.warn("removeElement, element is",e);return}e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode")}}const Ve={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",beforeRedrawBoard:"beforeRedrawBoard",afterRedrawBoard:"afterRedrawBoard",redrawBoard:"redrawBoard",animation:"animation",destroy:"destroy"};class Di{constructor(e){this.chessboard=e}registerExtensionPoint(e,t){e===Ve.redrawBoard&&(console.warn("EXTENSION_POINT.redrawBoard is deprecated, use EXTENSION_POINT.afterRedrawBoard"),e=Ve.afterRedrawBoard),this.chessboard.state.extensionPoints[e]||(this.chessboard.state.extensionPoints[e]=[]),this.chessboard.state.extensionPoints[e].push(t)}registerMethod(e,t){console.warn("registerMethod is deprecated, just add methods directly to the chessboard instance"),this.chessboard[e]?log.error("method",e,"already exists"):this.chessboard[e]=(...r)=>t.apply(this,r)}}class Vs{static delegate(e,t,r,n){const i=function(o){let l=o.target;for(;l&&l!==this;)l.matches(r)&&n.call(l,o),l=l.parentNode};return e.addEventListener(t,i),{remove:function(){e.removeEventListener(t,i)}}}static mergeObjects(e,t){const r=n=>n&&typeof n=="object";if(!r(e)||!r(t))return t;for(const n of Object.keys(t))t[n]instanceof Object&&Object.assign(t[n],Vs.mergeObjects(e[n],t[n]));return Object.assign(e||{},t),e}static createDomElement(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}static createTask(){let e,t;const r=new Promise(function(n,i){e=n,t=i});return r.resolve=e,r.reject=t,r}static isAbsoluteUrl(e){return e.indexOf("://")!==-1||e.startsWith("/")}}const ni={start:"start",frame:"frame",end:"end"};class pu{constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}async enqueue(e){return new Promise((t,r)=>{this.queue.push({promise:e,resolve:t,reject:r}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop){this.queue=[],this.stop=!1;return}const e=this.queue.shift();if(e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}}const Cs={move:0,appear:1,disappear:2};class Dr{constructor(e,t,r,n,i){this.view=e,t&&r?(this.animatedElements=this.createAnimation(t.squares,r.squares),this.duration=n,this.callback=i,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",r),this.view.positionsAnimationTask=Vs.createTask(),this.view.chessboard.state.invokeExtensionPoints(Ve.animation,{type:ni.start})}static seekChanges(e,t){const r=[],n=[],i=[];for(let o=0;o<64;o++){const l=e[o],c=t[o];c!==l&&(c&&r.push({piece:c,index:o}),l&&n.push({piece:l,index:o}))}return r.forEach(o=>{let l=8,c=null;n.forEach(u=>{if(o.piece===u.piece){const d=Dr.squareDistance(o.index,u.index);d<l&&(c=u,l=d)}}),c?(n.splice(n.indexOf(c),1),i.push({type:Cs.move,piece:o.piece,atIndex:c.index,toIndex:o.index})):i.push({type:Cs.appear,piece:o.piece,atIndex:o.index})}),n.forEach(o=>{i.push({type:Cs.disappear,piece:o.piece,atIndex:o.index})}),i}createAnimation(e,t){const r=Dr.seekChanges(e,t),n=[];return r.forEach(i=>{const o={type:i.type};switch(i.type){case Cs.move:o.element=this.view.getPieceElement(rt.indexToSquare(i.atIndex)),o.element.parentNode.appendChild(o.element),o.atPoint=this.view.indexToPoint(i.atIndex),o.toPoint=this.view.indexToPoint(i.toIndex);break;case Cs.appear:o.element=this.view.drawPieceOnSquare(rt.indexToSquare(i.atIndex),i.piece),o.element.style.opacity=0;break;case Cs.disappear:o.element=this.view.getPieceElement(rt.indexToSquare(i.atIndex));break}n.push(o)}),n}animationStep(e){if(!this.view||!this.view.chessboard.state)return;this.startTime||(this.startTime=e);const t=e-this.startTime;if(t<=this.duration)this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));else{cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(i=>{i.type===Cs.disappear&&he.removeElement(i.element)}),this.view.positionsAnimationTask.resolve(),this.view.chessboard.state.invokeExtensionPoints(Ve.animation,{type:ni.end}),this.callback();return}const r=Math.min(1,t/this.duration);let n=r<.5?2*r*r:-1+(4-2*r)*r;(isNaN(n)||n>.99)&&(n=1),this.animatedElements.forEach(i=>{if(i.element)switch(i.type){case Cs.move:i.element.transform.baseVal.removeItem(0);const o=this.view.svg.createSVGTransform();o.setTranslate(i.atPoint.x+(i.toPoint.x-i.atPoint.x)*n,i.atPoint.y+(i.toPoint.y-i.atPoint.y)*n),i.element.transform.baseVal.appendItem(o);break;case Cs.appear:i.element.style.opacity=Math.round(n*100)/100;break;case Cs.disappear:i.element.style.opacity=Math.round((1-n)*100)/100;break}else console.warn("animatedItem has no element",i)}),this.view.chessboard.state.invokeExtensionPoints(Ve.animation,{type:ni.frame,progress:n})}static squareDistance(e,t){const r=e%8,n=Math.floor(e/8),i=t%8,o=Math.floor(t/8);return Math.max(Math.abs(o-n),Math.abs(i-r))}}class gu extends pu{constructor(e){super(),this.chessboard=e}async enqueuePositionChange(e,t,r){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(n=>{let i=r?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(i=i/(1+Math.pow(this.queue.length/5,2))),new Dr(this.chessboard.view,e,t,r?i:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),n()})}))}async enqueueTurnBoard(e,t,r){return super.enqueue(()=>new Promise(n=>{const i=new rt(ln.empty);let o=r?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(o=o/(1+Math.pow(this.queue.length/5,2))),new Dr(this.chessboard.view,e,i,r?o:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(i.squares),new Dr(this.chessboard.view,i,e,r?o:0,()=>{this.chessboard.view.redrawPieces(e.squares),n()})})}))}}const U={waitForInputStart:"waitForInputStart",pieceClickedThreshold:"pieceClickedThreshold",clickTo:"clickTo",secondClickThreshold:"secondClickThreshold",dragTo:"dragTo",clickDragTo:"clickDragTo",moveDone:"moveDone",reset:"reset"},Xr={secondClick:"secondClick",secondaryClick:"secondaryClick",movedOutOfBoard:"movedOutOfBoard",draggedBack:"draggedBack",clickedAnotherPiece:"clickedAnotherPiece"},va=4;class mu{constructor(e){this.view=e,this.chessboard=e.chessboard,this.moveInputState=null,this.fromSquare=null,this.toSquare=null,this.setMoveInputState(U.waitForInputStart)}moveInputStartedCallback(e){const t=this.view.moveInputStartedCallback(e);return t&&(this.chessboard.state.moveInputProcess=Vs.createTask(),this.chessboard.state.moveInputProcess.then(r=>{(this.moveInputState===U.waitForInputStart||this.moveInputState===U.moveDone)&&this.view.moveInputFinishedCallback(this.fromSquare,this.toSquare,r)})),t}movingOverSquareCallback(e,t){this.view.movingOverSquareCallback(e,t)}validateMoveInputCallback(e,t){const r=this.view.validateMoveInputCallback(e,t);return this.chessboard.state.moveInputProcess.resolve(r),r}moveInputCanceledCallback(e,t,r){this.view.moveInputCanceledCallback(e,t,r),this.chessboard.state.moveInputProcess.resolve()}setMoveInputState(e,t=void 0){const r=this.moveInputState;switch(this.moveInputState=e,e){case U.waitForInputStart:break;case U.pieceClickedThreshold:if(U.waitForInputStart!==r&&U.clickTo!==r)throw new Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.fromSquare=t.square,this.toSquare=null,this.movedPiece=t.piece,this.startPoint=t.point,!this.pointerMoveListener&&!this.pointerUpListener){if(t.type==="mousedown")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else if(t.type==="touchstart")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener);else throw Error("4b74af");this.contextMenuListener||(this.contextMenuListener=this.onContextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener))}else throw Error("94ad0c");break;case U.clickTo:this.draggablePiece&&(he.removeElement(this.draggablePiece),this.draggablePiece=null),r===U.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case U.secondClickThreshold:if(U.clickTo!==r)throw new Error("moveInputState");this.startPoint=t.point;break;case U.dragTo:if(U.pieceClickedThreshold!==r)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case U.clickDragTo:if(U.secondClickThreshold!==r)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case U.moveDone:if([U.dragTo,U.clickTo,U.clickDragTo].indexOf(r)===-1)throw new Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?this.chessboard.movePiece(this.fromSquare,this.toSquare,r===U.clickTo).then(()=>{r===U.clickTo&&this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(U.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(U.reset));break;case U.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=null,this.toSquare=null,this.movedPiece=null,this.draggablePiece&&(he.removeElement(this.draggablePiece),this.draggablePiece=null),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.contextMenuListener&&(removeEventListener("contextmenu",this.contextMenuListener),this.contextMenuListener=null),this.setMoveInputState(U.waitForInputStart);const n=this.view.piecesGroup.querySelectorAll("[visibility=hidden]");for(let i=0;i<n.length;i++)n[i].removeAttribute("visibility");break;default:throw Error(`260b09: moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece already exists");this.draggablePiece=he.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.chessboard.props.assetsCache?"":this.view.getSpriteUrl(),r=he.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),n=this.view.squareHeight/this.chessboard.props.style.pieces.tileSize,i=this.draggablePiece.createSVGTransform();i.setScale(n,n),r.transform.baseVal.appendItem(i)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if(!(e.type==="mousedown"&&e.button===0||e.type==="touchstart"))return;const t=e.target.getAttribute("data-square");if(!t)return;const r=this.chessboard.getPiece(t);let n;if(r&&(n=r?r.substring(0,1):null,(n==="w"&&this.chessboard.state.inputWhiteEnabled||n==="b"&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault()),this.moveInputState!==U.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&n==="w"||this.chessboard.state.inputBlackEnabled&&n==="b"){let i;if(e.type==="mousedown"?i={x:e.clientX,y:e.clientY}:e.type==="touchstart"&&(i={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===U.waitForInputStart&&r&&this.moveInputStartedCallback(t))this.setMoveInputState(U.pieceClickedThreshold,{square:t,piece:r,point:i,type:e.type});else if(this.moveInputState===U.clickTo)if(t===this.fromSquare)this.setMoveInputState(U.secondClickThreshold,{square:t,piece:r,point:i,type:e.type});else{const o=this.chessboard.getPiece(t),l=o?o.substring(0,1):null,c=this.chessboard.getPiece(this.fromSquare),u=c?c.substring(0,1):null;n&&u===l?this.validateMoveInputCallback(this.fromSquare,t)||(this.moveInputCanceledCallback(this.fromSquare,t,Xr.clickedAnotherPiece),this.moveInputStartedCallback(t)?this.setMoveInputState(U.pieceClickedThreshold,{square:t,piece:o,point:i,type:e.type}):this.setMoveInputState(U.reset)):this.setMoveInputState(U.moveDone,{square:t})}}}onPointerMove(e){let t,r,n,i,o;if(e.type==="mousemove"?(n=e.clientX,i=e.clientY,t=e.pageX,r=e.pageY,o=e.target):e.type==="touchmove"&&(n=e.touches[0].clientX,i=e.touches[0].clientY,t=e.touches[0].pageX,r=e.touches[0].pageY,o=document.elementFromPoint(n,i)),this.moveInputState===U.pieceClickedThreshold||this.moveInputState===U.secondClickThreshold)(Math.abs(this.startPoint.x-n)>va||Math.abs(this.startPoint.y-i)>va)&&(this.moveInputState===U.secondClickThreshold?this.setMoveInputState(U.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(U.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled()&&this.moveDraggablePiece(t,r));else if(this.moveInputState===U.dragTo||this.moveInputState===U.clickDragTo||this.moveInputState===U.clickTo){if(o&&o.getAttribute&&o.parentElement===this.view.boardGroup){const l=o.getAttribute("data-square");l!==this.fromSquare&&l!==this.toSquare?(this.toSquare=l,this.movingOverSquareCallback(this.fromSquare,this.toSquare)):l===this.fromSquare&&this.toSquare!==null&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null))}else this.toSquare!==null&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null));this.view.chessboard.state.inputEnabled()&&(this.moveInputState===U.dragTo||this.moveInputState===U.clickDragTo)&&this.moveDraggablePiece(t,r)}}onPointerUp(e){let t;if(e.type==="mouseup"?t=e.target:e.type==="touchend"&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const r=t.getAttribute("data-square");if(r)this.moveInputState===U.dragTo||this.moveInputState===U.clickDragTo?this.fromSquare===r?this.moveInputState===U.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(r,null,Xr.draggedBack),this.setMoveInputState(U.reset)):this.setMoveInputState(U.clickTo,{square:r}):this.setMoveInputState(U.moveDone,{square:r}):this.moveInputState===U.pieceClickedThreshold?this.setMoveInputState(U.clickTo,{square:r}):this.moveInputState===U.secondClickThreshold&&(this.setMoveInputState(U.reset),this.moveInputCanceledCallback(r,null,Xr.secondClick));else{this.view.redrawPieces();const n=this.fromSquare;this.setMoveInputState(U.reset),this.moveInputCanceledCallback(n,null,Xr.movedOutOfBoard)}}else this.view.redrawPieces(),this.setMoveInputState(U.reset)}onContextMenu(e){e.preventDefault(),this.view.redrawPieces(),this.setMoveInputState(U.reset),this.moveInputCanceledCallback(this.fromSquare,null,Xr.secondaryClick)}isDragging(){return this.moveInputState===U.dragTo||this.moveInputState===U.clickDragTo}destroy(){this.setMoveInputState(U.reset)}}const Jt={white:"w",black:"b"},Kt={moveInputStarted:"moveInputStarted",movingOverSquare:"movingOverSquare",validateMoveInput:"validateMoveInput",moveInputCanceled:"moveInputCanceled",moveInputFinished:"moveInputFinished"},_o={pointerdown:"pointerdown"},qr={none:"none",thin:"thin",frame:"frame"};class _u{constructor(e){this.chessboard=e,this.visualMoveInput=new mu(this),e.props.assetsCache&&this.cacheSpriteToDiv("cm-chessboard-sprite",this.getSpriteUrl()),this.container=document.createElement("div"),this.chessboard.context.appendChild(this.container),e.props.responsive&&(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(()=>{setTimeout(()=>{this.handleResize()})}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.positionsAnimationTask=Promise.resolve(),this.pointerDownListener=this.pointerDownHandler.bind(this),this.container.addEventListener("mousedown",this.pointerDownListener),this.container.addEventListener("touchstart",this.pointerDownListener,{passive:!1}),this.createSvgAndGroups(),this.handleResize()}pointerDownHandler(e){this.visualMoveInput.onPointerDown(e)}destroy(){this.visualMoveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),he.removeElement(this.svg),this.container.remove()}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){const r=document.createElement("div");r.style.transform="scale(0)",r.style.position="absolute",r.setAttribute("aria-hidden","true"),r.id=e,document.body.appendChild(r);const n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){r.insertAdjacentHTML("afterbegin",n.response)},n.send()}}createSvgAndGroups(){this.svg=he.createSvg(this.container);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=he.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=he.addElement(this.svg,"g",{class:"coordinates","aria-hidden":"true"}),this.markersLayer=he.addElement(this.svg,"g",{class:"markers-layer"}),this.piecesLayer=he.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=he.addElement(this.piecesLayer,"g",{class:"pieces"}),this.markersTopLayer=he.addElement(this.svg,"g",{class:"markers-top-layer"}),this.interactiveTopLayer=he.addElement(this.svg,"g",{class:"interactive-top-layer"})}updateMetrics(){const e=this.chessboard.props.style.pieces.tileSize;this.width=this.container.clientWidth,this.height=this.container.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===qr.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===qr.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/e,this.scalingY=this.squareHeight/e,this.pieceXTranslate=this.squareWidth/2-e*this.scalingY/2}handleResize(){this.container.style.width=this.chessboard.context.clientWidth+"px",this.container.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",(this.container.clientWidth!==this.width||this.container.clientHeight!==this.height)&&(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.chessboard.state.invokeExtensionPoints(Ve.beforeRedrawBoard),this.redrawSquares(),this.drawCoordinates(),this.chessboard.state.invokeExtensionPoints(Ve.afterRedrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(he.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===qr.frame){const t=this.borderSize;he.addElement(this.boardGroup,"rect",{x:t,y:t,width:this.width-t*2,height:this.height-t*2}).setAttribute("class","border-inner")}for(let t=0;t<64;t++){const r=this.chessboard.state.orientation===Jt.white?t:63-t,i=`square ${(9*r&8)===0?"black":"white"}`,o=this.squareToPoint(rt.indexToSquare(r)),l=he.addElement(this.boardGroup,"rect",{x:o.x,y:o.y,width:this.squareWidth,height:this.squareHeight});l.setAttribute("class",i),l.setAttribute("data-square",rt.indexToSquare(r))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==qr.frame;for(let t=0;t<8;t++){let r=this.borderSize+(17+this.chessboard.props.style.pieces.tileSize*t)*this.scalingX,n=this.height-this.scalingY*3.5,i="coordinate file";e&&(r=r+this.scalingX*15.5,i+=t%2?" white":" black");const o=he.addElement(this.coordinatesGroup,"text",{class:i,x:r,y:n,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===Jt.white?o.textContent=String.fromCharCode(97+t):o.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let r=this.borderSize/3.7,n=this.borderSize+25*this.scalingY+t*this.squareHeight,i="coordinate rank";e&&(i+=t%2?" black":" white",this.chessboard.props.style.borderType===qr.frame?(r=r+this.scalingX*10,n=n-this.scalingY*15):(r=r+this.scalingX*2,n=n-this.scalingY*15));const o=he.addElement(this.coordinatesGroup,"text",{class:i,x:r,y:n,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===Jt.white?o.textContent=""+(8-t):o.textContent=""+(1+t)}}redrawPieces(e=this.chessboard.state.position.squares){const t=Array.from(this.piecesGroup.childNodes),r=this.visualMoveInput.isDragging();for(let n=0;n<64;n++){const i=e[n];if(i){const o=rt.indexToSquare(n);this.drawPieceOnSquare(o,i,r&&o===this.visualMoveInput.fromSquare)}}for(const n of t)this.piecesGroup.removeChild(n)}drawPiece(e,t,r){const n=he.addElement(e,"g",{});n.setAttribute("data-piece",t);const i=this.svg.createSVGTransform();i.setTranslate(r.x,r.y),n.transform.baseVal.appendItem(i);const o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),l=he.addElement(n,"use",{href:`${o}#${t}`,class:"piece"}),c=this.svg.createSVGTransform();return c.setScale(this.scalingY,this.scalingY),l.transform.baseVal.appendItem(c),n}drawPieceOnSquare(e,t,r=!1){const n=he.addElement(this.piecesGroup,"g",{});n.setAttribute("data-piece",t),n.setAttribute("data-square",e),r&&n.setAttribute("visibility","hidden");const i=this.squareToPoint(e),o=this.svg.createSVGTransform();o.setTranslate(i.x,i.y),n.transform.baseVal.appendItem(o);const l=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),c=he.addElement(n,"use",{href:`${l}#${t}`,class:"piece"}),u=this.svg.createSVGTransform();u.setTranslate(this.pieceXTranslate,0),c.transform.baseVal.appendItem(u);const d=this.svg.createSVGTransform();return d.setScale(this.scalingY,this.scalingY),c.transform.baseVal.appendItem(d),n}setPieceVisibility(e,t=!0){const r=this.getPieceElement(e);r?t?r.setAttribute("visibility","visible"):r.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(!e||e.length<2)return console.warn("invalid square",e),null;const t=this.piecesGroup.querySelector(`g[data-square='${e}']`);return t||(console.warn("no piece on",e),null)}enableMoveInput(e,t=null){if(this.chessboard.state.moveInputCallback)throw Error("moveInput already enabled");t===Jt.white?this.chessboard.state.inputWhiteEnabled=!0:t===Jt.black?this.chessboard.state.inputBlackEnabled=!0:(this.chessboard.state.inputWhiteEnabled=!0,this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(Ve.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.moveInputCallback=null,this.chessboard.state.invokeExtensionPoints(Ve.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){const t={chessboard:this.chessboard,type:Kt.moveInputStarted,square:e,squareFrom:e,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(t.moveInputCallbackResult=this.chessboard.state.moveInputCallback(t)),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,t),t.moveInputCallbackResult}movingOverSquareCallback(e,t){const r={chessboard:this.chessboard,type:Kt.movingOverSquare,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.chessboard.state.moveInputCallback&&(r.moveInputCallbackResult=this.chessboard.state.moveInputCallback(r)),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,r)}validateMoveInputCallback(e,t){const r={chessboard:this.chessboard,type:Kt.validateMoveInput,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(r.moveInputCallbackResult=this.chessboard.state.moveInputCallback(r)),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,r),r.moveInputCallbackResult}moveInputCanceledCallback(e,t,r){const n={chessboard:this.chessboard,type:Kt.moveInputCanceled,reason:r,squareFrom:e,squareTo:t};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(n),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,n)}moveInputFinishedCallback(e,t,r){const n={chessboard:this.chessboard,type:Kt.moveInputFinished,squareFrom:e,squareTo:t,legalMove:r};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(n),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,n)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,r;return this.chessboard.state.orientation===Jt.white?(t=this.borderSize+e%8*this.squareWidth,r=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,r=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:r}}squareToPoint(e){const t=rt.squareToIndex(e);return this.indexToPoint(t)}getSpriteUrl(){return Vs.isAbsoluteUrl(this.chessboard.props.style.pieces.file)?this.chessboard.props.style.pieces.file:this.chessboard.props.assetsUrl+this.chessboard.props.style.pieces.file}}const Zs={wp:"wp",wb:"wb",wn:"wn",wr:"wr",wq:"wq",wk:"wk",bp:"bp",bb:"bb",bn:"bn",br:"br",bq:"bq",bk:"bk"},bu={svgSprite:"svgSprite"};class wu{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[],this.props={position:ln.empty,orientation:Jt.white,responsive:!0,assetsUrl:"./assets/",assetsCache:!0,style:{cssClass:"default",showCoordinates:!0,borderType:qr.none,aspectRatio:1,pieces:{type:bu.svgSprite,file:"pieces/standard.svg",tileSize:40},animationDuration:300},extensions:[]},Vs.mergeObjects(this.props,t),this.state=new vu,this.view=new _u(this),this.positionAnimationsQueue=new gu(this),this.state.orientation=this.props.orientation;for(const r of this.props.extensions)this.addExtension(r.class,r.props);this.view.redrawBoard(),this.state.position=new rt(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(Ve.positionChanged),this.initialized=Promise.resolve()}async setPiece(e,t,r=!1){const n=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(Ve.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(n,this.state.position.clone(),r)}async movePiece(e,t,r=!1){const n=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(Ve.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(n,this.state.position.clone(),r)}async setPosition(e,t=!1){const r=this.state.position.clone(),n=new rt(e);return r.getFen()!==n.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(Ve.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(r,this.state.position.clone(),t)}async setOrientation(e,t=!1){const r=this.state.position.clone();if(this.boardTurning){console.warn("setOrientation is only once in queue allowed");return}return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(r,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(Ve.boardChanged)})}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}enableMoveInput(e,t=void 0){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}isMoveInputEnabled(){return this.state.inputWhiteEnabled||this.state.inputBlackEnabled}enableSquareSelect(e=_o.pointerdown,t){this.squareSelectListener||(this.squareSelectListener=function(r){const n=r.target.getAttribute("data-square");t({eventType:r.type,event:r,chessboard:this,square:n})}),this.context.addEventListener(e,this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(e){this.context.removeEventListener(e,this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}isSquareSelectEnabled(){return this.state.squareSelectEnabled}addExtension(e,t){if(this.getExtension(e))throw Error('extension "'+e.name+'" already added');this.extensions.push(new e(this,t))}getExtension(e){for(const t of this.extensions)if(t instanceof e)return t;return null}destroy(){this.state.invokeExtensionPoints(Ve.destroy),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0}}const Dt={hidden:"hidden",displayRequested:"displayRequested",shown:"shown"},yu={de:{choosePromotion:"Bauernumwandlung wÃ¤hlen",promotionDialogTitle:"Bauernumwandlung",pieces:{q:"Dame",r:"Turm",b:"LÃ¤ufer",n:"Springer"},promoteTo:"Umwandeln in"},en:{choosePromotion:"Choose promotion piece",promotionDialogTitle:"Pawn promotion",pieces:{q:"Queen",r:"Rook",b:"Bishop",n:"Knight"},promoteTo:"Promote to"}},tn={pieceSelected:"pieceSelected",canceled:"canceled"};class ku extends Di{constructor(e,t={}){super(e),this.props={language:navigator.language.substring(0,2).toLowerCase()},Object.assign(this.props,t),this.props.language!=="de"&&this.props.language!=="en"&&(this.props.language="en"),this.t=yu[this.props.language],this.pieceOrder=["q","r","b","n"],this.focusedIndex=0,this.previouslyFocusedElement=null,this.registerExtensionPoint(Ve.afterRedrawBoard,this.extensionPointRedrawBoard.bind(this)),this.registerExtensionPoint(Ve.destroy,this.destroy.bind(this)),e.showPromotionDialog=this.showPromotionDialog.bind(this),e.isPromotionDialogShown=this.isPromotionDialogShown.bind(this),this.promotionDialogGroup=he.addElement(e.view.interactiveTopLayer,"g",{class:"promotion-dialog-group",role:"dialog","aria-modal":"true","aria-label":this.t.choosePromotion}),this.liveRegion=document.createElement("div"),this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.className="cm-chessboard-promotion-live-region visually-hidden",this.liveRegion.style.cssText="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;",e.context.appendChild(this.liveRegion),this.state={displayState:Dt.hidden,callback:null,dialogParams:{square:null,color:null}},this.handleKeyDown=this.handleKeyDown.bind(this)}showPromotionDialog(e,t,r){this.previouslyFocusedElement=document.activeElement,this.focusedIndex=0,this.state.dialogParams.square=e,this.state.dialogParams.color=t,this.state.callback=r,this.setDisplayState(Dt.displayRequested),setTimeout(()=>{this.chessboard.view.positionsAnimationTask.then(()=>{this.setDisplayState(Dt.shown),this.announce(this.t.choosePromotion+": "+this.pieceOrder.map(n=>this.t.pieces[n]).join(", "))})})}isPromotionDialogShown(){return this.state.displayState===Dt.shown||this.state.displayState===Dt.displayRequested}extensionPointRedrawBoard(){this.redrawDialog()}drawPieceButton(e,t,r){const n=this.chessboard.view.squareWidth,i=this.chessboard.view.squareHeight,o=e.charAt(1),l=this.t.pieces[o],c=he.addElement(this.promotionDialogGroup,"g",{class:"promotion-dialog-button-group",role:"button",tabindex:r===0?"0":"-1","aria-label":l,"data-piece":e,"data-index":r});he.addElement(c,"rect",{x:t.x,y:t.y,width:n,height:i,class:"promotion-dialog-button","data-piece":e}),this.chessboard.view.drawPiece(c,e,t)}redrawDialog(){for(;this.promotionDialogGroup.firstChild;)this.promotionDialogGroup.removeChild(this.promotionDialogGroup.firstChild);if(this.state.displayState===Dt.shown){const e=this.chessboard.view.squareWidth,t=this.chessboard.view.squareHeight,r=this.chessboard.view.squareToPoint(this.state.dialogParams.square);r.x=r.x+e/2,r.y=r.y+t/2;let n=!1;const i=parseInt(this.state.dialogParams.square.charAt(1),10);(this.chessboard.getOrientation()===Jt.white&&i<5||this.chessboard.getOrientation()===Jt.black&&i>=5)&&(n=!0);const o=n?-4*t:0,l=r.x+e>this.chessboard.view.width?-e:0;he.addElement(this.promotionDialogGroup,"rect",{x:r.x+l,y:r.y+o,width:e,height:t*4,class:"promotion-dialog"});const c=this.state.dialogParams;n?(this.drawPieceButton(Zs[c.color+"q"],{x:r.x+l,y:r.y-t},0),this.drawPieceButton(Zs[c.color+"r"],{x:r.x+l,y:r.y-t*2},1),this.drawPieceButton(Zs[c.color+"b"],{x:r.x+l,y:r.y-t*3},2),this.drawPieceButton(Zs[c.color+"n"],{x:r.x+l,y:r.y-t*4},3)):(this.drawPieceButton(Zs[c.color+"q"],{x:r.x+l,y:r.y},0),this.drawPieceButton(Zs[c.color+"r"],{x:r.x+l,y:r.y+t},1),this.drawPieceButton(Zs[c.color+"b"],{x:r.x+l,y:r.y+t*2},2),this.drawPieceButton(Zs[c.color+"n"],{x:r.x+l,y:r.y+t*3},3))}}promotionDialogOnClickPiece(e){if(e.button!==2){let t=e.target.dataset.piece;if(!t&&e.target.closest){const r=e.target.closest(".promotion-dialog-button-group");r&&(t=r.dataset.piece)}t?this.selectPiece(t):this.promotionDialogOnCancel(e)}}selectPiece(e){this.state.callback&&this.state.callback({type:tn.pieceSelected,square:this.state.dialogParams.square,piece:e}),this.setDisplayState(Dt.hidden)}promotionDialogOnCancel(e){this.state.displayState===Dt.shown&&(e.preventDefault(),this.setDisplayState(Dt.hidden),this.state.callback&&this.state.callback({type:tn.canceled}))}contextMenu(e){e.preventDefault(),this.setDisplayState(Dt.hidden),this.state.callback&&this.state.callback({type:tn.canceled})}setDisplayState(e){this.state.displayState=e,e===Dt.shown?(this.clickDelegate=Vs.delegate(this.chessboard.view.svg,"pointerdown","*",this.promotionDialogOnClickPiece.bind(this)),this.contextMenuListener=this.contextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener),document.addEventListener("keydown",this.handleKeyDown)):e===Dt.hidden&&(this.clickDelegate.remove(),this.chessboard.view.svg.removeEventListener("contextmenu",this.contextMenuListener),document.removeEventListener("keydown",this.handleKeyDown),this.previouslyFocusedElement&&this.previouslyFocusedElement.focus&&this.previouslyFocusedElement.focus()),this.redrawDialog(),e===Dt.shown&&setTimeout(()=>{this.focusButton(0)},0)}handleKeyDown(e){if(this.state.displayState===Dt.shown)switch(e.key){case"ArrowDown":case"ArrowRight":e.preventDefault(),this.focusedIndex=(this.focusedIndex+1)%4,this.focusButton(this.focusedIndex);break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),this.focusedIndex=(this.focusedIndex-1+4)%4,this.focusButton(this.focusedIndex);break;case"Enter":case" ":e.preventDefault();const t=this.promotionDialogGroup.querySelectorAll(".promotion-dialog-button-group");if(t[this.focusedIndex]){const r=t[this.focusedIndex].dataset.piece;this.selectPiece(r)}break;case"Escape":e.preventDefault(),this.setDisplayState(Dt.hidden),this.state.callback&&this.state.callback({type:tn.canceled});break;case"Tab":e.preventDefault(),e.shiftKey?this.focusedIndex=(this.focusedIndex-1+4)%4:this.focusedIndex=(this.focusedIndex+1)%4,this.focusButton(this.focusedIndex);break}}focusButton(e){const t=this.promotionDialogGroup.querySelectorAll(".promotion-dialog-button-group");if(t.forEach((r,n)=>{r.setAttribute("tabindex",n===e?"0":"-1")}),t[e]){t[e].focus();const r=this.pieceOrder[e];this.announce(this.t.pieces[r])}}announce(e){this.liveRegion.textContent="",setTimeout(()=>{this.liveRegion.textContent=e},50)}destroy(){document.removeEventListener("keydown",this.handleKeyDown),this.liveRegion&&this.liveRegion.parentNode&&this.liveRegion.parentNode.removeChild(this.liveRegion)}}const pa={default:{class:"arrow-success"},success:{class:"arrow-success"},secondary:{class:"arrow-secondary"},warning:{class:"arrow-warning"},info:{class:"arrow-info"},danger:{class:"arrow-danger"}};class Eu extends Di{constructor(e,t={}){super(e),this.registerExtensionPoint(Ve.afterRedrawBoard,()=>{this.onRedrawBoard()}),this.props={sprite:"extensions/arrows/arrows.svg",slice:"arrowDefault",headSize:7,offsetFrom:0,offsetTo:.55},Object.assign(this.props,t),this.chessboard.props.assetsCache&&this.chessboard.view.cacheSpriteToDiv("cm-chessboard-arrows",this.getSpriteUrl()),e.addArrow=this.addArrow.bind(this),e.getArrows=this.getArrows.bind(this),e.removeArrows=this.removeArrows.bind(this),this.arrowGroup=he.addElement(e.view.markersTopLayer,"g",{class:"arrows"}),this.arrows=[]}onRedrawBoard(){for(;this.arrowGroup.firstChild;)this.arrowGroup.removeChild(this.arrowGroup.firstChild);this.arrows.forEach(e=>{this.drawArrow(e)})}drawArrow(e){const t=this.chessboard.view,r=he.addElement(this.arrowGroup,"g");r.setAttribute("data-arrow",e.from+e.to),r.setAttribute("class","arrow "+e.type.class);const n=t.squareToPoint(e.from),i=t.squareToPoint(e.to),o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),l=he.addElement(r,"defs"),c="arrow-"+e.from+e.to,u=he.addElement(l,"marker",{id:c,markerWidth:this.props.headSize,markerHeight:this.props.headSize,refX:20,refY:20,viewBox:"0 0 40 40",orient:"auto",class:"arrow-head"});he.addElement(u,"use",{href:`${o}#${this.props.slice}`});const d=n.x+t.squareWidth/2,p=n.y+t.squareHeight/2,f=i.x+t.squareWidth/2,g=i.y+t.squareHeight/2,E=f-d,q=g-p,C=Math.hypot(E,q)||1,N=E/C,j=q/C,x=Math.min(t.squareWidth,t.squareHeight)/2,L=Y=>Math.max(0,Math.min(1,Y)),B=x*L(this.props.offsetFrom),J=x*L(this.props.offsetTo),ee=d+N*B,H=p+j*B,ce=f-N*J,ue=g-j*J,Ie=(t.scalingX+t.scalingY)/2*8;let Re=he.addElement(r,"line");Re.setAttribute("x1",ee.toString()),Re.setAttribute("x2",ce.toString()),Re.setAttribute("y1",H.toString()),Re.setAttribute("y2",ue.toString()),Re.setAttribute("class","arrow-line"),Re.setAttribute("marker-end","url(#"+c+")"),Re.setAttribute("stroke-width",Ie+"px")}addArrow(e,t,r){this.arrows.push(new Su(t,r,e)),this.chessboard.view.redrawBoard()}getArrows(e=void 0,t=void 0,r=void 0){let n=[];return this.arrows.forEach(i=>{i.matches(t,r,e)&&n.push(i)}),n}removeArrows(e=void 0,t=void 0,r=void 0){this.arrows=this.arrows.filter(n=>!n.matches(t,r,e)),this.chessboard.view.redrawBoard()}getSpriteUrl(){return Vs.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class Su{constructor(e,t,r){this.from=e,this.to=t,this.type=r}matches(e=void 0,t=void 0,r=void 0){return e&&e!==this.from||t&&t!==this.to?!1:!(r&&r!==this.type)}}const dr={frame:{class:"marker-frame",slice:"markerFrame"},dot:{class:"marker-dot",slice:"markerDot",position:"above"},bevel:{class:"marker-bevel",slice:"markerBevel"}};class Cu extends Di{constructor(e,t={}){super(e),this.registerExtensionPoint(Ve.afterRedrawBoard,()=>{this.onRedrawBoard()}),this.props={autoMarkers:dr.frame,sprite:"extensions/markers/markers.svg"},Object.assign(this.props,t),e.props.assetsCache&&e.view.cacheSpriteToDiv("cm-chessboard-markers",this.getSpriteUrl()),e.addMarker=this.addMarker.bind(this),e.getMarkers=this.getMarkers.bind(this),e.removeMarkers=this.removeMarkers.bind(this),e.addLegalMovesMarkers=this.addLegalMovesMarkers.bind(this),e.removeLegalMovesMarkers=this.removeLegalMovesMarkers.bind(this),this.markerGroupDown=he.addElement(e.view.markersLayer,"g",{class:"markers"}),this.markerGroupUp=he.addElement(e.view.markersTopLayer,"g",{class:"markers"}),this.markers=[],this.props.autoMarkers&&(Object.assign(this.props.autoMarkers,this.props.autoMarkers),this.registerExtensionPoint(Ve.moveInput,r=>{this.drawAutoMarkers(r)}))}drawAutoMarkers(e){e.type!==Kt.moveInputFinished&&this.removeMarkers(this.props.autoMarkers),!(e.type===Kt.moveInputStarted&&!e.moveInputCallbackResult)&&(e.type===Kt.moveInputStarted||e.type===Kt.movingOverSquare)&&(e.squareFrom&&this.addMarker(this.props.autoMarkers,e.squareFrom),e.squareTo&&this.addMarker(this.props.autoMarkers,e.squareTo))}onRedrawBoard(){for(;this.markerGroupUp.firstChild;)this.markerGroupUp.removeChild(this.markerGroupUp.firstChild);for(;this.markerGroupDown.firstChild;)this.markerGroupDown.removeChild(this.markerGroupDown.firstChild);this.markers.forEach(e=>{this.drawMarker(e)})}addLegalMovesMarkers(e){for(const t of e)t.promotion&&t.promotion!=="q"||(this.chessboard.getPiece(t.to)?this.chessboard.addMarker(dr.bevel,t.to):this.chessboard.addMarker(dr.dot,t.to))}removeLegalMovesMarkers(){this.chessboard.removeMarkers(dr.bevel),this.chessboard.removeMarkers(dr.dot)}drawMarker(e){let t;e.type.position==="above"?t=he.addElement(this.markerGroupUp,"g"):t=he.addElement(this.markerGroupDown,"g"),t.setAttribute("data-square",e.square);const r=this.chessboard.view.squareToPoint(e.square),n=this.chessboard.view.svg.createSVGTransform();n.setTranslate(r.x,r.y),t.transform.baseVal.appendItem(n);const i=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),o=he.addElement(t,"use",{href:`${i}#${e.type.slice}`,class:"marker "+e.type.class}),l=this.chessboard.view.svg.createSVGTransform();return l.setScale(this.chessboard.view.scalingX,this.chessboard.view.scalingY),o.transform.baseVal.appendItem(l),t}addMarker(e,t){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x");return}this.markers.push(new xu(t,e)),this.onRedrawBoard()}getMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");return}let r=[];return this.markers.forEach(n=>{n.matches(t,e)&&r.push(n)}),r}removeMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x");return}this.markers=this.markers.filter(r=>!r.matches(t,e)),this.onRedrawBoard()}getSpriteUrl(){return Vs.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class xu{constructor(e,t){this.square=e,this.type=t}matches(e=void 0,t=void 0){if(!t&&!e)return!0;if(t){if(e){if(this.type===t&&e===this.square)return!0}else if(this.type===t)return!0}else if(e===this.square)return!0;return!1}}var Pu=F('<div class="chessboard-container svelte-ipgdpj"></div>');function bo(s,e){As(e,!0);let t=is(e,"fen",19,()=>ln.start),r=is(e,"orientation",3,"white"),n=is(e,"arrows",19,()=>[]),i=is(e,"markers",19,()=>[]),o=is(e,"inputMode",3,"none"),l=is(e,"showCoordinates",3,!0),c,u=null,d=null;Br(()=>{const x=[];x.push({class:ku}),x.push({class:Eu}),x.push({class:Cu,props:{autoMarkers:null}}),u=new wu(c,{position:t(),orientation:r()==="white"?Jt.white:Jt.black,responsive:!0,assetsUrl:"./cm-chessboard/",style:{cssClass:"default",showCoordinates:l(),borderType:"none",aspectRatio:1,animationDuration:200},extensions:x}),p(o()),q()}),co(()=>{u?.destroy(),u=null}),ct(()=>{u&&t()&&u.setPosition(t(),!0)}),ct(()=>{if(u){const x=r()==="white"?Jt.white:Jt.black;u.setOrientation(x,!0)}}),ct(()=>{if(u&&(u.removeArrows(),c?.querySelector("svg .engine-hover-defs")?.remove(),n().length!==0)){for(const x of n()){const L=x.type?pa[x.type]:pa.default;u.addArrow(L,x.from,x.to)}for(const x of n()){const L=x.from+x.to,B=c?.querySelector(`[data-arrow="${L}"]`);if(B&&(B.style.opacity=String(x.opacity),x.engineHover)){const J=B.querySelector(".arrow-line"),ee=B.querySelector("defs"),H=ee?.querySelector("marker");if(!J||!ee||!H)continue;const ce="http://www.w3.org/2000/svg",ue=B.closest("svg");if(!ue)continue;let Ie=ue.querySelector(".engine-hover-defs");Ie||(Ie=document.createElementNS(ce,"defs"),Ie.setAttribute("class","engine-hover-defs"),ue.appendChild(Ie));const Re=`mask-head-${L}`,Y=H.cloneNode(!0);Y.id=Re;const ye=Y.querySelector("use");ye&&(ye.style.fill="black"),Ie.appendChild(Y);const ke=`outline-mask-${L}`,ve=document.createElementNS(ce,"mask");ve.id=ke,ve.setAttribute("maskUnits","userSpaceOnUse"),ve.setAttribute("x","0"),ve.setAttribute("y","0"),ve.setAttribute("width","10000"),ve.setAttribute("height","10000");const Se=document.createElementNS(ce,"rect");Se.setAttribute("x","0"),Se.setAttribute("y","0"),Se.setAttribute("width","10000"),Se.setAttribute("height","10000"),Se.setAttribute("fill","white"),ve.appendChild(Se);const oe=J.cloneNode(!0);oe.setAttribute("stroke","black"),oe.style.opacity="1",oe.style.strokeLinecap="round",oe.setAttribute("marker-end",`url(#${Re})`),ve.appendChild(oe),Ie.appendChild(ve);const Ce=document.createElementNS(ce,"g");Ce.setAttribute("class","arrow-engine-outline"),Ce.setAttribute("mask",`url(#${ke})`);const xe=`outline-head-${L}`,z=H.cloneNode(!0);z.id=xe;const pe=z.querySelector("use");pe&&(pe.style.fill="blue");const Ne=document.createElementNS(ce,"defs");Ne.appendChild(z),Ce.appendChild(Ne);const $e=J.cloneNode(!0),Pe=parseFloat(J.getAttribute("stroke-width")||"0");$e.setAttribute("stroke-width",String(Pe+5)),$e.style.stroke="blue",$e.style.opacity="1",$e.style.strokeLinecap="round",$e.setAttribute("marker-end",`url(#${xe})`),Ce.appendChild($e),B.parentNode.insertBefore(Ce,B)}}}}),ct(()=>{if(u){u.removeMarkers(dr.dot);for(const x of i())u.addMarker(dr.dot,x.square)}}),ct(()=>{u&&o()!==d&&p(o())});function p(x){if(u){u.disableMoveInput();try{u.disableSquareSelect()}catch{}d=x,x==="legal"?u.enableMoveInput(f):x==="free"?u.enableMoveInput(g):x==="none"&&u.enableSquareSelect(_o.pointerdown,E)}}function f(x){if(x.type===Kt.moveInputStarted)return!0;if(x.type===Kt.validateMoveInput){const L=x.squareFrom,B=x.squareTo,J=x.piece,ee=J==="wp"&&B[1]==="8",H=J==="bp"&&B[1]==="1";if(ee||H){const ce=J[0];return u?.showPromotionDialog(B,ce,ue=>{if(ue.type===tn.pieceSelected&&ue.piece){const Ie=ue.piece[1];e.onMove?.(L,B,Ie)&&u?.setPosition(t(),!0)}}),!1}return e.onMove?.(L,B)??!1}x.type===Kt.moveInputFinished&&x.legalMove&&u?.setPosition(t(),!1)}function g(x){if(x.type===Kt.moveInputStarted)return!0;if(x.type===Kt.validateMoveInput){const L=x.squareFrom,B=x.squareTo,J=x.piece,ee=J[0]==="w"?J[1].toUpperCase():J[1].toLowerCase();return e.onFreeDrop?.(L,B,ee),!0}}function E(x){const L=x.square;L&&e.onSquareClick?.(L)}function q(){if(!c||!e.onArrowHover)return;const x=c.querySelector(".arrows");if(!x)return;let L=null;c.addEventListener("mousemove",B=>{x.style.pointerEvents="auto";const J=document.elementFromPoint(B.clientX,B.clientY);x.style.pointerEvents="none";const H=J?.closest?.("[data-arrow]")?.getAttribute("data-arrow")||null;H!==L&&(L=H,e.onArrowHover?.(H))}),c.addEventListener("mouseleave",()=>{L&&(L=null,e.onArrowHover?.(null))})}function C(x,L){if(!c)return;const B=c.querySelector(`[data-arrow="${x}"]`);B&&(L?(B.dataset.savedOpacity=B.style.opacity,B.style.opacity="1"):B.style.opacity=B.dataset.savedOpacity||"")}var N={highlightArrow:C},j=Pu();return In(j,x=>c=x,()=>c),T(s,j),Ms(N)}var qu=F('<span class="eval-label eval-label-dark svelte-5gau2q"> </span>'),Au=F('<span class="eval-label svelte-5gau2q"> </span>'),Mu=F('<div><div class="eval-fill-black svelte-5gau2q"><!></div> <div class="eval-fill-white svelte-5gau2q"><!></div></div>');function Iu(s,e){As(e,!0);let t=is(e,"evaluation",3,null),r=is(e,"orientation",3,"white");const n=de(()=>t()===null?50:t().type==="mate"?t().moves>0?100:0:1/(1+Math.exp(-t().pawns*.5))*100),i=de(()=>{if(t()===null)return"Â·Â·Â·";if(t().type==="mate"){const q=Math.abs(t().moves);return t().moves>0?`M${q}`:`âM${q}`}return`${t().pawns>=0?"+":"â"}${Math.abs(t().pawns).toFixed(1)}`});var o=Mu();let l;var c=w(o),u=w(c);{var d=E=>{var q=qu(),C=w(q);Q(()=>R(C,a(i))),T(E,q)};we(u,E=>{a(n)<50&&E(d)})}var p=S(c,2),f=w(p);{var g=E=>{var q=Au(),C=w(q);Q(()=>R(C,a(i))),T(E,q)};we(f,E=>{a(n)>=50&&E(g)})}Q(()=>{l=_e(o,1,"eval-bar svelte-5gau2q",null,l,{flipped:r()==="black"}),Ws(c,`height: ${100-a(n)}%`),Ws(p,`height: ${a(n)??""}%`)}),T(s,o),Ms()}let gs=D(ut([])),gr=D(0),cn=D(ut(new lr)),Tu=de(()=>a(cn).fen()),mr=D(ut([]));function Lu(){const s=new lr,e=[];for(const t of a(gs))try{const r=s.move({from:t.slice(0,2),to:t.slice(2,4),promotion:t[4]});e.push(r.san)}catch{e.push(t)}h(mr,e,!0)}const Te={get moves(){return a(gs)},get index(){return a(gr)},get fen(){return a(Tu)},get sanList(){return a(mr)}};function Oi(s,e,t){a(gr)<a(gs).length&&(h(gs,a(gs).slice(0,a(gr)),!0),h(mr,a(mr).slice(0,a(gr)),!0));try{const r=new lr(a(cn).fen()),n=r.move({from:s,to:e,promotion:t});if(!n)return!1;const i=s+e+(t||"");return h(gs,[...a(gs),i],!0),h(mr,[...a(mr),n.san],!0),Fl(gr),h(cn,r,!0),!0}catch{return!1}}function es(s){const e=Math.max(0,Math.min(s,a(gs).length));h(gr,e,!0);const t=new lr;for(let r=0;r<e;r++){const n=a(gs)[r];try{t.move({from:n.slice(0,2),to:n.slice(2,4),promotion:n[4]})}catch{break}}h(cn,t,!0)}function _i(){h(gs,[],!0),h(gr,0),h(cn,new lr,!0),h(mr,[],!0)}function wo(s,e){h(gs,[...s],!0),Lu(),es(Math.min(e,s.length))}let Ar=D(ut([])),Du=0;function Ou(s,e=2e3){const t=Du++;a(Ar).push({id:t,message:s,visible:!1}),requestAnimationFrame(()=>{const r=a(Ar).find(n=>n.id===t);r&&(r.visible=!0)}),setTimeout(()=>{const r=a(Ar).find(n=>n.id===t);r&&(r.visible=!1),setTimeout(()=>{h(Ar,a(Ar).filter(n=>n.id!==t),!0)},300)},e)}var Ru=F("<div> </div>");function Nu(s){var e=Hs(),t=et(e);Ot(t,17,()=>a(Ar),Ps,(r,n)=>{var i=Ru();let o;var l=w(i);Q(()=>{o=_e(i,1,"toast-notification svelte-1w29e1y",null,o,{visible:a(n).visible}),R(l,a(n).message)}),T(r,i)}),T(s,e)}let Fn=D(null),Bn=D(0),un=D(ut([])),Un=D(!1),mt=null,Ri=0,bi=0,yo="white";const _r={get eval(){return a(Fn)},get depth(){return a(Bn)},get lines(){return a(un)},get ready(){return a(Un)}};function $u(s){const e=s.match(/\bdepth (\d+)/);if(!e)return null;const t=parseInt(e[1],10);let r;const n=s.match(/\bscore cp (-?\d+)/);if(n)r={type:"cp",pawns:parseInt(n[1],10)/100};else{const u=s.match(/\bscore mate (-?\d+)/);if(u)r={type:"mate",moves:parseInt(u[1],10)};else return null}const i=s.match(/\bmultipv (\d+)/),o=i?parseInt(i[1],10):1;let l=[];const c=s.indexOf(" pv ");return c!==-1&&(l=s.slice(c+4).split(/\s+/).filter(Boolean)),{eval:r,depth:t,multipv:o,pvUci:l}}function Fu(s){const e=typeof s.data=="string"?s.data:String(s.data);if(e==="readyok"){bi++;return}if(e.startsWith("bestmove")||bi<Ri||!e.startsWith("info")||!e.includes(" score "))return;const t=$u(e);if(t){let r;yo==="black"?t.eval.type==="cp"?r={type:"cp",pawns:-t.eval.pawns}:r={type:"mate",moves:-t.eval.moves}:r=t.eval;const n={multipv:t.multipv,eval:r,depth:t.depth,pvUci:t.pvUci},i=t.multipv-1,o=[...a(un)];for(;o.length<=i;){const l=o.length+1;o.push({multipv:l,eval:r,depth:t.depth,pvUci:[]})}o[i]=n,h(un,o,!0),t.multipv===1&&(h(Fn,r,!0),h(Bn,t.depth,!0))}}function Bu(){return new Promise((s,e)=>{try{mt=new Worker("./stockfish/stockfish-17.1-lite-51f59da.js")}catch(r){e(r);return}let t=!1;mt.onmessage=r=>{const n=typeof r.data=="string"?r.data:String(r.data);if(!t&&n==="uciok"){const i=Math.min(navigator.hardwareConcurrency||1,2);mt.postMessage(`setoption name Threads value ${i}`),mt.postMessage("setoption name Hash value 128"),mt.postMessage("setoption name MultiPV value 3"),mt.postMessage("isready"),t=!0;return}if(t&&n==="readyok"){mt.onmessage=Fu,h(Un,!0),s();return}},mt.onerror=r=>{e(new Error("Stockfish worker failed to load: "+r.message))},mt.postMessage("uci")})}function Uu(s){if(!mt||!a(Un))return;Ri++,h(Fn,null),h(Bn,0),h(un,[],!0),yo=s.length%2===0?"white":"black",mt.postMessage("stop"),mt.postMessage("isready");const e=s.length===0?"position startpos":"position startpos moves "+s.join(" ");mt.postMessage(e),mt.postMessage("go depth 30")}function Gu(){mt&&(mt.postMessage("quit"),mt.terminate(),mt=null),h(Fn,null),h(Bn,0),h(un,[],!0),h(Un,!1),Ri=0,bi=0}var Wu=F('<div class="engine-line svelte-eu7elq"><span class="engine-moves svelte-eu7elq">&middot;&middot;&middot;</span></div>'),Ku=F('<div class="engine-line clickable svelte-eu7elq" role="button" tabindex="0"><span> </span> <span class="engine-moves svelte-eu7elq"> </span></div>'),Hu=F('<span class="move-list-empty svelte-eu7elq">Starting position</span>'),zu=F("<td> </td>"),Vu=F('<td class="svelte-eu7elq"></td>'),ju=F('<tr class="svelte-eu7elq"><td class="move-number svelte-eu7elq"></td><td> </td><!></tr>'),Yu=F('<table class="move-table svelte-eu7elq"></table>'),Qu=F('<div class="engine-section svelte-eu7elq"><div class="engine-header svelte-eu7elq"><span class="engine-label svelte-eu7elq"> </span></div> <!></div> <div class="current-line-section svelte-eu7elq"><h3 class="section-title svelte-eu7elq">Current Line</h3> <div class="move-list svelte-eu7elq"><!></div></div> <div class="vcr-controls svelte-eu7elq"><button class="vcr-btn svelte-eu7elq" title="Start">â®</button> <button class="vcr-btn svelte-eu7elq" title="Back">â</button> <button class="vcr-btn svelte-eu7elq" title="Forward">â¶</button> <button class="vcr-btn svelte-eu7elq" title="End">â­</button></div> <div class="export-controls svelte-eu7elq"><button class="export-btn svelte-eu7elq">Copy PGN</button></div>',1);function Xu(s,e){As(e,!0);let t;function r(Y,ye){if(ye.length===0)return"";const ke=new lr(Y),ve=[],Se=ke.turn()==="w"?0:1;for(let oe=0;oe<ye.length;oe++){const Ce=ye[oe];try{const xe=ke.move({from:Ce.slice(0,2),to:Ce.slice(2,4),promotion:Ce[4]}),z=Se+oe;z%2===0?ve.push(`${Math.floor(z/2)+1}.${xe.san}`):oe===0?ve.push(`${Math.floor(z/2)+1}...${xe.san}`):ve.push(xe.san)}catch{ve.push(Ce);break}}return ve.join(" ")}function n(Y){if(!Y)return;const ye=Y.slice(0,2),ke=Y.slice(2,4),ve=Y[4];Oi(ye,ke,ve)}ct(()=>{Te.index,no().then(()=>{const Y=t?.querySelector(".move-san.active");Y&&Y.scrollIntoView({block:"nearest",behavior:"smooth"})})});const i=de(()=>Te.index===0),o=de(()=>Te.index>=Te.moves.length);function l(){let Y="";const ye=Te.sanList;for(let ke=0;ke<ye.length;ke++)ke%2===0?(ke>0&&(Y+=" "),Y+=`${Math.floor(ke/2)+1}. ${ye[ke]}`):Y+=` ${ye[ke]}`;return Y}function c(){const Y=l();Y&&navigator.clipboard.writeText(Y).then(()=>Ou("Copied!"))}var u=Qu(),d=et(u),p=w(d),f=w(p),g=w(f),E=S(p,2);{var q=Y=>{var ye=Wu();T(Y,ye)},C=Y=>{var ye=Hs(),ke=et(ye);Ot(ke,17,()=>_r.lines,ve=>ve.multipv,(ve,Se)=>{var oe=Ku();oe.__click=()=>n(a(Se).pvUci[0]);var Ce=w(oe);let xe;var z=w(Ce),pe=S(Ce,2),Ne=w(pe);Q(($e,Pe,Qe)=>{xe=_e(Ce,1,"eval-badge svelte-eu7elq",null,xe,$e),R(z,Pe),R(Ne,Qe)},[()=>({positive:!Gr(a(Se).eval),negative:Gr(a(Se).eval)}),()=>Li(a(Se).eval),()=>r(Te.fen,a(Se).pvUci)]),Ks("mouseenter",oe,()=>e.onEngineLineHover?.(a(Se).pvUci[0]??null)),Ks("mouseleave",oe,()=>e.onEngineLineHover?.(null)),T(ve,oe)}),T(Y,ye)};we(E,Y=>{_r.lines.length===0?Y(q):Y(C,!1)})}var N=S(d,2),j=S(w(N),2),x=w(j);{var L=Y=>{var ye=Hu();T(Y,ye)},B=Y=>{var ye=Yu();Ot(ye,21,()=>Array(Math.ceil(Te.sanList.length/2)),Ps,(ke,ve,Se)=>{const oe=de(()=>Se*2);var Ce=ju(),xe=w(Ce);xe.textContent=`${Se+1}.`;var z=S(xe);let pe;z.__click=()=>es(a(oe)+1);var Ne=w(z),$e=S(z);{var Pe=Oe=>{var it=zu();let dt;it.__click=()=>es(a(oe)+2);var Vt=w(it);Q(()=>{dt=_e(it,1,"move-san svelte-eu7elq",null,dt,{active:a(oe)+2===Te.index}),R(Vt,Te.sanList[a(oe)+1])}),T(Oe,it)},Qe=Oe=>{var it=Vu();T(Oe,it)};we($e,Oe=>{a(oe)+1<Te.sanList.length?Oe(Pe):Oe(Qe,!1)})}Q(()=>{pe=_e(z,1,"move-san svelte-eu7elq",null,pe,{active:a(oe)+1===Te.index}),R(Ne,Te.sanList[a(oe)])}),T(ke,Ce)}),T(Y,ye)};we(x,Y=>{Te.sanList.length===0?Y(L):Y(B,!1)})}In(j,Y=>t=Y,()=>t);var J=S(N,2),ee=w(J);ee.__click=()=>es(0);var H=S(ee,2);H.__click=()=>es(Te.index-1);var ce=S(H,2);ce.__click=()=>es(Te.index+1);var ue=S(ce,2);ue.__click=()=>es(Te.moves.length);var Ie=S(J,2),Re=w(Ie);Re.__click=c,Q(()=>{R(g,`Engine${_r.depth>0?` Â· depth ${_r.depth}`:""}`),ee.disabled=a(i),H.disabled=a(i),ce.disabled=a(o),ue.disabled=a(o)}),T(s,u),Ms()}gn(["click"]);let Ni=D(null),Gn=D("white"),Wn=D(null),Kn=D(ut([])),Hn=D("explorer"),Wr=D("white");const Me={get playerContext(){return a(Ni)},get playerColor(){return a(Gn)},get timeControl(){return a(Wn)},get availableTimeControls(){return a(Kn)},get activeMode(){return a(Hn)},get boardOrientation(){return a(Wr)}};function Zu(s){h(Ni,s,!0),h(Gn,"white"),h(Wn,null),h(Kn,[],!0),h(Hn,"explorer"),h(Wr,"white")}function Ju(){h(Ni,null),h(Gn,"white"),h(Wn,null),h(Kn,[],!0),h(Hn,"explorer"),h(Wr,"white")}function ii(s){h(Gn,s,!0)}function wi(){h(Wr,a(Wr)==="white"?"black":"white",!0)}function ef(s){h(Wr,s,!0)}function tf(s){h(Wn,s,!0)}function sf(s){h(Kn,s,!0)}function ga(s){h(Hn,s,!0)}const rf=50,Rs=new Map;function ko(s,e,t,r){return JSON.stringify([s,e,t,r])}function nf(s,e,t,r){const n=ko(s,e,t,r),i=Rs.get(n);return i!==void 0&&(Rs.delete(n),Rs.set(n,i)),i}function af(s,e,t,r,n){const i=ko(s,e,t,r);if(Rs.delete(i),Rs.set(i,n),Rs.size>rf){const o=Rs.keys().next().value;o!==void 0&&Rs.delete(o)}}function of(){Rs.clear()}class Eo extends Map{#e=new Map;#s=D(0);#t=D(0);#a=Gs||-1;constructor(e){if(super(),e){for(var[t,r]of e)super.set(t,r);this.#t.v=super.size}}#n(e){return Gs===this.#a?D(e):nr(e)}has(e){var t=this.#e,r=t.get(e);if(r===void 0){var n=super.get(e);if(n!==void 0)r=this.#n(0),t.set(e,r);else return a(this.#s),!1}return a(r),!0}forEach(e,t){this.#r(),super.forEach(e,t)}get(e){var t=this.#e,r=t.get(e);if(r===void 0){var n=super.get(e);if(n!==void 0)r=this.#n(0),t.set(e,r);else{a(this.#s);return}}return a(r),super.get(e)}set(e,t){var r=this.#e,n=r.get(e),i=super.get(e),o=super.set(e,t),l=this.#s;if(n===void 0)n=this.#n(0),r.set(e,n),h(this.#t,super.size),xs(l);else if(i!==t){xs(n);var c=l.reactions===null?null:new Set(l.reactions),u=c===null||!n.reactions?.every(d=>c.has(d));u&&xs(l)}return o}delete(e){var t=this.#e,r=t.get(e),n=super.delete(e);return r!==void 0&&(t.delete(e),h(this.#t,super.size),h(r,-1),xs(this.#s)),n}clear(){if(super.size!==0){super.clear();var e=this.#e;h(this.#t,0);for(var t of e.values())h(t,-1);xs(this.#s),e.clear()}}#r(){a(this.#s);var e=this.#e;if(this.#t.v!==e.size){for(var t of super.keys())if(!e.has(t)){var r=this.#n(0);e.set(t,r)}}for([,r]of this.#e)a(r)}keys(){return a(this.#s),super.keys()}values(){return this.#r(),super.values()}entries(){return this.#r(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return a(this.#t),super.size}}const So=15,lf=2,cf=64,uf=200;let rr=new Eo,fn=D(0),hn=D(0),Co=D(So),lt=null,br=!1,Tn=[],Kr=[],yi="continuation",xo=[],Po=[],$i=0,ki=0,Cn="",qo="continuation",ds=null;const vs={get cache(){return rr},get continuationFensLeft(){return a(fn)},get posSearchFensLeft(){return a(hn)}};function ff(s){const e=s.match(/\bdepth (\d+)/);if(!e)return null;const t=parseInt(e[1],10),r=s.match(/\bscore cp (-?\d+)/);if(r)return{eval:{type:"cp",pawns:parseInt(r[1],10)/100},depth:t};const n=s.match(/\bscore mate (-?\d+)/);return n?{eval:{type:"mate",moves:parseInt(n[1],10)},depth:t}:null}function hf(s){const e=typeof s.data=="string"?s.data:String(s.data);if(e==="readyok"){ki++;return}if(e.startsWith("bestmove")){if(ds&&Cn){const r=Cn.split(" ")[1];let n;r==="b"?ds.eval.type==="cp"?n={type:"cp",pawns:-ds.eval.pawns}:n={type:"mate",moves:-ds.eval.moves}:n=ds.eval,rr.set(Cn,{eval:n,depth:ds.depth}),qo==="continuation"?h(fn,Math.max(0,a(fn)-1),!0):h(hn,Math.max(0,a(hn)-1),!0)}Fi();return}if(ki<$i||!e.startsWith("info")||!e.includes(" score "))return;const t=ff(e);t&&(!ds||t.depth>ds.depth)&&(ds=t)}function Fi(){if(!lt){br=!1;return}for(;;){let s;const e=yi==="continuation"?Tn:Kr,t=yi==="continuation"?Kr:Tn;if(e.length>0)s=e.shift();else if(t.length>0)s=t.shift();else{br=!1;return}if(!s){br=!1;return}if(!rr.has(s.fen)){br=!0,Cn=s.fen,qo=s.source,ds=null,$i++,lt.postMessage("stop"),lt.postMessage("isready"),lt.postMessage(`position fen ${s.fen}`),lt.postMessage(`go depth ${a(Co)}`);return}}}function df(){const s=xo.length+Po.length+uf;for(;rr.size>s;){const e=rr.keys().next().value;if(e===void 0)break;rr.delete(e)}}function vf(){return new Promise((s,e)=>{try{lt=new Worker("./stockfish/stockfish-17.1-lite-51f59da.js")}catch(r){e(r);return}let t=!1;lt.onmessage=r=>{const n=typeof r.data=="string"?r.data:String(r.data);if(!t&&n==="uciok"){const i=Math.min(navigator.hardwareConcurrency||1,lf);lt.postMessage(`setoption name Threads value ${i}`),lt.postMessage(`setoption name Hash value ${cf}`),lt.postMessage("setoption name MultiPV value 1"),lt.postMessage("isready"),t=!0;return}if(t&&n==="readyok"){lt.onmessage=hf,s();return}},lt.onerror=r=>{e(new Error("Eval queue worker failed to load: "+r.message))},lt.postMessage("uci")})}function pf(){lt&&(lt.postMessage("quit"),lt.terminate(),lt=null),rr=new Eo,h(fn,0),h(hn,0),h(Co,So),br=!1,Tn=[],Kr=[],$i=0,ki=0,ds=null}function Ao(s,e){const t=e.filter(n=>!rr.has(n)),r=t.map(n=>({fen:n,source:s}));s==="continuation"?(Tn=r,h(fn,t.length,!0),xo=e):(Kr=r,h(hn,t.length,!0),Po=e),df(),!br&&lt&&Fi()}function gf(s,e){Kr=[...e.map(r=>({fen:r,source:s})),...Kr],!br&&lt&&Fi()}function mf(s){yi=s}var _f=F('<div class="cont-loading svelte-1wi8bi9">Loading...</div>'),bf=F('<div class="cont-empty svelte-1wi8bi9">No games from this position</div>'),wf=F("<span> </span>"),yf=F('<span class="eval-badge eval-pending svelte-1wi8bi9"><span class="eval-spinner svelte-1wi8bi9">â¿</span></span>'),kf=F('<div class="cont-loading svelte-1wi8bi9">Loading games...</div>'),Ef=F('<div class="cont-empty svelte-1wi8bi9">No games found</div>'),Sf=F("<button> </button>"),Cf=F("<strong> </strong>"),xf=F("<strong> </strong>"),Pf=F('<div class="game-row svelte-1wi8bi9" role="button" tabindex="0"><span class="game-players svelte-1wi8bi9"><!> <!> </span> <span class="game-result svelte-1wi8bi9"> </span> <span class="game-date svelte-1wi8bi9"> </span></div>'),qf=F('<button class="show-all-games svelte-1wi8bi9"> </button>'),Af=F('<div class="game-sort-controls svelte-1wi8bi9"><span class="sort-label svelte-1wi8bi9">Sort:</span> <!></div> <div class="game-list svelte-1wi8bi9"></div> <!>',1),Mf=F('<div class="cont-expanded svelte-1wi8bi9"><!></div>'),If=F('<div role="button" tabindex="0"><span class="cont-count svelte-1wi8bi9"> </span> <span class="cont-move svelte-1wi8bi9"> </span> <!> <div class="wdl-bar svelte-1wi8bi9"><div class="wdl-white svelte-1wi8bi9"> </div> <div class="wdl-draw svelte-1wi8bi9"> </div> <div class="wdl-black svelte-1wi8bi9"> </div></div> <span class="cont-perf svelte-1wi8bi9"> </span> <button class="cont-show-games svelte-1wi8bi9"> </button></div> <!>',1),Tf=F('<div class="cont-game-count svelte-1wi8bi9"> </div> <div class="cont-list svelte-1wi8bi9"></div>',1),Lf=F('<div class="continuations-header svelte-1wi8bi9"><h2 class="panel-title svelte-1wi8bi9">Continuations</h2> <div class="sort-controls svelte-1wi8bi9"><span class="sort-label svelte-1wi8bi9">Sort:</span> <button> </button> <button> </button> <button> </button></div></div> <div class="cont-toolbar svelte-1wi8bi9"><button class="cont-nav-btn svelte-1wi8bi9" title="Go back">&#8593;</button> <button class="cont-nav-btn svelte-1wi8bi9" title="Go to start">&#8962;</button> <label class="transposition-toggle svelte-1wi8bi9"><input type="checkbox" class="svelte-1wi8bi9"/> Transpositions</label></div> <div class="cont-content"><!></div>',1);function Df(s,e){As(e,!0);let t=is(e,"highlightedArrowUci",3,null),r=D(ut([])),n=D(""),i=D(!1),o=0,l=D("games"),c=D(!1),u=D(!1),d=D(null),p=D(null),f=D(ut([])),g=D(!1),E=D(!1),q=D("date"),C=D(!1);function N(M,$){const ge=new lr(M);try{return ge.move({from:$.slice(0,2),to:$.slice(2,4),promotion:$[4]}).san}catch{return console.error(`UCI-to-SAN failed for "${$}" â not a legal move at FEN "${M}"`),"â "+$}}const j=de(()=>{if(a(r).length===0)return[];const M=Math.max(...a(r).map($=>$.gameCount));return a(r).map($=>({from:$.move.slice(0,2),to:$.move.slice(2,4),opacity:Math.max(.4,$.gameCount/M)}))});ct(()=>{e.onArrowsChanged(a(j))}),ct(()=>{if(a(r).length===0||!a(n))return;const M=a(n),$=a(r).map(fe=>yn(M,fe.move)),ge=setTimeout(()=>Ao("continuation",$),1e3);return()=>clearTimeout(ge)});const x=de(()=>a(r).reduce((M,$)=>M+$.gameCount,0));function L(M){return M.eval.type==="cp"?M.eval.pawns:M.eval.moves>0?1e4-M.eval.moves:-1e4-M.eval.moves}function B(M,$,ge){const fe=[...M],re=ge?1:-1;if($==="eval"){const ie=a(n).split(" ")[1]==="w"?1:-1;fe.sort((ae,Be)=>{const Fe=yn(a(n),ae.move),Ue=yn(a(n),Be.move),Ge=vs.cache.get(Fe),me=vs.cache.get(Ue);return!Ge&&!me?0:Ge?me?re*ie*(L(Ge)-L(me)):-1:1})}else $==="perf"?fe.sort((ie,ae)=>re*(ie.performanceRating-ae.performanceRating)):fe.sort((ie,ae)=>re*(ie.gameCount-ae.gameCount));return fe}function J(M,$,ge){const fe=[...M],re=ge?1:-1;if($==="result"){const ie={"1-0":0,"1/2-1/2":1,"0-1":2};fe.sort((ae,Be)=>re*((ie[ae.result]??3)-(ie[Be.result]??3)))}else if($==="elo"){const ie=ae=>ae.playerColor==="white"?ae.blackRating:ae.whiteRating;fe.sort((ae,Be)=>re*(ie(ae)-ie(Be)))}else fe.sort((ie,ae)=>re*(ie.date-ae.date));return fe}function ee(M){M.length===1&&M[0].gameCount<10&&Ie(M[0].move,M[0].gameIds)}Hl(()=>{const M=Me.playerContext;if(!M)return;const $=Te.moves.slice(0,Te.index),ge=Me.playerColor,fe=Me.timeControl,re=a(u),ie=nf($,ge,fe,re);if(ie){const Fe=B(ie,a(l),a(c));h(r,Fe,!0),h(n,Te.fen,!0),h(i,!1),h(p,null),h(f,[],!0),ee(Fe);return}const ae=++o,Be=Te.fen;h(i,!0),h(p,null),h(f,[],!0),h(g,!1),h(E,!1),Pc(M.username,M.platform,M.since,M.until,$,ge,fe,re).then(Fe=>{if(ae!==o)return;af($,ge,fe,re,Fe);const Ue=B(Fe,a(l),a(c));h(r,Ue,!0),h(n,Be,!0),h(i,!1),ee(Ue)}).catch(Fe=>{ae===o&&(h(i,!1),h(r,[],!0),h(n,Be,!0),console.error("getContinuations failed:",Fe))})});function H(M){M===a(l)?h(c,!a(c)):(h(l,M,!0),h(c,!1)),h(r,B(a(r),a(l),a(c)),!0)}function ce(M,$,ge){const re={games:"Games",perf:"Perf",eval:"Eval"}[M]||M;return M===$?`${re} ${ge?"â²":"â¼"}`:re}function ue(M){const $=M.slice(0,2),ge=M.slice(2,4),fe=M[4];Oi($,ge,fe)}function Ie(M,$){h(p,M,!0),h(f,[],!0),h(g,!0),h(E,!1),h(q,"date"),h(C,!1);const ge=Me.playerContext;po(ge.username,ge.platform,$).then(fe=>{a(p)===M&&(h(f,J(fe,a(q),a(C)),!0),h(g,!1))}).catch(fe=>{a(p)===M&&(h(g,!1),h(f,[],!0),console.error("getGamesMetadata failed:",fe))})}function Re(M,$){if(a(p)===M){h(p,null),h(f,[],!0),h(g,!1),h(E,!1);return}Ie(M,$)}function Y(M){M===a(q)?h(C,!a(C)):(h(q,M,!0),h(C,!1)),h(f,J(a(f),a(q),a(C)),!0)}function ye(M){const ge={date:"Date",result:"Result",elo:"Elo"}[M]||M;return M===a(q)?`${ge} ${a(C)?"â²":"â¼"}`:ge}function ke(M){const $=M.whiteWins+M.draws+M.blackWins;return{wPct:$>0?M.whiteWins/$*100:0,dPct:$>0?M.draws/$*100:0,bPct:$>0?M.blackWins/$*100:0}}var ve=Lf(),Se=et(ve),oe=S(w(Se),2),Ce=S(w(oe),2);let xe;Ce.__click=()=>H("games");var z=w(Ce),pe=S(Ce,2);let Ne;pe.__click=()=>H("eval");var $e=w(pe),Pe=S(pe,2);let Qe;Pe.__click=()=>H("perf");var Oe=w(Pe),it=S(Se,2),dt=w(it);dt.__click=()=>es(Math.max(0,Te.index-1));var Vt=S(dt,2);Vt.__click=()=>es(0);var cs=S(Vt,2),Ls=w(cs),ys=S(it,2),us=w(ys);{var Rt=M=>{var $=_f();T(M,$)},fs=M=>{var $=Hs(),ge=et($);{var fe=ie=>{var ae=bf();T(ie,ae)},re=ie=>{var ae=Tf(),Be=et(ae),Fe=w(Be),Ue=S(Be,2);Ot(Ue,21,()=>a(r),Ge=>Ge.move,(Ge,me)=>{const Xe=de(()=>ke(a(me))),jt=de(()=>N(a(n),a(me).move)),Yt=de(()=>yn(a(n),a(me).move)),Mt=de(()=>vs.cache.get(a(Yt))),It=de(()=>a(p)===a(me).move),ks=de(()=>t()===a(me).move||a(d)===a(me).move);var We=If(),Ee=et(We);let bt;Ee.__click=()=>ue(a(me).move);var I=w(Ee),te=w(I),le=S(I,2),je=w(le),wt=S(le,2);{var ft=qe=>{var y=wf();let P;var k=w(y);Q((W,X)=>{P=_e(y,1,"eval-badge svelte-1wi8bi9",null,P,W),R(k,X)},[()=>({positive:!Gr(a(Mt).eval),negative:Gr(a(Mt).eval)}),()=>Li(a(Mt).eval)]),T(qe,y)},Qt=qe=>{var y=yf();T(qe,y)};we(wt,qe=>{a(Mt)?qe(ft):qe(Qt,!1)})}var hs=S(wt,2),Nt=w(hs),Es=w(Nt),vt=S(Nt,2),m=w(vt),$t=S(vt,2),at=w($t),Ke=S(hs,2),A=w(Ke),Ft=S(Ke,2);Ft.__click=qe=>{qe.stopPropagation(),Re(a(me).move,a(me).gameIds)};var He=w(Ft),yt=S(Ee,2);{var js=qe=>{var y=Mf(),P=w(y);{var k=X=>{var V=kf();T(X,V)},W=X=>{var V=Hs(),ne=et(V);{var Ze=Bt=>{var Ae=Ef();T(Bt,Ae)},Tt=Bt=>{var Ae=Af(),Je=et(Ae),Ss=S(w(Je),2);Ot(Ss,16,()=>["date","result","elo"],Ps,(Pt,ze)=>{var Lt=Sf();let ss;Lt.__click=()=>Y(ze);var Ds=w(Lt);Q(tt=>{ss=_e(Lt,1,"sort-btn game-sort-btn svelte-1wi8bi9",null,ss,{active:ze===a(q)}),R(Ds,tt)},[()=>ye(ze)]),T(Pt,Lt)});var Cr=S(Je,2);Ot(Cr,21,()=>a(E)?a(f):a(f).slice(0,100),Pt=>Pt.gameId,(Pt,ze)=>{var Lt=Pf();Lt.__click=()=>window.open(a(ze).url,"_blank");var ss=w(Lt),Ds=w(ss);{var tt=pt=>{var qt=Cf(),fr=w(qt);Q(()=>R(fr,a(ze).whiteName)),T(pt,qt)},v=pt=>{var qt=ar();Q(()=>R(qt,a(ze).whiteName)),T(pt,qt)};we(Ds,pt=>{a(ze).result==="1-0"?pt(tt):pt(v,!1)})}var _=S(Ds),b=S(_);{var K=pt=>{var qt=xf(),fr=w(qt);Q(()=>R(fr,a(ze).blackName)),T(pt,qt)},O=pt=>{var qt=ar();Q(()=>R(qt,a(ze).blackName)),T(pt,qt)};we(b,pt=>{a(ze).result==="0-1"?pt(K):pt(O,!1)})}var G=S(b),st=S(ss,2),Ut=w(st),ur=S(st,2),Vr=w(ur);Q(pt=>{R(_,` (${a(ze).whiteRating??""}) vs `),R(G,` (${a(ze).blackRating??""})`),R(Ut,a(ze).result==="1/2-1/2"?"Â½-Â½":a(ze).result),R(Vr,pt)},[()=>new Date(a(ze).date).toLocaleDateString()]),T(Pt,Lt)});var zr=S(Cr,2);{var cr=Pt=>{var ze=qf();ze.__click=()=>{h(E,!0)};var Lt=w(ze);Q(ss=>R(Lt,`Show all ${ss??""} games`),[()=>a(f).length.toLocaleString()]),T(Pt,ze)};we(zr,Pt=>{!a(E)&&a(f).length>100&&Pt(cr)})}T(Bt,Ae)};we(ne,Bt=>{a(f).length===0?Bt(Ze):Bt(Tt,!1)},!0)}T(X,V)};we(P,X=>{a(g)?X(k):X(W,!1)})}T(qe,y)};we(yt,qe=>{a(It)&&qe(js)})}Q((qe,y)=>{bt=_e(Ee,1,"cont-row svelte-1wi8bi9",null,bt,{expanded:a(It),hover:a(ks)}),R(te,qe),R(je,a(jt)),Ws(Nt,`width: ${a(Xe).wPct??""}%`),R(Es,a(me).whiteWins>0&&a(Xe).wPct>15?a(me).whiteWins:""),Ws(vt,`width: ${a(Xe).dPct??""}%`),R(m,a(me).draws>0&&a(Xe).dPct>10?a(me).draws:""),Ws($t,`width: ${a(Xe).bPct??""}%`),R(at,a(me).blackWins>0&&a(Xe).bPct>15?a(me).blackWins:""),R(A,y),R(He,a(It)?"Hide games":"Show games")},[()=>a(me).gameCount.toLocaleString(),()=>a(me).performanceRating>0?`PR: ${Math.round(a(me).performanceRating)}`:"PR: â"]),Ks("mouseenter",Ee,()=>{h(d,a(me).move,!0)}),Ks("mouseleave",Ee,()=>{h(d,null)}),T(Ge,We)}),Q(Ge=>R(Fe,`${Ge??""} games`),[()=>a(x).toLocaleString()]),T(ie,ae)};we(ge,ie=>{a(r).length===0?ie(fe):ie(re,!1)},!0)}T(M,$)};we(us,M=>{a(i)?M(Rt):M(fs,!1)})}Q((M,$,ge)=>{xe=_e(Ce,1,"sort-btn svelte-1wi8bi9",null,xe,{active:a(l)==="games"}),R(z,M),Ne=_e(pe,1,"sort-btn svelte-1wi8bi9",null,Ne,{active:a(l)==="eval"}),pe.disabled=vs.continuationFensLeft>0,R($e,$),Qe=_e(Pe,1,"sort-btn svelte-1wi8bi9",null,Qe,{active:a(l)==="perf"}),R(Oe,ge)},[()=>ce("games",a(l),a(c)),()=>ce("eval",a(l),a(c)),()=>ce("perf",a(l),a(c))]),mc(Ls,()=>a(u),M=>h(u,M)),T(s,ve),Ms()}gn(["click"]);var Of=F("<div> </div>"),Rf=F('<div class="mini-board svelte-tgw8do"></div>');function Nf(s,e){As(e,!0);const t={K:"â",Q:"â",R:"â",B:"â",N:"â",P:"â",k:"â",q:"â",r:"â",b:"â",n:"â",p:"â"};let r=is(e,"size",3,160);const n=de(()=>{const l=[],c=e.placement.split("/");for(let u=0;u<8;u++){const d=c[u]||"";let p=0;for(const f of d)if(f>="1"&&f<="8")for(let g=0;g<parseInt(f);g++)l.push({light:(u+p)%2===1,piece:""}),p++;else l.push({light:(u+p)%2===1,piece:t[f]||""}),p++;for(;p<8;)l.push({light:(u+p)%2===1,piece:""}),p++}return l});var i=Rf();let o;Ot(i,21,()=>a(n),Ps,(l,c)=>{var u=Of();let d;var p=w(u);Q(()=>{d=_e(u,1,"mini-square svelte-tgw8do",null,d,{light:a(c).light,dark:!a(c).light}),R(p,a(c).piece)}),T(l,u)}),Q(()=>o=Ws(i,"",o,{width:`${r()??""}px`,height:`${r()??""}px`})),T(s,i),Ms()}var $f=F("<button> </button>"),Ff=F("<button> </button>"),Bf=F('<div class="search-empty svelte-1goeqgu">Place pieces on the board to search</div>'),Uf=F('<div class="search-loading svelte-1goeqgu">Searching...</div>'),Gf=F('<div class="search-empty svelte-1goeqgu">No games found</div>'),Wf=F("<button> </button>"),Kf=F('<div class="eval-sort-overlay svelte-1goeqgu"><div class="eval-sort-progress svelte-1goeqgu"> <button class="eval-sort-cancel svelte-1goeqgu">Cancel</button></div></div>'),Hf=F("<span> </span>"),zf=F('<span class="eval-badge eval-pending svelte-1goeqgu"><span class="eval-spinner svelte-1goeqgu">â¿</span></span>'),Vf=F("<strong> </strong>"),jf=F("<strong> </strong>"),Yf=F('<div class="result-row svelte-1goeqgu"><!> <!> <div class="result-info svelte-1goeqgu"><div class="result-players svelte-1goeqgu"><!> <!> </div> <div class="result-meta svelte-1goeqgu"> </div> <div class="result-actions svelte-1goeqgu"><button class="result-show-btn svelte-1goeqgu">Show on main board</button> <a class="result-link svelte-1goeqgu" target="_blank"> </a></div></div></div>'),Qf=F('<div class="scroll-sentinel svelte-1goeqgu" id="search-sentinel"></div>'),Xf=F('<div class="search-results-header svelte-1goeqgu"><div class="search-count svelte-1goeqgu"> </div></div> <div class="sort-controls svelte-1goeqgu"><span class="sort-label svelte-1goeqgu">Sort:</span> <!> <button>Eval</button></div> <div class="result-list-wrapper svelte-1goeqgu"><!> <div class="result-list svelte-1goeqgu"><!> <!></div></div>',1),Zf=F('<div><div class="piece-palette white-palette svelte-1goeqgu"><button></button> <!> <button></button> <button></button></div> <div class="editor-board-wrap svelte-1goeqgu"><!></div> <div class="piece-palette black-palette svelte-1goeqgu"><button></button> <!> <button></button> <button></button></div></div> <div class="editor-controls svelte-1goeqgu"><button class="editor-btn svelte-1goeqgu">Clear</button> <button class="editor-btn svelte-1goeqgu">From Current</button> <button class="editor-btn svelte-1goeqgu">Flip Board</button></div> <div class="resize-handle svelte-1goeqgu"><div class="resize-grip svelte-1goeqgu"></div></div> <div class="search-results svelte-1goeqgu"><!></div>',1);function Jf(s,e){As(e,!0);let t=is(e,"platformLabel",3,"");const r={K:"â",Q:"â",R:"â",B:"â",N:"â",P:"â",k:"â",q:"â",r:"â",b:"â",n:"â",p:"â"},n=["K","Q","R","B","N","P"],i=["k","q","r","b","n","p"];let o=D(ut(new Map)),l=D(null),c=null,u=!1;const d="posSearchBoardWidth",p=150;let g=D(420),E=D(void 0);Br(()=>{const y=localStorage.getItem(d);if(y){const P=Number(y);P>=p&&h(g,P,!0)}});function q(){let y=a(E)?.parentElement??null;for(;y;){if(y.offsetWidth>0)return y.offsetWidth;y=y.parentElement}return 600}function C(y){if(!a(E))return;y.preventDefault();const P=y.clientY,k=a(g),W=a(E),X=q();function V(Tt){return Math.max(p,Math.min(X,k+Tt))}function ne(Tt){const Bt=V(Tt.clientY-P);W.style.width=Bt+"px"}function Ze(Tt){document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",Ze),h(g,V(Tt.clientY-P),!0),localStorage.setItem(d,String(a(g)))}document.addEventListener("mousemove",ne),document.addEventListener("mouseup",Ze)}let N=0,j=D(!1),x=D(null),L=D(ut([])),B=D("date"),J=D(!1),ee=D(50),H=null,ce=null,ue=D(null),Ie=null;const Re=de(()=>Ne(a(o))),Y=de(()=>{const y=[];for(const[P,k]of a(o))k==="X"&&y.push({square:P});return y}),ye=de(()=>a(l)===null?"free":"none");function ke(y){!c||c.style.display==="none"||(c.style.left=`${y.clientX+12}px`,c.style.top=`${y.clientY+12}px`)}function ve(y){c||(c=document.createElement("div"),c.className="ghost-cursor",c.style.cssText="position:fixed;pointer-events:none;font-size:28px;z-index:10000;opacity:0.7;display:none;",document.body.appendChild(c)),c.textContent=y,c.style.display=u?"block":"none"}function Se(){c&&(c.style.display="none")}function oe(){u=!0,c&&a(l)!==null&&(c.style.display="block")}function Ce(){u=!1,Se()}Br(()=>{document.addEventListener("mousemove",ke)}),co(()=>{document.removeEventListener("mousemove",ke),c&&(c.remove(),c=null),ce!==null&&clearTimeout(ce),Ie!==null&&clearTimeout(Ie),H&&(H.disconnect(),H=null)});function xe(y){h(l,y,!0),y===null?Se():ve(y==="trash"?"ðï¸":y==="X"?"â":r[y]||y)}function z(y){if(a(l)===null)return;const P=new Map(a(o));a(l)==="trash"?P.delete(y):a(l)==="X"?P.set(y,"X"):P.set(y,a(l)),h(o,P,!0),Qe()}function pe(y,P,k){const W=new Map(a(o));W.delete(y),W.set(P,k),h(o,W,!0),Qe()}function Ne(y){const P=Array.from({length:8},()=>Array(8).fill(""));for(const[W,X]of y){if(X==="X")continue;const V=W.charCodeAt(0)-97,ne=parseInt(W[1])-1;P[ne][V]=X}const k=[];for(let W=7;W>=0;W--){let X="",V=0;for(let ne=0;ne<8;ne++)P[W][ne]===""?V++:(V>0&&(X+=V,V=0),X+=P[W][ne]);V>0&&(X+=V),k.push(X)}return k.join("/")+" w - - 0 1"}function $e(){h(o,new Map,!0),Qe()}function Pe(){const y=new Map,W=Te.fen.split(" ")[0].split("/");for(let X=0;X<8;X++){const V=7-X;let ne=0;for(const Ze of W[X])if(Ze>="1"&&Ze<="8")ne+=parseInt(Ze);else{const Tt=String.fromCharCode(97+ne)+(V+1);y.set(Tt,Ze),ne++}}h(o,y,!0),Qe()}function Qe(){ce!==null&&clearTimeout(ce),ce=setTimeout(()=>{ce=null,Oe()},300)}ct(()=>(Me.playerColor,Me.timeControl,or(()=>a(o).size)>0&&Qe(),()=>{ce!==null&&(clearTimeout(ce),ce=null)}));async function Oe(){if(a(o).size===0){h(x,null),h(L,[],!0),h(j,!1);return}const y=++N;h(j,!0),h(ee,50);try{const P={};for(const[X,V]of a(o))P[X]=V;const k=Me.playerContext,W=await qc(k.username,k.platform,k.since,k.until,{pieces:P},Me.playerColor,Me.timeControl);if(y!==N)return;if(h(x,W,!0),W.gameIds.length>0){const X=await po(k.username,k.platform,W.gameIds);if(y!==N)return;const V=new Map(X.map(ne=>[ne.gameId,ne]));h(L,it(W.gameIds.map(ne=>V.get(ne)).filter(Boolean),a(B),a(J)),!0)}else h(L,[],!0);h(j,!1)}catch(P){if(y!==N)return;h(j,!1),h(x,null),h(L,[],!0),console.error("searchByPosition failed:",P)}}function it(y,P,k){if(P==="eval")return y;const W=[...y],X=k?1:-1;if(P==="result"){const V={"1-0":0,"1/2-1/2":1,"0-1":2};W.sort((ne,Ze)=>X*((V[ne.result]??3)-(V[Ze.result]??3)))}else if(P==="elo"){const V=ne=>ne.playerColor==="white"?ne.blackRating:ne.whiteRating;W.sort((ne,Ze)=>X*(V(ne)-V(Ze)))}else W.sort((V,ne)=>X*(V.date-ne.date));return W}function dt(y){y===a(B)?h(J,!a(J)):(h(B,y,!0),h(J,!1)),h(L,it(a(L),a(B),a(J)),!0),h(ee,50)}function Vt(y){const k={date:"Date",result:"Result",elo:"Opp Elo"}[y]||y;return y===a(B)?`${k} ${a(J)?"â²":"â¼"}`:k}async function cs(y,P){try{const k=Me.playerContext,W=await go(k.username,k.platform,[y]);if(W.length===0){console.error("No moves found for game",y);return}wo(W[0].moves,P)}catch(k){console.error("getGamesMoves failed:",k)}}function Ls(){H&&(H.disconnect(),H=null);const y=document.getElementById("search-sentinel");y&&(H=new IntersectionObserver(P=>{for(const k of P)k.isIntersecting&&a(ee)<a(L).length&&h(ee,a(ee)+50)},{threshold:.1}),H.observe(y))}ct(()=>(a(L).length>0&&a(ee)<a(L).length&&queueMicrotask(()=>Ls()),()=>{H&&(H.disconnect(),H=null)}));function ys(y){let P=y.parentElement;for(;P;){const k=getComputedStyle(P).overflowY;if(k==="auto"||k==="scroll")return P;P=P.parentElement}return null}function us(){Ie===null&&(Ie=setTimeout(()=>{Ie=null,Rt()},200))}ct(()=>{const y=a(ue);if(!y)return;const P=ys(y);if(P)return P.addEventListener("scroll",us),()=>{P.removeEventListener("scroll",us)}});function Rt(){if(!a(ue)||!a(x)||a(M).length===0)return;const y=a(ue).querySelectorAll(".result-row"),P=[];for(const k of y){const W=k.getBoundingClientRect();if(W.bottom>0&&W.top<window.innerHeight){const X=k.dataset.gameId;if(X){const V=a($).get(Number(X));V&&P.push(V)}}}P.length>0&&gf("position_search",P)}const fs=de(()=>{if(a(L).length===0)return 0;const y=[];let P=0;for(const k of a(L)){const W=k.playerColor==="white"?k.blackRating:k.whiteRating;y.push(W),k.result==="1-0"?P+=k.playerColor==="white"?1:0:k.result==="0-1"?P+=k.playerColor==="black"?1:0:P+=.5}return Math.round(tu(y,P))}),M=de(()=>a(L).slice(0,a(ee))),$=de(()=>{if(!a(x))return new Map;const y=a(x),P=new Map;return y.gameIds.forEach((k,W)=>P.set(k,y.fens[W])),P});ct(()=>{if(!a(x)||a(L).length===0)return;const y=a(L).slice(0,a(ee)),P=a(L).slice(a(ee)),k=[...y,...P].map(W=>a($).get(W.gameId)).filter(W=>W!=null);Ao("position_search",k)});let ge=D(!1),fe=null,re=D(0);function ie(y){return y.eval.type==="cp"?y.eval.pawns:y.eval.moves>0?1e4-y.eval.moves:-1e4-y.eval.moves}function ae(y){const P=[...y];return P.sort((k,W)=>{const X=a($).get(k.gameId),V=a($).get(W.gameId),ne=X?vs.cache.get(X):void 0,Ze=V?vs.cache.get(V):void 0;return!ne&&!Ze?0:ne?Ze?ie(Ze)-ie(ne):-1:1}),P}function Be(){vs.posSearchFensLeft===0?(h(L,ae(a(L)),!0),h(B,"eval"),h(J,!1),h(ee,50)):(h(ge,!0),fe=[...a(L)],h(re,a(L).length,!0))}function Fe(){h(ge,!1),fe&&(h(L,fe,!0),fe=null)}ct(()=>{a(ge)&&vs.posSearchFensLeft===0&&(h(L,ae(a(L)),!0),h(B,"eval"),h(J,!1),h(ee,50),h(ge,!1),fe=null)});function Ue(y){if(!a(x))return"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";const P=a(x).gameIds.indexOf(y.gameId);return P===-1?"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR":a(x).fens[P].split(" ")[0]}function Ge(y){if(!a(x))return 0;const P=a(x).gameIds.indexOf(y.gameId);return P!==-1?a(x).plys[P]:0}var me=Zf(),Xe=et(me);let jt,Yt;var Mt=w(Xe),It=w(Mt);let ks;It.__mousedown=y=>{y.preventDefault(),xe(null)},It.textContent="â";var We=S(It,2);Ot(We,17,()=>n,Ps,(y,P)=>{var k=$f();let W;k.__mousedown=V=>{V.preventDefault(),xe(a(P))};var X=w(k);Q(()=>{W=_e(k,1,"palette-piece svelte-1goeqgu",null,W,{active:a(l)===a(P)}),R(X,r[a(P)])}),T(y,k)});var Ee=S(We,2);let bt;Ee.__mousedown=y=>{y.preventDefault(),xe("X")},Ee.textContent="â";var I=S(Ee,2);let te;I.__mousedown=y=>{y.preventDefault(),xe("trash")},I.textContent="ðï¸";var le=S(Mt,2),je=w(le);bo(je,{get fen(){return a(Re)},get orientation(){return Me.boardOrientation},get inputMode(){return a(ye)},get markers(){return a(Y)},showCoordinates:!1,onSquareClick:z,onFreeDrop:pe});var wt=S(le,2),ft=w(wt);let Qt;ft.__mousedown=y=>{y.preventDefault(),xe(null)},ft.textContent="â";var hs=S(ft,2);Ot(hs,17,()=>i,Ps,(y,P)=>{var k=Ff();let W;k.__mousedown=V=>{V.preventDefault(),xe(a(P))};var X=w(k);Q(()=>{W=_e(k,1,"palette-piece svelte-1goeqgu",null,W,{active:a(l)===a(P)}),R(X,r[a(P)])}),T(y,k)});var Nt=S(hs,2);let Es;Nt.__mousedown=y=>{y.preventDefault(),xe("X")},Nt.textContent="â";var vt=S(Nt,2);let m;vt.__mousedown=y=>{y.preventDefault(),xe("trash")},vt.textContent="ðï¸",In(Xe,y=>h(E,y),()=>a(E));var $t=S(Xe,2),at=w($t);at.__click=$e;var Ke=S(at,2);Ke.__click=Pe;var A=S(Ke,2);A.__click=function(...y){wi?.apply(this,y)};var Ft=S($t,2);Ft.__mousedown=C;var He=S(Ft,2),yt=w(He);{var js=y=>{var P=Bf();T(y,P)},qe=y=>{var P=Hs(),k=et(P);{var W=V=>{var ne=Uf();T(V,ne)},X=V=>{var ne=Hs(),Ze=et(ne);{var Tt=Ae=>{var Je=Gf();T(Ae,Je)},Bt=Ae=>{var Je=Xf(),Ss=et(Je),Cr=w(Ss),zr=w(Cr),cr=S(Ss,2),Pt=S(w(cr),2);Ot(Pt,16,()=>["date","result","elo"],Ps,(O,G)=>{var st=Wf();let Ut;st.__click=()=>dt(G);var ur=w(st);Q(Vr=>{Ut=_e(st,1,"sort-btn search-sort-btn svelte-1goeqgu",null,Ut,{active:G===a(B)}),R(ur,Vr)},[()=>Vt(G)]),T(O,st)});var ze=S(Pt,2);let Lt;ze.__click=Be;var ss=S(cr,2),Ds=w(ss);{var tt=O=>{var G=Kf(),st=w(G),Ut=w(st),ur=S(Ut);ur.__click=Fe,Q(()=>R(Ut,`Evaluating positions: ${a(re)-vs.posSearchFensLeft} of ${a(re)??""} `)),T(O,G)};we(Ds,O=>{a(ge)&&vs.posSearchFensLeft>0&&O(tt)})}var v=S(Ds,2),_=w(v);Ot(_,17,()=>a(M),O=>O.gameId,(O,G)=>{const st=de(()=>Ge(a(G))),Ut=de(()=>Math.floor(a(st)/2)+1),ur=de(()=>a(st)%2===1?"...":""),Vr=de(()=>a(G).result==="1/2-1/2"?"Â½-Â½":a(G).result),pt=de(()=>a($).get(a(G).gameId)),qt=de(()=>a(pt)?vs.cache.get(a(pt)):void 0);var fr=Yf(),Bi=w(fr);{let Ye=de(()=>Ue(a(G)));Nf(Bi,{get placement(){return a(Ye)}})}var Ui=S(Bi,2);{var Mo=Ye=>{var kt=Hf();let xr;var Uo=w(kt);Q((Go,Wo)=>{xr=_e(kt,1,"eval-badge svelte-1goeqgu",null,xr,Go),R(Uo,Wo)},[()=>({positive:!Gr(a(qt).eval),negative:Gr(a(qt).eval)}),()=>Li(a(qt).eval)]),T(Ye,kt)},Io=Ye=>{var kt=zf();T(Ye,kt)};we(Ui,Ye=>{a(qt)?Ye(Mo):Ye(Io,!1)})}var To=S(Ui,2),Gi=w(To),Wi=w(Gi);{var Lo=Ye=>{var kt=Vf(),xr=w(kt);Q(()=>R(xr,a(G).whiteName)),T(Ye,kt)},Do=Ye=>{var kt=ar();Q(()=>R(kt,a(G).whiteName)),T(Ye,kt)};we(Wi,Ye=>{a(G).result==="1-0"?Ye(Lo):Ye(Do,!1)})}var Ki=S(Wi),Hi=S(Ki);{var Oo=Ye=>{var kt=jf(),xr=w(kt);Q(()=>R(xr,a(G).blackName)),T(Ye,kt)},Ro=Ye=>{var kt=ar();Q(()=>R(kt,a(G).blackName)),T(Ye,kt)};we(Hi,Ye=>{a(G).result==="0-1"?Ye(Oo):Ye(Ro,!1)})}var No=S(Hi),zi=S(Gi,2),$o=w(zi),Fo=S(zi,2),Vi=w(Fo);Vi.__click=()=>cs(a(G).gameId,a(st));var ji=S(Vi,2),Bo=w(ji);Q(Ye=>{Mn(fr,"data-game-id",a(G).gameId),R(Ki,` (${a(G).whiteRating??""}) vs `),R(No,` (${a(G).blackRating??""})`),R($o,`${Ye??""} Â· ${a(Vr)??""} Â· move ${a(Ut)??""}${a(ur)??""}`),Mn(ji,"href",a(G).url),R(Bo,`View on ${t()??""}`)},[()=>new Date(a(G).date).toLocaleDateString()]),T(O,fr)});var b=S(_,2);{var K=O=>{var G=Qf();T(O,G)};we(b,O=>{a(ee)<a(L).length&&O(K)})}In(v,O=>h(ue,O),()=>a(ue)),Q(O=>{R(zr,`Found in ${O??""} games ${a(fs)>0?`Â· PR: ${a(fs)}`:""}`),Lt=_e(ze,1,"sort-btn svelte-1goeqgu",null,Lt,{active:a(B)==="eval"})},[()=>a(x).gameIds.length.toLocaleString()]),T(Ae,Je)};we(Ze,Ae=>{!a(x)||a(x).gameIds.length===0?Ae(Tt):Ae(Bt,!1)},!0)}T(V,ne)};we(k,V=>{a(j)?V(W):V(X,!1)},!0)}T(y,P)};we(yt,y=>{a(o).size===0?y(js):y(qe,!1)})}Q(()=>{jt=_e(Xe,1,"editor-section svelte-1goeqgu",null,jt,{flipped:Me.boardOrientation==="black"}),Yt=Ws(Xe,"",Yt,{width:`${a(g)??""}px`}),ks=_e(It,1,"palette-piece palette-tool svelte-1goeqgu",null,ks,{active:a(l)===null}),bt=_e(Ee,1,"palette-piece palette-tool svelte-1goeqgu",null,bt,{active:a(l)==="X"}),te=_e(I,1,"palette-piece palette-tool svelte-1goeqgu",null,te,{active:a(l)==="trash"}),Qt=_e(ft,1,"palette-piece palette-tool svelte-1goeqgu",null,Qt,{active:a(l)===null}),Es=_e(Nt,1,"palette-piece palette-tool svelte-1goeqgu",null,Es,{active:a(l)==="X"}),m=_e(vt,1,"palette-piece palette-tool svelte-1goeqgu",null,m,{active:a(l)==="trash"})}),Ks("mouseenter",Xe,oe),Ks("mouseleave",Xe,Ce),T(s,me),Ms()}gn(["mousedown","click"]);var eh=F("<option> </option>"),th=F('<div class="recent-games-empty svelte-9k08f">Loading...</div>'),sh=F('<div class="recent-games-empty svelte-9k08f">No games found</div>'),rh=F("<strong> </strong>"),nh=F("<strong> </strong>"),ih=F('<button class="recent-game-row svelte-9k08f"><span></span> <span class="recent-game-players svelte-9k08f"><!> <!> </span> <span class="recent-game-result svelte-9k08f"> </span> <span class="recent-game-date svelte-9k08f"> </span></button>'),ah=F('<div class="recent-games-menu svelte-9k08f"><!></div>'),oh=F('<header class="workspace-header svelte-9k08f"><button class="ws-back-btn svelte-9k08f">&larr; Back</button> <div class="color-filter svelte-9k08f"><button> </button> <button> </button></div> <select class="tc-select svelte-9k08f"><option>All time controls</option><!></select> <div class="ws-player-info svelte-9k08f"><span class="ws-username svelte-9k08f"> </span> <span class="ws-meta svelte-9k08f"> </span> <span class="ws-date-range svelte-9k08f"> </span></div> <div><button class="recent-games-btn svelte-9k08f">Recent Games &#x25BE;</button> <!></div> <div class="mode-toggle svelte-9k08f"><button>Opening Explorer</button> <button>Partial Position Search</button></div> <button class="ws-gear-btn svelte-9k08f" title="Settings">&#9881;</button></header> <div class="workspace-columns svelte-9k08f"><div class="workspace-col col-board svelte-9k08f"><div class="board-with-eval svelte-9k08f"><!> <div class="main-board-wrap svelte-9k08f"><!></div></div> <div class="board-controls svelte-9k08f"><button class="board-btn svelte-9k08f">Flip Board</button> <button class="board-btn svelte-9k08f">Reset</button> <button class="board-btn svelte-9k08f">Open Analysis Board</button></div></div> <div class="workspace-col col-pgn svelte-9k08f"><!></div> <div class="workspace-col col-context svelte-9k08f"><div><!></div> <div><!></div></div></div>',1);function lh(s,e){As(e,!0);let t=D(ut([])),r=D(null),n=D(null),i=D(null);ct(()=>{const I=_r.lines[0]?.pvUci[0]??null;if(I===a(i))return;const te=setTimeout(()=>{h(i,I,!0)},150);return()=>clearTimeout(te)});const o=de(()=>a(n)?a(n):!a(i)||a(i).length<4?null:{from:a(i).slice(0,2),to:a(i).slice(2,4)}),l=de(()=>{if(!a(o))return[...a(t)];const I=a(o).from+a(o).to,te=a(t).findIndex(je=>je.from+je.to===I);if(te>=0)return a(t).map((je,wt)=>wt===te?{...je,engineHover:!0}:{...je});const le=[...a(t)];return le.push({...a(o),opacity:1,type:"info"}),le});Br(async()=>{const I=Me.playerContext;if(I)try{const te=await Mc(I.username,I.platform,I.since,I.until);sf(te)}catch(te){console.error("getAvailableTimeControls failed:",te)}}),Br(()=>(Bu().catch(I=>console.error("Engine init failed:",I)),vf().catch(I=>console.error("Eval queue init failed:",I)),()=>{Gu(),pf()})),ct(()=>{const I=Te.moves,te=Te.index;_r.ready&&(Uu(I.slice(0,te)),h(n,null),h(i,null))}),ct(()=>{mf(Me.activeMode==="explorer"?"continuation":"position_search")});function c(I,te,le){return Oi(I,te,le)}function u(I){if(I===null){h(r,null);return}h(r,I,!0)}function d(I){h(t,I,!0)}function p(I){if(!I){h(n,null);return}h(n,{from:I.slice(0,2),to:I.slice(2,4)},!0)}function f(I){const te=I.target?.tagName;if(!(te==="INPUT"||te==="TEXTAREA"||te==="SELECT")&&!a(N))switch(I.key){case"x":case"X":wi();break;case"ArrowLeft":I.preventDefault(),es(Te.index-1);break;case"ArrowRight":I.preventDefault(),es(Te.index+1);break;case"Home":I.preventDefault(),es(0);break;case"End":I.preventDefault(),es(Te.moves.length);break}}function g(){const I=Te.sanList;let te="";for(let le=0;le<I.length;le++)le%2===0?(le>0&&(te+=" "),te+=`${Math.floor(le/2)+1}. ${I[le]}`):te+=` ${I[le]}`;te&&window.open(`https://lichess.org/analysis/pgn/${encodeURIComponent(te)}`,"_blank")}const E=de(()=>Me.playerContext),q=de(()=>a(E)?.platform==="lichess"?"Lichess":"Chess.com"),C=de(()=>a(E)?`${Ir(a(E).since)} â ${Ir(a(E).until)}`:"");let N=D(!1),j=D(ut([])),x=D(!1),L=0;ct(()=>{const I=Me.playerContext,te=Me.timeControl;if(!I)return;const le=++L;h(x,!0),Ac(I.username,I.platform,I.since,I.until,te,100).then(je=>{le===L&&(h(j,je,!0),h(x,!1))}).catch(je=>{le===L&&(console.error("getRecentGames failed:",je),h(j,[],!0),h(x,!1))})});function B(){h(N,!a(N))}function J(){h(N,!1)}async function ee(I){h(N,!1);const te=Me.playerContext;if(te)try{const le=await go(te.username,te.platform,[I.gameId]);le.length>0&&(wo(le[0].moves,Math.min(1,le[0].moves.length)),ii(I.playerColor),ef(I.playerColor))}catch(le){console.error("Failed to load game moves:",le)}}var H=oh();Ks("keydown",rn,f),Ks("click",rn,J);var ce=et(H),ue=w(ce);ue.__click=function(...I){e.onBack?.apply(this,I)};var Ie=S(ue,2),Re=w(Ie);let Y;Re.__click=()=>ii("white");var ye=w(Re),ke=S(Re,2);let ve;ke.__click=()=>ii("black");var Se=w(ke),oe=S(Ie,2);oe.__change=I=>tf(I.target.value||null);var Ce=w(oe);Ce.value=Ce.__value="";var xe=S(Ce);Ot(xe,17,()=>Me.availableTimeControls,Ps,(I,te)=>{var le=eh(),je=w(le),wt={};Q(()=>{R(je,a(te)),wt!==(wt=a(te))&&(le.value=(le.__value=a(te))??"")}),T(I,le)});var z;hc(oe);var pe=S(oe,2),Ne=w(pe),$e=w(Ne),Pe=S(Ne,2),Qe=w(Pe),Oe=S(Pe,2),it=w(Oe),dt=S(pe,2);let Vt;dt.__click=I=>I.stopPropagation();var cs=w(dt);cs.__click=B;var Ls=S(cs,2);{var ys=I=>{var te=ah(),le=w(te);{var je=ft=>{var Qt=th();T(ft,Qt)},wt=ft=>{var Qt=Hs(),hs=et(Qt);{var Nt=vt=>{var m=sh();T(vt,m)},Es=vt=>{var m=Hs(),$t=et(m);Ot($t,17,()=>a(j),at=>at.gameId,(at,Ke)=>{var A=ih();A.__click=()=>ee(a(Ke));var Ft=w(A);let He;var yt=S(Ft,2),js=w(yt);{var qe=Ae=>{var Je=rh(),Ss=w(Je);Q(()=>R(Ss,a(Ke).whiteName)),T(Ae,Je)},y=Ae=>{var Je=ar();Q(()=>R(Je,a(Ke).whiteName)),T(Ae,Je)};we(js,Ae=>{a(Ke).result==="1-0"?Ae(qe):Ae(y,!1)})}var P=S(js),k=S(P);{var W=Ae=>{var Je=nh(),Ss=w(Je);Q(()=>R(Ss,a(Ke).blackName)),T(Ae,Je)},X=Ae=>{var Je=ar();Q(()=>R(Je,a(Ke).blackName)),T(Ae,Je)};we(k,Ae=>{a(Ke).result==="0-1"?Ae(W):Ae(X,!1)})}var V=S(k),ne=S(yt,2),Ze=w(ne),Tt=S(ne,2),Bt=w(Tt);Q(Ae=>{He=_e(Ft,1,"recent-game-color svelte-9k08f",null,He,{white:a(Ke).playerColor==="white",black:a(Ke).playerColor==="black"}),R(P,` (${a(Ke).whiteRating??""}) vs `),R(V,` (${a(Ke).blackRating??""})`),R(Ze,a(Ke).result==="1/2-1/2"?"Â½-Â½":a(Ke).result),R(Bt,Ae)},[()=>new Date(a(Ke).date).toLocaleDateString()]),T(at,A)}),T(vt,m)};we(hs,vt=>{a(j).length===0?vt(Nt):vt(Es,!1)},!0)}T(ft,Qt)};we(le,ft=>{a(x)?ft(je):ft(wt,!1)})}T(I,te)};we(Ls,I=>{a(N)&&I(ys)})}var us=S(dt,2),Rt=w(us);let fs;Rt.__click=()=>ga("explorer");var M=S(Rt,2);let $;M.__click=()=>ga("search");var ge=S(ce,2),fe=w(ge),re=w(fe),ie=w(re);Iu(ie,{get evaluation(){return _r.eval},get orientation(){return Me.boardOrientation}});var ae=S(ie,2),Be=w(ae);bo(Be,{get fen(){return Te.fen},get orientation(){return Me.boardOrientation},get arrows(){return a(l)},inputMode:"legal",onMove:c,onArrowHover:u});var Fe=S(re,2),Ue=w(Fe);Ue.__click=function(...I){wi?.apply(this,I)};var Ge=S(Ue,2);Ge.__click=function(...I){_i?.apply(this,I)};var me=S(Ge,2);me.__click=g;var Xe=S(fe,2),jt=w(Xe);Xu(jt,{onEngineLineHover:p});var Yt=S(Xe,2),Mt=w(Yt);let It;var ks=w(Mt);Df(ks,{onArrowsChanged:d,get highlightedArrowUci(){return a(r)}});var We=S(Mt,2);let Ee;var bt=w(We);Jf(bt,{get platformLabel(){return a(q)}}),Q(I=>{Y=_e(Re,1,"color-btn svelte-9k08f",null,Y,{active:Me.playerColor==="white"}),R(ye,`${a(E)?.username??""} as White`),ve=_e(ke,1,"color-btn svelte-9k08f",null,ve,{active:Me.playerColor==="black"}),R(Se,`${a(E)?.username??""} as Black`),z!==(z=Me.timeControl??"")&&(oe.value=(oe.__value=Me.timeControl??"")??"",lo(oe,Me.timeControl??"")),R($e,a(E)?.username),R(Qe,`Â· ${I??""} games`),R(it,a(C)),Vt=_e(dt,1,"recent-games-dropdown svelte-9k08f",null,Vt,{open:a(N)}),fs=_e(Rt,1,"mode-btn svelte-9k08f",null,fs,{active:Me.activeMode==="explorer"}),$=_e(M,1,"mode-btn svelte-9k08f",null,$,{active:Me.activeMode==="search"}),It=Ws(Mt,"",It,{display:Me.activeMode==="explorer"?"contents":"none"}),Ee=Ws(We,"",Ee,{display:Me.activeMode==="search"?"contents":"none"})},[()=>a(E)?.gameCount.toLocaleString()]),T(s,H),Ms()}gn(["click","change"]);var ch=F("<!> <!>",1);function uh(s,e){As(e,!0);let t=D("setup"),r=D(ut([]));async function n(){try{h(r,await pi(),!0)}catch(g){console.error("Failed to load cached players:",g)}}n();function i(g){Zu(g),_i(),h(t,"workspace")}async function o(){Ju(),_i(),of();try{h(r,await pi(),!0)}catch(g){console.error("Failed to refresh cached players:",g)}h(t,"setup")}function l(g){h(r,g,!0)}var c=ch(),u=et(c);{var d=g=>{du(g,{get cachedPlayers(){return a(r)},onEnterWorkspace:i,onCachedPlayersChanged:l})},p=g=>{lh(g,{onBack:o})};we(u,g=>{a(t)==="setup"?g(d):g(p,!1)})}var f=S(u,2);Nu(f),T(s,c),Ms()}Ec();rc(uh,{target:document.getElementById("app")});
