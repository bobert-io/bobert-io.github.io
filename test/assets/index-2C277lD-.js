(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const oi=!1;var Si=Array.isArray,Ko=Array.prototype.indexOf,Or=Array.prototype.includes,Dn=Array.from,Ho=Object.defineProperty,Tr=Object.getOwnPropertyDescriptor,Wo=Object.getOwnPropertyDescriptors,zo=Object.prototype,Vo=Array.prototype,_a=Object.getPrototypeOf,Qi=Object.isExtensible;function jo(s){for(var e=0;e<s.length;e++)s[e]()}function ba(){var s,e,t=new Promise((r,n)=>{s=r,e=n});return{promise:t,resolve:s,reject:e}}function Yo(s,e){if(Array.isArray(s))return s;if(!(Symbol.iterator in s))return Array.from(s);const t=[];for(const r of s)if(t.push(r),t.length===e)break;return t}const Ct=2,Pn=4,hn=8,wa=1<<24,Ws=16,ws=32,Sr=64,Ci=128,as=512,_t=1024,xt=2048,bs=4096,ts=8192,$s=16384,xi=32768,Rr=65536,Xi=1<<17,ya=1<<18,Wr=1<<19,ka=1<<20,Ns=1<<25,Er=32768,li=1<<21,Pi=1<<22,Js=1<<23,wr=Symbol("$state"),Qo=Symbol("legacy props"),Xo=Symbol(""),Ir=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Ea(s){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Zo(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Jo(s,e,t){throw new Error("https://svelte.dev/e/each_key_duplicate")}function el(s){throw new Error("https://svelte.dev/e/effect_in_teardown")}function tl(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function sl(s){throw new Error("https://svelte.dev/e/effect_orphan")}function rl(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function nl(s){throw new Error("https://svelte.dev/e/props_invalid_value")}function il(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function al(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function ol(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ll(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const cl=1,ul=2,Sa=4,fl=8,hl=16,dl=1,vl=4,pl=8,gl=16,ml=1,_l=2,St=Symbol(),bl="http://www.w3.org/1999/xhtml";function wl(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function yl(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Ca(s){return s===this.v}function kl(s,e){return s!=s?e==e:s!==e||s!==null&&typeof s=="object"||typeof s=="function"}function xa(s){return!kl(s,this.v)}let El=!1,zt=null;function Nr(s){zt=s}function As(s,e=!1,t){zt={p:zt,i:!1,c:null,e:null,s,x:null,l:null}}function Is(s){var e=zt,t=e.e;if(t!==null){e.e=null;for(var r of t)Va(r)}return s!==void 0&&(e.x=s),e.i=!0,zt=e.p,s??{}}function Pa(){return!0}let vr=[];function qa(){var s=vr;vr=[],jo(s)}function Fs(s){if(vr.length===0&&!sn){var e=vr;queueMicrotask(()=>{e===vr&&qa()})}vr.push(s)}function Sl(){for(;vr.length>0;)qa()}function Aa(s){var e=De;if(e===null)return be.f|=Js,s;if((e.f&xi)===0){if((e.f&Ci)===0)throw s;e.b.error(s)}else $r(s,e)}function $r(s,e){for(;e!==null;){if((e.f&Ci)!==0)try{e.b.error(s);return}catch(t){s=t}e=e.parent}throw s}const Cl=-7169;function nt(s,e){s.f=s.f&Cl|e}function qi(s){(s.f&as)!==0||s.deps===null?nt(s,_t):nt(s,bs)}function Ia(s){if(s!==null)for(const e of s)(e.f&Ct)===0||(e.f&Er)===0||(e.f^=Er,Ia(e.deps))}function Ma(s,e,t){(s.f&xt)!==0?e.add(s):(s.f&bs)!==0&&t.add(s),Ia(s.deps),nt(s,_t)}const gn=new Set;let Le=null,ci=null,ps=null,Gt=[],On=null,ui=!1,sn=!1;class er{committed=!1;current=new Map;previous=new Map;#e=new Set;#s=new Set;#t=0;#a=0;#n=null;#r=new Set;#i=new Set;#o=new Map;is_fork=!1;#l=!1;is_deferred(){return this.is_fork||this.#a>0}skip_effect(e){this.#o.has(e)||this.#o.set(e,{d:[],m:[]})}unskip_effect(e){var t=this.#o.get(e);if(t){this.#o.delete(e);for(var r of t.d)nt(r,xt),ms(r);for(r of t.m)nt(r,bs),ms(r)}}process(e){Gt=[],this.apply();var t=[],r=[];for(const n of e)this.#c(n,t,r);if(this.is_deferred()){this.#u(r),this.#u(t);for(const[n,i]of this.#o)Oa(n,i)}else{for(const n of this.#e)n();this.#e.clear(),this.#t===0&&this.#f(),ci=this,Le=null,Zi(r),Zi(t),ci=null,this.#n?.resolve()}ps=null}#c(e,t,r){e.f^=_t;for(var n=e.first,i=null;n!==null;){var o=n.f,l=(o&(ws|Sr))!==0,c=l&&(o&_t)!==0,u=c||(o&ts)!==0||this.#o.has(n);if(!u&&n.fn!==null){l?n.f^=_t:i!==null&&(o&(Pn|hn|wa))!==0?i.b.defer_effect(n):(o&Pn)!==0?t.push(n):vn(n)&&((o&Ws)!==0&&this.#i.add(n),nn(n));var d=n.first;if(d!==null){n=d;continue}}var p=n.parent;for(n=n.next;n===null&&p!==null;)p===i&&(i=null),n=p.next,p=p.parent}}#u(e){for(var t=0;t<e.length;t+=1)Ma(e[t],this.#r,this.#i)}capture(e,t){t!==St&&!this.previous.has(e)&&this.previous.set(e,t),(e.f&Js)===0&&(this.current.set(e,e.v),ps?.set(e,e.v))}activate(){Le=this,this.apply()}deactivate(){Le===this&&(Le=null,ps=null)}flush(){if(this.activate(),Gt.length>0){if(Ta(),Le!==null&&Le!==this)return}else this.#t===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#s)e(this);this.#s.clear()}#f(){if(gn.size>1){this.previous.clear();var e=ps,t=!0;for(const n of gn){if(n===this){t=!1;continue}const i=[];for(const[l,c]of this.current){if(n.current.has(l))if(t&&c!==n.current.get(l))n.current.set(l,c);else continue;i.push(l)}if(i.length===0)continue;const o=[...n.current.keys()].filter(l=>!this.current.has(l));if(o.length>0){var r=Gt;Gt=[];const l=new Set,c=new Map;for(const u of i)La(u,o,l,c);if(Gt.length>0){Le=n,n.apply();for(const u of Gt)n.#c(u,[],[]);n.deactivate()}Gt=r}}Le=null,ps=e}this.committed=!0,gn.delete(this)}increment(e){this.#t+=1,e&&(this.#a+=1)}decrement(e){this.#t-=1,e&&(this.#a-=1),!this.#l&&(this.#l=!0,Fs(()=>{this.#l=!1,this.is_deferred()?Gt.length>0&&this.flush():this.revive()}))}revive(){for(const e of this.#r)this.#i.delete(e),nt(e,xt),ms(e);for(const e of this.#i)nt(e,bs),ms(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#s.add(e)}settled(){return(this.#n??=ba()).promise}static ensure(){if(Le===null){const e=Le=new er;gn.add(Le),sn||Fs(()=>{Le===e&&e.flush()})}return Le}apply(){}}function xl(s){var e=sn;sn=!0;try{for(var t;;){if(Sl(),Gt.length===0&&(Le?.flush(),Gt.length===0))return On=null,t;Ta()}}finally{sn=e}}function Ta(){ui=!0;var s=null;try{for(var e=0;Gt.length>0;){var t=er.ensure();if(e++>1e3){var r,n;Pl()}t.process(Gt),tr.clear()}}finally{Gt=[],ui=!1,On=null}}function Pl(){try{rl()}catch(s){$r(s,On)}}let Os=null;function Zi(s){var e=s.length;if(e!==0){for(var t=0;t<e;){var r=s[t++];if((r.f&($s|ts))===0&&vn(r)&&(Os=new Set,nn(r),r.deps===null&&r.first===null&&r.nodes===null&&(r.teardown===null&&r.ac===null?Qa(r):r.fn=null),Os?.size>0)){tr.clear();for(const n of Os){if((n.f&($s|ts))!==0)continue;const i=[n];let o=n.parent;for(;o!==null;)Os.has(o)&&(Os.delete(o),i.push(o)),o=o.parent;for(let l=i.length-1;l>=0;l--){const c=i[l];(c.f&($s|ts))===0&&nn(c)}}Os.clear()}}Os=null}}function La(s,e,t,r){if(!t.has(s)&&(t.add(s),s.reactions!==null))for(const n of s.reactions){const i=n.f;(i&Ct)!==0?La(n,e,t,r):(i&(Pi|Ws))!==0&&(i&xt)===0&&Da(n,e,r)&&(nt(n,xt),ms(n))}}function Da(s,e,t){const r=t.get(s);if(r!==void 0)return r;if(s.deps!==null)for(const n of s.deps){if(Or.call(e,n))return!0;if((n.f&Ct)!==0&&Da(n,e,t))return t.set(n,!0),!0}return t.set(s,!1),!1}function ms(s){for(var e=On=s;e.parent!==null;){e=e.parent;var t=e.f;if(ui&&e===De&&(t&Ws)!==0&&(t&ya)===0)return;if((t&(Sr|ws))!==0){if((t&_t)===0)return;e.f^=_t}}Gt.push(e)}function Oa(s,e){if(!((s.f&ws)!==0&&(s.f&_t)!==0)){(s.f&xt)!==0?e.d.push(s):(s.f&bs)!==0&&e.m.push(s),nt(s,_t);for(var t=s.first;t!==null;)Oa(t,e),t=t.next}}function ql(s){let e=0,t=nr(0),r;return()=>{Ii()&&(a(t),$n(()=>(e===0&&(r=or(()=>s(()=>xs(t)))),e+=1,()=>{Fs(()=>{e-=1,e===0&&(r?.(),r=void 0,xs(t))})})))}}var Al=Rr|Wr|Ci;function Il(s,e,t){new Ml(s,e,t)}class Ml{parent;is_pending=!1;#e;#s=null;#t;#a;#n;#r=null;#i=null;#o=null;#l=null;#c=null;#u=0;#f=0;#v=!1;#d=!1;#p=new Set;#g=new Set;#h=null;#y=ql(()=>(this.#h=nr(this.#u),()=>{this.#h=null}));constructor(e,t,r){this.#e=e,this.#t=t,this.#a=r,this.parent=De.b,this.is_pending=!!this.#t.pending,this.#n=Ti(()=>{De.b=this;{var n=this.#b();try{this.#r=ns(()=>r(n))}catch(i){this.error(i)}this.#f>0?this.#_():this.is_pending=!1}return()=>{this.#c?.remove()}},Al)}#k(){try{this.#r=ns(()=>this.#a(this.#e))}catch(e){this.error(e)}}#E(){const e=this.#t.pending;e&&(this.#i=ns(()=>e(this.#e)),Fs(()=>{var t=this.#b();this.#r=this.#m(()=>(er.ensure(),ns(()=>this.#a(t)))),this.#f>0?this.#_():(yr(this.#i,()=>{this.#i=null}),this.is_pending=!1)}))}#b(){var e=this.#e;return this.is_pending&&(this.#c=Bs(),this.#e.before(this.#c),e=this.#c),e}defer_effect(e){Ma(e,this.#p,this.#g)}is_rendered(){return!this.is_pending&&(!this.parent||this.parent.is_rendered())}has_pending_snippet(){return!!this.#t.pending}#m(e){var t=De,r=be,n=zt;qs(this.#n),ls(this.#n),Nr(this.#n.ctx);try{return e()}catch(i){return Aa(i),null}finally{qs(t),ls(r),Nr(n)}}#_(){const e=this.#t.pending;this.#r!==null&&(this.#l=document.createDocumentFragment(),this.#l.append(this.#c),Ja(this.#r,this.#l)),this.#i===null&&(this.#i=ns(()=>e(this.#e)))}#w(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#w(e);return}if(this.#f+=e,this.#f===0){this.is_pending=!1;for(const t of this.#p)nt(t,xt),ms(t);for(const t of this.#g)nt(t,bs),ms(t);this.#p.clear(),this.#g.clear(),this.#i&&yr(this.#i,()=>{this.#i=null}),this.#l&&(this.#e.before(this.#l),this.#l=null)}}update_pending_count(e){this.#w(e),this.#u+=e,!(!this.#h||this.#v)&&(this.#v=!0,Fs(()=>{this.#v=!1,this.#h&&Fr(this.#h,this.#u)}))}get_effect_pending(){return this.#y(),a(this.#h)}error(e){var t=this.#t.onerror;let r=this.#t.failed;if(this.#d||!t&&!r)throw e;this.#r&&(Wt(this.#r),this.#r=null),this.#i&&(Wt(this.#i),this.#i=null),this.#o&&(Wt(this.#o),this.#o=null);var n=!1,i=!1;const o=()=>{if(n){yl();return}n=!0,i&&ll(),er.ensure(),this.#u=0,this.#o!==null&&yr(this.#o,()=>{this.#o=null}),this.is_pending=this.has_pending_snippet(),this.#r=this.#m(()=>(this.#d=!1,ns(()=>this.#a(this.#e)))),this.#f>0?this.#_():this.is_pending=!1};Fs(()=>{try{i=!0,t?.(e,o),i=!1}catch(l){$r(l,this.#n&&this.#n.parent)}r&&(this.#o=this.#m(()=>{er.ensure(),this.#d=!0;try{return ns(()=>{r(this.#e,()=>e,()=>o)})}catch(l){return $r(l,this.#n.parent),null}finally{this.#d=!1}}))})}}function Tl(s,e,t,r){const n=Rn;var i=s.filter(f=>!f.settled);if(t.length===0&&i.length===0){r(e.map(n));return}var o=Le,l=De,c=Ll(),u=i.length===1?i[0].promise:i.length>1?Promise.all(i.map(f=>f.promise)):null;function d(f){c();try{r(f)}catch(g){(l.f&$s)===0&&$r(g,l)}o?.deactivate(),fi()}if(t.length===0){u.then(()=>d(e.map(n)));return}function p(){c(),Promise.all(t.map(f=>Dl(f))).then(f=>d([...e.map(n),...f])).catch(f=>$r(f,l))}u?u.then(p):p()}function Ll(){var s=De,e=be,t=zt,r=Le;return function(i=!0){qs(s),ls(e),Nr(t),i&&r?.activate()}}function fi(){qs(null),ls(null),Nr(null)}function Rn(s){var e=Ct|xt,t=be!==null&&(be.f&Ct)!==0?be:null;return De!==null&&(De.f|=Wr),{ctx:zt,deps:null,effects:null,equals:Ca,f:e,fn:s,reactions:null,rv:0,v:St,wv:0,parent:t??De,ac:null}}function Dl(s,e,t){let r=De;r===null&&Zo();var n=r.b,i=void 0,o=nr(St),l=!be,c=new Map;return Vl(()=>{var u=ba();i=u.promise;try{Promise.resolve(s()).then(u.resolve,u.reject).then(()=>{d===Le&&d.committed&&d.deactivate(),fi()})}catch(g){u.reject(g),fi()}var d=Le;if(l){var p=n.is_rendered();n.update_pending_count(1),d.increment(p),c.get(d)?.reject(Ir),c.delete(d),c.set(d,u)}const f=(g,E=void 0)=>{if(d.activate(),E)E!==Ir&&(o.f|=Js,Fr(o,E));else{(o.f&Js)!==0&&(o.f^=Js),Fr(o,g);for(const[q,C]of c){if(c.delete(q),q===d)break;C.reject(Ir)}}l&&(n.update_pending_count(-1),d.decrement(p))};u.promise.then(f,g=>f(null,g||"unknown"))}),Mi(()=>{for(const u of c.values())u.reject(Ir)}),new Promise(u=>{function d(p){function f(){p===i?u(o):d(i)}p.then(f,f)}d(i)})}function he(s){const e=Rn(s);return eo(e),e}function Ra(s){const e=Rn(s);return e.equals=xa,e}function Na(s){var e=s.effects;if(e!==null){s.effects=null;for(var t=0;t<e.length;t+=1)Wt(e[t])}}function Ol(s){for(var e=s.parent;e!==null;){if((e.f&Ct)===0)return(e.f&$s)===0?e:null;e=e.parent}return null}function Ai(s){var e,t=De;qs(Ol(s));try{s.f&=~Er,Na(s),e=no(s)}finally{qs(t)}return e}function $a(s){var e=Ai(s);if(!s.equals(e)&&(s.wv=so(),(!Le?.is_fork||s.deps===null)&&(s.v=e,s.deps===null))){nt(s,_t);return}ir||(ps!==null?(Ii()||Le?.is_fork)&&ps.set(s,e):qi(s))}let hi=new Set;const tr=new Map;let Fa=!1;function nr(s,e){var t={f:0,v:s,reactions:null,equals:Ca,rv:0,wv:0};return t}function D(s,e){const t=nr(s);return eo(t),t}function Rl(s,e=!1,t=!0){const r=nr(s);return e||(r.equals=xa),r}function h(s,e,t=!1){be!==null&&(!_s||(be.f&Xi)!==0)&&Pa()&&(be.f&(Ct|Ws|Pi|Xi))!==0&&(os===null||!Or.call(os,s))&&ol();let r=t?ut(e):e;return Fr(s,r)}function Fr(s,e){if(!s.equals(e)){var t=s.v;ir?tr.set(s,e):tr.set(s,t),s.v=e;var r=er.ensure();if(r.capture(s,t),(s.f&Ct)!==0){const n=s;(s.f&xt)!==0&&Ai(n),qi(n)}s.wv=so(),Ba(s,xt),De!==null&&(De.f&_t)!==0&&(De.f&(ws|Sr))===0&&(rs===null?Ql([s]):rs.push(s)),!r.is_fork&&hi.size>0&&!Fa&&Nl()}return e}function Nl(){Fa=!1;for(const s of hi)(s.f&_t)!==0&&nt(s,bs),vn(s)&&nn(s);hi.clear()}function $l(s,e=1){var t=a(s),r=e===1?t++:t--;return h(s,t),r}function xs(s){h(s,s.v+1)}function Ba(s,e){var t=s.reactions;if(t!==null)for(var r=t.length,n=0;n<r;n++){var i=t[n],o=i.f,l=(o&xt)===0;if(l&&nt(i,e),(o&Ct)!==0){var c=i;ps?.delete(c),(o&Er)===0&&(o&as&&(i.f|=Er),Ba(c,bs))}else l&&((o&Ws)!==0&&Os!==null&&Os.add(i),ms(i))}}function ut(s){if(typeof s!="object"||s===null||wr in s)return s;const e=_a(s);if(e!==zo&&e!==Vo)return s;var t=new Map,r=Si(s),n=D(0),i=Us,o=l=>{if(Us===i)return l();var c=be,u=Us;ls(null),sa(i);var d=l();return ls(c),sa(u),d};return r&&t.set("length",D(s.length)),new Proxy(s,{defineProperty(l,c,u){(!("value"in u)||u.configurable===!1||u.enumerable===!1||u.writable===!1)&&il();var d=t.get(c);return d===void 0?d=o(()=>{var p=D(u.value);return t.set(c,p),p}):h(d,u.value,!0),!0},deleteProperty(l,c){var u=t.get(c);if(u===void 0){if(c in l){const d=o(()=>D(St));t.set(c,d),xs(n)}}else h(u,St),xs(n);return!0},get(l,c,u){if(c===wr)return s;var d=t.get(c),p=c in l;if(d===void 0&&(!p||Tr(l,c)?.writable)&&(d=o(()=>{var g=ut(p?l[c]:St),E=D(g);return E}),t.set(c,d)),d!==void 0){var f=a(d);return f===St?void 0:f}return Reflect.get(l,c,u)},getOwnPropertyDescriptor(l,c){var u=Reflect.getOwnPropertyDescriptor(l,c);if(u&&"value"in u){var d=t.get(c);d&&(u.value=a(d))}else if(u===void 0){var p=t.get(c),f=p?.v;if(p!==void 0&&f!==St)return{enumerable:!0,configurable:!0,value:f,writable:!0}}return u},has(l,c){if(c===wr)return!0;var u=t.get(c),d=u!==void 0&&u.v!==St||Reflect.has(l,c);if(u!==void 0||De!==null&&(!d||Tr(l,c)?.writable)){u===void 0&&(u=o(()=>{var f=d?ut(l[c]):St,g=D(f);return g}),t.set(c,u));var p=a(u);if(p===St)return!1}return d},set(l,c,u,d){var p=t.get(c),f=c in l;if(r&&c==="length")for(var g=u;g<p.v;g+=1){var E=t.get(g+"");E!==void 0?h(E,St):g in l&&(E=o(()=>D(St)),t.set(g+"",E))}if(p===void 0)(!f||Tr(l,c)?.writable)&&(p=o(()=>D(void 0)),h(p,ut(u)),t.set(c,p));else{f=p.v!==St;var q=o(()=>ut(u));h(p,q)}var C=Reflect.getOwnPropertyDescriptor(l,c);if(C?.set&&C.set.call(d,u),!f){if(r&&typeof c=="string"){var N=t.get("length"),j=Number(c);Number.isInteger(j)&&j>=N.v&&h(N,j+1)}xs(n)}return!0},ownKeys(l){a(n);var c=Reflect.ownKeys(l).filter(p=>{var f=t.get(p);return f===void 0||f.v!==St});for(var[u,d]of t)d.v!==St&&!(u in l)&&c.push(u);return c},setPrototypeOf(){al()}})}function Ji(s){try{if(s!==null&&typeof s=="object"&&wr in s)return s[wr]}catch{}return s}function Fl(s,e){return Object.is(Ji(s),Ji(e))}var rn,Ua,Ga,Ka;function Bl(){if(rn===void 0){rn=window,Ua=/Firefox/.test(navigator.userAgent);var s=Element.prototype,e=Node.prototype,t=Text.prototype;Ga=Tr(e,"firstChild").get,Ka=Tr(e,"nextSibling").get,Qi(s)&&(s.__click=void 0,s.__className=void 0,s.__attributes=null,s.__style=void 0,s.__e=void 0),Qi(t)&&(t.__t=void 0)}}function Bs(s=""){return document.createTextNode(s)}function qn(s){return Ga.call(s)}function dn(s){return Ka.call(s)}function w(s,e){return qn(s)}function et(s,e=!1){{var t=qn(s);return t instanceof Comment&&t.data===""?dn(t):t}}function S(s,e=1,t=!1){let r=s;for(;e--;)r=dn(r);return r}function Ul(s){s.textContent=""}function Ha(){return!1}let ea=!1;function Gl(){ea||(ea=!0,document.addEventListener("reset",s=>{Promise.resolve().then(()=>{if(!s.defaultPrevented)for(const e of s.target.elements)e.__on_r?.()})},{capture:!0}))}function Nn(s){var e=be,t=De;ls(null),qs(null);try{return s()}finally{ls(e),qs(t)}}function Wa(s,e,t,r=t){s.addEventListener(e,()=>Nn(t));const n=s.__on_r;n?s.__on_r=()=>{n(),r(!0)}:s.__on_r=()=>r(!0),Gl()}function za(s){De===null&&(be===null&&sl(),tl()),ir&&el()}function Kl(s,e){var t=e.last;t===null?e.last=e.first=s:(t.next=s,s.prev=t,e.last=s)}function Ms(s,e,t){var r=De;r!==null&&(r.f&ts)!==0&&(s|=ts);var n={ctx:zt,deps:null,nodes:null,f:s|xt|as,first:null,fn:e,last:null,next:null,parent:r,b:r&&r.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{nn(n),n.f|=xi}catch(l){throw Wt(n),l}else e!==null&&ms(n);var i=n;if(t&&i.deps===null&&i.teardown===null&&i.nodes===null&&i.first===i.last&&(i.f&Wr)===0&&(i=i.first,(s&Ws)!==0&&(s&Rr)!==0&&i!==null&&(i.f|=Rr)),i!==null&&(i.parent=r,r!==null&&Kl(i,r),be!==null&&(be.f&Ct)!==0&&(s&Sr)===0)){var o=be;(o.effects??=[]).push(i)}return n}function Ii(){return be!==null&&!_s}function Mi(s){const e=Ms(hn,null,!1);return nt(e,_t),e.teardown=s,e}function ct(s){za();var e=De.f,t=!be&&(e&ws)!==0&&(e&xi)===0;if(t){var r=zt;(r.e??=[]).push(s)}else return Va(s)}function Va(s){return Ms(Pn|ka,s,!1)}function Hl(s){return za(),Ms(hn|ka,s,!0)}function Wl(s){er.ensure();const e=Ms(Sr|Wr,s,!0);return(t={})=>new Promise(r=>{t.outro?yr(e,()=>{Wt(e),r(void 0)}):(Wt(e),r(void 0))})}function zl(s){return Ms(Pn,s,!1)}function Vl(s){return Ms(Pi|Wr,s,!0)}function $n(s,e=0){return Ms(hn|e,s,!0)}function Q(s,e=[],t=[],r=[]){Tl(r,e,t,n=>{Ms(hn,()=>s(...n.map(a)),!0)})}function Ti(s,e=0){var t=Ms(Ws|e,s,!0);return t}function ns(s){return Ms(ws|Wr,s,!0)}function ja(s){var e=s.teardown;if(e!==null){const t=ir,r=be;ta(!0),ls(null);try{e.call(null)}finally{ta(t),ls(r)}}}function Ya(s,e=!1){var t=s.first;for(s.first=s.last=null;t!==null;){const n=t.ac;n!==null&&Nn(()=>{n.abort(Ir)});var r=t.next;(t.f&Sr)!==0?t.parent=null:Wt(t,e),t=r}}function jl(s){for(var e=s.first;e!==null;){var t=e.next;(e.f&ws)===0&&Wt(e),e=t}}function Wt(s,e=!0){var t=!1;(e||(s.f&ya)!==0)&&s.nodes!==null&&s.nodes.end!==null&&(Yl(s.nodes.start,s.nodes.end),t=!0),Ya(s,e&&!t),An(s,0),nt(s,$s);var r=s.nodes&&s.nodes.t;if(r!==null)for(const i of r)i.stop();ja(s);var n=s.parent;n!==null&&n.first!==null&&Qa(s),s.next=s.prev=s.teardown=s.ctx=s.deps=s.fn=s.nodes=s.ac=null}function Yl(s,e){for(;s!==null;){var t=s===e?null:dn(s);s.remove(),s=t}}function Qa(s){var e=s.parent,t=s.prev,r=s.next;t!==null&&(t.next=r),r!==null&&(r.prev=t),e!==null&&(e.first===s&&(e.first=r),e.last===s&&(e.last=t))}function yr(s,e,t=!0){var r=[];Xa(s,r,!0);var n=()=>{t&&Wt(s),e&&e()},i=r.length;if(i>0){var o=()=>--i||n();for(var l of r)l.out(o)}else n()}function Xa(s,e,t){if((s.f&ts)===0){s.f^=ts;var r=s.nodes&&s.nodes.t;if(r!==null)for(const l of r)(l.is_global||t)&&e.push(l);for(var n=s.first;n!==null;){var i=n.next,o=(n.f&Rr)!==0||(n.f&ws)!==0&&(s.f&Ws)!==0;Xa(n,e,o?t:!1),n=i}}}function Li(s){Za(s,!0)}function Za(s,e){if((s.f&ts)!==0){s.f^=ts,(s.f&_t)===0&&(nt(s,xt),ms(s));for(var t=s.first;t!==null;){var r=t.next,n=(t.f&Rr)!==0||(t.f&ws)!==0;Za(t,n?e:!1),t=r}var i=s.nodes&&s.nodes.t;if(i!==null)for(const o of i)(o.is_global||e)&&o.in()}}function Ja(s,e){if(s.nodes)for(var t=s.nodes.start,r=s.nodes.end;t!==null;){var n=t===r?null:dn(t);e.append(t),t=n}}let yn=!1,ir=!1;function ta(s){ir=s}let be=null,_s=!1;function ls(s){be=s}let De=null;function qs(s){De=s}let os=null;function eo(s){be!==null&&(os===null?os=[s]:os.push(s))}let Kt=null,Zt=0,rs=null;function Ql(s){rs=s}let to=1,pr=0,Us=pr;function sa(s){Us=s}function so(){return++to}function vn(s){var e=s.f;if((e&xt)!==0)return!0;if(e&Ct&&(s.f&=~Er),(e&bs)!==0){for(var t=s.deps,r=t.length,n=0;n<r;n++){var i=t[n];if(vn(i)&&$a(i),i.wv>s.wv)return!0}(e&as)!==0&&ps===null&&nt(s,_t)}return!1}function ro(s,e,t=!0){var r=s.reactions;if(r!==null&&!(os!==null&&Or.call(os,s)))for(var n=0;n<r.length;n++){var i=r[n];(i.f&Ct)!==0?ro(i,e,!1):e===i&&(t?nt(i,xt):(i.f&_t)!==0&&nt(i,bs),ms(i))}}function no(s){var e=Kt,t=Zt,r=rs,n=be,i=os,o=zt,l=_s,c=Us,u=s.f;Kt=null,Zt=0,rs=null,be=(u&(ws|Sr))===0?s:null,os=null,Nr(s.ctx),_s=!1,Us=++pr,s.ac!==null&&(Nn(()=>{s.ac.abort(Ir)}),s.ac=null);try{s.f|=li;var d=s.fn,p=d(),f=s.deps,g=Le?.is_fork;if(Kt!==null){var E;if(g||An(s,Zt),f!==null&&Zt>0)for(f.length=Zt+Kt.length,E=0;E<Kt.length;E++)f[Zt+E]=Kt[E];else s.deps=f=Kt;if(Ii()&&(s.f&as)!==0)for(E=Zt;E<f.length;E++)(f[E].reactions??=[]).push(s)}else!g&&f!==null&&Zt<f.length&&(An(s,Zt),f.length=Zt);if(Pa()&&rs!==null&&!_s&&f!==null&&(s.f&(Ct|bs|xt))===0)for(E=0;E<rs.length;E++)ro(rs[E],s);if(n!==null&&n!==s){if(pr++,n.deps!==null)for(let q=0;q<t;q+=1)n.deps[q].rv=pr;if(e!==null)for(const q of e)q.rv=pr;rs!==null&&(r===null?r=rs:r.push(...rs))}return(s.f&Js)!==0&&(s.f^=Js),p}catch(q){return Aa(q)}finally{s.f^=li,Kt=e,Zt=t,rs=r,be=n,os=i,Nr(o),_s=l,Us=c}}function Xl(s,e){let t=e.reactions;if(t!==null){var r=Ko.call(t,s);if(r!==-1){var n=t.length-1;n===0?t=e.reactions=null:(t[r]=t[n],t.pop())}}if(t===null&&(e.f&Ct)!==0&&(Kt===null||!Or.call(Kt,e))){var i=e;(i.f&as)!==0&&(i.f^=as,i.f&=~Er),qi(i),Na(i),An(i,0)}}function An(s,e){var t=s.deps;if(t!==null)for(var r=e;r<t.length;r++)Xl(s,t[r])}function nn(s){var e=s.f;if((e&$s)===0){nt(s,_t);var t=De,r=yn;De=s,yn=!0;try{(e&(Ws|wa))!==0?jl(s):Ya(s),ja(s);var n=no(s);s.teardown=typeof n=="function"?n:null,s.wv=to;var i;oi&&El&&(s.f&xt)!==0&&s.deps}finally{yn=r,De=t}}}async function io(){await Promise.resolve(),xl()}function a(s){var e=s.f,t=(e&Ct)!==0;if(be!==null&&!_s){var r=De!==null&&(De.f&$s)!==0;if(!r&&(os===null||!Or.call(os,s))){var n=be.deps;if((be.f&li)!==0)s.rv<pr&&(s.rv=pr,Kt===null&&n!==null&&n[Zt]===s?Zt++:Kt===null?Kt=[s]:Kt.push(s));else{(be.deps??=[]).push(s);var i=s.reactions;i===null?s.reactions=[be]:Or.call(i,be)||i.push(be)}}}if(ir&&tr.has(s))return tr.get(s);if(t){var o=s;if(ir){var l=o.v;return((o.f&_t)===0&&o.reactions!==null||oo(o))&&(l=Ai(o)),tr.set(o,l),l}var c=(o.f&as)===0&&!_s&&be!==null&&(yn||(be.f&as)!==0),u=o.deps===null;vn(o)&&(c&&(o.f|=as),$a(o)),c&&!u&&ao(o)}if(ps?.has(s))return ps.get(s);if((s.f&Js)!==0)throw s.v;return s.v}function ao(s){if(s.deps!==null){s.f|=as;for(const e of s.deps)(e.reactions??=[]).push(s),(e.f&Ct)!==0&&(e.f&as)===0&&ao(e)}}function oo(s){if(s.v===St)return!0;if(s.deps===null)return!1;for(const e of s.deps)if(tr.has(e)||(e.f&Ct)!==0&&oo(e))return!0;return!1}function or(s){var e=_s;try{return _s=!0,s()}finally{_s=e}}const Zl=["touchstart","touchmove"];function Jl(s){return Zl.includes(s)}const lo=new Set,di=new Set;function ec(s,e,t,r={}){function n(i){if(r.capture||Zr.call(e,i),!i.cancelBubble)return Nn(()=>t?.call(this,i))}return s.startsWith("pointer")||s.startsWith("touch")||s==="wheel"?Fs(()=>{e.addEventListener(s,n,r)}):e.addEventListener(s,n,r),n}function Ks(s,e,t,r,n){var i={capture:r,passive:n},o=ec(s,e,t,i);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Mi(()=>{e.removeEventListener(s,o,i)})}function pn(s){for(var e=0;e<s.length;e++)lo.add(s[e]);for(var t of di)t(s)}let ra=null;function Zr(s){var e=this,t=e.ownerDocument,r=s.type,n=s.composedPath?.()||[],i=n[0]||s.target;ra=s;var o=0,l=ra===s&&s.__root;if(l){var c=n.indexOf(l);if(c!==-1&&(e===document||e===window)){s.__root=e;return}var u=n.indexOf(e);if(u===-1)return;c<=u&&(o=c)}if(i=n[o]||s.target,i!==e){Ho(s,"currentTarget",{configurable:!0,get(){return i||t}});var d=be,p=De;ls(null),qs(null);try{for(var f,g=[];i!==null;){var E=i.assignedSlot||i.parentNode||i.host||null;try{var q=i["__"+r];q!=null&&(!i.disabled||s.target===i)&&q.call(i,s)}catch(C){f?g.push(C):f=C}if(s.cancelBubble||E===e||E===null)break;i=E}if(f){for(let C of g)queueMicrotask(()=>{throw C});throw f}}finally{s.__root=e,delete s.currentTarget,ls(d),qs(p)}}}function tc(s){var e=document.createElement("template");return e.innerHTML=s.replaceAll("<!>","<!---->"),e.content}function In(s,e){var t=De;t.nodes===null&&(t.nodes={start:s,end:e,a:null,t:null})}function F(s,e){var t=(e&ml)!==0,r=(e&_l)!==0,n,i=!s.startsWith("<!>");return()=>{n===void 0&&(n=tc(i?s:"<!>"+s),t||(n=qn(n)));var o=r||Ua?document.importNode(n,!0):n.cloneNode(!0);if(t){var l=qn(o),c=o.lastChild;In(l,c)}else In(o,o);return o}}function ar(s=""){{var e=Bs(s+"");return In(e,e),e}}function Hs(){var s=document.createDocumentFragment(),e=document.createComment(""),t=Bs();return s.append(e,t),In(e,t),s}function T(s,e){s!==null&&s.before(e)}function R(s,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(s.__t??=s.nodeValue)&&(s.__t=t,s.nodeValue=t+"")}function sc(s,e){return rc(s,e)}const Pr=new Map;function rc(s,{target:e,anchor:t,props:r={},events:n,context:i,intro:o=!0}){Bl();var l=new Set,c=p=>{for(var f=0;f<p.length;f++){var g=p[f];if(!l.has(g)){l.add(g);var E=Jl(g);e.addEventListener(g,Zr,{passive:E});var q=Pr.get(g);q===void 0?(document.addEventListener(g,Zr,{passive:E}),Pr.set(g,1)):Pr.set(g,q+1)}}};c(Dn(lo)),di.add(c);var u=void 0,d=Wl(()=>{var p=t??e.appendChild(Bs());return Il(p,{pending:()=>{}},f=>{As({});var g=zt;i&&(g.c=i),n&&(r.$$events=n),u=s(f,r)||{},Is()}),()=>{for(var f of l){e.removeEventListener(f,Zr);var g=Pr.get(f);--g===0?(document.removeEventListener(f,Zr),Pr.delete(f)):Pr.set(f,g)}di.delete(c),p!==t&&p.parentNode?.removeChild(p)}});return nc.set(u,d),u}let nc=new WeakMap;class ic{anchor;#e=new Map;#s=new Map;#t=new Map;#a=new Set;#n=!0;constructor(e,t=!0){this.anchor=e,this.#n=t}#r=()=>{var e=Le;if(this.#e.has(e)){var t=this.#e.get(e),r=this.#s.get(t);if(r)Li(r),this.#a.delete(t);else{var n=this.#t.get(t);n&&(this.#s.set(t,n.effect),this.#t.delete(t),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),r=n.effect)}for(const[i,o]of this.#e){if(this.#e.delete(i),i===e)break;const l=this.#t.get(o);l&&(Wt(l.effect),this.#t.delete(o))}for(const[i,o]of this.#s){if(i===t||this.#a.has(i))continue;const l=()=>{if(Array.from(this.#e.values()).includes(i)){var u=document.createDocumentFragment();Ja(o,u),u.append(Bs()),this.#t.set(i,{effect:o,fragment:u})}else Wt(o);this.#a.delete(i),this.#s.delete(i)};this.#n||!r?(this.#a.add(i),yr(o,l,!1)):l()}}};#i=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[r,n]of this.#t)t.includes(r)||(Wt(n.effect),this.#t.delete(r))};ensure(e,t){var r=Le,n=Ha();if(t&&!this.#s.has(e)&&!this.#t.has(e))if(n){var i=document.createDocumentFragment(),o=Bs();i.append(o),this.#t.set(e,{effect:ns(()=>t(o)),fragment:i})}else this.#s.set(e,ns(()=>t(this.anchor)));if(this.#e.set(r,e),n){for(const[l,c]of this.#s)l===e?r.unskip_effect(c):r.skip_effect(c);for(const[l,c]of this.#t)l===e?r.unskip_effect(c.effect):r.skip_effect(c.effect);r.oncommit(this.#r),r.ondiscard(this.#i)}else this.#r()}}function we(s,e,t=!1){var r=new ic(s),n=t?Rr:0;function i(o,l){r.ensure(o,l)}Ti(()=>{var o=!1;e((l,c=!0)=>{o=!0,i(c,l)}),o||i(!1,null)},n)}function Ps(s,e){return e}function ac(s,e,t){for(var r=[],n=e.length,i,o=e.length,l=0;l<n;l++){let p=e[l];yr(p,()=>{if(i){if(i.pending.delete(p),i.done.add(p),i.pending.size===0){var f=s.outrogroups;vi(Dn(i.done)),f.delete(i),f.size===0&&(s.outrogroups=null)}}else o-=1},!1)}if(o===0){var c=r.length===0&&t!==null;if(c){var u=t,d=u.parentNode;Ul(d),d.append(u),s.items.clear()}vi(e,!c)}else i={pending:new Set(e),done:new Set},(s.outrogroups??=new Set).add(i)}function vi(s,e=!0){for(var t=0;t<s.length;t++)Wt(s[t],e)}var na;function Ot(s,e,t,r,n,i=null){var o=s,l=new Map,c=(e&Sa)!==0;if(c){var u=s;o=u.appendChild(Bs())}var d=null,p=Ra(()=>{var N=t();return Si(N)?N:N==null?[]:Dn(N)}),f,g=!0;function E(){C.fallback=d,oc(C,f,o,e,r),d!==null&&(f.length===0?(d.f&Ns)===0?Li(d):(d.f^=Ns,Jr(d,null,o)):yr(d,()=>{d=null}))}var q=Ti(()=>{f=a(p);for(var N=f.length,j=new Set,x=Le,L=Ha(),B=0;B<N;B+=1){var J=f[B],ee=r(J,B),W=g?null:l.get(ee);W?(W.v&&Fr(W.v,J),W.i&&Fr(W.i,B),L&&x.unskip_effect(W.e)):(W=lc(l,g?o:na??=Bs(),J,ee,B,n,e,t),g||(W.e.f|=Ns),l.set(ee,W)),j.add(ee)}if(N===0&&i&&!d&&(g?d=ns(()=>i(o)):(d=ns(()=>i(na??=Bs())),d.f|=Ns)),N>j.size&&Jo(),!g)if(L){for(const[ce,ue]of l)j.has(ce)||x.skip_effect(ue.e);x.oncommit(E),x.ondiscard(()=>{})}else E();a(p)}),C={effect:q,items:l,outrogroups:null,fallback:d};g=!1}function jr(s){for(;s!==null&&(s.f&ws)===0;)s=s.next;return s}function oc(s,e,t,r,n){var i=(r&fl)!==0,o=e.length,l=s.items,c=jr(s.effect.first),u,d=null,p,f=[],g=[],E,q,C,N;if(i)for(N=0;N<o;N+=1)E=e[N],q=n(E,N),C=l.get(q).e,(C.f&Ns)===0&&(C.nodes?.a?.measure(),(p??=new Set).add(C));for(N=0;N<o;N+=1){if(E=e[N],q=n(E,N),C=l.get(q).e,s.outrogroups!==null)for(const ue of s.outrogroups)ue.pending.delete(C),ue.done.delete(C);if((C.f&Ns)!==0)if(C.f^=Ns,C===c)Jr(C,null,t);else{var j=d?d.next:c;C===s.effect.last&&(s.effect.last=C.prev),C.prev&&(C.prev.next=C.next),C.next&&(C.next.prev=C.prev),js(s,d,C),js(s,C,j),Jr(C,j,t),d=C,f=[],g=[],c=jr(d.next);continue}if((C.f&ts)!==0&&(Li(C),i&&(C.nodes?.a?.unfix(),(p??=new Set).delete(C))),C!==c){if(u!==void 0&&u.has(C)){if(f.length<g.length){var x=g[0],L;d=x.prev;var B=f[0],J=f[f.length-1];for(L=0;L<f.length;L+=1)Jr(f[L],x,t);for(L=0;L<g.length;L+=1)u.delete(g[L]);js(s,B.prev,J.next),js(s,d,B),js(s,J,x),c=x,d=J,N-=1,f=[],g=[]}else u.delete(C),Jr(C,c,t),js(s,C.prev,C.next),js(s,C,d===null?s.effect.first:d.next),js(s,d,C),d=C;continue}for(f=[],g=[];c!==null&&c!==C;)(u??=new Set).add(c),g.push(c),c=jr(c.next);if(c===null)continue}(C.f&Ns)===0&&f.push(C),d=C,c=jr(C.next)}if(s.outrogroups!==null){for(const ue of s.outrogroups)ue.pending.size===0&&(vi(Dn(ue.done)),s.outrogroups?.delete(ue));s.outrogroups.size===0&&(s.outrogroups=null)}if(c!==null||u!==void 0){var ee=[];if(u!==void 0)for(C of u)(C.f&ts)===0&&ee.push(C);for(;c!==null;)(c.f&ts)===0&&c!==s.fallback&&ee.push(c),c=jr(c.next);var W=ee.length;if(W>0){var ce=(r&Sa)!==0&&o===0?t:null;if(i){for(N=0;N<W;N+=1)ee[N].nodes?.a?.measure();for(N=0;N<W;N+=1)ee[N].nodes?.a?.fix()}ac(s,ee,ce)}}i&&Fs(()=>{if(p!==void 0)for(C of p)C.nodes?.a?.apply()})}function lc(s,e,t,r,n,i,o,l){var c=(o&cl)!==0?(o&hl)===0?Rl(t,!1,!1):nr(t):null,u=(o&ul)!==0?nr(n):null;return{v:c,i:u,e:ns(()=>(i(e,c??t,u??n,l),()=>{s.delete(r)}))}}function Jr(s,e,t){if(s.nodes)for(var r=s.nodes.start,n=s.nodes.end,i=e&&(e.f&Ns)===0?e.nodes.start:t;r!==null;){var o=dn(r);if(i.before(r),r===n)return;r=o}}function js(s,e,t){e===null?s.effect.first=t:e.next=t,t===null?s.effect.last=e:t.prev=e}const ia=[...` 	
\r\fÂ \v\uFEFF`];function cc(s,e,t){var r=s==null?"":""+s;if(e&&(r=r?r+" "+e:e),t){for(var n in t)if(t[n])r=r?r+" "+n:n;else if(r.length)for(var i=n.length,o=0;(o=r.indexOf(n,o))>=0;){var l=o+i;(o===0||ia.includes(r[o-1]))&&(l===r.length||ia.includes(r[l]))?r=(o===0?"":r.substring(0,o))+r.substring(l+1):o=l}}return r===""?null:r}function aa(s,e=!1){var t=e?" !important;":";",r="";for(var n in s){var i=s[n];i!=null&&i!==""&&(r+=" "+n+": "+i+t)}return r}function Vn(s){return s[0]!=="-"||s[1]!=="-"?s.toLowerCase():s}function uc(s,e){if(e){var t="",r,n;if(Array.isArray(e)?(r=e[0],n=e[1]):r=e,s){s=String(s).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,o=0,l=!1,c=[];r&&c.push(...Object.keys(r).map(Vn)),n&&c.push(...Object.keys(n).map(Vn));var u=0,d=-1;const q=s.length;for(var p=0;p<q;p++){var f=s[p];if(l?f==="/"&&s[p-1]==="*"&&(l=!1):i?i===f&&(i=!1):f==="/"&&s[p+1]==="*"?l=!0:f==='"'||f==="'"?i=f:f==="("?o++:f===")"&&o--,!l&&i===!1&&o===0){if(f===":"&&d===-1)d=p;else if(f===";"||p===q-1){if(d!==-1){var g=Vn(s.substring(u,d).trim());if(!c.includes(g)){f!==";"&&p++;var E=s.substring(u,p).trim();t+=" "+E+";"}}u=p+1,d=-1}}}}return r&&(t+=aa(r)),n&&(t+=aa(n,!0)),t=t.trim(),t===""?null:t}return s==null?null:String(s)}function _e(s,e,t,r,n,i){var o=s.__className;if(o!==t||o===void 0){var l=cc(t,r,i);l==null?s.removeAttribute("class"):s.className=l,s.__className=t}else if(i&&n!==i)for(var c in i){var u=!!i[c];(n==null||u!==!!n[c])&&s.classList.toggle(c,u)}return i}function jn(s,e={},t,r){for(var n in t){var i=t[n];e[n]!==i&&(t[n]==null?s.style.removeProperty(n):s.style.setProperty(n,i,r))}}function Gs(s,e,t,r){var n=s.__style;if(n!==e){var i=uc(e,r);i==null?s.removeAttribute("style"):s.style.cssText=i,s.__style=e}else r&&(Array.isArray(r)?(jn(s,t?.[0],r[0]),jn(s,t?.[1],r[1],"important")):jn(s,t,r));return r}function co(s,e,t=!1){if(s.multiple){if(e==null)return;if(!Si(e))return wl();for(var r of s.options)r.selected=e.includes(oa(r));return}for(r of s.options){var n=oa(r);if(Fl(n,e)){r.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function fc(s){var e=new MutationObserver(()=>{co(s,s.__value)});e.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Mi(()=>{e.disconnect()})}function oa(s){return"__value"in s?s.__value:s.value}const hc=Symbol("is custom element"),dc=Symbol("is html");function Mn(s,e,t,r){var n=vc(s);n[e]!==(n[e]=t)&&(e==="loading"&&(s[Xo]=t),t==null?s.removeAttribute(e):typeof t!="string"&&pc(s).includes(e)?s[e]=t:s.setAttribute(e,t))}function vc(s){return s.__attributes??={[hc]:s.nodeName.includes("-"),[dc]:s.namespaceURI===bl}}var la=new Map;function pc(s){var e=s.getAttribute("is")||s.nodeName,t=la.get(e);if(t)return t;la.set(e,t=[]);for(var r,n=s,i=Element.prototype;i!==n;){r=Wo(n);for(var o in r)r[o].set&&t.push(o);n=_a(n)}return t}function Yn(s,e,t=e){var r=new WeakSet;Wa(s,"input",async n=>{var i=n?s.defaultValue:s.value;if(i=Qn(s)?Xn(i):i,t(i),Le!==null&&r.add(Le),await io(),i!==(i=e())){var o=s.selectionStart,l=s.selectionEnd,c=s.value.length;if(s.value=i??"",l!==null){var u=s.value.length;o===l&&l===c&&u>c?(s.selectionStart=u,s.selectionEnd=u):(s.selectionStart=o,s.selectionEnd=Math.min(l,u))}}}),or(e)==null&&s.value&&(t(Qn(s)?Xn(s.value):s.value),Le!==null&&r.add(Le)),$n(()=>{var n=e();if(s===document.activeElement){var i=ci??Le;if(r.has(i))return}Qn(s)&&n===Xn(s.value)||s.type==="date"&&!n&&!s.value||n!==s.value&&(s.value=n??"")})}function gc(s,e,t=e){Wa(s,"change",r=>{var n=r?s.defaultChecked:s.checked;t(n)}),or(e)==null&&t(s.checked),$n(()=>{var r=e();s.checked=!!r})}function Qn(s){var e=s.type;return e==="number"||e==="range"}function Xn(s){return s===""?null:+s}function ca(s,e){return s===e||s?.[wr]===e}function Tn(s={},e,t,r){return zl(()=>{var n,i;return $n(()=>{n=i,i=[],or(()=>{s!==t(...i)&&(e(s,...i),n&&ca(t(...n),s)&&e(null,...n))})}),()=>{Fs(()=>{i&&ca(t(...i),s)&&e(null,...i)})}}),s}let mn=!1;function mc(s){var e=mn;try{return mn=!1,[s(),mn]}finally{mn=e}}function is(s,e,t,r){var n=(t&pl)!==0,i=(t&gl)!==0,o=r,l=!0,c=()=>(l&&(l=!1,o=i?or(r):r),o),u;if(n){var d=wr in s||Qo in s;u=Tr(s,e)?.set??(d&&e in s?j=>s[e]=j:void 0)}var p,f=!1;n?[p,f]=mc(()=>s[e]):p=s[e],p===void 0&&r!==void 0&&(p=c(),u&&(nl(),u(p)));var g;if(g=()=>{var j=s[e];return j===void 0?c():(l=!0,j)},(t&vl)===0)return g;if(u){var E=s.$$legacy;return(function(j,x){return arguments.length>0?((!x||E||f)&&u(x?g():j),j):g()})}var q=!1,C=((t&dl)!==0?Rn:Ra)(()=>(q=!1,g()));n&&a(C);var N=De;return(function(j,x){if(arguments.length>0){const L=x?a(C):n?ut(j):j;return h(C,L),q=!0,o!==void 0&&(o=L),j}return ir&&q||(N.f&$s)!==0?C.v:a(C)})}function Br(s){zt===null&&Ea(),ct(()=>{const e=or(s);if(typeof e=="function")return e})}function uo(s){zt===null&&Ea(),Br(()=>()=>or(s))}let sr=null,fo=0,pi=null;const Lr=new Map;let kn=null,En=0;function _c(){En=0,kn=setInterval(()=>{if(sr){if(En++,En>=3){console.warn("[db-client] SharedWorker unresponsive, reconnecting..."),wc();return}sr.postMessage({type:"ping"})}},1e3)}function bc(){kn&&(clearInterval(kn),kn=null)}function wc(){bc();for(const[,s]of Lr)s.reject(new Error("SharedWorker connection lost"));Lr.clear(),ho()}function ho(){sr=new SharedWorker(new URL(""+new URL("db-shared-worker-D6dryD4o.js",import.meta.url).href,import.meta.url),{type:"module"}).port,sr.onmessage=e=>{const t=e.data;if(t.type==="pong"){En=0;return}if(t.type==="reload"){pi?pi():location.reload();return}const{requestId:r}=t,n=Lr.get(r);if(n)switch(t.type){case"progress":n.onProgress?.(t.message);break;case"status":n.onBlockedByIngestion?.(t.status);break;case"result":Lr.delete(r),n.resolve(t.data);break;case"error":Lr.delete(r),t.error==="AbortError"?n.reject(new DOMException("Aborted","AbortError")):n.reject(new Error(t.error));break}},sr.start(),_c()}function yc(s){pi=null,ho()}function Ts(s,e){return new Promise((t,r)=>{if(!sr){r(new Error("SharedWorker not connected"));return}const n=fo++;Lr.set(n,{resolve:t,reject:r,onProgress:e?.onProgress,onBlockedByIngestion:e?.onBlockedByIngestion}),sr.postMessage({...s,requestId:n})})}async function gi(){return Ts({type:"listCachedPlayers"})}async function kc(s,e){return Ts({type:"clearPlayerData",username:s,platform:e})}async function Ec(){return Ts({type:"clearAllData"})}async function Sc(s,e,t,r,n,i){if(i?.aborted)throw new DOMException("Aborted","AbortError");const o=fo,l=()=>{sr?.postMessage({type:"cancel",cancelRequestId:o})};i&&i.addEventListener("abort",l,{once:!0});try{return await Ts({type:"ensureIngested",username:s,platform:e,since:t,until:r},{onProgress:n})}finally{i?.removeEventListener("abort",l)}}async function Cc(s,e,t,r,n,i,o,l,c){return Ts({type:"getContinuations",username:s,platform:e,since:t,until:r,moveSequence:n,playerColor:i,timeControl:o,includeTranspositions:l},{onBlockedByIngestion:c})}async function xc(s,e,t,r,n,i,o,l){return Ts({type:"searchByPosition",username:s,platform:e,since:t,until:r,pattern:n,playerColor:i,timeControl:o},{onBlockedByIngestion:l})}async function vo(s,e,t,r){return Ts({type:"getGamesMetadata",username:s,platform:e,gameIds:t},{onBlockedByIngestion:r})}async function po(s,e,t,r){return Ts({type:"getGamesMoves",username:s,platform:e,gameIds:t},{onBlockedByIngestion:r})}async function Pc(s,e,t,r,n,i,o){return Ts({type:"getRecentGames",username:s,platform:e,since:t,until:r,timeControl:n,limit:i},{onBlockedByIngestion:o})}async function qc(s,e,t,r,n){return Ts({type:"getAvailableTimeControls",username:s,platform:e,since:t,until:r},{onBlockedByIngestion:n})}const Ac="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Ac);function Ic(s){return s!==null?{comment:s,variations:[]}:{variations:[]}}function Mc(s,e,t,r,n){const i={move:s,variations:n};return e&&(i.suffix=e),t&&(i.nag=t),r!==null&&(i.comment=r),i}function Tc(...s){const[e,...t]=s;let r=e;for(const n of t)n!==null&&(r.variations=[n,...n.variations],n.variations=[],r=n);return e}function Lc(s,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const r=t.variations[0];if(!r){t.comment=e.marker.comment;break}t=r}}return{headers:s,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function Dc(s,e){function t(){this.constructor=s}t.prototype=e.prototype,s.prototype=new t}function Ur(s,e,t,r){var n=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(n,Ur.prototype),n.expected=e,n.found=t,n.location=r,n.name="SyntaxError",n}Dc(Ur,Error);function Zn(s,e,t){return t=t||" ",s.length>e?s:(e-=s.length,t+=t.repeat(e),s+t.slice(0,e))}Ur.prototype.format=function(s){var e="Error: "+this.message;if(this.location){var t=null,r;for(r=0;r<s.length;r++)if(s[r].source===this.location.source){t=s[r].text.split(/\r\n|\n|\r/g);break}var n=this.location.start,i=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(n):n,o=this.location.source+":"+i.line+":"+i.column;if(t){var l=this.location.end,c=Zn("",i.line.toString().length," "),u=t[n.line-1],d=n.line===l.line?l.column:u.length+1,p=d-n.column||1;e+=`
 --> `+o+`
`+c+` |
`+i.line+" | "+u+`
`+c+" | "+Zn("",n.column-1," ")+Zn("",p,"^")}else e+=`
 at `+o}return e};Ur.buildMessage=function(s,e){var t={literal:function(u){return'"'+n(u.text)+'"'},class:function(u){var d=u.parts.map(function(p){return Array.isArray(p)?i(p[0])+"-"+i(p[1]):i(p)});return"["+(u.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(u){return u.description}};function r(u){return u.charCodeAt(0).toString(16).toUpperCase()}function n(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+r(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+r(d)})}function i(u){return u.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+r(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+r(d)})}function o(u){return t[u.type](u)}function l(u){var d=u.map(o),p,f;if(d.sort(),d.length>0){for(p=1,f=1;p<d.length;p++)d[p-1]!==d[p]&&(d[f]=d[p],f++);d.length=f}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function c(u){return u?'"'+n(u)+'"':"end of input"}return"Expected "+l(s)+" but "+c(e)+" found."};function Oc(s,e){e=e!==void 0?e:{};var t={},r=e.grammarSource,n={pgn:X},i=X,o="[",l='"',c="]",u=".",d="O-O-O",p="O-O",f="0-0-0",g="0-0",E="$",q="{",C="}",N=";",j="(",x=")",L="1-0",B="0-1",J="1/2-1/2",ee="*",W=/^[a-zA-Z]/,ce=/^[^"]/,ue=/^[0-9]/,Me=/^[.]/,Re=/^[a-zA-Z1-8\-=]/,Y=/^[+#]/,ye=/^[!?]/,ke=/^[^}]/,de=/^[^\r\n]/,Se=/^[ \t\r\n]/,oe=qe("tag pair"),Ce=We("[",!1),xe=We('"',!1),z=We("]",!1),ve=qe("tag name"),Ne=yt([["a","z"],["A","Z"]],!1,!1),$e=qe("tag value"),Pe=yt(['"'],!0,!1),Qe=qe("move number"),Oe=yt([["0","9"]],!1,!1),it=We(".",!1),dt=yt(["."],!1,!1),Vt=qe("standard algebraic notation"),cs=We("O-O-O",!1),Ls=We("O-O",!1),ys=We("0-0-0",!1),us=We("0-0",!1),Rt=yt([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),fs=yt(["+","#"],!1,!1),I=qe("suffix annotation"),$=yt(["!","?"],!1,!1),pe=qe("NAG"),ge=We("$",!1),re=qe("brace comment"),ie=We("{",!1),ae=yt(["}"],!0,!1),Be=We("}",!1),Fe=qe("rest of line comment"),Ue=We(";",!1),Ge=yt(["\r",`
`],!0,!1),me=qe("variation"),Xe=We("(",!1),jt=We(")",!1),Yt=qe("game termination marker"),It=We("1-0",!1),Mt=We("0-1",!1),ks=We("1/2-1/2",!1),Ke=We("*",!1),Ee=qe("whitespace"),bt=yt([" ","	","\r",`
`],!1,!1),M=function(v,_){return Lc(v,_)},te=function(v){return Object.fromEntries(v)},le=function(v,_){return[v,_]},je=function(v,_){return{root:v,marker:_}},wt=function(v,_){return Tc(Ic(v),..._.flat())},ft=function(v,_,b,H,O){return Mc(v,_,b,H,O)},Qt=function(v){return v},hs=function(v){return v.replace(/[\r\n]+/g," ")},Nt=function(v){return v.trim()},Es=function(v){return v},vt=function(v,_){return{result:v,comment:_}},m=e.peg$currPos|0,$t=[{line:1,column:1}],at=m,He=e.peg$maxFailExpected||[],A=e.peg$silentFails|0,Ft;if(e.startRule){if(!(e.startRule in n))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');i=n[e.startRule]}function We(v,_){return{type:"literal",text:v,ignoreCase:_}}function yt(v,_,b){return{type:"class",parts:v,inverted:_,ignoreCase:b}}function Vs(){return{type:"end"}}function qe(v){return{type:"other",description:v}}function y(v){var _=$t[v],b;if(_)return _;if(v>=$t.length)b=$t.length-1;else for(b=v;!$t[--b];);for(_=$t[b],_={line:_.line,column:_.column};b<v;)s.charCodeAt(b)===10?(_.line++,_.column=1):_.column++,b++;return $t[v]=_,_}function P(v,_,b){var H=y(v),O=y(_),G={source:r,start:{offset:v,line:H.line,column:H.column},end:{offset:_,line:O.line,column:O.column}};return G}function k(v){m<at||(m>at&&(at=m,He=[]),He.push(v))}function K(v,_,b){return new Ur(Ur.buildMessage(v,_),v,_,b)}function X(){var v,_,b;return v=m,_=V(),b=Bt(),v=M(_,b),v}function V(){var v,_,b;for(v=m,_=[],b=ne();b!==t;)_.push(b),b=ne();return b=tt(),v=te(_),v}function ne(){var v,_,b,H,O,G,st;return A++,v=m,tt(),s.charCodeAt(m)===91?(_=o,m++):(_=t,A===0&&k(Ce)),_!==t?(tt(),b=Ze(),b!==t?(tt(),s.charCodeAt(m)===34?(H=l,m++):(H=t,A===0&&k(xe)),H!==t?(O=Tt(),s.charCodeAt(m)===34?(G=l,m++):(G=t,A===0&&k(xe)),G!==t?(tt(),s.charCodeAt(m)===93?(st=c,m++):(st=t,A===0&&k(z)),st!==t?v=le(b,O):(m=v,v=t)):(m=v,v=t)):(m=v,v=t)):(m=v,v=t)):(m=v,v=t),A--,v===t&&A===0&&k(oe),v}function Ze(){var v,_,b;if(A++,v=m,_=[],b=s.charAt(m),W.test(b)?m++:(b=t,A===0&&k(Ne)),b!==t)for(;b!==t;)_.push(b),b=s.charAt(m),W.test(b)?m++:(b=t,A===0&&k(Ne));else _=t;return _!==t?v=s.substring(v,m):v=_,A--,v===t&&(_=t,A===0&&k(ve)),v}function Tt(){var v,_,b;for(A++,v=m,_=[],b=s.charAt(m),ce.test(b)?m++:(b=t,A===0&&k(Pe));b!==t;)_.push(b),b=s.charAt(m),ce.test(b)?m++:(b=t,A===0&&k(Pe));return v=s.substring(v,m),A--,_=t,A===0&&k($e),v}function Bt(){var v,_,b;return v=m,_=Ae(),tt(),b=Ds(),b===t&&(b=null),tt(),v=je(_,b),v}function Ae(){var v,_,b,H;for(v=m,_=Pt(),_===t&&(_=null),b=[],H=Je();H!==t;)b.push(H),H=Je();return v=wt(_,b),v}function Je(){var v,_,b,H,O,G,st,Ut;if(v=m,tt(),Ss(),tt(),_=Cr(),_!==t){for(b=zr(),b===t&&(b=null),H=[],O=cr();O!==t;)H.push(O),O=cr();for(O=tt(),G=Pt(),G===t&&(G=null),st=[],Ut=ss();Ut!==t;)st.push(Ut),Ut=ss();v=ft(_,b,H,G,st)}else m=v,v=t;return v}function Ss(){var v,_,b,H,O,G;for(A++,v=m,_=[],b=s.charAt(m),ue.test(b)?m++:(b=t,A===0&&k(Oe));b!==t;)_.push(b),b=s.charAt(m),ue.test(b)?m++:(b=t,A===0&&k(Oe));if(s.charCodeAt(m)===46?(b=u,m++):(b=t,A===0&&k(it)),b!==t){for(H=tt(),O=[],G=s.charAt(m),Me.test(G)?m++:(G=t,A===0&&k(dt));G!==t;)O.push(G),G=s.charAt(m),Me.test(G)?m++:(G=t,A===0&&k(dt));_=[_,b,H,O],v=_}else m=v,v=t;return A--,v===t&&(_=t,A===0&&k(Qe)),v}function Cr(){var v,_,b,H,O,G;if(A++,v=m,_=m,s.substr(m,5)===d?(b=d,m+=5):(b=t,A===0&&k(cs)),b===t&&(s.substr(m,3)===p?(b=p,m+=3):(b=t,A===0&&k(Ls)),b===t&&(s.substr(m,5)===f?(b=f,m+=5):(b=t,A===0&&k(ys)),b===t&&(s.substr(m,3)===g?(b=g,m+=3):(b=t,A===0&&k(us)),b===t))))if(b=m,H=s.charAt(m),W.test(H)?m++:(H=t,A===0&&k(Ne)),H!==t){if(O=[],G=s.charAt(m),Re.test(G)?m++:(G=t,A===0&&k(Rt)),G!==t)for(;G!==t;)O.push(G),G=s.charAt(m),Re.test(G)?m++:(G=t,A===0&&k(Rt));else O=t;O!==t?(H=[H,O],b=H):(m=b,b=t)}else m=b,b=t;return b!==t?(H=s.charAt(m),Y.test(H)?m++:(H=t,A===0&&k(fs)),H===t&&(H=null),b=[b,H],_=b):(m=_,_=t),_!==t?v=s.substring(v,m):v=_,A--,v===t&&(_=t,A===0&&k(Vt)),v}function zr(){var v,_,b;for(A++,v=m,_=[],b=s.charAt(m),ye.test(b)?m++:(b=t,A===0&&k($));b!==t;)_.push(b),_.length>=2?b=t:(b=s.charAt(m),ye.test(b)?m++:(b=t,A===0&&k($)));return _.length<1?(m=v,v=t):v=_,A--,v===t&&(_=t,A===0&&k(I)),v}function cr(){var v,_,b,H,O;if(A++,v=m,tt(),s.charCodeAt(m)===36?(_=E,m++):(_=t,A===0&&k(ge)),_!==t){if(b=m,H=[],O=s.charAt(m),ue.test(O)?m++:(O=t,A===0&&k(Oe)),O!==t)for(;O!==t;)H.push(O),O=s.charAt(m),ue.test(O)?m++:(O=t,A===0&&k(Oe));else H=t;H!==t?b=s.substring(b,m):b=H,b!==t?v=Qt(b):(m=v,v=t)}else m=v,v=t;return A--,v===t&&A===0&&k(pe),v}function Pt(){var v;return v=ze(),v===t&&(v=Lt()),v}function ze(){var v,_,b,H,O;if(A++,v=m,s.charCodeAt(m)===123?(_=q,m++):(_=t,A===0&&k(ie)),_!==t){for(b=m,H=[],O=s.charAt(m),ke.test(O)?m++:(O=t,A===0&&k(ae));O!==t;)H.push(O),O=s.charAt(m),ke.test(O)?m++:(O=t,A===0&&k(ae));b=s.substring(b,m),s.charCodeAt(m)===125?(H=C,m++):(H=t,A===0&&k(Be)),H!==t?v=hs(b):(m=v,v=t)}else m=v,v=t;return A--,v===t&&(_=t,A===0&&k(re)),v}function Lt(){var v,_,b,H,O;if(A++,v=m,s.charCodeAt(m)===59?(_=N,m++):(_=t,A===0&&k(Ue)),_!==t){for(b=m,H=[],O=s.charAt(m),de.test(O)?m++:(O=t,A===0&&k(Ge));O!==t;)H.push(O),O=s.charAt(m),de.test(O)?m++:(O=t,A===0&&k(Ge));b=s.substring(b,m),v=Nt(b)}else m=v,v=t;return A--,v===t&&(_=t,A===0&&k(Fe)),v}function ss(){var v,_,b,H;return A++,v=m,tt(),s.charCodeAt(m)===40?(_=j,m++):(_=t,A===0&&k(Xe)),_!==t?(b=Ae(),b!==t?(tt(),s.charCodeAt(m)===41?(H=x,m++):(H=t,A===0&&k(jt)),H!==t?v=Es(b):(m=v,v=t)):(m=v,v=t)):(m=v,v=t),A--,v===t&&A===0&&k(me),v}function Ds(){var v,_,b;return A++,v=m,s.substr(m,3)===L?(_=L,m+=3):(_=t,A===0&&k(It)),_===t&&(s.substr(m,3)===B?(_=B,m+=3):(_=t,A===0&&k(Mt)),_===t&&(s.substr(m,7)===J?(_=J,m+=7):(_=t,A===0&&k(ks)),_===t&&(s.charCodeAt(m)===42?(_=ee,m++):(_=t,A===0&&k(Ke))))),_!==t?(tt(),b=Pt(),b===t&&(b=null),v=vt(_,b)):(m=v,v=t),A--,v===t&&(_=t,A===0&&k(Yt)),v}function tt(){var v,_;for(A++,v=[],_=s.charAt(m),Se.test(_)?m++:(_=t,A===0&&k(bt));_!==t;)v.push(_),_=s.charAt(m),Se.test(_)?m++:(_=t,A===0&&k(bt));return A--,_=t,A===0&&k(Ee),v}if(Ft=i(),e.peg$library)return{peg$result:Ft,peg$currPos:m,peg$FAILED:t,peg$maxFailExpected:He,peg$maxFailPos:at};if(Ft!==t&&m===s.length)return Ft;throw Ft!==t&&m<s.length&&k(Vs()),K(He,at<s.length?s.charAt(at):null,at<s.length?P(at,at+1):P(at,at))}const Sn=0xffffffffffffffffn;function Jn(s,e){return(s<<e|s>>64n-e)&0xffffffffffffffffn}function ua(s,e){return s*e&Sn}function Rc(s){return function(){let e=BigInt(s&Sn),t=BigInt(s>>64n&Sn);const r=ua(Jn(ua(e,5n),7n),9n);return t^=e,e=(Jn(e,24n)^t^t<<16n)&Sn,t=Jn(t,37n),s=t<<64n|e,r}}const Fn=Rc(0xa187eb39cdcaed8f31c4b365b102e01en),Nc=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Fn()))),$c=Array.from({length:8},()=>Fn()),Fc=Array.from({length:16},()=>Fn()),ei=Fn(),At="w",Xt="b",ot="p",mi="n",Cn="b",en="r",Zs="q",ht="k",ti="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class _n{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){const{color:r,piece:n,from:i,to:o,flags:l,captured:c,promotion:u}=t,d=gt(i),p=gt(o);this.color=r,this.piece=n,this.from=d,this.to=p,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=d+p,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const f in se)se[f]&l&&(this.flags+=hr[f]);c&&(this.captured=c),u&&(this.promotion=u,this.lan+=u)}isCapture(){return this.flags.indexOf(hr.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(hr.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(hr.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(hr.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(hr.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(hr.BIG_PAWN)>-1}}const Et=-1,hr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},se={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},_i={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Bc={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Uc={..._i,...Bc},Z={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},si={b:[16,32,17,15],w:[-16,-32,-17,-15]},fa={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Gc=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Kc=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Hc={p:1,n:2,b:4,r:8,q:16,k:32},Wc="pnbrqkPNBRQK",ha=[mi,Cn,en,Zs],zc=7,Vc=6,jc=1,Yc=0,bn={[ht]:se.KSIDE_CASTLE,[Zs]:se.QSIDE_CASTLE},Ys={w:[{square:Z.a1,flag:se.QSIDE_CASTLE},{square:Z.h1,flag:se.KSIDE_CASTLE}],b:[{square:Z.a8,flag:se.QSIDE_CASTLE},{square:Z.h8,flag:se.KSIDE_CASTLE}]},Qc={b:jc,w:Vc},ri="--";function kr(s){return s>>4}function an(s){return s&15}function go(s){return"0123456789".indexOf(s)!==-1}function gt(s){const e=an(s),t=kr(s);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function Yr(s){return s===At?Xt:At}function Xc(s){const e=s.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const r=parseInt(e[4],10);if(isNaN(r)||r<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const n=e[0].split("/");if(n.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<n.length;o++){let l=0,c=!1;for(let u=0;u<n[o].length;u++)if(go(n[o][u])){if(c)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(n[o][u],10),c=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[o][u]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,c=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const i=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:l}of i){if(!l.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(n[0]+n[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Zc(s,e){const t=s.from,r=s.to,n=s.piece;let i=0,o=0,l=0;for(let c=0,u=e.length;c<u;c++){const d=e[c].from,p=e[c].to,f=e[c].piece;n===f&&t!==d&&r===p&&(i++,kr(t)===kr(d)&&o++,an(t)===an(d)&&l++)}return i>0?o>0&&l>0?gt(t):l>0?gt(t).charAt(1):gt(t).charAt(0):""}function Qs(s,e,t,r,n,i=void 0,o=se.NORMAL){const l=kr(r);if(n===ot&&(l===zc||l===Yc))for(let c=0;c<ha.length;c++){const u=ha[c];s.push({color:e,from:t,to:r,piece:n,captured:i,promotion:u,flags:o|se.PROMOTION})}else s.push({color:e,from:t,to:r,piece:n,captured:i,flags:o})}function da(s){let e=s.charAt(0);return e>="a"&&e<="h"?s.match(/[a-h]\d.*[a-h]\d/)?void 0:ot:(e=e.toLowerCase(),e==="o"?ht:e)}function ni(s){return s.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class lr{_board=new Array(128);_turn=At;_header={};_kings={w:Et,b:Et};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=ti,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:Et,b:Et},this._turn=At,this._castling={w:0,b:0},this._epSquare=Et,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...Uc},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:r=!1}={}){let n=e.split(/\s+/);if(n.length>=2&&n.length<6){const l=["-","-","0","1"];e=n.concat(l.slice(-(6-n.length))).join(" ")}if(n=e.split(/\s+/),!t){const{ok:l,error:c}=Xc(e);if(!l)throw new Error(c)}const i=n[0];let o=0;this.clear({preserveHeaders:r});for(let l=0;l<i.length;l++){const c=i.charAt(l);if(c==="/")o+=8;else if(go(c))o+=parseInt(c,10);else{const u=c<"a"?At:Xt;this._put({type:c.toLowerCase(),color:u},gt(o)),o++}}this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=se.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=se.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=se.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=se.QSIDE_CASTLE),this._epSquare=n[3]==="-"?Et:Z[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let t=0,r="";for(let o=Z.a8;o<=Z.h1;o++){if(this._board[o]){t>0&&(r+=t,t=0);const{color:l,type:c}=this._board[o];r+=l===At?c.toUpperCase():c.toLowerCase()}else t++;o+1&136&&(t>0&&(r+=t),o!==Z.h1&&(r+="/"),t=0,o+=8)}let n="";this._castling[At]&se.KSIDE_CASTLE&&(n+="K"),this._castling[At]&se.QSIDE_CASTLE&&(n+="Q"),this._castling[Xt]&se.KSIDE_CASTLE&&(n+="k"),this._castling[Xt]&se.QSIDE_CASTLE&&(n+="q"),n=n||"-";let i="-";if(this._epSquare!==Et)if(e)i=gt(this._epSquare);else{const o=this._epSquare+(this._turn===At?16:-16),l=[o+1,o-1];for(const c of l){if(c&136)continue;const u=this._turn;if(this._board[c]?.color===u&&this._board[c]?.type===ot){this._makeMove({color:u,from:c,to:this._epSquare,piece:ot,captured:ot,flags:se.EP_CAPTURE});const d=!this._isKingAttacked(u);if(this._undoMove(),d){i=gt(this._epSquare);break}}}}return[r,this._turn,n,i,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:t,type:r}=this._board[e],n={w:0,b:1}[t],i={p:0,n:1,b:2,r:3,q:4,k:5}[r];return Nc[n][i][e]}_epKey(){return this._epSquare===Et?0n:$c[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return Fc[e]}_computeHash(){let e=0n;for(let t=Z.a8;t<=Z.h1;t++){if(t&136){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=ei),e}_updateSetup(e){this._history.length>0||(e!==ti?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(ti)}get(e){return this._board[Z[e]]}findPiece(e){const t=[];for(let r=Z.a8;r<=Z.h1;r++){if(r&136){r+=7;continue}!this._board[r]||this._board[r]?.color!==e.color||this._board[r].color===e.color&&this._board[r].type===e.type&&t.push(gt(r))}return t}put({type:e,color:t},r){return this._put({type:e,color:t},r)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},r){if(Wc.indexOf(e.toLowerCase())===-1||!(r in Z))return!1;const n=Z[r];if(e==ht&&!(this._kings[t]==Et||this._kings[t]==n))return!1;const i=this._board[n];return i&&i.type===ht&&(this._kings[i.color]=Et),this._set(n,{type:e,color:t}),e===ht&&(this._kings[t]=n),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const t=this.get(e);return this._clear(Z[e]),t&&t.type===ht&&(this._kings[t.color]=Et),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){this._hash^=this._castlingKey();const e=this._board[Z.e1]?.type===ht&&this._board[Z.e1]?.color===At,t=this._board[Z.e8]?.type===ht&&this._board[Z.e8]?.color===Xt;(!e||this._board[Z.a1]?.type!==en||this._board[Z.a1]?.color!==At)&&(this._castling.w&=-65),(!e||this._board[Z.h1]?.type!==en||this._board[Z.h1]?.color!==At)&&(this._castling.w&=-33),(!t||this._board[Z.a8]?.type!==en||this._board[Z.a8]?.color!==Xt)&&(this._castling.b&=-65),(!t||this._board[Z.h8]?.type!==en||this._board[Z.h8]?.color!==Xt)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===Et)return;const e=this._epSquare+(this._turn===At?-16:16),t=this._epSquare+(this._turn===At?16:-16),r=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||this._board[t]?.color!==Yr(this._turn)||this._board[t]?.type!==ot){this._hash^=this._epKey(),this._epSquare=Et;return}const n=i=>!(i&136)&&this._board[i]?.color===this._turn&&this._board[i]?.type===ot;r.some(n)||(this._hash^=this._epKey(),this._epSquare=Et)}_attacked(e,t,r){const n=[];for(let i=Z.a8;i<=Z.h1;i++){if(i&136){i+=7;continue}if(this._board[i]===void 0||this._board[i].color!==e)continue;const o=this._board[i],l=i-t;if(l===0)continue;const c=l+119;if(Gc[c]&Hc[o.type]){if(o.type===ot){if(l>0&&o.color===At||l<=0&&o.color===Xt)if(r)n.push(gt(i));else return!0;continue}if(o.type==="n"||o.type==="k")if(r){n.push(gt(i));continue}else return!0;const u=Kc[c];let d=i+u,p=!1;for(;d!==t;){if(this._board[d]!=null){p=!0;break}d+=u}if(!p)if(r){n.push(gt(i));continue}else return!0}}return r?n:!1}attackers(e,t){return t?this._attacked(t,Z[e],!0):this._attacked(this._turn,Z[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(Yr(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,Z[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let r=0,n=0;for(let i=Z.a8;i<=Z.h1;i++){if(n=(n+1)%2,i&136){i+=7;continue}const o=this._board[i];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===Cn&&t.push(n),r++)}if(r===2)return!0;if(r===3&&(e[Cn]===1||e[mi]===1))return!0;if(r===e[Cn]+2){let i=0;const o=t.length;for(let l=0;l<o;l++)i+=t[l];if(i===0||i===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:r=void 0}={}){const n=this._moves({square:t,piece:r});return e?n.map(i=>new _n(this,i)):n.map(i=>this._moveToSan(i,n))}_moves({legal:e=!0,piece:t=void 0,square:r=void 0}={}){const n=r?r.toLowerCase():void 0,i=t?.toLowerCase(),o=[],l=this._turn,c=Yr(l);let u=Z.a8,d=Z.h1,p=!1;if(n)if(n in Z)u=d=Z[n],p=!0;else return[];for(let g=u;g<=d;g++){if(g&136){g+=7;continue}if(!this._board[g]||this._board[g].color===c)continue;const{type:E}=this._board[g];let q;if(E===ot){if(i&&i!==E)continue;q=g+si[l][0],this._board[q]||(Qs(o,l,g,q,ot),q=g+si[l][1],Qc[l]===kr(g)&&!this._board[q]&&Qs(o,l,g,q,ot,void 0,se.BIG_PAWN));for(let C=2;C<4;C++)q=g+si[l][C],!(q&136)&&(this._board[q]?.color===c?Qs(o,l,g,q,ot,this._board[q].type,se.CAPTURE):q===this._epSquare&&Qs(o,l,g,q,ot,ot,se.EP_CAPTURE))}else{if(i&&i!==E)continue;for(let C=0,N=fa[E].length;C<N;C++){const j=fa[E][C];for(q=g;q+=j,!(q&136);){if(!this._board[q])Qs(o,l,g,q,E);else{if(this._board[q].color===l)break;Qs(o,l,g,q,E,this._board[q].type,se.CAPTURE);break}if(E===mi||E===ht)break}}}}if((i===void 0||i===ht)&&(!p||d===this._kings[l])){if(this._castling[l]&se.KSIDE_CASTLE){const g=this._kings[l],E=g+2;!this._board[g+1]&&!this._board[E]&&!this._attacked(c,this._kings[l])&&!this._attacked(c,g+1)&&!this._attacked(c,E)&&Qs(o,l,this._kings[l],E,ht,void 0,se.KSIDE_CASTLE)}if(this._castling[l]&se.QSIDE_CASTLE){const g=this._kings[l],E=g-2;!this._board[g-1]&&!this._board[g-2]&&!this._board[g-3]&&!this._attacked(c,this._kings[l])&&!this._attacked(c,g-1)&&!this._attacked(c,E)&&Qs(o,l,this._kings[l],E,ht,void 0,se.QSIDE_CASTLE)}}if(!e||this._kings[l]===-1)return o;const f=[];for(let g=0,E=o.length;g<E;g++)this._makeMove(o[g]),this._isKingAttacked(l)||f.push(o[g]),this._undoMove();return f}move(e,{strict:t=!1}={}){let r=null;if(typeof e=="string")r=this._moveFromSan(e,t);else if(e===null)r=this._moveFromSan(ri,t);else if(typeof e=="object"){const i=this._moves();for(let o=0,l=i.length;o<l;o++)if(e.from===gt(i[o].from)&&e.to===gt(i[o].to)&&(!("promotion"in i[o])||e.promotion===i[o].promotion)){r=i[o];break}}if(!r)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&r.flags&se.NULL_MOVE)throw new Error("Null move not allowed when in check");const n=new _n(this,r);return this._makeMove(r),this._incPositionCount(),n}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){const t=this._turn,r=Yr(t);if(this._push(e),e.flags&se.NULL_MOVE){t===Xt&&this._moveNumber++,this._halfMoves++,this._turn=r,this._epSquare=Et;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&se.EP_CAPTURE&&(this._turn===Xt?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),this._board[e.to].type===ht){if(this._kings[t]=e.to,e.flags&se.KSIDE_CASTLE){const n=e.to-1,i=e.to+1;this._movePiece(i,n)}else if(e.flags&se.QSIDE_CASTLE){const n=e.to+1,i=e.to-2;this._movePiece(i,n)}this._castling[t]=0}if(this._castling[t]){for(let n=0,i=Ys[t].length;n<i;n++)if(e.from===Ys[t][n].square&&this._castling[t]&Ys[t][n].flag){this._castling[t]^=Ys[t][n].flag;break}}if(this._castling[r]){for(let n=0,i=Ys[r].length;n<i;n++)if(e.to===Ys[r][n].square&&this._castling[r]&Ys[r][n].flag){this._castling[r]^=Ys[r][n].flag;break}}if(this._hash^=this._castlingKey(),e.flags&se.BIG_PAWN){let n;t===Xt?n=e.to-16:n=e.to+16,!(e.to-1&136)&&this._board[e.to-1]?.type===ot&&this._board[e.to-1]?.color===r||!(e.to+1&136)&&this._board[e.to+1]?.type===ot&&this._board[e.to+1]?.color===r?(this._epSquare=n,this._hash^=this._epKey()):this._epSquare=Et}else this._epSquare=Et;e.piece===ot?this._halfMoves=0:e.flags&(se.CAPTURE|se.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===Xt&&this._moveNumber++,this._turn=r,this._hash^=ei}undo(){const e=this._hash,t=this._undoMove();if(t){const r=new _n(this,t);return this._decPositionCount(e),r}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=ei;const r=this._turn,n=Yr(r);if(t.flags&se.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:r})),t.captured)if(t.flags&se.EP_CAPTURE){let i;r===Xt?i=t.to-16:i=t.to+16,this._set(i,{type:ot,color:n})}else this._set(t.to,{type:t.captured,color:n});if(t.flags&(se.KSIDE_CASTLE|se.QSIDE_CASTLE)){let i,o;t.flags&se.KSIDE_CASTLE?(i=t.to+1,o=t.to-1):(i=t.to-2,o=t.to+1),this._movePiece(o,i)}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const r=[];let n=!1;for(const f in this._header)this._header[f]&&r.push(`[${f} "${this._header[f]}"]`+e),n=!0;n&&this._history.length&&r.push(e);const i=f=>{const g=this._comments[this.fen()];if(typeof g<"u"){const E=f.length>0?" ":"";f=`${f}${E}{${g}}`}return f},o=[];for(;this._history.length>0;)o.push(this._undoMove());const l=[];let c="";for(o.length===0&&l.push(i(""));o.length>0;){c=i(c);const f=o.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const g=`${this._moveNumber}. ...`;c=c?`${c} ${g}`:g}else f.color==="w"&&(c.length&&l.push(c),c=this._moveNumber+".");c=c+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(c.length&&l.push(i(c)),l.push(this._header.Result||"*"),t===0)return r.join("")+l.join(" ");const u=function(){return r.length>0&&r[r.length-1]===" "?(r.pop(),!0):!1},d=function(f,g){for(const E of g.split(" "))if(E){if(f+E.length>t){for(;u();)f--;r.push(e),f=0}r.push(E),f+=E.length,r.push(" "),f++}return u()&&f--,f};let p=0;for(let f=0;f<l.length;f++){if(p+l[f].length>t&&l[f].includes("{")){p=d(p,l[f]);continue}p+l[f].length>t&&f!==0?(r[r.length-1]===" "&&r.pop(),r.push(e),p=0):f!==0&&(r.push(" "),p++),r.push(l[f]),p+=l[f].length}return r.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??_i[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=_i[e]||null,!0):!1}getHeaders(){const e={};for(const[t,r]of Object.entries(this._header))r!==null&&(e[t]=r);return e}loadPgn(e,{strict:t=!1,newlineChar:r=`\r?
`}={}){r!==`\r?
`&&(e=e.replace(new RegExp(r,"g"),`
`));const n=Oc(e);this.reset();const i=n.headers;let o="";for(const u in i)u.toLowerCase()==="fen"&&(o=i[u]),this.header(u,i[u]);if(!t)o&&this.load(o,{preserveHeaders:!0});else if(i.SetUp==="1"){if(!("FEN"in i))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(i.FEN,{preserveHeaders:!0})}let l=n.root;for(;l;){if(l.move){const u=this._moveFromSan(l.move,t);if(u==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(u),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const c=n.result;c&&Object.keys(this._header).length&&this._header.Result!==c&&this.setHeader("Result",c)}_moveToSan(e,t){let r="";if(e.flags&se.KSIDE_CASTLE)r="O-O";else if(e.flags&se.QSIDE_CASTLE)r="O-O-O";else{if(e.flags&se.NULL_MOVE)return ri;if(e.piece!==ot){const n=Zc(e,t);r+=e.piece.toUpperCase()+n}e.flags&(se.CAPTURE|se.EP_CAPTURE)&&(e.piece===ot&&(r+=gt(e.from)[0]),r+="x"),r+=gt(e.to),e.promotion&&(r+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?r+="#":r+="+"),this._undoMove(),r}_moveFromSan(e,t=!1){let r=ni(e);if(t||(r==="0-0"?r="O-O":r==="0-0-0"&&(r="O-O-O")),r==ri)return{color:this._turn,from:0,to:0,piece:"k",flags:se.NULL_MOVE};let n=da(r),i=this._moves({legal:!0,piece:n});for(let f=0,g=i.length;f<g;f++)if(r===ni(this._moveToSan(i[f],i)))return i[f];if(t)return null;let o,l,c,u,d,p=!1;if(l=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(o=l[1],c=l[2],u=l[3],d=l[4],c.length==1&&(p=!0)):(l=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(o=l[1],c=l[2],u=l[3],d=l[4],c.length==1&&(p=!0))),n=da(r),i=this._moves({legal:!0,piece:o||n}),!u)return null;for(let f=0,g=i.length;f<g;f++)if(c){if((!o||o.toLowerCase()==i[f].piece)&&Z[c]==i[f].from&&Z[u]==i[f].to&&(!d||d.toLowerCase()==i[f].promotion))return i[f];if(p){const E=gt(i[f].from);if((!o||o.toLowerCase()==i[f].piece)&&Z[u]==i[f].to&&(c==E[0]||c==E[1])&&(!d||d.toLowerCase()==i[f].promotion))return i[f]}}else if(r===ni(this._moveToSan(i[f],i)).replace("x",""))return i[f];return null}ascii(){let e=`   +------------------------+
`;for(let t=Z.a8;t<=Z.h1;t++){if(an(t)===0&&(e+=" "+"87654321"[kr(t)]+" |"),this._board[t]){const r=this._board[t].type,i=this._board[t].color===At?r.toUpperCase():r.toLowerCase();e+=" "+i+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let r=0;const n=this._turn;for(let i=0,o=t.length;i<o;i++)this._makeMove(t[i]),this._isKingAttacked(n)||(e-1>0?r+=this.perft(e-1):r++),this._undoMove();return r}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let t=[];for(let r=Z.a8;r<=Z.h1;r++)this._board[r]==null?t.push(null):t.push({square:gt(r),type:this._board[r].type,color:this._board[r].color}),r+1&136&&(e.push(t),t=[],r+=8);return e}squareColor(e){if(e in Z){const t=Z[e];return(kr(t)+an(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],r=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const n=t.pop();if(!n)break;e?r.push(new _n(this,n)):r.push(this._moveToSan(n,this._moves())),this._makeMove(n)}return r}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const t=this._positionCount.get(e)??0;t===1?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){const e=[],t={},r=n=>{n in this._comments&&(t[n]=this._comments[n])};for(;this._history.length>0;)e.push(this._undoMove());for(r(this.fen());;){const n=e.pop();if(!n)break;this._makeMove(n),r(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const n of[ht,Zs])t[n]!==void 0&&(t[n]?this._castling[e]|=bn[n]:this._castling[e]&=~bn[n]);this._updateCastlingRights();const r=this.getCastlingRights(e);return(t[ht]===void 0||t[ht]===r[ht])&&(t[Zs]===void 0||t[Zs]===r[Zs])}getCastlingRights(e){return{[ht]:(this._castling[e]&bn[ht])!==0,[Zs]:(this._castling[e]&bn[Zs])!==0}}moveNumber(){return this._moveNumber}}function Di(s){if(s.type==="cp"){const t=s.pawns>=0?"+":"â",r=Math.abs(s.pawns).toFixed(1);return`${t}${r}`}return`${s.moves>=0?"":"â"}M${Math.abs(s.moves)}`}function Gr(s){return s.type==="cp"?s.pawns<0:s.moves<0}function wn(s,e){const t=new lr(s);try{return t.move({from:e.slice(0,2),to:e.slice(2,4),promotion:e[4]}),t.fen()}catch{const r=`FATAL: fenAfterMove failed for "${e}" at FEN "${s}" â illegal move`;return console.error(r),alert(r),s}}function Jc(s,e){if(s.length===0)return 0;const t=s.length,r=s.reduce((o,l)=>o+l,0)/t;if(e<=0)return r-400;if(e>=t)return r+400;let n=0,i=4e3;for(;i-n>.01;){const o=(n+i)/2;s.reduce((c,u)=>c+1/(1+Math.pow(10,(u-o)/400)),0)>e?i=o:n=o}return(n+i)/2}function Mr(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function Qr(s){return new Date(s).toISOString().split("T")[0]}function eu(s){const[e,t,r]=s.split("-").map(Number);return new Date(e,t-1,r,0,0,0,0).getTime()}function tu(s){const[e,t,r]=s.split("-").map(Number),n=new Date(e,t-1,r,23,59,59,999).getTime();return Math.min(n,Date.now())}function su(s){const e=new Date,t=e;let r;switch(s){case"month":r=new Date(e),r.setMonth(r.getMonth()-1);break;case"3months":r=new Date(e),r.setMonth(r.getMonth()-3);break;case"year":r=new Date(e),r.setFullYear(r.getFullYear()-1);break;case"all":r=new Date(0);break;default:r=new Date(e),r.setMonth(r.getMonth()-3)}return{from:r,to:t}}var ru=F('<header class="header svelte-aum2bf"><div></div> <div class="header-content svelte-aum2bf"><h1 class="svelte-aum2bf">Opening Explorer</h1> <p class="subtitle svelte-aum2bf">Explore your chess openings from Lichess and Chess.com</p></div> <div></div></header> <main class="card loading-card svelte-aum2bf"><h2 class="svelte-aum2bf"> </h2> <p class="loading-status svelte-aum2bf"> </p> <button class="secondary-btn svelte-aum2bf">Cancel</button></main>',1),nu=F('<button class="dropdown-item svelte-aum2bf"><div> </div> <div class="player-info svelte-aum2bf"><div class="player-name svelte-aum2bf"> </div> <div class="player-details svelte-aum2bf"> </div></div></button>'),iu=F('<div class="cache-info svelte-aum2bf"><div class="cache-icon svelte-aum2bf">ð</div> <div class="cache-details svelte-aum2bf"><span class="cached-label svelte-aum2bf">Cached:</span> <span class="cache-range svelte-aum2bf"> </span></div> <button class="cache-clear-btn svelte-aum2bf">Clear</button></div>'),au=F('<div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Account</label>  <div><button class="account-select svelte-aum2bf"><!></button> <div class="dropdown-menu svelte-aum2bf"><!> <button class="dropdown-item add-account-item svelte-aum2bf"><div class="plus-icon svelte-aum2bf">+</div> <div class="player-info svelte-aum2bf"><div class="player-name svelte-aum2bf">Add new account</div></div></button></div></div></div> <!>',1),ou=F('<div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Platform</label> <div class="platform-toggle svelte-aum2bf"><button>Chess.com</button> <button>Lichess</button></div></div> <div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Username</label> <input type="text" class="username-input svelte-aum2bf" placeholder="Enter username"/></div>',1),lu=F("<button> </button>"),cu=F('<div class="error-text svelte-aum2bf"> </div>'),uu=F('<header class="header svelte-aum2bf"><div></div> <div class="header-content svelte-aum2bf"><h1 class="svelte-aum2bf">Opening Explorer</h1> <p class="subtitle svelte-aum2bf">Explore your chess openings from Lichess and Chess.com</p></div> <div class="header-right svelte-aum2bf"><button class="link-btn svelte-aum2bf">Clear all data</button></div></header> <main class="card svelte-aum2bf"><h2 class="svelte-aum2bf">Connect Your Account</h2> <!> <!> <div class="form-section svelte-aum2bf"><label class="svelte-aum2bf">Date Range</label> <div class="preset-group svelte-aum2bf"></div></div> <div class="date-inputs svelte-aum2bf"><div class="date-field svelte-aum2bf"><label class="svelte-aum2bf">From</label> <input type="date" class="svelte-aum2bf"/></div> <div class="date-field svelte-aum2bf"><label class="svelte-aum2bf">To</label> <input type="date" class="svelte-aum2bf"/></div></div> <!> <button class="primary-btn svelte-aum2bf">Load Games</button></main>',1);function fu(s,e){As(e,!0);let t=is(e,"cachedPlayers",19,()=>[]),r=D(ut(t()[0]??null)),n=D(!1),i=D("chesscom"),o=D(""),l=D("3months"),c=D(""),u=D(""),d=D(""),p=D(!1),f=D(""),g=D(null),E=D(!1);const q=he(()=>t().length>0),C=he(()=>a(n)||!a(q)),N=he(()=>Qr(Date.now())),j=he(()=>a(i)==="lichess"?"Lichess":"Chess.com");ct(()=>{if(a(l)!=="custom"){const{from:z,to:ve}=su(a(l));h(c,Qr(z.getTime()),!0),h(u,Qr(ve.getTime()),!0)}else a(r)&&!a(n)&&(h(c,Qr(a(r).cacheStart),!0),h(u,Qr(a(r).cacheEnd),!0))}),ct(()=>{t().length>0&&!a(r)&&h(r,t()[0],!0)});function x(z){return z==="lichess"?"lichess":"chesscom"}function L(z){return z.toLocaleString()}function B(z){h(r,z,!0),h(n,!1),h(l,"custom"),h(E,!1)}function J(){h(n,!0),h(r,null),h(l,"3months"),h(E,!1)}function ee(z){h(l,z,!0)}function W(){h(l,"custom"),ce()}function ce(){return a(c)&&a(u)&&a(c)>a(u)?(h(d,'"From" date cannot be after "To" date'),!1):(h(d,""),!0)}async function ue(){confirm("Clear all cached data? This cannot be undone.")&&(await Ec(),e.onCachedPlayersChanged([]),h(r,null),h(n,!1))}async function Me(){if(a(r)&&confirm(`Clear all data for ${a(r).username}?`)){await kc(a(r).username,a(r).platform);const z=t().filter(ve=>!(ve.username===a(r).username&&ve.platform===a(r).platform));e.onCachedPlayersChanged(z),h(r,z[0]??null,!0),a(r)||h(n,!1)}}function Re(){return a(r)&&!a(n)?!0:a(o).trim()!==""}async function Y(){if(!ce())return;let z,ve;if(a(r)&&!a(n))z=a(r).username,ve=a(r).platform;else if(z=a(o).trim(),ve=a(i),!z){alert("Please enter a username");return}const Ne=eu(a(c)),$e=tu(a(u));h(p,!0),h(f,""),h(g,new AbortController,!0);try{await Sc(z,ve,Ne,$e,Oe=>{h(f,Oe,!0)},a(g).signal);const Pe=await gi();e.onCachedPlayersChanged(Pe);const Qe=Pe.find(Oe=>Oe.username===z&&Oe.platform===ve);e.onEnterWorkspace({username:z,platform:ve,gameCount:Qe?.gameCount??0,since:Ne,until:$e})}catch(Pe){Pe instanceof DOMException&&Pe.name==="AbortError"||(console.error("Failed to load games:",Pe),alert(`Failed to load games: ${Pe instanceof Error?Pe.message:String(Pe)}`))}finally{h(p,!1),h(g,null)}}function ye(){a(g)?.abort()}function ke(z){z.stopPropagation(),h(E,!a(E))}function de(){h(E,!1)}var Se=Hs();Ks("click",rn,de);var oe=et(Se);{var Ce=z=>{var ve=ru(),Ne=S(et(ve),2),$e=w(Ne),Pe=w($e),Qe=S($e,2),Oe=w(Qe),it=S(Qe,2);it.__click=ye,Q(()=>{R(Pe,`Loading ${(a(o)||a(r)?.username)??""} (${a(j)??""})...`),R(Oe,a(f))}),T(z,ve)},xe=z=>{var ve=uu(),Ne=et(ve),$e=S(w(Ne),4),Pe=w($e);Pe.__click=ue;var Qe=S(Ne,2),Oe=S(w(Qe),2);{var it=re=>{var ie=au(),ae=et(ie),Be=S(w(ae),2);let Fe;var Ue=w(Be);Ue.__click=ke;var Ge=w(Ue);{var me=Ke=>{var Ee=ar();Q(()=>R(Ee,`${a(r).username??""} (${a(r).platform==="lichess"?"Lichess":"Chess.com"})`)),T(Ke,Ee)},Xe=Ke=>{var Ee=ar("Select an account...");T(Ke,Ee)};we(Ge,Ke=>{a(r)&&!a(n)?Ke(me):Ke(Xe,!1)})}var jt=S(Ue,2);jt.__click=Ke=>Ke.stopPropagation();var Yt=w(jt);Ot(Yt,17,t,Ps,(Ke,Ee)=>{var bt=nu();bt.__click=()=>B(a(Ee));var M=w(bt),te=w(M),le=S(M,2),je=w(le),wt=w(je),ft=S(je,2),Qt=w(ft);Q((hs,Nt,Es,vt,m)=>{_e(M,1,`player-avatar ${hs??""}`,"svelte-aum2bf"),R(te,Nt),R(wt,a(Ee).username),R(Qt,`${Es??""} games on ${a(Ee).platform==="lichess"?"Lichess":"Chess.com"} Â· ${vt??""} - ${m??""}`)},[()=>x(a(Ee).platform),()=>a(Ee).username[0].toUpperCase(),()=>L(a(Ee).gameCount),()=>Mr(a(Ee).cacheStart),()=>Mr(a(Ee).cacheEnd)]),T(Ke,bt)});var It=S(Yt,2);It.__click=J;var Mt=S(ae,2);{var ks=Ke=>{var Ee=iu(),bt=S(w(Ee),2),M=S(w(bt),2),te=w(M),le=S(bt,2);le.__click=Me,Q((je,wt,ft)=>R(te,`${je??""} games Â· ${wt??""} - ${ft??""}`),[()=>L(a(r).gameCount),()=>Mr(a(r).cacheStart),()=>Mr(a(r).cacheEnd)]),T(Ke,Ee)};we(Mt,Ke=>{a(r)&&!a(n)&&Ke(ks)})}Q(()=>Fe=_e(Be,1,"account-dropdown svelte-aum2bf",null,Fe,{open:a(E)})),T(re,ie)};we(Oe,re=>{a(q)&&re(it)})}var dt=S(Oe,2);{var Vt=re=>{var ie=ou(),ae=et(ie),Be=S(w(ae),2),Fe=w(Be);let Ue;Fe.__click=()=>h(i,"chesscom");var Ge=S(Fe,2);let me;Ge.__click=()=>h(i,"lichess");var Xe=S(ae,2),jt=S(w(Xe),2);Q(()=>{Ue=_e(Fe,1,"platform-btn svelte-aum2bf",null,Ue,{active:a(i)==="chesscom"}),me=_e(Ge,1,"platform-btn svelte-aum2bf",null,me,{active:a(i)==="lichess"})}),Yn(jt,()=>a(o),Yt=>h(o,Yt)),T(re,ie)};we(dt,re=>{a(C)&&re(Vt)})}var cs=S(dt,2),Ls=S(w(cs),2);Ot(Ls,20,()=>[["3months","Last 3 months"],["month","Last month"],["year","Last year"],["all","All time"],["custom","Custom"]],Ps,(re,ie)=>{var ae=he(()=>Yo(ie,2));let Be=()=>a(ae)[0],Fe=()=>a(ae)[1];var Ue=lu();let Ge;Ue.__click=()=>ee(Be());var me=w(Ue);Q(()=>{Ge=_e(Ue,1,"preset-btn svelte-aum2bf",null,Ge,{active:a(l)===Be()}),R(me,Fe())}),T(re,Ue)});var ys=S(cs,2),us=w(ys),Rt=S(w(us),2);Rt.__input=W;var fs=S(us,2),I=S(w(fs),2);I.__input=W;var $=S(ys,2);{var pe=re=>{var ie=cu(),ae=w(ie);Q(()=>R(ae,a(d))),T(re,ie)};we($,re=>{a(d)&&re(pe)})}var ge=S($,2);ge.__click=Y,Q(re=>{Mn(Rt,"max",a(N)),Mn(I,"max",a(N)),ge.disabled=re},[()=>!Re()]),Yn(Rt,()=>a(c),re=>h(c,re)),Yn(I,()=>a(u),re=>h(u,re)),T(z,ve)};we(oe,z=>{a(p)?z(Ce):z(xe,!1)})}T(s,Se),Is()}pn(["click","input"]);const on={start:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",empty:"8/8/8/8/8/8/8/8"};class rt{constructor(e=on.empty){this.squares=new Array(64).fill(null),this.setFen(e)}setFen(e=on.empty){const t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let r=0;r<8;r++){const n=t[7-r].replace(/\d/g,i=>{const o=parseInt(i);let l="";for(let c=0;c<o;c++)l+="-";return l});for(let i=0;i<8;i++){const o=n.substring(i,i+1);let l=null;o!=="-"&&(o.toUpperCase()===o?l=`w${o.toLowerCase()}`:l=`b${o}`),this.squares[r*8+i]=l}}}getFen(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let r=0;for(let n=0;n<8;n++){const i=this.squares[t*8+n];if(!i)r++;else{r>0&&(e[7-t]+=r,r=0);const o=i.substring(0,1),l=i.substring(1,2);o==="w"?e[7-t]+=l.toUpperCase():e[7-t]+=l}}r>0&&(e[7-t]+=r,r=0)}return e.join("/")}getPieces(e=void 0,t=void 0,r=["k","q","r","b","n","p"]){const n=[],i=(o,l)=>r.indexOf(o.name)-r.indexOf(l.name);for(let o=0;o<64;o++){const l=this.squares[o];if(l){const c=l.charAt(1),u=l.charAt(0),d=rt.indexToSquare(o);if(t&&t!==c||e&&e!==u)continue;n.push({name:c,type:c,color:u,position:d,square:d})}}return r&&n.sort(i),n}movePiece(e,t){if(!this.squares[rt.squareToIndex(e)]){console.warn("no piece on",e);return}this.squares[rt.squareToIndex(t)]=this.squares[rt.squareToIndex(e)],this.squares[rt.squareToIndex(e)]=null}setPiece(e,t){this.squares[rt.squareToIndex(e)]=t}getPiece(e){return this.squares[rt.squareToIndex(e)]}static squareToIndex(e){const t=rt.squareToCoordinates(e);return t[0]+t[1]*8}static indexToSquare(e){return this.coordinatesToSquare([Math.floor(e%8),e/8])}static squareToCoordinates(e){const t=e.charCodeAt(0)-97,r=e.charCodeAt(1)-49;return[t,r]}static coordinatesToSquare(e){const t=String.fromCharCode(e[0]+97),r=String.fromCharCode(e[1]+49);return t+r}toString(){return this.getFen()}clone(){const e=new rt;return e.squares=this.squares.slice(0),e}}class hu{constructor(){this.position=new rt,this.orientation=void 0,this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.squareSelectEnabled=!1,this.moveInputCallback=null,this.extensionPoints={},this.moveInputProcess=Promise.resolve()}inputEnabled(){return this.inputWhiteEnabled||this.inputBlackEnabled}invokeExtensionPoints(e,t={}){const r=this.extensionPoints[e],n=Object.assign({},t);n.extensionPoint=e;let i=!0;if(r)for(const o of r)o(n)===!1&&(i=!1);return i}}const va="http://www.w3.org/2000/svg";class fe{static createSvg(e=void 0){let t=document.createElementNS(va,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,r={}){let n=document.createElementNS(va,t);t==="use"&&(r["xlink:href"]=r.href);for(let i in r)if(r.hasOwnProperty(i))if(i.indexOf(":")!==-1){const o=i.split(":");n.setAttributeNS("http://www.w3.org/1999/"+o[0],o[1],r[i])}else n.setAttribute(i,r[i]);return e.appendChild(n),n}static removeElement(e){if(!e){console.warn("removeElement, element is",e);return}e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode")}}const Ve={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",beforeRedrawBoard:"beforeRedrawBoard",afterRedrawBoard:"afterRedrawBoard",redrawBoard:"redrawBoard",animation:"animation",destroy:"destroy"};class Oi{constructor(e){this.chessboard=e}registerExtensionPoint(e,t){e===Ve.redrawBoard&&(console.warn("EXTENSION_POINT.redrawBoard is deprecated, use EXTENSION_POINT.afterRedrawBoard"),e=Ve.afterRedrawBoard),this.chessboard.state.extensionPoints[e]||(this.chessboard.state.extensionPoints[e]=[]),this.chessboard.state.extensionPoints[e].push(t)}registerMethod(e,t){console.warn("registerMethod is deprecated, just add methods directly to the chessboard instance"),this.chessboard[e]?log.error("method",e,"already exists"):this.chessboard[e]=(...r)=>t.apply(this,r)}}class zs{static delegate(e,t,r,n){const i=function(o){let l=o.target;for(;l&&l!==this;)l.matches(r)&&n.call(l,o),l=l.parentNode};return e.addEventListener(t,i),{remove:function(){e.removeEventListener(t,i)}}}static mergeObjects(e,t){const r=n=>n&&typeof n=="object";if(!r(e)||!r(t))return t;for(const n of Object.keys(t))t[n]instanceof Object&&Object.assign(t[n],zs.mergeObjects(e[n],t[n]));return Object.assign(e||{},t),e}static createDomElement(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}static createTask(){let e,t;const r=new Promise(function(n,i){e=n,t=i});return r.resolve=e,r.reject=t,r}static isAbsoluteUrl(e){return e.indexOf("://")!==-1||e.startsWith("/")}}const ii={start:"start",frame:"frame",end:"end"};class du{constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}async enqueue(e){return new Promise((t,r)=>{this.queue.push({promise:e,resolve:t,reject:r}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop){this.queue=[],this.stop=!1;return}const e=this.queue.shift();if(e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}}const Cs={move:0,appear:1,disappear:2};class Dr{constructor(e,t,r,n,i){this.view=e,t&&r?(this.animatedElements=this.createAnimation(t.squares,r.squares),this.duration=n,this.callback=i,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",r),this.view.positionsAnimationTask=zs.createTask(),this.view.chessboard.state.invokeExtensionPoints(Ve.animation,{type:ii.start})}static seekChanges(e,t){const r=[],n=[],i=[];for(let o=0;o<64;o++){const l=e[o],c=t[o];c!==l&&(c&&r.push({piece:c,index:o}),l&&n.push({piece:l,index:o}))}return r.forEach(o=>{let l=8,c=null;n.forEach(u=>{if(o.piece===u.piece){const d=Dr.squareDistance(o.index,u.index);d<l&&(c=u,l=d)}}),c?(n.splice(n.indexOf(c),1),i.push({type:Cs.move,piece:o.piece,atIndex:c.index,toIndex:o.index})):i.push({type:Cs.appear,piece:o.piece,atIndex:o.index})}),n.forEach(o=>{i.push({type:Cs.disappear,piece:o.piece,atIndex:o.index})}),i}createAnimation(e,t){const r=Dr.seekChanges(e,t),n=[];return r.forEach(i=>{const o={type:i.type};switch(i.type){case Cs.move:o.element=this.view.getPieceElement(rt.indexToSquare(i.atIndex)),o.element.parentNode.appendChild(o.element),o.atPoint=this.view.indexToPoint(i.atIndex),o.toPoint=this.view.indexToPoint(i.toIndex);break;case Cs.appear:o.element=this.view.drawPieceOnSquare(rt.indexToSquare(i.atIndex),i.piece),o.element.style.opacity=0;break;case Cs.disappear:o.element=this.view.getPieceElement(rt.indexToSquare(i.atIndex));break}n.push(o)}),n}animationStep(e){if(!this.view||!this.view.chessboard.state)return;this.startTime||(this.startTime=e);const t=e-this.startTime;if(t<=this.duration)this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));else{cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(i=>{i.type===Cs.disappear&&fe.removeElement(i.element)}),this.view.positionsAnimationTask.resolve(),this.view.chessboard.state.invokeExtensionPoints(Ve.animation,{type:ii.end}),this.callback();return}const r=Math.min(1,t/this.duration);let n=r<.5?2*r*r:-1+(4-2*r)*r;(isNaN(n)||n>.99)&&(n=1),this.animatedElements.forEach(i=>{if(i.element)switch(i.type){case Cs.move:i.element.transform.baseVal.removeItem(0);const o=this.view.svg.createSVGTransform();o.setTranslate(i.atPoint.x+(i.toPoint.x-i.atPoint.x)*n,i.atPoint.y+(i.toPoint.y-i.atPoint.y)*n),i.element.transform.baseVal.appendItem(o);break;case Cs.appear:i.element.style.opacity=Math.round(n*100)/100;break;case Cs.disappear:i.element.style.opacity=Math.round((1-n)*100)/100;break}else console.warn("animatedItem has no element",i)}),this.view.chessboard.state.invokeExtensionPoints(Ve.animation,{type:ii.frame,progress:n})}static squareDistance(e,t){const r=e%8,n=Math.floor(e/8),i=t%8,o=Math.floor(t/8);return Math.max(Math.abs(o-n),Math.abs(i-r))}}class vu extends du{constructor(e){super(),this.chessboard=e}async enqueuePositionChange(e,t,r){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(n=>{let i=r?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(i=i/(1+Math.pow(this.queue.length/5,2))),new Dr(this.chessboard.view,e,t,r?i:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),n()})}))}async enqueueTurnBoard(e,t,r){return super.enqueue(()=>new Promise(n=>{const i=new rt(on.empty);let o=r?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(o=o/(1+Math.pow(this.queue.length/5,2))),new Dr(this.chessboard.view,e,i,r?o:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(i.squares),new Dr(this.chessboard.view,i,e,r?o:0,()=>{this.chessboard.view.redrawPieces(e.squares),n()})})}))}}const U={waitForInputStart:"waitForInputStart",pieceClickedThreshold:"pieceClickedThreshold",clickTo:"clickTo",secondClickThreshold:"secondClickThreshold",dragTo:"dragTo",clickDragTo:"clickDragTo",moveDone:"moveDone",reset:"reset"},Xr={secondClick:"secondClick",secondaryClick:"secondaryClick",movedOutOfBoard:"movedOutOfBoard",draggedBack:"draggedBack",clickedAnotherPiece:"clickedAnotherPiece"},pa=4;class pu{constructor(e){this.view=e,this.chessboard=e.chessboard,this.moveInputState=null,this.fromSquare=null,this.toSquare=null,this.setMoveInputState(U.waitForInputStart)}moveInputStartedCallback(e){const t=this.view.moveInputStartedCallback(e);return t&&(this.chessboard.state.moveInputProcess=zs.createTask(),this.chessboard.state.moveInputProcess.then(r=>{(this.moveInputState===U.waitForInputStart||this.moveInputState===U.moveDone)&&this.view.moveInputFinishedCallback(this.fromSquare,this.toSquare,r)})),t}movingOverSquareCallback(e,t){this.view.movingOverSquareCallback(e,t)}validateMoveInputCallback(e,t){const r=this.view.validateMoveInputCallback(e,t);return this.chessboard.state.moveInputProcess.resolve(r),r}moveInputCanceledCallback(e,t,r){this.view.moveInputCanceledCallback(e,t,r),this.chessboard.state.moveInputProcess.resolve()}setMoveInputState(e,t=void 0){const r=this.moveInputState;switch(this.moveInputState=e,e){case U.waitForInputStart:break;case U.pieceClickedThreshold:if(U.waitForInputStart!==r&&U.clickTo!==r)throw new Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.fromSquare=t.square,this.toSquare=null,this.movedPiece=t.piece,this.startPoint=t.point,!this.pointerMoveListener&&!this.pointerUpListener){if(t.type==="mousedown")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else if(t.type==="touchstart")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener);else throw Error("4b74af");this.contextMenuListener||(this.contextMenuListener=this.onContextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener))}else throw Error("94ad0c");break;case U.clickTo:this.draggablePiece&&(fe.removeElement(this.draggablePiece),this.draggablePiece=null),r===U.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case U.secondClickThreshold:if(U.clickTo!==r)throw new Error("moveInputState");this.startPoint=t.point;break;case U.dragTo:if(U.pieceClickedThreshold!==r)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case U.clickDragTo:if(U.secondClickThreshold!==r)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case U.moveDone:if([U.dragTo,U.clickTo,U.clickDragTo].indexOf(r)===-1)throw new Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?this.chessboard.movePiece(this.fromSquare,this.toSquare,r===U.clickTo).then(()=>{r===U.clickTo&&this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(U.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(U.reset));break;case U.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=null,this.toSquare=null,this.movedPiece=null,this.draggablePiece&&(fe.removeElement(this.draggablePiece),this.draggablePiece=null),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.contextMenuListener&&(removeEventListener("contextmenu",this.contextMenuListener),this.contextMenuListener=null),this.setMoveInputState(U.waitForInputStart);const n=this.view.piecesGroup.querySelectorAll("[visibility=hidden]");for(let i=0;i<n.length;i++)n[i].removeAttribute("visibility");break;default:throw Error(`260b09: moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece already exists");this.draggablePiece=fe.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.chessboard.props.assetsCache?"":this.view.getSpriteUrl(),r=fe.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),n=this.view.squareHeight/this.chessboard.props.style.pieces.tileSize,i=this.draggablePiece.createSVGTransform();i.setScale(n,n),r.transform.baseVal.appendItem(i)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if(!(e.type==="mousedown"&&e.button===0||e.type==="touchstart"))return;const t=e.target.getAttribute("data-square");if(!t)return;const r=this.chessboard.getPiece(t);let n;if(r&&(n=r?r.substring(0,1):null,(n==="w"&&this.chessboard.state.inputWhiteEnabled||n==="b"&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault()),this.moveInputState!==U.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&n==="w"||this.chessboard.state.inputBlackEnabled&&n==="b"){let i;if(e.type==="mousedown"?i={x:e.clientX,y:e.clientY}:e.type==="touchstart"&&(i={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===U.waitForInputStart&&r&&this.moveInputStartedCallback(t))this.setMoveInputState(U.pieceClickedThreshold,{square:t,piece:r,point:i,type:e.type});else if(this.moveInputState===U.clickTo)if(t===this.fromSquare)this.setMoveInputState(U.secondClickThreshold,{square:t,piece:r,point:i,type:e.type});else{const o=this.chessboard.getPiece(t),l=o?o.substring(0,1):null,c=this.chessboard.getPiece(this.fromSquare),u=c?c.substring(0,1):null;n&&u===l?this.validateMoveInputCallback(this.fromSquare,t)||(this.moveInputCanceledCallback(this.fromSquare,t,Xr.clickedAnotherPiece),this.moveInputStartedCallback(t)?this.setMoveInputState(U.pieceClickedThreshold,{square:t,piece:o,point:i,type:e.type}):this.setMoveInputState(U.reset)):this.setMoveInputState(U.moveDone,{square:t})}}}onPointerMove(e){let t,r,n,i,o;if(e.type==="mousemove"?(n=e.clientX,i=e.clientY,t=e.pageX,r=e.pageY,o=e.target):e.type==="touchmove"&&(n=e.touches[0].clientX,i=e.touches[0].clientY,t=e.touches[0].pageX,r=e.touches[0].pageY,o=document.elementFromPoint(n,i)),this.moveInputState===U.pieceClickedThreshold||this.moveInputState===U.secondClickThreshold)(Math.abs(this.startPoint.x-n)>pa||Math.abs(this.startPoint.y-i)>pa)&&(this.moveInputState===U.secondClickThreshold?this.setMoveInputState(U.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(U.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled()&&this.moveDraggablePiece(t,r));else if(this.moveInputState===U.dragTo||this.moveInputState===U.clickDragTo||this.moveInputState===U.clickTo){if(o&&o.getAttribute&&o.parentElement===this.view.boardGroup){const l=o.getAttribute("data-square");l!==this.fromSquare&&l!==this.toSquare?(this.toSquare=l,this.movingOverSquareCallback(this.fromSquare,this.toSquare)):l===this.fromSquare&&this.toSquare!==null&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null))}else this.toSquare!==null&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null));this.view.chessboard.state.inputEnabled()&&(this.moveInputState===U.dragTo||this.moveInputState===U.clickDragTo)&&this.moveDraggablePiece(t,r)}}onPointerUp(e){let t;if(e.type==="mouseup"?t=e.target:e.type==="touchend"&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const r=t.getAttribute("data-square");if(r)this.moveInputState===U.dragTo||this.moveInputState===U.clickDragTo?this.fromSquare===r?this.moveInputState===U.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(r,null,Xr.draggedBack),this.setMoveInputState(U.reset)):this.setMoveInputState(U.clickTo,{square:r}):this.setMoveInputState(U.moveDone,{square:r}):this.moveInputState===U.pieceClickedThreshold?this.setMoveInputState(U.clickTo,{square:r}):this.moveInputState===U.secondClickThreshold&&(this.setMoveInputState(U.reset),this.moveInputCanceledCallback(r,null,Xr.secondClick));else{this.view.redrawPieces();const n=this.fromSquare;this.setMoveInputState(U.reset),this.moveInputCanceledCallback(n,null,Xr.movedOutOfBoard)}}else this.view.redrawPieces(),this.setMoveInputState(U.reset)}onContextMenu(e){e.preventDefault(),this.view.redrawPieces(),this.setMoveInputState(U.reset),this.moveInputCanceledCallback(this.fromSquare,null,Xr.secondaryClick)}isDragging(){return this.moveInputState===U.dragTo||this.moveInputState===U.clickDragTo}destroy(){this.setMoveInputState(U.reset)}}const Jt={white:"w",black:"b"},Ht={moveInputStarted:"moveInputStarted",movingOverSquare:"movingOverSquare",validateMoveInput:"validateMoveInput",moveInputCanceled:"moveInputCanceled",moveInputFinished:"moveInputFinished"},mo={pointerdown:"pointerdown"},qr={none:"none",thin:"thin",frame:"frame"};class gu{constructor(e){this.chessboard=e,this.visualMoveInput=new pu(this),e.props.assetsCache&&this.cacheSpriteToDiv("cm-chessboard-sprite",this.getSpriteUrl()),this.container=document.createElement("div"),this.chessboard.context.appendChild(this.container),e.props.responsive&&(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(()=>{setTimeout(()=>{this.handleResize()})}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.positionsAnimationTask=Promise.resolve(),this.pointerDownListener=this.pointerDownHandler.bind(this),this.container.addEventListener("mousedown",this.pointerDownListener),this.container.addEventListener("touchstart",this.pointerDownListener,{passive:!1}),this.createSvgAndGroups(),this.handleResize()}pointerDownHandler(e){this.visualMoveInput.onPointerDown(e)}destroy(){this.visualMoveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),fe.removeElement(this.svg),this.container.remove()}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){const r=document.createElement("div");r.style.transform="scale(0)",r.style.position="absolute",r.setAttribute("aria-hidden","true"),r.id=e,document.body.appendChild(r);const n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){r.insertAdjacentHTML("afterbegin",n.response)},n.send()}}createSvgAndGroups(){this.svg=fe.createSvg(this.container);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=fe.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=fe.addElement(this.svg,"g",{class:"coordinates","aria-hidden":"true"}),this.markersLayer=fe.addElement(this.svg,"g",{class:"markers-layer"}),this.piecesLayer=fe.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=fe.addElement(this.piecesLayer,"g",{class:"pieces"}),this.markersTopLayer=fe.addElement(this.svg,"g",{class:"markers-top-layer"}),this.interactiveTopLayer=fe.addElement(this.svg,"g",{class:"interactive-top-layer"})}updateMetrics(){const e=this.chessboard.props.style.pieces.tileSize;this.width=this.container.clientWidth,this.height=this.container.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===qr.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===qr.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/e,this.scalingY=this.squareHeight/e,this.pieceXTranslate=this.squareWidth/2-e*this.scalingY/2}handleResize(){this.container.style.width=this.chessboard.context.clientWidth+"px",this.container.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",(this.container.clientWidth!==this.width||this.container.clientHeight!==this.height)&&(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.chessboard.state.invokeExtensionPoints(Ve.beforeRedrawBoard),this.redrawSquares(),this.drawCoordinates(),this.chessboard.state.invokeExtensionPoints(Ve.afterRedrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(fe.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===qr.frame){const t=this.borderSize;fe.addElement(this.boardGroup,"rect",{x:t,y:t,width:this.width-t*2,height:this.height-t*2}).setAttribute("class","border-inner")}for(let t=0;t<64;t++){const r=this.chessboard.state.orientation===Jt.white?t:63-t,i=`square ${(9*r&8)===0?"black":"white"}`,o=this.squareToPoint(rt.indexToSquare(r)),l=fe.addElement(this.boardGroup,"rect",{x:o.x,y:o.y,width:this.squareWidth,height:this.squareHeight});l.setAttribute("class",i),l.setAttribute("data-square",rt.indexToSquare(r))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==qr.frame;for(let t=0;t<8;t++){let r=this.borderSize+(17+this.chessboard.props.style.pieces.tileSize*t)*this.scalingX,n=this.height-this.scalingY*3.5,i="coordinate file";e&&(r=r+this.scalingX*15.5,i+=t%2?" white":" black");const o=fe.addElement(this.coordinatesGroup,"text",{class:i,x:r,y:n,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===Jt.white?o.textContent=String.fromCharCode(97+t):o.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let r=this.borderSize/3.7,n=this.borderSize+25*this.scalingY+t*this.squareHeight,i="coordinate rank";e&&(i+=t%2?" black":" white",this.chessboard.props.style.borderType===qr.frame?(r=r+this.scalingX*10,n=n-this.scalingY*15):(r=r+this.scalingX*2,n=n-this.scalingY*15));const o=fe.addElement(this.coordinatesGroup,"text",{class:i,x:r,y:n,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===Jt.white?o.textContent=""+(8-t):o.textContent=""+(1+t)}}redrawPieces(e=this.chessboard.state.position.squares){const t=Array.from(this.piecesGroup.childNodes),r=this.visualMoveInput.isDragging();for(let n=0;n<64;n++){const i=e[n];if(i){const o=rt.indexToSquare(n);this.drawPieceOnSquare(o,i,r&&o===this.visualMoveInput.fromSquare)}}for(const n of t)this.piecesGroup.removeChild(n)}drawPiece(e,t,r){const n=fe.addElement(e,"g",{});n.setAttribute("data-piece",t);const i=this.svg.createSVGTransform();i.setTranslate(r.x,r.y),n.transform.baseVal.appendItem(i);const o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),l=fe.addElement(n,"use",{href:`${o}#${t}`,class:"piece"}),c=this.svg.createSVGTransform();return c.setScale(this.scalingY,this.scalingY),l.transform.baseVal.appendItem(c),n}drawPieceOnSquare(e,t,r=!1){const n=fe.addElement(this.piecesGroup,"g",{});n.setAttribute("data-piece",t),n.setAttribute("data-square",e),r&&n.setAttribute("visibility","hidden");const i=this.squareToPoint(e),o=this.svg.createSVGTransform();o.setTranslate(i.x,i.y),n.transform.baseVal.appendItem(o);const l=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),c=fe.addElement(n,"use",{href:`${l}#${t}`,class:"piece"}),u=this.svg.createSVGTransform();u.setTranslate(this.pieceXTranslate,0),c.transform.baseVal.appendItem(u);const d=this.svg.createSVGTransform();return d.setScale(this.scalingY,this.scalingY),c.transform.baseVal.appendItem(d),n}setPieceVisibility(e,t=!0){const r=this.getPieceElement(e);r?t?r.setAttribute("visibility","visible"):r.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(!e||e.length<2)return console.warn("invalid square",e),null;const t=this.piecesGroup.querySelector(`g[data-square='${e}']`);return t||(console.warn("no piece on",e),null)}enableMoveInput(e,t=null){if(this.chessboard.state.moveInputCallback)throw Error("moveInput already enabled");t===Jt.white?this.chessboard.state.inputWhiteEnabled=!0:t===Jt.black?this.chessboard.state.inputBlackEnabled=!0:(this.chessboard.state.inputWhiteEnabled=!0,this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(Ve.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.moveInputCallback=null,this.chessboard.state.invokeExtensionPoints(Ve.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){const t={chessboard:this.chessboard,type:Ht.moveInputStarted,square:e,squareFrom:e,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(t.moveInputCallbackResult=this.chessboard.state.moveInputCallback(t)),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,t),t.moveInputCallbackResult}movingOverSquareCallback(e,t){const r={chessboard:this.chessboard,type:Ht.movingOverSquare,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.chessboard.state.moveInputCallback&&(r.moveInputCallbackResult=this.chessboard.state.moveInputCallback(r)),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,r)}validateMoveInputCallback(e,t){const r={chessboard:this.chessboard,type:Ht.validateMoveInput,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(r.moveInputCallbackResult=this.chessboard.state.moveInputCallback(r)),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,r),r.moveInputCallbackResult}moveInputCanceledCallback(e,t,r){const n={chessboard:this.chessboard,type:Ht.moveInputCanceled,reason:r,squareFrom:e,squareTo:t};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(n),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,n)}moveInputFinishedCallback(e,t,r){const n={chessboard:this.chessboard,type:Ht.moveInputFinished,squareFrom:e,squareTo:t,legalMove:r};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(n),this.chessboard.state.invokeExtensionPoints(Ve.moveInput,n)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,r;return this.chessboard.state.orientation===Jt.white?(t=this.borderSize+e%8*this.squareWidth,r=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,r=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:r}}squareToPoint(e){const t=rt.squareToIndex(e);return this.indexToPoint(t)}getSpriteUrl(){return zs.isAbsoluteUrl(this.chessboard.props.style.pieces.file)?this.chessboard.props.style.pieces.file:this.chessboard.props.assetsUrl+this.chessboard.props.style.pieces.file}}const Xs={wp:"wp",wb:"wb",wn:"wn",wr:"wr",wq:"wq",wk:"wk",bp:"bp",bb:"bb",bn:"bn",br:"br",bq:"bq",bk:"bk"},mu={svgSprite:"svgSprite"};class _u{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[],this.props={position:on.empty,orientation:Jt.white,responsive:!0,assetsUrl:"./assets/",assetsCache:!0,style:{cssClass:"default",showCoordinates:!0,borderType:qr.none,aspectRatio:1,pieces:{type:mu.svgSprite,file:"pieces/standard.svg",tileSize:40},animationDuration:300},extensions:[]},zs.mergeObjects(this.props,t),this.state=new hu,this.view=new gu(this),this.positionAnimationsQueue=new vu(this),this.state.orientation=this.props.orientation;for(const r of this.props.extensions)this.addExtension(r.class,r.props);this.view.redrawBoard(),this.state.position=new rt(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(Ve.positionChanged),this.initialized=Promise.resolve()}async setPiece(e,t,r=!1){const n=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(Ve.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(n,this.state.position.clone(),r)}async movePiece(e,t,r=!1){const n=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(Ve.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(n,this.state.position.clone(),r)}async setPosition(e,t=!1){const r=this.state.position.clone(),n=new rt(e);return r.getFen()!==n.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(Ve.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(r,this.state.position.clone(),t)}async setOrientation(e,t=!1){const r=this.state.position.clone();if(this.boardTurning){console.warn("setOrientation is only once in queue allowed");return}return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(r,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(Ve.boardChanged)})}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}enableMoveInput(e,t=void 0){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}isMoveInputEnabled(){return this.state.inputWhiteEnabled||this.state.inputBlackEnabled}enableSquareSelect(e=mo.pointerdown,t){this.squareSelectListener||(this.squareSelectListener=function(r){const n=r.target.getAttribute("data-square");t({eventType:r.type,event:r,chessboard:this,square:n})}),this.context.addEventListener(e,this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(e){this.context.removeEventListener(e,this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}isSquareSelectEnabled(){return this.state.squareSelectEnabled}addExtension(e,t){if(this.getExtension(e))throw Error('extension "'+e.name+'" already added');this.extensions.push(new e(this,t))}getExtension(e){for(const t of this.extensions)if(t instanceof e)return t;return null}destroy(){this.state.invokeExtensionPoints(Ve.destroy),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0}}const Dt={hidden:"hidden",displayRequested:"displayRequested",shown:"shown"},bu={de:{choosePromotion:"Bauernumwandlung wÃ¤hlen",promotionDialogTitle:"Bauernumwandlung",pieces:{q:"Dame",r:"Turm",b:"LÃ¤ufer",n:"Springer"},promoteTo:"Umwandeln in"},en:{choosePromotion:"Choose promotion piece",promotionDialogTitle:"Pawn promotion",pieces:{q:"Queen",r:"Rook",b:"Bishop",n:"Knight"},promoteTo:"Promote to"}},tn={pieceSelected:"pieceSelected",canceled:"canceled"};class wu extends Oi{constructor(e,t={}){super(e),this.props={language:navigator.language.substring(0,2).toLowerCase()},Object.assign(this.props,t),this.props.language!=="de"&&this.props.language!=="en"&&(this.props.language="en"),this.t=bu[this.props.language],this.pieceOrder=["q","r","b","n"],this.focusedIndex=0,this.previouslyFocusedElement=null,this.registerExtensionPoint(Ve.afterRedrawBoard,this.extensionPointRedrawBoard.bind(this)),this.registerExtensionPoint(Ve.destroy,this.destroy.bind(this)),e.showPromotionDialog=this.showPromotionDialog.bind(this),e.isPromotionDialogShown=this.isPromotionDialogShown.bind(this),this.promotionDialogGroup=fe.addElement(e.view.interactiveTopLayer,"g",{class:"promotion-dialog-group",role:"dialog","aria-modal":"true","aria-label":this.t.choosePromotion}),this.liveRegion=document.createElement("div"),this.liveRegion.setAttribute("aria-live","polite"),this.liveRegion.setAttribute("aria-atomic","true"),this.liveRegion.className="cm-chessboard-promotion-live-region visually-hidden",this.liveRegion.style.cssText="position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;",e.context.appendChild(this.liveRegion),this.state={displayState:Dt.hidden,callback:null,dialogParams:{square:null,color:null}},this.handleKeyDown=this.handleKeyDown.bind(this)}showPromotionDialog(e,t,r){this.previouslyFocusedElement=document.activeElement,this.focusedIndex=0,this.state.dialogParams.square=e,this.state.dialogParams.color=t,this.state.callback=r,this.setDisplayState(Dt.displayRequested),setTimeout(()=>{this.chessboard.view.positionsAnimationTask.then(()=>{this.setDisplayState(Dt.shown),this.announce(this.t.choosePromotion+": "+this.pieceOrder.map(n=>this.t.pieces[n]).join(", "))})})}isPromotionDialogShown(){return this.state.displayState===Dt.shown||this.state.displayState===Dt.displayRequested}extensionPointRedrawBoard(){this.redrawDialog()}drawPieceButton(e,t,r){const n=this.chessboard.view.squareWidth,i=this.chessboard.view.squareHeight,o=e.charAt(1),l=this.t.pieces[o],c=fe.addElement(this.promotionDialogGroup,"g",{class:"promotion-dialog-button-group",role:"button",tabindex:r===0?"0":"-1","aria-label":l,"data-piece":e,"data-index":r});fe.addElement(c,"rect",{x:t.x,y:t.y,width:n,height:i,class:"promotion-dialog-button","data-piece":e}),this.chessboard.view.drawPiece(c,e,t)}redrawDialog(){for(;this.promotionDialogGroup.firstChild;)this.promotionDialogGroup.removeChild(this.promotionDialogGroup.firstChild);if(this.state.displayState===Dt.shown){const e=this.chessboard.view.squareWidth,t=this.chessboard.view.squareHeight,r=this.chessboard.view.squareToPoint(this.state.dialogParams.square);r.x=r.x+e/2,r.y=r.y+t/2;let n=!1;const i=parseInt(this.state.dialogParams.square.charAt(1),10);(this.chessboard.getOrientation()===Jt.white&&i<5||this.chessboard.getOrientation()===Jt.black&&i>=5)&&(n=!0);const o=n?-4*t:0,l=r.x+e>this.chessboard.view.width?-e:0;fe.addElement(this.promotionDialogGroup,"rect",{x:r.x+l,y:r.y+o,width:e,height:t*4,class:"promotion-dialog"});const c=this.state.dialogParams;n?(this.drawPieceButton(Xs[c.color+"q"],{x:r.x+l,y:r.y-t},0),this.drawPieceButton(Xs[c.color+"r"],{x:r.x+l,y:r.y-t*2},1),this.drawPieceButton(Xs[c.color+"b"],{x:r.x+l,y:r.y-t*3},2),this.drawPieceButton(Xs[c.color+"n"],{x:r.x+l,y:r.y-t*4},3)):(this.drawPieceButton(Xs[c.color+"q"],{x:r.x+l,y:r.y},0),this.drawPieceButton(Xs[c.color+"r"],{x:r.x+l,y:r.y+t},1),this.drawPieceButton(Xs[c.color+"b"],{x:r.x+l,y:r.y+t*2},2),this.drawPieceButton(Xs[c.color+"n"],{x:r.x+l,y:r.y+t*3},3))}}promotionDialogOnClickPiece(e){if(e.button!==2){let t=e.target.dataset.piece;if(!t&&e.target.closest){const r=e.target.closest(".promotion-dialog-button-group");r&&(t=r.dataset.piece)}t?this.selectPiece(t):this.promotionDialogOnCancel(e)}}selectPiece(e){this.state.callback&&this.state.callback({type:tn.pieceSelected,square:this.state.dialogParams.square,piece:e}),this.setDisplayState(Dt.hidden)}promotionDialogOnCancel(e){this.state.displayState===Dt.shown&&(e.preventDefault(),this.setDisplayState(Dt.hidden),this.state.callback&&this.state.callback({type:tn.canceled}))}contextMenu(e){e.preventDefault(),this.setDisplayState(Dt.hidden),this.state.callback&&this.state.callback({type:tn.canceled})}setDisplayState(e){this.state.displayState=e,e===Dt.shown?(this.clickDelegate=zs.delegate(this.chessboard.view.svg,"pointerdown","*",this.promotionDialogOnClickPiece.bind(this)),this.contextMenuListener=this.contextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener),document.addEventListener("keydown",this.handleKeyDown)):e===Dt.hidden&&(this.clickDelegate.remove(),this.chessboard.view.svg.removeEventListener("contextmenu",this.contextMenuListener),document.removeEventListener("keydown",this.handleKeyDown),this.previouslyFocusedElement&&this.previouslyFocusedElement.focus&&this.previouslyFocusedElement.focus()),this.redrawDialog(),e===Dt.shown&&setTimeout(()=>{this.focusButton(0)},0)}handleKeyDown(e){if(this.state.displayState===Dt.shown)switch(e.key){case"ArrowDown":case"ArrowRight":e.preventDefault(),this.focusedIndex=(this.focusedIndex+1)%4,this.focusButton(this.focusedIndex);break;case"ArrowUp":case"ArrowLeft":e.preventDefault(),this.focusedIndex=(this.focusedIndex-1+4)%4,this.focusButton(this.focusedIndex);break;case"Enter":case" ":e.preventDefault();const t=this.promotionDialogGroup.querySelectorAll(".promotion-dialog-button-group");if(t[this.focusedIndex]){const r=t[this.focusedIndex].dataset.piece;this.selectPiece(r)}break;case"Escape":e.preventDefault(),this.setDisplayState(Dt.hidden),this.state.callback&&this.state.callback({type:tn.canceled});break;case"Tab":e.preventDefault(),e.shiftKey?this.focusedIndex=(this.focusedIndex-1+4)%4:this.focusedIndex=(this.focusedIndex+1)%4,this.focusButton(this.focusedIndex);break}}focusButton(e){const t=this.promotionDialogGroup.querySelectorAll(".promotion-dialog-button-group");if(t.forEach((r,n)=>{r.setAttribute("tabindex",n===e?"0":"-1")}),t[e]){t[e].focus();const r=this.pieceOrder[e];this.announce(this.t.pieces[r])}}announce(e){this.liveRegion.textContent="",setTimeout(()=>{this.liveRegion.textContent=e},50)}destroy(){document.removeEventListener("keydown",this.handleKeyDown),this.liveRegion&&this.liveRegion.parentNode&&this.liveRegion.parentNode.removeChild(this.liveRegion)}}const ga={default:{class:"arrow-success"},success:{class:"arrow-success"},secondary:{class:"arrow-secondary"},warning:{class:"arrow-warning"},info:{class:"arrow-info"},danger:{class:"arrow-danger"}};class yu extends Oi{constructor(e,t={}){super(e),this.registerExtensionPoint(Ve.afterRedrawBoard,()=>{this.onRedrawBoard()}),this.props={sprite:"extensions/arrows/arrows.svg",slice:"arrowDefault",headSize:7,offsetFrom:0,offsetTo:.55},Object.assign(this.props,t),this.chessboard.props.assetsCache&&this.chessboard.view.cacheSpriteToDiv("cm-chessboard-arrows",this.getSpriteUrl()),e.addArrow=this.addArrow.bind(this),e.getArrows=this.getArrows.bind(this),e.removeArrows=this.removeArrows.bind(this),this.arrowGroup=fe.addElement(e.view.markersTopLayer,"g",{class:"arrows"}),this.arrows=[]}onRedrawBoard(){for(;this.arrowGroup.firstChild;)this.arrowGroup.removeChild(this.arrowGroup.firstChild);this.arrows.forEach(e=>{this.drawArrow(e)})}drawArrow(e){const t=this.chessboard.view,r=fe.addElement(this.arrowGroup,"g");r.setAttribute("data-arrow",e.from+e.to),r.setAttribute("class","arrow "+e.type.class);const n=t.squareToPoint(e.from),i=t.squareToPoint(e.to),o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),l=fe.addElement(r,"defs"),c="arrow-"+e.from+e.to,u=fe.addElement(l,"marker",{id:c,markerWidth:this.props.headSize,markerHeight:this.props.headSize,refX:20,refY:20,viewBox:"0 0 40 40",orient:"auto",class:"arrow-head"});fe.addElement(u,"use",{href:`${o}#${this.props.slice}`});const d=n.x+t.squareWidth/2,p=n.y+t.squareHeight/2,f=i.x+t.squareWidth/2,g=i.y+t.squareHeight/2,E=f-d,q=g-p,C=Math.hypot(E,q)||1,N=E/C,j=q/C,x=Math.min(t.squareWidth,t.squareHeight)/2,L=Y=>Math.max(0,Math.min(1,Y)),B=x*L(this.props.offsetFrom),J=x*L(this.props.offsetTo),ee=d+N*B,W=p+j*B,ce=f-N*J,ue=g-j*J,Me=(t.scalingX+t.scalingY)/2*8;let Re=fe.addElement(r,"line");Re.setAttribute("x1",ee.toString()),Re.setAttribute("x2",ce.toString()),Re.setAttribute("y1",W.toString()),Re.setAttribute("y2",ue.toString()),Re.setAttribute("class","arrow-line"),Re.setAttribute("marker-end","url(#"+c+")"),Re.setAttribute("stroke-width",Me+"px")}addArrow(e,t,r){this.arrows.push(new ku(t,r,e)),this.chessboard.view.redrawBoard()}getArrows(e=void 0,t=void 0,r=void 0){let n=[];return this.arrows.forEach(i=>{i.matches(t,r,e)&&n.push(i)}),n}removeArrows(e=void 0,t=void 0,r=void 0){this.arrows=this.arrows.filter(n=>!n.matches(t,r,e)),this.chessboard.view.redrawBoard()}getSpriteUrl(){return zs.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class ku{constructor(e,t,r){this.from=e,this.to=t,this.type=r}matches(e=void 0,t=void 0,r=void 0){return e&&e!==this.from||t&&t!==this.to?!1:!(r&&r!==this.type)}}const dr={frame:{class:"marker-frame",slice:"markerFrame"},dot:{class:"marker-dot",slice:"markerDot",position:"above"},bevel:{class:"marker-bevel",slice:"markerBevel"}};class Eu extends Oi{constructor(e,t={}){super(e),this.registerExtensionPoint(Ve.afterRedrawBoard,()=>{this.onRedrawBoard()}),this.props={autoMarkers:dr.frame,sprite:"extensions/markers/markers.svg"},Object.assign(this.props,t),e.props.assetsCache&&e.view.cacheSpriteToDiv("cm-chessboard-markers",this.getSpriteUrl()),e.addMarker=this.addMarker.bind(this),e.getMarkers=this.getMarkers.bind(this),e.removeMarkers=this.removeMarkers.bind(this),e.addLegalMovesMarkers=this.addLegalMovesMarkers.bind(this),e.removeLegalMovesMarkers=this.removeLegalMovesMarkers.bind(this),this.markerGroupDown=fe.addElement(e.view.markersLayer,"g",{class:"markers"}),this.markerGroupUp=fe.addElement(e.view.markersTopLayer,"g",{class:"markers"}),this.markers=[],this.props.autoMarkers&&(Object.assign(this.props.autoMarkers,this.props.autoMarkers),this.registerExtensionPoint(Ve.moveInput,r=>{this.drawAutoMarkers(r)}))}drawAutoMarkers(e){e.type!==Ht.moveInputFinished&&this.removeMarkers(this.props.autoMarkers),!(e.type===Ht.moveInputStarted&&!e.moveInputCallbackResult)&&(e.type===Ht.moveInputStarted||e.type===Ht.movingOverSquare)&&(e.squareFrom&&this.addMarker(this.props.autoMarkers,e.squareFrom),e.squareTo&&this.addMarker(this.props.autoMarkers,e.squareTo))}onRedrawBoard(){for(;this.markerGroupUp.firstChild;)this.markerGroupUp.removeChild(this.markerGroupUp.firstChild);for(;this.markerGroupDown.firstChild;)this.markerGroupDown.removeChild(this.markerGroupDown.firstChild);this.markers.forEach(e=>{this.drawMarker(e)})}addLegalMovesMarkers(e){for(const t of e)t.promotion&&t.promotion!=="q"||(this.chessboard.getPiece(t.to)?this.chessboard.addMarker(dr.bevel,t.to):this.chessboard.addMarker(dr.dot,t.to))}removeLegalMovesMarkers(){this.chessboard.removeMarkers(dr.bevel),this.chessboard.removeMarkers(dr.dot)}drawMarker(e){let t;e.type.position==="above"?t=fe.addElement(this.markerGroupUp,"g"):t=fe.addElement(this.markerGroupDown,"g"),t.setAttribute("data-square",e.square);const r=this.chessboard.view.squareToPoint(e.square),n=this.chessboard.view.svg.createSVGTransform();n.setTranslate(r.x,r.y),t.transform.baseVal.appendItem(n);const i=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),o=fe.addElement(t,"use",{href:`${i}#${e.type.slice}`,class:"marker "+e.type.class}),l=this.chessboard.view.svg.createSVGTransform();return l.setScale(this.chessboard.view.scalingX,this.chessboard.view.scalingY),o.transform.baseVal.appendItem(l),t}addMarker(e,t){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x");return}this.markers.push(new Su(t,e)),this.onRedrawBoard()}getMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");return}let r=[];return this.markers.forEach(n=>{n.matches(t,e)&&r.push(n)}),r}removeMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x");return}this.markers=this.markers.filter(r=>!r.matches(t,e)),this.onRedrawBoard()}getSpriteUrl(){return zs.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class Su{constructor(e,t){this.square=e,this.type=t}matches(e=void 0,t=void 0){if(!t&&!e)return!0;if(t){if(e){if(this.type===t&&e===this.square)return!0}else if(this.type===t)return!0}else if(e===this.square)return!0;return!1}}var Cu=F('<div class="chessboard-container svelte-ipgdpj"></div>');function _o(s,e){As(e,!0);let t=is(e,"fen",19,()=>on.start),r=is(e,"orientation",3,"white"),n=is(e,"arrows",19,()=>[]),i=is(e,"markers",19,()=>[]),o=is(e,"inputMode",3,"none"),l=is(e,"showCoordinates",3,!0),c,u=null,d=null;Br(()=>{const x=[];x.push({class:wu}),x.push({class:yu}),x.push({class:Eu,props:{autoMarkers:null}}),u=new _u(c,{position:t(),orientation:r()==="white"?Jt.white:Jt.black,responsive:!0,assetsUrl:"/cm-chessboard/",style:{cssClass:"default",showCoordinates:l(),borderType:"none",aspectRatio:1,animationDuration:200},extensions:x}),p(o()),q()}),uo(()=>{u?.destroy(),u=null}),ct(()=>{u&&t()&&u.setPosition(t(),!0)}),ct(()=>{if(u){const x=r()==="white"?Jt.white:Jt.black;u.setOrientation(x,!0)}}),ct(()=>{if(u&&(u.removeArrows(),c?.querySelector("svg .engine-hover-defs")?.remove(),n().length!==0)){for(const x of n()){const L=x.type?ga[x.type]:ga.default;u.addArrow(L,x.from,x.to)}for(const x of n()){const L=x.from+x.to,B=c?.querySelector(`[data-arrow="${L}"]`);if(B&&(B.style.opacity=String(x.opacity),x.engineHover)){const J=B.querySelector(".arrow-line"),ee=B.querySelector("defs"),W=ee?.querySelector("marker");if(!J||!ee||!W)continue;const ce="http://www.w3.org/2000/svg",ue=B.closest("svg");if(!ue)continue;let Me=ue.querySelector(".engine-hover-defs");Me||(Me=document.createElementNS(ce,"defs"),Me.setAttribute("class","engine-hover-defs"),ue.appendChild(Me));const Re=`mask-head-${L}`,Y=W.cloneNode(!0);Y.id=Re;const ye=Y.querySelector("use");ye&&(ye.style.fill="black"),Me.appendChild(Y);const ke=`outline-mask-${L}`,de=document.createElementNS(ce,"mask");de.id=ke,de.setAttribute("maskUnits","userSpaceOnUse"),de.setAttribute("x","0"),de.setAttribute("y","0"),de.setAttribute("width","10000"),de.setAttribute("height","10000");const Se=document.createElementNS(ce,"rect");Se.setAttribute("x","0"),Se.setAttribute("y","0"),Se.setAttribute("width","10000"),Se.setAttribute("height","10000"),Se.setAttribute("fill","white"),de.appendChild(Se);const oe=J.cloneNode(!0);oe.setAttribute("stroke","black"),oe.style.opacity="1",oe.style.strokeLinecap="round",oe.setAttribute("marker-end",`url(#${Re})`),de.appendChild(oe),Me.appendChild(de);const Ce=document.createElementNS(ce,"g");Ce.setAttribute("class","arrow-engine-outline"),Ce.setAttribute("mask",`url(#${ke})`);const xe=`outline-head-${L}`,z=W.cloneNode(!0);z.id=xe;const ve=z.querySelector("use");ve&&(ve.style.fill="blue");const Ne=document.createElementNS(ce,"defs");Ne.appendChild(z),Ce.appendChild(Ne);const $e=J.cloneNode(!0),Pe=parseFloat(J.getAttribute("stroke-width")||"0");$e.setAttribute("stroke-width",String(Pe+5)),$e.style.stroke="blue",$e.style.opacity="1",$e.style.strokeLinecap="round",$e.setAttribute("marker-end",`url(#${xe})`),Ce.appendChild($e),B.parentNode.insertBefore(Ce,B)}}}}),ct(()=>{if(u){u.removeMarkers(dr.dot);for(const x of i())u.addMarker(dr.dot,x.square)}}),ct(()=>{u&&o()!==d&&p(o())});function p(x){if(u){u.disableMoveInput();try{u.disableSquareSelect()}catch{}d=x,x==="legal"?u.enableMoveInput(f):x==="free"?u.enableMoveInput(g):x==="none"&&u.enableSquareSelect(mo.pointerdown,E)}}function f(x){if(x.type===Ht.moveInputStarted)return!0;if(x.type===Ht.validateMoveInput){const L=x.squareFrom,B=x.squareTo,J=x.piece,ee=J==="wp"&&B[1]==="8",W=J==="bp"&&B[1]==="1";if(ee||W){const ce=J[0];return u?.showPromotionDialog(B,ce,ue=>{if(ue.type===tn.pieceSelected&&ue.piece){const Me=ue.piece[1];e.onMove?.(L,B,Me)&&u?.setPosition(t(),!0)}}),!1}return e.onMove?.(L,B)??!1}x.type===Ht.moveInputFinished&&x.legalMove&&u?.setPosition(t(),!1)}function g(x){if(x.type===Ht.moveInputStarted)return!0;if(x.type===Ht.validateMoveInput){const L=x.squareFrom,B=x.squareTo,J=x.piece,ee=J[0]==="w"?J[1].toUpperCase():J[1].toLowerCase();return e.onFreeDrop?.(L,B,ee),!0}}function E(x){const L=x.square;L&&e.onSquareClick?.(L)}function q(){if(!c||!e.onArrowHover)return;const x=c.querySelector(".arrows");if(!x)return;let L=null;c.addEventListener("mousemove",B=>{x.style.pointerEvents="auto";const J=document.elementFromPoint(B.clientX,B.clientY);x.style.pointerEvents="none";const W=J?.closest?.("[data-arrow]")?.getAttribute("data-arrow")||null;W!==L&&(L=W,e.onArrowHover?.(W))}),c.addEventListener("mouseleave",()=>{L&&(L=null,e.onArrowHover?.(null))})}function C(x,L){if(!c)return;const B=c.querySelector(`[data-arrow="${x}"]`);B&&(L?(B.dataset.savedOpacity=B.style.opacity,B.style.opacity="1"):B.style.opacity=B.dataset.savedOpacity||"")}var N={highlightArrow:C},j=Cu();return Tn(j,x=>c=x,()=>c),T(s,j),Is(N)}var xu=F('<span class="eval-label eval-label-dark svelte-5gau2q"> </span>'),Pu=F('<span class="eval-label svelte-5gau2q"> </span>'),qu=F('<div><div class="eval-fill-black svelte-5gau2q"><!></div> <div class="eval-fill-white svelte-5gau2q"><!></div></div>');function Au(s,e){As(e,!0);let t=is(e,"evaluation",3,null),r=is(e,"orientation",3,"white");const n=he(()=>t()===null?50:t().type==="mate"?t().moves>0?100:0:1/(1+Math.exp(-t().pawns*.5))*100),i=he(()=>{if(t()===null)return"Â·Â·Â·";if(t().type==="mate"){const q=Math.abs(t().moves);return t().moves>0?`M${q}`:`âM${q}`}return`${t().pawns>=0?"+":"â"}${Math.abs(t().pawns).toFixed(1)}`});var o=qu();let l;var c=w(o),u=w(c);{var d=E=>{var q=xu(),C=w(q);Q(()=>R(C,a(i))),T(E,q)};we(u,E=>{a(n)<50&&E(d)})}var p=S(c,2),f=w(p);{var g=E=>{var q=Pu(),C=w(q);Q(()=>R(C,a(i))),T(E,q)};we(f,E=>{a(n)>=50&&E(g)})}Q(()=>{l=_e(o,1,"eval-bar svelte-5gau2q",null,l,{flipped:r()==="black"}),Gs(c,`height: ${100-a(n)}%`),Gs(p,`height: ${a(n)??""}%`)}),T(s,o),Is()}let gs=D(ut([])),gr=D(0),ln=D(ut(new lr)),Iu=he(()=>a(ln).fen()),mr=D(ut([]));function Mu(){const s=new lr,e=[];for(const t of a(gs))try{const r=s.move({from:t.slice(0,2),to:t.slice(2,4),promotion:t[4]});e.push(r.san)}catch{e.push(t)}h(mr,e,!0)}const Te={get moves(){return a(gs)},get index(){return a(gr)},get fen(){return a(Iu)},get sanList(){return a(mr)}};function Ri(s,e,t){a(gr)<a(gs).length&&(h(gs,a(gs).slice(0,a(gr)),!0),h(mr,a(mr).slice(0,a(gr)),!0));try{const r=new lr(a(ln).fen()),n=r.move({from:s,to:e,promotion:t});if(!n)return!1;const i=s+e+(t||"");return h(gs,[...a(gs),i],!0),h(mr,[...a(mr),n.san],!0),$l(gr),h(ln,r,!0),!0}catch{return!1}}function es(s){const e=Math.max(0,Math.min(s,a(gs).length));h(gr,e,!0);const t=new lr;for(let r=0;r<e;r++){const n=a(gs)[r];try{t.move({from:n.slice(0,2),to:n.slice(2,4),promotion:n[4]})}catch{break}}h(ln,t,!0)}function bi(){h(gs,[],!0),h(gr,0),h(ln,new lr,!0),h(mr,[],!0)}function bo(s,e){h(gs,[...s],!0),Mu(),es(Math.min(e,s.length))}let Ar=D(ut([])),Tu=0;function Lu(s,e=2e3){const t=Tu++;a(Ar).push({id:t,message:s,visible:!1}),requestAnimationFrame(()=>{const r=a(Ar).find(n=>n.id===t);r&&(r.visible=!0)}),setTimeout(()=>{const r=a(Ar).find(n=>n.id===t);r&&(r.visible=!1),setTimeout(()=>{h(Ar,a(Ar).filter(n=>n.id!==t),!0)},300)},e)}var Du=F("<div> </div>");function Ou(s){var e=Hs(),t=et(e);Ot(t,17,()=>a(Ar),Ps,(r,n)=>{var i=Du();let o;var l=w(i);Q(()=>{o=_e(i,1,"toast-notification svelte-1w29e1y",null,o,{visible:a(n).visible}),R(l,a(n).message)}),T(r,i)}),T(s,e)}let Bn=D(null),Un=D(0),cn=D(ut([])),Gn=D(!1),mt=null,Ni=0,wi=0,wo="white";const _r={get eval(){return a(Bn)},get depth(){return a(Un)},get lines(){return a(cn)},get ready(){return a(Gn)}};function Ru(s){const e=s.match(/\bdepth (\d+)/);if(!e)return null;const t=parseInt(e[1],10);let r;const n=s.match(/\bscore cp (-?\d+)/);if(n)r={type:"cp",pawns:parseInt(n[1],10)/100};else{const u=s.match(/\bscore mate (-?\d+)/);if(u)r={type:"mate",moves:parseInt(u[1],10)};else return null}const i=s.match(/\bmultipv (\d+)/),o=i?parseInt(i[1],10):1;let l=[];const c=s.indexOf(" pv ");return c!==-1&&(l=s.slice(c+4).split(/\s+/).filter(Boolean)),{eval:r,depth:t,multipv:o,pvUci:l}}function Nu(s){const e=typeof s.data=="string"?s.data:String(s.data);if(e==="readyok"){wi++;return}if(e.startsWith("bestmove")||wi<Ni||!e.startsWith("info")||!e.includes(" score "))return;const t=Ru(e);if(t){let r;wo==="black"?t.eval.type==="cp"?r={type:"cp",pawns:-t.eval.pawns}:r={type:"mate",moves:-t.eval.moves}:r=t.eval;const n={multipv:t.multipv,eval:r,depth:t.depth,pvUci:t.pvUci},i=t.multipv-1,o=[...a(cn)];for(;o.length<=i;){const l=o.length+1;o.push({multipv:l,eval:r,depth:t.depth,pvUci:[]})}o[i]=n,h(cn,o,!0),t.multipv===1&&(h(Bn,r,!0),h(Un,t.depth,!0))}}function $u(){return new Promise((s,e)=>{try{mt=new Worker("/stockfish/stockfish-17.1-lite-51f59da.js")}catch(r){e(r);return}let t=!1;mt.onmessage=r=>{const n=typeof r.data=="string"?r.data:String(r.data);if(!t&&n==="uciok"){const i=Math.min(navigator.hardwareConcurrency||1,4);mt.postMessage(`setoption name Threads value ${i}`),mt.postMessage("setoption name Hash value 128"),mt.postMessage("setoption name MultiPV value 3"),mt.postMessage("isready"),t=!0;return}if(t&&n==="readyok"){mt.onmessage=Nu,h(Gn,!0),s();return}},mt.onerror=r=>{e(new Error("Stockfish worker failed to load: "+r.message))},mt.postMessage("uci")})}function Fu(s){if(!mt||!a(Gn))return;Ni++,h(Bn,null),h(Un,0),h(cn,[],!0),wo=s.length%2===0?"white":"black",mt.postMessage("stop"),mt.postMessage("isready");const e=s.length===0?"position startpos":"position startpos moves "+s.join(" ");mt.postMessage(e),mt.postMessage("go infinite")}function Bu(){mt&&(mt.postMessage("quit"),mt.terminate(),mt=null),h(Bn,null),h(Un,0),h(cn,[],!0),h(Gn,!1),Ni=0,wi=0}var Uu=F('<div class="engine-line svelte-eu7elq"><span class="engine-moves svelte-eu7elq">&middot;&middot;&middot;</span></div>'),Gu=F('<div class="engine-line clickable svelte-eu7elq" role="button" tabindex="0"><span> </span> <span class="engine-moves svelte-eu7elq"> </span></div>'),Ku=F('<span class="move-list-empty svelte-eu7elq">Starting position</span>'),Hu=F("<td> </td>"),Wu=F('<td class="svelte-eu7elq"></td>'),zu=F('<tr class="svelte-eu7elq"><td class="move-number svelte-eu7elq"></td><td> </td><!></tr>'),Vu=F('<table class="move-table svelte-eu7elq"></table>'),ju=F('<div class="engine-section svelte-eu7elq"><div class="engine-header svelte-eu7elq"><span class="engine-label svelte-eu7elq"> </span></div> <!></div> <div class="current-line-section svelte-eu7elq"><h3 class="section-title svelte-eu7elq">Current Line</h3> <div class="move-list svelte-eu7elq"><!></div></div> <div class="vcr-controls svelte-eu7elq"><button class="vcr-btn svelte-eu7elq" title="Start">â®</button> <button class="vcr-btn svelte-eu7elq" title="Back">â</button> <button class="vcr-btn svelte-eu7elq" title="Forward">â¶</button> <button class="vcr-btn svelte-eu7elq" title="End">â­</button></div> <div class="export-controls svelte-eu7elq"><button class="export-btn svelte-eu7elq">Copy PGN</button></div>',1);function Yu(s,e){As(e,!0);let t;function r(Y,ye){if(ye.length===0)return"";const ke=new lr(Y),de=[],Se=ke.turn()==="w"?0:1;for(let oe=0;oe<ye.length;oe++){const Ce=ye[oe];try{const xe=ke.move({from:Ce.slice(0,2),to:Ce.slice(2,4),promotion:Ce[4]}),z=Se+oe;z%2===0?de.push(`${Math.floor(z/2)+1}.${xe.san}`):oe===0?de.push(`${Math.floor(z/2)+1}...${xe.san}`):de.push(xe.san)}catch{de.push(Ce);break}}return de.join(" ")}function n(Y){if(!Y)return;const ye=Y.slice(0,2),ke=Y.slice(2,4),de=Y[4];Ri(ye,ke,de)}ct(()=>{Te.index,io().then(()=>{const Y=t?.querySelector(".move-san.active");Y&&Y.scrollIntoView({block:"nearest",behavior:"smooth"})})});const i=he(()=>Te.index===0),o=he(()=>Te.index>=Te.moves.length);function l(){let Y="";const ye=Te.sanList;for(let ke=0;ke<ye.length;ke++)ke%2===0?(ke>0&&(Y+=" "),Y+=`${Math.floor(ke/2)+1}. ${ye[ke]}`):Y+=` ${ye[ke]}`;return Y}function c(){const Y=l();Y&&navigator.clipboard.writeText(Y).then(()=>Lu("Copied!"))}var u=ju(),d=et(u),p=w(d),f=w(p),g=w(f),E=S(p,2);{var q=Y=>{var ye=Uu();T(Y,ye)},C=Y=>{var ye=Hs(),ke=et(ye);Ot(ke,17,()=>_r.lines,de=>de.multipv,(de,Se)=>{var oe=Gu();oe.__click=()=>n(a(Se).pvUci[0]);var Ce=w(oe);let xe;var z=w(Ce),ve=S(Ce,2),Ne=w(ve);Q(($e,Pe,Qe)=>{xe=_e(Ce,1,"eval-badge svelte-eu7elq",null,xe,$e),R(z,Pe),R(Ne,Qe)},[()=>({positive:!Gr(a(Se).eval),negative:Gr(a(Se).eval)}),()=>Di(a(Se).eval),()=>r(Te.fen,a(Se).pvUci)]),Ks("mouseenter",oe,()=>e.onEngineLineHover?.(a(Se).pvUci[0]??null)),Ks("mouseleave",oe,()=>e.onEngineLineHover?.(null)),T(de,oe)}),T(Y,ye)};we(E,Y=>{_r.lines.length===0?Y(q):Y(C,!1)})}var N=S(d,2),j=S(w(N),2),x=w(j);{var L=Y=>{var ye=Ku();T(Y,ye)},B=Y=>{var ye=Vu();Ot(ye,21,()=>Array(Math.ceil(Te.sanList.length/2)),Ps,(ke,de,Se)=>{const oe=he(()=>Se*2);var Ce=zu(),xe=w(Ce);xe.textContent=`${Se+1}.`;var z=S(xe);let ve;z.__click=()=>es(a(oe)+1);var Ne=w(z),$e=S(z);{var Pe=Oe=>{var it=Hu();let dt;it.__click=()=>es(a(oe)+2);var Vt=w(it);Q(()=>{dt=_e(it,1,"move-san svelte-eu7elq",null,dt,{active:a(oe)+2===Te.index}),R(Vt,Te.sanList[a(oe)+1])}),T(Oe,it)},Qe=Oe=>{var it=Wu();T(Oe,it)};we($e,Oe=>{a(oe)+1<Te.sanList.length?Oe(Pe):Oe(Qe,!1)})}Q(()=>{ve=_e(z,1,"move-san svelte-eu7elq",null,ve,{active:a(oe)+1===Te.index}),R(Ne,Te.sanList[a(oe)])}),T(ke,Ce)}),T(Y,ye)};we(x,Y=>{Te.sanList.length===0?Y(L):Y(B,!1)})}Tn(j,Y=>t=Y,()=>t);var J=S(N,2),ee=w(J);ee.__click=()=>es(0);var W=S(ee,2);W.__click=()=>es(Te.index-1);var ce=S(W,2);ce.__click=()=>es(Te.index+1);var ue=S(ce,2);ue.__click=()=>es(Te.moves.length);var Me=S(J,2),Re=w(Me);Re.__click=c,Q(()=>{R(g,`Engine${_r.depth>0?` Â· depth ${_r.depth}`:""}`),ee.disabled=a(i),W.disabled=a(i),ce.disabled=a(o),ue.disabled=a(o)}),T(s,u),Is()}pn(["click"]);let $i=D(null),Kn=D("white"),Hn=D(null),Wn=D(ut([])),zn=D("explorer"),Kr=D("white");const Ie={get playerContext(){return a($i)},get playerColor(){return a(Kn)},get timeControl(){return a(Hn)},get availableTimeControls(){return a(Wn)},get activeMode(){return a(zn)},get boardOrientation(){return a(Kr)}};function Qu(s){h($i,s,!0),h(Kn,"white"),h(Hn,null),h(Wn,[],!0),h(zn,"explorer"),h(Kr,"white")}function Xu(){h($i,null),h(Kn,"white"),h(Hn,null),h(Wn,[],!0),h(zn,"explorer"),h(Kr,"white")}function ai(s){h(Kn,s,!0)}function yi(){h(Kr,a(Kr)==="white"?"black":"white",!0)}function Zu(s){h(Kr,s,!0)}function Ju(s){h(Hn,s,!0)}function ef(s){h(Wn,s,!0)}function ma(s){h(zn,s,!0)}const tf=50,Rs=new Map;function yo(s,e,t,r){return JSON.stringify([s,e,t,r])}function sf(s,e,t,r){const n=yo(s,e,t,r),i=Rs.get(n);return i!==void 0&&(Rs.delete(n),Rs.set(n,i)),i}function rf(s,e,t,r,n){const i=yo(s,e,t,r);if(Rs.delete(i),Rs.set(i,n),Rs.size>tf){const o=Rs.keys().next().value;o!==void 0&&Rs.delete(o)}}function nf(){Rs.clear()}class ko extends Map{#e=new Map;#s=D(0);#t=D(0);#a=Us||-1;constructor(e){if(super(),e){for(var[t,r]of e)super.set(t,r);this.#t.v=super.size}}#n(e){return Us===this.#a?D(e):nr(e)}has(e){var t=this.#e,r=t.get(e);if(r===void 0){var n=super.get(e);if(n!==void 0)r=this.#n(0),t.set(e,r);else return a(this.#s),!1}return a(r),!0}forEach(e,t){this.#r(),super.forEach(e,t)}get(e){var t=this.#e,r=t.get(e);if(r===void 0){var n=super.get(e);if(n!==void 0)r=this.#n(0),t.set(e,r);else{a(this.#s);return}}return a(r),super.get(e)}set(e,t){var r=this.#e,n=r.get(e),i=super.get(e),o=super.set(e,t),l=this.#s;if(n===void 0)n=this.#n(0),r.set(e,n),h(this.#t,super.size),xs(l);else if(i!==t){xs(n);var c=l.reactions===null?null:new Set(l.reactions),u=c===null||!n.reactions?.every(d=>c.has(d));u&&xs(l)}return o}delete(e){var t=this.#e,r=t.get(e),n=super.delete(e);return r!==void 0&&(t.delete(e),h(this.#t,super.size),h(r,-1),xs(this.#s)),n}clear(){if(super.size!==0){super.clear();var e=this.#e;h(this.#t,0);for(var t of e.values())h(t,-1);xs(this.#s),e.clear()}}#r(){a(this.#s);var e=this.#e;if(this.#t.v!==e.size){for(var t of super.keys())if(!e.has(t)){var r=this.#n(0);e.set(t,r)}}for([,r]of this.#e)a(r)}keys(){return a(this.#s),super.keys()}values(){return this.#r(),super.values()}entries(){return this.#r(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return a(this.#t),super.size}}const Eo=15,af=2,of=64,lf=200;let rr=new ko,un=D(0),fn=D(0),So=D(Eo),lt=null,br=!1,Ln=[],Hr=[],ki="continuation",Co=[],xo=[],Fi=0,Ei=0,xn="",Po="continuation",ds=null;const vs={get cache(){return rr},get continuationFensLeft(){return a(un)},get posSearchFensLeft(){return a(fn)}};function cf(s){const e=s.match(/\bdepth (\d+)/);if(!e)return null;const t=parseInt(e[1],10),r=s.match(/\bscore cp (-?\d+)/);if(r)return{eval:{type:"cp",pawns:parseInt(r[1],10)/100},depth:t};const n=s.match(/\bscore mate (-?\d+)/);return n?{eval:{type:"mate",moves:parseInt(n[1],10)},depth:t}:null}function uf(s){const e=typeof s.data=="string"?s.data:String(s.data);if(e==="readyok"){Ei++;return}if(e.startsWith("bestmove")){if(ds&&xn){const r=xn.split(" ")[1];let n;r==="b"?ds.eval.type==="cp"?n={type:"cp",pawns:-ds.eval.pawns}:n={type:"mate",moves:-ds.eval.moves}:n=ds.eval,rr.set(xn,{eval:n,depth:ds.depth}),Po==="continuation"?h(un,Math.max(0,a(un)-1),!0):h(fn,Math.max(0,a(fn)-1),!0)}Bi();return}if(Ei<Fi||!e.startsWith("info")||!e.includes(" score "))return;const t=cf(e);t&&(!ds||t.depth>ds.depth)&&(ds=t)}function Bi(){if(!lt){br=!1;return}for(;;){let s;const e=ki==="continuation"?Ln:Hr,t=ki==="continuation"?Hr:Ln;if(e.length>0)s=e.shift();else if(t.length>0)s=t.shift();else{br=!1;return}if(!s){br=!1;return}if(!rr.has(s.fen)){br=!0,xn=s.fen,Po=s.source,ds=null,Fi++,lt.postMessage("stop"),lt.postMessage("isready"),lt.postMessage(`position fen ${s.fen}`),lt.postMessage(`go depth ${a(So)}`);return}}}function ff(){const s=Co.length+xo.length+lf;for(;rr.size>s;){const e=rr.keys().next().value;if(e===void 0)break;rr.delete(e)}}function hf(){return new Promise((s,e)=>{try{lt=new Worker("/stockfish/stockfish-17.1-lite-51f59da.js")}catch(r){e(r);return}let t=!1;lt.onmessage=r=>{const n=typeof r.data=="string"?r.data:String(r.data);if(!t&&n==="uciok"){const i=Math.min(navigator.hardwareConcurrency||1,af);lt.postMessage(`setoption name Threads value ${i}`),lt.postMessage(`setoption name Hash value ${of}`),lt.postMessage("setoption name MultiPV value 1"),lt.postMessage("isready"),t=!0;return}if(t&&n==="readyok"){lt.onmessage=uf,s();return}},lt.onerror=r=>{e(new Error("Eval queue worker failed to load: "+r.message))},lt.postMessage("uci")})}function df(){lt&&(lt.postMessage("quit"),lt.terminate(),lt=null),rr=new ko,h(un,0),h(fn,0),h(So,Eo),br=!1,Ln=[],Hr=[],Fi=0,Ei=0,ds=null}function qo(s,e){const t=e.filter(n=>!rr.has(n)),r=t.map(n=>({fen:n,source:s}));s==="continuation"?(Ln=r,h(un,t.length,!0),Co=e):(Hr=r,h(fn,t.length,!0),xo=e),ff(),!br&&lt&&Bi()}function vf(s,e){Hr=[...e.map(r=>({fen:r,source:s})),...Hr],!br&&lt&&Bi()}function pf(s){ki=s}var gf=F('<div class="cont-loading svelte-1wi8bi9">Loading...</div>'),mf=F('<div class="cont-empty svelte-1wi8bi9">No games from this position</div>'),_f=F("<span> </span>"),bf=F('<span class="eval-badge eval-pending svelte-1wi8bi9"><span class="eval-spinner svelte-1wi8bi9">â¿</span></span>'),wf=F('<div class="cont-loading svelte-1wi8bi9">Loading games...</div>'),yf=F('<div class="cont-empty svelte-1wi8bi9">No games found</div>'),kf=F("<button> </button>"),Ef=F("<strong> </strong>"),Sf=F("<strong> </strong>"),Cf=F('<div class="game-row svelte-1wi8bi9" role="button" tabindex="0"><span class="game-players svelte-1wi8bi9"><!> <!> </span> <span class="game-result svelte-1wi8bi9"> </span> <span class="game-date svelte-1wi8bi9"> </span></div>'),xf=F('<button class="show-all-games svelte-1wi8bi9"> </button>'),Pf=F('<div class="game-sort-controls svelte-1wi8bi9"><span class="sort-label svelte-1wi8bi9">Sort:</span> <!></div> <div class="game-list svelte-1wi8bi9"></div> <!>',1),qf=F('<div class="cont-expanded svelte-1wi8bi9"><!></div>'),Af=F('<div role="button" tabindex="0"><span class="cont-count svelte-1wi8bi9"> </span> <span class="cont-move svelte-1wi8bi9"> </span> <!> <div class="wdl-bar svelte-1wi8bi9"><div class="wdl-white svelte-1wi8bi9"> </div> <div class="wdl-draw svelte-1wi8bi9"> </div> <div class="wdl-black svelte-1wi8bi9"> </div></div> <span class="cont-perf svelte-1wi8bi9"> </span> <button class="cont-show-games svelte-1wi8bi9"> </button></div> <!>',1),If=F('<div class="cont-game-count svelte-1wi8bi9"> </div> <div class="cont-list svelte-1wi8bi9"></div>',1),Mf=F('<div class="continuations-header svelte-1wi8bi9"><h2 class="panel-title svelte-1wi8bi9">Continuations</h2> <div class="sort-controls svelte-1wi8bi9"><span class="sort-label svelte-1wi8bi9">Sort:</span> <button> </button> <button> </button> <button> </button></div></div> <div class="cont-toolbar svelte-1wi8bi9"><button class="cont-nav-btn svelte-1wi8bi9" title="Go back">&#8593;</button> <button class="cont-nav-btn svelte-1wi8bi9" title="Go to start">&#8962;</button> <label class="transposition-toggle svelte-1wi8bi9"><input type="checkbox" class="svelte-1wi8bi9"/> Transpositions</label></div> <div class="cont-content"><!></div>',1);function Tf(s,e){As(e,!0);let t=is(e,"highlightedArrowUci",3,null),r=D(ut([])),n=D(""),i=D(!1),o=0,l=D("games"),c=D(!1),u=D(!1),d=D(null),p=D(null),f=D(ut([])),g=D(!1),E=D(!1),q=D("date"),C=D(!1);function N(I,$){const pe=new lr(I);try{return pe.move({from:$.slice(0,2),to:$.slice(2,4),promotion:$[4]}).san}catch{return console.error(`UCI-to-SAN failed for "${$}" â not a legal move at FEN "${I}"`),"â "+$}}const j=he(()=>{if(a(r).length===0)return[];const I=Math.max(...a(r).map($=>$.gameCount));return a(r).map($=>({from:$.move.slice(0,2),to:$.move.slice(2,4),opacity:Math.max(.4,$.gameCount/I)}))});ct(()=>{e.onArrowsChanged(a(j))}),ct(()=>{if(a(r).length===0||!a(n))return;const I=a(n),$=a(r).map(pe=>wn(I,pe.move));qo("continuation",$)});const x=he(()=>a(r).reduce((I,$)=>I+$.gameCount,0));function L(I){return I.eval.type==="cp"?I.eval.pawns:I.eval.moves>0?1e4-I.eval.moves:-1e4-I.eval.moves}function B(I,$,pe){const ge=[...I],re=pe?1:-1;if($==="eval"){const ie=a(n).split(" ")[1]==="w"?1:-1;ge.sort((ae,Be)=>{const Fe=wn(a(n),ae.move),Ue=wn(a(n),Be.move),Ge=vs.cache.get(Fe),me=vs.cache.get(Ue);return!Ge&&!me?0:Ge?me?re*ie*(L(Ge)-L(me)):-1:1})}else $==="perf"?ge.sort((ie,ae)=>re*(ie.performanceRating-ae.performanceRating)):ge.sort((ie,ae)=>re*(ie.gameCount-ae.gameCount));return ge}function J(I,$,pe){const ge=[...I],re=pe?1:-1;if($==="result"){const ie={"1-0":0,"1/2-1/2":1,"0-1":2};ge.sort((ae,Be)=>re*((ie[ae.result]??3)-(ie[Be.result]??3)))}else if($==="elo"){const ie=ae=>ae.playerColor==="white"?ae.blackRating:ae.whiteRating;ge.sort((ae,Be)=>re*(ie(ae)-ie(Be)))}else ge.sort((ie,ae)=>re*(ie.date-ae.date));return ge}function ee(I){I.length===1&&I[0].gameCount<10&&Me(I[0].move,I[0].gameIds)}Hl(()=>{const I=Ie.playerContext;if(!I)return;const $=Te.moves.slice(0,Te.index),pe=Ie.playerColor,ge=Ie.timeControl,re=a(u),ie=sf($,pe,ge,re);if(ie){const Fe=B(ie,a(l),a(c));h(r,Fe,!0),h(n,Te.fen,!0),h(i,!1),h(p,null),h(f,[],!0),ee(Fe);return}const ae=++o,Be=Te.fen;h(i,!0),h(p,null),h(f,[],!0),h(g,!1),h(E,!1),Cc(I.username,I.platform,I.since,I.until,$,pe,ge,re).then(Fe=>{if(ae!==o)return;rf($,pe,ge,re,Fe);const Ue=B(Fe,a(l),a(c));h(r,Ue,!0),h(n,Be,!0),h(i,!1),ee(Ue)}).catch(Fe=>{ae===o&&(h(i,!1),h(r,[],!0),h(n,Be,!0),console.error("getContinuations failed:",Fe))})});function W(I){I===a(l)?h(c,!a(c)):(h(l,I,!0),h(c,!1)),h(r,B(a(r),a(l),a(c)),!0)}function ce(I,$,pe){const re={games:"Games",perf:"Perf",eval:"Eval"}[I]||I;return I===$?`${re} ${pe?"â²":"â¼"}`:re}function ue(I){const $=I.slice(0,2),pe=I.slice(2,4),ge=I[4];Ri($,pe,ge)}function Me(I,$){h(p,I,!0),h(f,[],!0),h(g,!0),h(E,!1),h(q,"date"),h(C,!1);const pe=Ie.playerContext;vo(pe.username,pe.platform,$).then(ge=>{a(p)===I&&(h(f,J(ge,a(q),a(C)),!0),h(g,!1))}).catch(ge=>{a(p)===I&&(h(g,!1),h(f,[],!0),console.error("getGamesMetadata failed:",ge))})}function Re(I,$){if(a(p)===I){h(p,null),h(f,[],!0),h(g,!1),h(E,!1);return}Me(I,$)}function Y(I){I===a(q)?h(C,!a(C)):(h(q,I,!0),h(C,!1)),h(f,J(a(f),a(q),a(C)),!0)}function ye(I){const pe={date:"Date",result:"Result",elo:"Elo"}[I]||I;return I===a(q)?`${pe} ${a(C)?"â²":"â¼"}`:pe}function ke(I){const $=I.whiteWins+I.draws+I.blackWins;return{wPct:$>0?I.whiteWins/$*100:0,dPct:$>0?I.draws/$*100:0,bPct:$>0?I.blackWins/$*100:0}}var de=Mf(),Se=et(de),oe=S(w(Se),2),Ce=S(w(oe),2);let xe;Ce.__click=()=>W("games");var z=w(Ce),ve=S(Ce,2);let Ne;ve.__click=()=>W("eval");var $e=w(ve),Pe=S(ve,2);let Qe;Pe.__click=()=>W("perf");var Oe=w(Pe),it=S(Se,2),dt=w(it);dt.__click=()=>es(Math.max(0,Te.index-1));var Vt=S(dt,2);Vt.__click=()=>es(0);var cs=S(Vt,2),Ls=w(cs),ys=S(it,2),us=w(ys);{var Rt=I=>{var $=gf();T(I,$)},fs=I=>{var $=Hs(),pe=et($);{var ge=ie=>{var ae=mf();T(ie,ae)},re=ie=>{var ae=If(),Be=et(ae),Fe=w(Be),Ue=S(Be,2);Ot(Ue,21,()=>a(r),Ge=>Ge.move,(Ge,me)=>{const Xe=he(()=>ke(a(me))),jt=he(()=>N(a(n),a(me).move)),Yt=he(()=>wn(a(n),a(me).move)),It=he(()=>vs.cache.get(a(Yt))),Mt=he(()=>a(p)===a(me).move),ks=he(()=>t()===a(me).move||a(d)===a(me).move);var Ke=Af(),Ee=et(Ke);let bt;Ee.__click=()=>ue(a(me).move);var M=w(Ee),te=w(M),le=S(M,2),je=w(le),wt=S(le,2);{var ft=qe=>{var y=_f();let P;var k=w(y);Q((K,X)=>{P=_e(y,1,"eval-badge svelte-1wi8bi9",null,P,K),R(k,X)},[()=>({positive:!Gr(a(It).eval),negative:Gr(a(It).eval)}),()=>Di(a(It).eval)]),T(qe,y)},Qt=qe=>{var y=bf();T(qe,y)};we(wt,qe=>{a(It)?qe(ft):qe(Qt,!1)})}var hs=S(wt,2),Nt=w(hs),Es=w(Nt),vt=S(Nt,2),m=w(vt),$t=S(vt,2),at=w($t),He=S(hs,2),A=w(He),Ft=S(He,2);Ft.__click=qe=>{qe.stopPropagation(),Re(a(me).move,a(me).gameIds)};var We=w(Ft),yt=S(Ee,2);{var Vs=qe=>{var y=qf(),P=w(y);{var k=X=>{var V=wf();T(X,V)},K=X=>{var V=Hs(),ne=et(V);{var Ze=Bt=>{var Ae=yf();T(Bt,Ae)},Tt=Bt=>{var Ae=Pf(),Je=et(Ae),Ss=S(w(Je),2);Ot(Ss,16,()=>["date","result","elo"],Ps,(Pt,ze)=>{var Lt=kf();let ss;Lt.__click=()=>Y(ze);var Ds=w(Lt);Q(tt=>{ss=_e(Lt,1,"sort-btn game-sort-btn svelte-1wi8bi9",null,ss,{active:ze===a(q)}),R(Ds,tt)},[()=>ye(ze)]),T(Pt,Lt)});var Cr=S(Je,2);Ot(Cr,21,()=>a(E)?a(f):a(f).slice(0,100),Pt=>Pt.gameId,(Pt,ze)=>{var Lt=Cf();Lt.__click=()=>window.open(a(ze).url,"_blank");var ss=w(Lt),Ds=w(ss);{var tt=pt=>{var qt=Ef(),fr=w(qt);Q(()=>R(fr,a(ze).whiteName)),T(pt,qt)},v=pt=>{var qt=ar();Q(()=>R(qt,a(ze).whiteName)),T(pt,qt)};we(Ds,pt=>{a(ze).result==="1-0"?pt(tt):pt(v,!1)})}var _=S(Ds),b=S(_);{var H=pt=>{var qt=Sf(),fr=w(qt);Q(()=>R(fr,a(ze).blackName)),T(pt,qt)},O=pt=>{var qt=ar();Q(()=>R(qt,a(ze).blackName)),T(pt,qt)};we(b,pt=>{a(ze).result==="0-1"?pt(H):pt(O,!1)})}var G=S(b),st=S(ss,2),Ut=w(st),ur=S(st,2),Vr=w(ur);Q(pt=>{R(_,` (${a(ze).whiteRating??""}) vs `),R(G,` (${a(ze).blackRating??""})`),R(Ut,a(ze).result==="1/2-1/2"?"Â½-Â½":a(ze).result),R(Vr,pt)},[()=>new Date(a(ze).date).toLocaleDateString()]),T(Pt,Lt)});var zr=S(Cr,2);{var cr=Pt=>{var ze=xf();ze.__click=()=>{h(E,!0)};var Lt=w(ze);Q(ss=>R(Lt,`Show all ${ss??""} games`),[()=>a(f).length.toLocaleString()]),T(Pt,ze)};we(zr,Pt=>{!a(E)&&a(f).length>100&&Pt(cr)})}T(Bt,Ae)};we(ne,Bt=>{a(f).length===0?Bt(Ze):Bt(Tt,!1)},!0)}T(X,V)};we(P,X=>{a(g)?X(k):X(K,!1)})}T(qe,y)};we(yt,qe=>{a(Mt)&&qe(Vs)})}Q((qe,y)=>{bt=_e(Ee,1,"cont-row svelte-1wi8bi9",null,bt,{expanded:a(Mt),hover:a(ks)}),R(te,qe),R(je,a(jt)),Gs(Nt,`width: ${a(Xe).wPct??""}%`),R(Es,a(me).whiteWins>0&&a(Xe).wPct>15?a(me).whiteWins:""),Gs(vt,`width: ${a(Xe).dPct??""}%`),R(m,a(me).draws>0&&a(Xe).dPct>10?a(me).draws:""),Gs($t,`width: ${a(Xe).bPct??""}%`),R(at,a(me).blackWins>0&&a(Xe).bPct>15?a(me).blackWins:""),R(A,y),R(We,a(Mt)?"Hide games":"Show games")},[()=>a(me).gameCount.toLocaleString(),()=>a(me).performanceRating>0?`PR: ${Math.round(a(me).performanceRating)}`:"PR: â"]),Ks("mouseenter",Ee,()=>{h(d,a(me).move,!0)}),Ks("mouseleave",Ee,()=>{h(d,null)}),T(Ge,Ke)}),Q(Ge=>R(Fe,`${Ge??""} games`),[()=>a(x).toLocaleString()]),T(ie,ae)};we(pe,ie=>{a(r).length===0?ie(ge):ie(re,!1)},!0)}T(I,$)};we(us,I=>{a(i)?I(Rt):I(fs,!1)})}Q((I,$,pe)=>{xe=_e(Ce,1,"sort-btn svelte-1wi8bi9",null,xe,{active:a(l)==="games"}),R(z,I),Ne=_e(ve,1,"sort-btn svelte-1wi8bi9",null,Ne,{active:a(l)==="eval"}),ve.disabled=vs.continuationFensLeft>0,R($e,$),Qe=_e(Pe,1,"sort-btn svelte-1wi8bi9",null,Qe,{active:a(l)==="perf"}),R(Oe,pe)},[()=>ce("games",a(l),a(c)),()=>ce("eval",a(l),a(c)),()=>ce("perf",a(l),a(c))]),gc(Ls,()=>a(u),I=>h(u,I)),T(s,de),Is()}pn(["click"]);var Lf=F("<div> </div>"),Df=F('<div class="mini-board svelte-tgw8do"></div>');function Of(s,e){As(e,!0);const t={K:"â",Q:"â",R:"â",B:"â",N:"â",P:"â",k:"â",q:"â",r:"â",b:"â",n:"â",p:"â"};let r=is(e,"size",3,160);const n=he(()=>{const l=[],c=e.placement.split("/");for(let u=0;u<8;u++){const d=c[u]||"";let p=0;for(const f of d)if(f>="1"&&f<="8")for(let g=0;g<parseInt(f);g++)l.push({light:(u+p)%2===1,piece:""}),p++;else l.push({light:(u+p)%2===1,piece:t[f]||""}),p++;for(;p<8;)l.push({light:(u+p)%2===1,piece:""}),p++}return l});var i=Df();let o;Ot(i,21,()=>a(n),Ps,(l,c)=>{var u=Lf();let d;var p=w(u);Q(()=>{d=_e(u,1,"mini-square svelte-tgw8do",null,d,{light:a(c).light,dark:!a(c).light}),R(p,a(c).piece)}),T(l,u)}),Q(()=>o=Gs(i,"",o,{width:`${r()??""}px`,height:`${r()??""}px`})),T(s,i),Is()}var Rf=F("<button> </button>"),Nf=F("<button> </button>"),$f=F('<div class="search-empty svelte-1goeqgu">Place pieces on the board to search</div>'),Ff=F('<div class="search-loading svelte-1goeqgu">Searching...</div>'),Bf=F('<div class="search-empty svelte-1goeqgu">No games found</div>'),Uf=F("<button> </button>"),Gf=F('<div class="eval-sort-overlay svelte-1goeqgu"><div class="eval-sort-progress svelte-1goeqgu"> <button class="eval-sort-cancel svelte-1goeqgu">Cancel</button></div></div>'),Kf=F("<span> </span>"),Hf=F('<span class="eval-badge eval-pending svelte-1goeqgu"><span class="eval-spinner svelte-1goeqgu">â¿</span></span>'),Wf=F("<strong> </strong>"),zf=F("<strong> </strong>"),Vf=F('<div class="result-row svelte-1goeqgu"><!> <!> <div class="result-info svelte-1goeqgu"><div class="result-players svelte-1goeqgu"><!> <!> </div> <div class="result-meta svelte-1goeqgu"> </div> <div class="result-actions svelte-1goeqgu"><button class="result-show-btn svelte-1goeqgu">Show on main board</button> <a class="result-link svelte-1goeqgu" target="_blank"> </a></div></div></div>'),jf=F('<div class="scroll-sentinel svelte-1goeqgu" id="search-sentinel"></div>'),Yf=F('<div class="search-results-header svelte-1goeqgu"><div class="search-count svelte-1goeqgu"> </div></div> <div class="sort-controls svelte-1goeqgu"><span class="sort-label svelte-1goeqgu">Sort:</span> <!> <button>Eval</button></div> <div class="result-list-wrapper svelte-1goeqgu"><!> <div class="result-list svelte-1goeqgu"><!> <!></div></div>',1),Qf=F('<div><div class="piece-palette white-palette svelte-1goeqgu"><button></button> <!> <button></button> <button></button></div> <div class="editor-board-wrap svelte-1goeqgu"><!></div> <div class="piece-palette black-palette svelte-1goeqgu"><button></button> <!> <button></button> <button></button></div></div> <div class="editor-controls svelte-1goeqgu"><button class="editor-btn svelte-1goeqgu">Clear</button> <button class="editor-btn svelte-1goeqgu">From Current</button> <button class="editor-btn svelte-1goeqgu">Flip Board</button></div> <div class="resize-handle svelte-1goeqgu"><div class="resize-grip svelte-1goeqgu"></div></div> <div class="search-results svelte-1goeqgu"><!></div>',1);function Xf(s,e){As(e,!0);let t=is(e,"platformLabel",3,"");const r={K:"â",Q:"â",R:"â",B:"â",N:"â",P:"â",k:"â",q:"â",r:"â",b:"â",n:"â",p:"â"},n=["K","Q","R","B","N","P"],i=["k","q","r","b","n","p"];let o=D(ut(new Map)),l=D(null),c=null,u=!1;const d="posSearchBoardWidth",p=150;let g=D(420),E=D(void 0);Br(()=>{const y=localStorage.getItem(d);if(y){const P=Number(y);P>=p&&h(g,P,!0)}});function q(){let y=a(E)?.parentElement??null;for(;y;){if(y.offsetWidth>0)return y.offsetWidth;y=y.parentElement}return 600}function C(y){if(!a(E))return;y.preventDefault();const P=y.clientY,k=a(g),K=a(E),X=q();function V(Tt){return Math.max(p,Math.min(X,k+Tt))}function ne(Tt){const Bt=V(Tt.clientY-P);K.style.width=Bt+"px"}function Ze(Tt){document.removeEventListener("mousemove",ne),document.removeEventListener("mouseup",Ze),h(g,V(Tt.clientY-P),!0),localStorage.setItem(d,String(a(g)))}document.addEventListener("mousemove",ne),document.addEventListener("mouseup",Ze)}let N=0,j=D(!1),x=D(null),L=D(ut([])),B=D("date"),J=D(!1),ee=D(50),W=null,ce=null,ue=D(null),Me=null;const Re=he(()=>Ne(a(o))),Y=he(()=>{const y=[];for(const[P,k]of a(o))k==="X"&&y.push({square:P});return y}),ye=he(()=>a(l)===null?"free":"none");function ke(y){!c||c.style.display==="none"||(c.style.left=`${y.clientX+12}px`,c.style.top=`${y.clientY+12}px`)}function de(y){c||(c=document.createElement("div"),c.className="ghost-cursor",c.style.cssText="position:fixed;pointer-events:none;font-size:28px;z-index:10000;opacity:0.7;display:none;",document.body.appendChild(c)),c.textContent=y,c.style.display=u?"block":"none"}function Se(){c&&(c.style.display="none")}function oe(){u=!0,c&&a(l)!==null&&(c.style.display="block")}function Ce(){u=!1,Se()}Br(()=>{document.addEventListener("mousemove",ke)}),uo(()=>{document.removeEventListener("mousemove",ke),c&&(c.remove(),c=null),ce!==null&&clearTimeout(ce),Me!==null&&clearTimeout(Me),W&&(W.disconnect(),W=null)});function xe(y){h(l,y,!0),y===null?Se():de(y==="trash"?"ðï¸":y==="X"?"â":r[y]||y)}function z(y){if(a(l)===null)return;const P=new Map(a(o));a(l)==="trash"?P.delete(y):a(l)==="X"?P.set(y,"X"):P.set(y,a(l)),h(o,P,!0),Qe()}function ve(y,P,k){const K=new Map(a(o));K.delete(y),K.set(P,k),h(o,K,!0),Qe()}function Ne(y){const P=Array.from({length:8},()=>Array(8).fill(""));for(const[K,X]of y){if(X==="X")continue;const V=K.charCodeAt(0)-97,ne=parseInt(K[1])-1;P[ne][V]=X}const k=[];for(let K=7;K>=0;K--){let X="",V=0;for(let ne=0;ne<8;ne++)P[K][ne]===""?V++:(V>0&&(X+=V,V=0),X+=P[K][ne]);V>0&&(X+=V),k.push(X)}return k.join("/")+" w - - 0 1"}function $e(){h(o,new Map,!0),Qe()}function Pe(){const y=new Map,K=Te.fen.split(" ")[0].split("/");for(let X=0;X<8;X++){const V=7-X;let ne=0;for(const Ze of K[X])if(Ze>="1"&&Ze<="8")ne+=parseInt(Ze);else{const Tt=String.fromCharCode(97+ne)+(V+1);y.set(Tt,Ze),ne++}}h(o,y,!0),Qe()}function Qe(){ce!==null&&clearTimeout(ce),ce=setTimeout(()=>{ce=null,Oe()},300)}ct(()=>(Ie.playerColor,Ie.timeControl,or(()=>a(o).size)>0&&Qe(),()=>{ce!==null&&(clearTimeout(ce),ce=null)}));async function Oe(){if(a(o).size===0){h(x,null),h(L,[],!0),h(j,!1);return}const y=++N;h(j,!0),h(ee,50);try{const P={};for(const[X,V]of a(o))P[X]=V;const k=Ie.playerContext,K=await xc(k.username,k.platform,k.since,k.until,{pieces:P},Ie.playerColor,Ie.timeControl);if(y!==N)return;if(h(x,K,!0),K.gameIds.length>0){const X=await vo(k.username,k.platform,K.gameIds);if(y!==N)return;const V=new Map(X.map(ne=>[ne.gameId,ne]));h(L,it(K.gameIds.map(ne=>V.get(ne)).filter(Boolean),a(B),a(J)),!0)}else h(L,[],!0);h(j,!1)}catch(P){if(y!==N)return;h(j,!1),h(x,null),h(L,[],!0),console.error("searchByPosition failed:",P)}}function it(y,P,k){if(P==="eval")return y;const K=[...y],X=k?1:-1;if(P==="result"){const V={"1-0":0,"1/2-1/2":1,"0-1":2};K.sort((ne,Ze)=>X*((V[ne.result]??3)-(V[Ze.result]??3)))}else if(P==="elo"){const V=ne=>ne.playerColor==="white"?ne.blackRating:ne.whiteRating;K.sort((ne,Ze)=>X*(V(ne)-V(Ze)))}else K.sort((V,ne)=>X*(V.date-ne.date));return K}function dt(y){y===a(B)?h(J,!a(J)):(h(B,y,!0),h(J,!1)),h(L,it(a(L),a(B),a(J)),!0),h(ee,50)}function Vt(y){const k={date:"Date",result:"Result",elo:"Opp Elo"}[y]||y;return y===a(B)?`${k} ${a(J)?"â²":"â¼"}`:k}async function cs(y,P){try{const k=Ie.playerContext,K=await po(k.username,k.platform,[y]);if(K.length===0){console.error("No moves found for game",y);return}bo(K[0].moves,P)}catch(k){console.error("getGamesMoves failed:",k)}}function Ls(){W&&(W.disconnect(),W=null);const y=document.getElementById("search-sentinel");y&&(W=new IntersectionObserver(P=>{for(const k of P)k.isIntersecting&&a(ee)<a(L).length&&h(ee,a(ee)+50)},{threshold:.1}),W.observe(y))}ct(()=>(a(L).length>0&&a(ee)<a(L).length&&queueMicrotask(()=>Ls()),()=>{W&&(W.disconnect(),W=null)}));function ys(y){let P=y.parentElement;for(;P;){const k=getComputedStyle(P).overflowY;if(k==="auto"||k==="scroll")return P;P=P.parentElement}return null}function us(){Me===null&&(Me=setTimeout(()=>{Me=null,Rt()},200))}ct(()=>{const y=a(ue);if(!y)return;const P=ys(y);if(P)return P.addEventListener("scroll",us),()=>{P.removeEventListener("scroll",us)}});function Rt(){if(!a(ue)||!a(x)||a(I).length===0)return;const y=a(ue).querySelectorAll(".result-row"),P=[];for(const k of y){const K=k.getBoundingClientRect();if(K.bottom>0&&K.top<window.innerHeight){const X=k.dataset.gameId;if(X){const V=a($).get(Number(X));V&&P.push(V)}}}P.length>0&&vf("position_search",P)}const fs=he(()=>{if(a(L).length===0)return 0;const y=[];let P=0;for(const k of a(L)){const K=k.playerColor==="white"?k.blackRating:k.whiteRating;y.push(K),k.result==="1-0"?P+=k.playerColor==="white"?1:0:k.result==="0-1"?P+=k.playerColor==="black"?1:0:P+=.5}return Math.round(Jc(y,P))}),I=he(()=>a(L).slice(0,a(ee))),$=he(()=>{if(!a(x))return new Map;const y=a(x),P=new Map;return y.gameIds.forEach((k,K)=>P.set(k,y.fens[K])),P});ct(()=>{if(!a(x)||a(L).length===0)return;const y=a(L).slice(0,a(ee)),P=a(L).slice(a(ee)),k=[...y,...P].map(K=>a($).get(K.gameId)).filter(K=>K!=null);qo("position_search",k)});let pe=D(!1),ge=null,re=D(0);function ie(y){return y.eval.type==="cp"?y.eval.pawns:y.eval.moves>0?1e4-y.eval.moves:-1e4-y.eval.moves}function ae(y){const P=[...y];return P.sort((k,K)=>{const X=a($).get(k.gameId),V=a($).get(K.gameId),ne=X?vs.cache.get(X):void 0,Ze=V?vs.cache.get(V):void 0;return!ne&&!Ze?0:ne?Ze?ie(Ze)-ie(ne):-1:1}),P}function Be(){vs.posSearchFensLeft===0?(h(L,ae(a(L)),!0),h(B,"eval"),h(J,!1),h(ee,50)):(h(pe,!0),ge=[...a(L)],h(re,a(L).length,!0))}function Fe(){h(pe,!1),ge&&(h(L,ge,!0),ge=null)}ct(()=>{a(pe)&&vs.posSearchFensLeft===0&&(h(L,ae(a(L)),!0),h(B,"eval"),h(J,!1),h(ee,50),h(pe,!1),ge=null)});function Ue(y){if(!a(x))return"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";const P=a(x).gameIds.indexOf(y.gameId);return P===-1?"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR":a(x).fens[P].split(" ")[0]}function Ge(y){if(!a(x))return 0;const P=a(x).gameIds.indexOf(y.gameId);return P!==-1?a(x).plys[P]:0}var me=Qf(),Xe=et(me);let jt,Yt;var It=w(Xe),Mt=w(It);let ks;Mt.__mousedown=y=>{y.preventDefault(),xe(null)},Mt.textContent="â";var Ke=S(Mt,2);Ot(Ke,17,()=>n,Ps,(y,P)=>{var k=Rf();let K;k.__mousedown=V=>{V.preventDefault(),xe(a(P))};var X=w(k);Q(()=>{K=_e(k,1,"palette-piece svelte-1goeqgu",null,K,{active:a(l)===a(P)}),R(X,r[a(P)])}),T(y,k)});var Ee=S(Ke,2);let bt;Ee.__mousedown=y=>{y.preventDefault(),xe("X")},Ee.textContent="â";var M=S(Ee,2);let te;M.__mousedown=y=>{y.preventDefault(),xe("trash")},M.textContent="ðï¸";var le=S(It,2),je=w(le);_o(je,{get fen(){return a(Re)},get orientation(){return Ie.boardOrientation},get inputMode(){return a(ye)},get markers(){return a(Y)},showCoordinates:!1,onSquareClick:z,onFreeDrop:ve});var wt=S(le,2),ft=w(wt);let Qt;ft.__mousedown=y=>{y.preventDefault(),xe(null)},ft.textContent="â";var hs=S(ft,2);Ot(hs,17,()=>i,Ps,(y,P)=>{var k=Nf();let K;k.__mousedown=V=>{V.preventDefault(),xe(a(P))};var X=w(k);Q(()=>{K=_e(k,1,"palette-piece svelte-1goeqgu",null,K,{active:a(l)===a(P)}),R(X,r[a(P)])}),T(y,k)});var Nt=S(hs,2);let Es;Nt.__mousedown=y=>{y.preventDefault(),xe("X")},Nt.textContent="â";var vt=S(Nt,2);let m;vt.__mousedown=y=>{y.preventDefault(),xe("trash")},vt.textContent="ðï¸",Tn(Xe,y=>h(E,y),()=>a(E));var $t=S(Xe,2),at=w($t);at.__click=$e;var He=S(at,2);He.__click=Pe;var A=S(He,2);A.__click=function(...y){yi?.apply(this,y)};var Ft=S($t,2);Ft.__mousedown=C;var We=S(Ft,2),yt=w(We);{var Vs=y=>{var P=$f();T(y,P)},qe=y=>{var P=Hs(),k=et(P);{var K=V=>{var ne=Ff();T(V,ne)},X=V=>{var ne=Hs(),Ze=et(ne);{var Tt=Ae=>{var Je=Bf();T(Ae,Je)},Bt=Ae=>{var Je=Yf(),Ss=et(Je),Cr=w(Ss),zr=w(Cr),cr=S(Ss,2),Pt=S(w(cr),2);Ot(Pt,16,()=>["date","result","elo"],Ps,(O,G)=>{var st=Uf();let Ut;st.__click=()=>dt(G);var ur=w(st);Q(Vr=>{Ut=_e(st,1,"sort-btn search-sort-btn svelte-1goeqgu",null,Ut,{active:G===a(B)}),R(ur,Vr)},[()=>Vt(G)]),T(O,st)});var ze=S(Pt,2);let Lt;ze.__click=Be;var ss=S(cr,2),Ds=w(ss);{var tt=O=>{var G=Gf(),st=w(G),Ut=w(st),ur=S(Ut);ur.__click=Fe,Q(()=>R(Ut,`Evaluating positions: ${a(re)-vs.posSearchFensLeft} of ${a(re)??""} `)),T(O,G)};we(Ds,O=>{a(pe)&&vs.posSearchFensLeft>0&&O(tt)})}var v=S(Ds,2),_=w(v);Ot(_,17,()=>a(I),O=>O.gameId,(O,G)=>{const st=he(()=>Ge(a(G))),Ut=he(()=>Math.floor(a(st)/2)+1),ur=he(()=>a(st)%2===1?"...":""),Vr=he(()=>a(G).result==="1/2-1/2"?"Â½-Â½":a(G).result),pt=he(()=>a($).get(a(G).gameId)),qt=he(()=>a(pt)?vs.cache.get(a(pt)):void 0);var fr=Vf(),Ui=w(fr);{let Ye=he(()=>Ue(a(G)));Of(Ui,{get placement(){return a(Ye)}})}var Gi=S(Ui,2);{var Ao=Ye=>{var kt=Kf();let xr;var Bo=w(kt);Q((Uo,Go)=>{xr=_e(kt,1,"eval-badge svelte-1goeqgu",null,xr,Uo),R(Bo,Go)},[()=>({positive:!Gr(a(qt).eval),negative:Gr(a(qt).eval)}),()=>Di(a(qt).eval)]),T(Ye,kt)},Io=Ye=>{var kt=Hf();T(Ye,kt)};we(Gi,Ye=>{a(qt)?Ye(Ao):Ye(Io,!1)})}var Mo=S(Gi,2),Ki=w(Mo),Hi=w(Ki);{var To=Ye=>{var kt=Wf(),xr=w(kt);Q(()=>R(xr,a(G).whiteName)),T(Ye,kt)},Lo=Ye=>{var kt=ar();Q(()=>R(kt,a(G).whiteName)),T(Ye,kt)};we(Hi,Ye=>{a(G).result==="1-0"?Ye(To):Ye(Lo,!1)})}var Wi=S(Hi),zi=S(Wi);{var Do=Ye=>{var kt=zf(),xr=w(kt);Q(()=>R(xr,a(G).blackName)),T(Ye,kt)},Oo=Ye=>{var kt=ar();Q(()=>R(kt,a(G).blackName)),T(Ye,kt)};we(zi,Ye=>{a(G).result==="0-1"?Ye(Do):Ye(Oo,!1)})}var Ro=S(zi),Vi=S(Ki,2),No=w(Vi),$o=S(Vi,2),ji=w($o);ji.__click=()=>cs(a(G).gameId,a(st));var Yi=S(ji,2),Fo=w(Yi);Q(Ye=>{Mn(fr,"data-game-id",a(G).gameId),R(Wi,` (${a(G).whiteRating??""}) vs `),R(Ro,` (${a(G).blackRating??""})`),R(No,`${Ye??""} Â· ${a(Vr)??""} Â· move ${a(Ut)??""}${a(ur)??""}`),Mn(Yi,"href",a(G).url),R(Fo,`View on ${t()??""}`)},[()=>new Date(a(G).date).toLocaleDateString()]),T(O,fr)});var b=S(_,2);{var H=O=>{var G=jf();T(O,G)};we(b,O=>{a(ee)<a(L).length&&O(H)})}Tn(v,O=>h(ue,O),()=>a(ue)),Q(O=>{R(zr,`Found in ${O??""} games ${a(fs)>0?`Â· PR: ${a(fs)}`:""}`),Lt=_e(ze,1,"sort-btn svelte-1goeqgu",null,Lt,{active:a(B)==="eval"})},[()=>a(x).gameIds.length.toLocaleString()]),T(Ae,Je)};we(Ze,Ae=>{!a(x)||a(x).gameIds.length===0?Ae(Tt):Ae(Bt,!1)},!0)}T(V,ne)};we(k,V=>{a(j)?V(K):V(X,!1)},!0)}T(y,P)};we(yt,y=>{a(o).size===0?y(Vs):y(qe,!1)})}Q(()=>{jt=_e(Xe,1,"editor-section svelte-1goeqgu",null,jt,{flipped:Ie.boardOrientation==="black"}),Yt=Gs(Xe,"",Yt,{width:`${a(g)??""}px`}),ks=_e(Mt,1,"palette-piece palette-tool svelte-1goeqgu",null,ks,{active:a(l)===null}),bt=_e(Ee,1,"palette-piece palette-tool svelte-1goeqgu",null,bt,{active:a(l)==="X"}),te=_e(M,1,"palette-piece palette-tool svelte-1goeqgu",null,te,{active:a(l)==="trash"}),Qt=_e(ft,1,"palette-piece palette-tool svelte-1goeqgu",null,Qt,{active:a(l)===null}),Es=_e(Nt,1,"palette-piece palette-tool svelte-1goeqgu",null,Es,{active:a(l)==="X"}),m=_e(vt,1,"palette-piece palette-tool svelte-1goeqgu",null,m,{active:a(l)==="trash"})}),Ks("mouseenter",Xe,oe),Ks("mouseleave",Xe,Ce),T(s,me),Is()}pn(["mousedown","click"]);var Zf=F("<option> </option>"),Jf=F('<div class="recent-games-empty svelte-9k08f">Loading...</div>'),eh=F('<div class="recent-games-empty svelte-9k08f">No games found</div>'),th=F("<strong> </strong>"),sh=F("<strong> </strong>"),rh=F('<button class="recent-game-row svelte-9k08f"><span></span> <span class="recent-game-players svelte-9k08f"><!> <!> </span> <span class="recent-game-result svelte-9k08f"> </span> <span class="recent-game-date svelte-9k08f"> </span></button>'),nh=F('<div class="recent-games-menu svelte-9k08f"><!></div>'),ih=F('<header class="workspace-header svelte-9k08f"><button class="ws-back-btn svelte-9k08f">&larr; Back</button> <div class="color-filter svelte-9k08f"><button> </button> <button> </button></div> <select class="tc-select svelte-9k08f"><option>All time controls</option><!></select> <div class="ws-player-info svelte-9k08f"><span class="ws-username svelte-9k08f"> </span> <span class="ws-meta svelte-9k08f"> </span> <span class="ws-date-range svelte-9k08f"> </span></div> <div><button class="recent-games-btn svelte-9k08f">Recent Games &#x25BE;</button> <!></div> <div class="mode-toggle svelte-9k08f"><button>Opening Explorer</button> <button>Partial Position Search</button></div> <button class="ws-gear-btn svelte-9k08f" title="Settings">&#9881;</button></header> <div class="workspace-columns svelte-9k08f"><div class="workspace-col col-board svelte-9k08f"><div class="board-with-eval svelte-9k08f"><!> <div class="main-board-wrap svelte-9k08f"><!></div></div> <div class="board-controls svelte-9k08f"><button class="board-btn svelte-9k08f">Flip Board</button> <button class="board-btn svelte-9k08f">Reset</button> <button class="board-btn svelte-9k08f">Open Analysis Board</button></div></div> <div class="workspace-col col-pgn svelte-9k08f"><!></div> <div class="workspace-col col-context svelte-9k08f"><div><!></div> <div><!></div></div></div>',1);function ah(s,e){As(e,!0);let t=D(ut([])),r=D(null),n=D(null),i=D(null);ct(()=>{const M=_r.lines[0]?.pvUci[0]??null;if(M===a(i))return;const te=setTimeout(()=>{h(i,M,!0)},150);return()=>clearTimeout(te)});const o=he(()=>a(n)?a(n):!a(i)||a(i).length<4?null:{from:a(i).slice(0,2),to:a(i).slice(2,4)}),l=he(()=>{if(!a(o))return[...a(t)];const M=a(o).from+a(o).to,te=a(t).findIndex(je=>je.from+je.to===M);if(te>=0)return a(t).map((je,wt)=>wt===te?{...je,engineHover:!0}:{...je});const le=[...a(t)];return le.push({...a(o),opacity:1,type:"info"}),le});Br(async()=>{const M=Ie.playerContext;if(M)try{const te=await qc(M.username,M.platform,M.since,M.until);ef(te)}catch(te){console.error("getAvailableTimeControls failed:",te)}}),Br(()=>($u().catch(M=>console.error("Engine init failed:",M)),hf().catch(M=>console.error("Eval queue init failed:",M)),()=>{Bu(),df()})),ct(()=>{const M=Te.moves,te=Te.index;_r.ready&&(Fu(M.slice(0,te)),h(n,null),h(i,null))}),ct(()=>{pf(Ie.activeMode==="explorer"?"continuation":"position_search")});function c(M,te,le){return Ri(M,te,le)}function u(M){if(M===null){h(r,null);return}h(r,M,!0)}function d(M){h(t,M,!0)}function p(M){if(!M){h(n,null);return}h(n,{from:M.slice(0,2),to:M.slice(2,4)},!0)}function f(M){const te=M.target?.tagName;if(!(te==="INPUT"||te==="TEXTAREA"||te==="SELECT")&&!a(N))switch(M.key){case"x":case"X":yi();break;case"ArrowLeft":M.preventDefault(),es(Te.index-1);break;case"ArrowRight":M.preventDefault(),es(Te.index+1);break;case"Home":M.preventDefault(),es(0);break;case"End":M.preventDefault(),es(Te.moves.length);break}}function g(){const M=Te.sanList;let te="";for(let le=0;le<M.length;le++)le%2===0?(le>0&&(te+=" "),te+=`${Math.floor(le/2)+1}. ${M[le]}`):te+=` ${M[le]}`;te&&window.open(`https://lichess.org/analysis/pgn/${encodeURIComponent(te)}`,"_blank")}const E=he(()=>Ie.playerContext),q=he(()=>a(E)?.platform==="lichess"?"Lichess":"Chess.com"),C=he(()=>a(E)?`${Mr(a(E).since)} â ${Mr(a(E).until)}`:"");let N=D(!1),j=D(ut([])),x=D(!1),L=0;ct(()=>{const M=Ie.playerContext,te=Ie.timeControl;if(!M)return;const le=++L;h(x,!0),Pc(M.username,M.platform,M.since,M.until,te,100).then(je=>{le===L&&(h(j,je,!0),h(x,!1))}).catch(je=>{le===L&&(console.error("getRecentGames failed:",je),h(j,[],!0),h(x,!1))})});function B(){h(N,!a(N))}function J(){h(N,!1)}async function ee(M){h(N,!1);const te=Ie.playerContext;if(te)try{const le=await po(te.username,te.platform,[M.gameId]);le.length>0&&(bo(le[0].moves,Math.min(1,le[0].moves.length)),ai(M.playerColor),Zu(M.playerColor))}catch(le){console.error("Failed to load game moves:",le)}}var W=ih();Ks("keydown",rn,f),Ks("click",rn,J);var ce=et(W),ue=w(ce);ue.__click=function(...M){e.onBack?.apply(this,M)};var Me=S(ue,2),Re=w(Me);let Y;Re.__click=()=>ai("white");var ye=w(Re),ke=S(Re,2);let de;ke.__click=()=>ai("black");var Se=w(ke),oe=S(Me,2);oe.__change=M=>Ju(M.target.value||null);var Ce=w(oe);Ce.value=Ce.__value="";var xe=S(Ce);Ot(xe,17,()=>Ie.availableTimeControls,Ps,(M,te)=>{var le=Zf(),je=w(le),wt={};Q(()=>{R(je,a(te)),wt!==(wt=a(te))&&(le.value=(le.__value=a(te))??"")}),T(M,le)});var z;fc(oe);var ve=S(oe,2),Ne=w(ve),$e=w(Ne),Pe=S(Ne,2),Qe=w(Pe),Oe=S(Pe,2),it=w(Oe),dt=S(ve,2);let Vt;dt.__click=M=>M.stopPropagation();var cs=w(dt);cs.__click=B;var Ls=S(cs,2);{var ys=M=>{var te=nh(),le=w(te);{var je=ft=>{var Qt=Jf();T(ft,Qt)},wt=ft=>{var Qt=Hs(),hs=et(Qt);{var Nt=vt=>{var m=eh();T(vt,m)},Es=vt=>{var m=Hs(),$t=et(m);Ot($t,17,()=>a(j),at=>at.gameId,(at,He)=>{var A=rh();A.__click=()=>ee(a(He));var Ft=w(A);let We;var yt=S(Ft,2),Vs=w(yt);{var qe=Ae=>{var Je=th(),Ss=w(Je);Q(()=>R(Ss,a(He).whiteName)),T(Ae,Je)},y=Ae=>{var Je=ar();Q(()=>R(Je,a(He).whiteName)),T(Ae,Je)};we(Vs,Ae=>{a(He).result==="1-0"?Ae(qe):Ae(y,!1)})}var P=S(Vs),k=S(P);{var K=Ae=>{var Je=sh(),Ss=w(Je);Q(()=>R(Ss,a(He).blackName)),T(Ae,Je)},X=Ae=>{var Je=ar();Q(()=>R(Je,a(He).blackName)),T(Ae,Je)};we(k,Ae=>{a(He).result==="0-1"?Ae(K):Ae(X,!1)})}var V=S(k),ne=S(yt,2),Ze=w(ne),Tt=S(ne,2),Bt=w(Tt);Q(Ae=>{We=_e(Ft,1,"recent-game-color svelte-9k08f",null,We,{white:a(He).playerColor==="white",black:a(He).playerColor==="black"}),R(P,` (${a(He).whiteRating??""}) vs `),R(V,` (${a(He).blackRating??""})`),R(Ze,a(He).result==="1/2-1/2"?"Â½-Â½":a(He).result),R(Bt,Ae)},[()=>new Date(a(He).date).toLocaleDateString()]),T(at,A)}),T(vt,m)};we(hs,vt=>{a(j).length===0?vt(Nt):vt(Es,!1)},!0)}T(ft,Qt)};we(le,ft=>{a(x)?ft(je):ft(wt,!1)})}T(M,te)};we(Ls,M=>{a(N)&&M(ys)})}var us=S(dt,2),Rt=w(us);let fs;Rt.__click=()=>ma("explorer");var I=S(Rt,2);let $;I.__click=()=>ma("search");var pe=S(ce,2),ge=w(pe),re=w(ge),ie=w(re);Au(ie,{get evaluation(){return _r.eval},get orientation(){return Ie.boardOrientation}});var ae=S(ie,2),Be=w(ae);_o(Be,{get fen(){return Te.fen},get orientation(){return Ie.boardOrientation},get arrows(){return a(l)},inputMode:"legal",onMove:c,onArrowHover:u});var Fe=S(re,2),Ue=w(Fe);Ue.__click=function(...M){yi?.apply(this,M)};var Ge=S(Ue,2);Ge.__click=function(...M){bi?.apply(this,M)};var me=S(Ge,2);me.__click=g;var Xe=S(ge,2),jt=w(Xe);Yu(jt,{onEngineLineHover:p});var Yt=S(Xe,2),It=w(Yt);let Mt;var ks=w(It);Tf(ks,{onArrowsChanged:d,get highlightedArrowUci(){return a(r)}});var Ke=S(It,2);let Ee;var bt=w(Ke);Xf(bt,{get platformLabel(){return a(q)}}),Q(M=>{Y=_e(Re,1,"color-btn svelte-9k08f",null,Y,{active:Ie.playerColor==="white"}),R(ye,`${a(E)?.username??""} as White`),de=_e(ke,1,"color-btn svelte-9k08f",null,de,{active:Ie.playerColor==="black"}),R(Se,`${a(E)?.username??""} as Black`),z!==(z=Ie.timeControl??"")&&(oe.value=(oe.__value=Ie.timeControl??"")??"",co(oe,Ie.timeControl??"")),R($e,a(E)?.username),R(Qe,`Â· ${M??""} games`),R(it,a(C)),Vt=_e(dt,1,"recent-games-dropdown svelte-9k08f",null,Vt,{open:a(N)}),fs=_e(Rt,1,"mode-btn svelte-9k08f",null,fs,{active:Ie.activeMode==="explorer"}),$=_e(I,1,"mode-btn svelte-9k08f",null,$,{active:Ie.activeMode==="search"}),Mt=Gs(It,"",Mt,{display:Ie.activeMode==="explorer"?"contents":"none"}),Ee=Gs(Ke,"",Ee,{display:Ie.activeMode==="search"?"contents":"none"})},[()=>a(E)?.gameCount.toLocaleString()]),T(s,W),Is()}pn(["click","change"]);var oh=F("<!> <!>",1);function lh(s,e){As(e,!0);let t=D("setup"),r=D(ut([]));async function n(){try{h(r,await gi(),!0)}catch(g){console.error("Failed to load cached players:",g)}}n();function i(g){Qu(g),bi(),h(t,"workspace")}async function o(){Xu(),bi(),nf();try{h(r,await gi(),!0)}catch(g){console.error("Failed to refresh cached players:",g)}h(t,"setup")}function l(g){h(r,g,!0)}var c=oh(),u=et(c);{var d=g=>{fu(g,{get cachedPlayers(){return a(r)},onEnterWorkspace:i,onCachedPlayersChanged:l})},p=g=>{ah(g,{onBack:o})};we(u,g=>{a(t)==="setup"?g(d):g(p,!1)})}var f=S(u,2);Ou(f),T(s,c),Is()}yc();sc(lh,{target:document.getElementById("app")});
